import{J as K,r as b,I as z,c as M,q as J,aa as Q,o as c,b as T,d as t,i as o,u as a,a6 as V,ai as X,h as i,j as x,t as m,a3 as S,a1 as h,g as _,w as L,a2 as C,k as f,a7 as Y,a4 as Z,B as y,s as ee,U as F,p as le,m as ae,_ as oe}from"./index-e0d1eab6.js";const O=w=>(le("data-v-3b847427"),w=w(),ae(),w),te={class:"codes-container"},se=O(()=>t("h3",{class:"title"},[t("strong",null,"Códigos generados y redimidos para recolección de emails")],-1)),ie={class:"toolbar card"},ne={class:"left"},de={class:"p-input-icon-left"},re=O(()=>t("i",{class:"pi pi-search"},null,-1)),ue={class:"columns-toggle"},ce={class:"right"},pe={class:"table-wrapper card"},me={class:"cell-flex"},ve={class:"mono"},be={class:"truncate"},he={class:"cell-flex"},_e={class:"mono"},fe={class:"truncate"},ye={class:"cell-flex"},ge=["href"],Ve={key:1,class:"muted"},Ce=K({__name:"userEmail",setup(w){const R=b(),v=b([]),p=b(!1),I=b(!1),A=[{label:"Todos",value:null},{label:"Sí",value:!0},{label:"No",value:!1}],r=b({global:{value:null,matchMode:y.CONTAINS},code:{value:null,matchMode:y.CONTAINS},redimido:{value:null,matchMode:y.EQUALS},user_name:{value:null,matchMode:y.CONTAINS},user_phone:{value:null,matchMode:y.CONTAINS},user_address:{value:null,matchMode:y.CONTAINS},email:{value:null,matchMode:y.CONTAINS}}),k=b("");let N=null;z(k,l=>{N&&window.clearTimeout(N),N=window.setTimeout(()=>{r.value.global.value=l||null},300)});const E=[{field:"code",label:"Código"},{field:"redimido",label:"Redimido"},{field:"user_name",label:"Nombre"},{field:"user_phone",label:"Teléfono"},{field:"user_address",label:"Dirección"},{field:"email",label:"Email"}],U=b(E.map(l=>l.field));function g(l){return U.value.includes(l)}const B=M(()=>v.value.filter(l=>l.redimido).length),D=M(()=>v.value.filter(l=>!l.redimido).length);function W(l){return{redeemed:l.redimido,pending:!l.redimido}}const j=M(()=>r.value.global.value&&String(r.value.global.value).length>0||Object.entries(r.value).some(([n,u])=>n!=="global"&&(u==null?void 0:u.value))?"Sin resultados con los filtros aplicados.":"Aún no hay registros para mostrar.");async function P(){p.value=!0;try{v.value=await ee.get(`${F}/get-users-code-plain`)}finally{p.value=!1}}async function q(){I.value=!0;try{const l=await fetch(`${F}/get-users-code`,{method:"GET"});if(!l.ok)throw new Error("Error al descargar el archivo.");const n=await l.blob(),u=window.URL.createObjectURL(n),e=document.createElement("a");e.href=u,e.download="users-codes.xlsx",e.click(),window.URL.revokeObjectURL(u)}catch(l){console.error(l)}finally{I.value=!1}}function G(){var l,n;(n=(l=R.value)==null?void 0:l.exportCSV)==null||n.call(l)}function H(){k.value="",r.value.global.value=null,r.value.code.value=null,r.value.redimido.value=null,r.value.user_name.value=null,r.value.user_phone.value=null,r.value.user_address.value=null,r.value.email.value=null}async function $(l){try{await navigator.clipboard.writeText(l)}catch{console.warn("No se pudo copiar al portapapeles.")}}return J(P),(l,n)=>{const u=Q("tooltip");return c(),T("div",te,[se,t("div",ie,[t("div",ne,[t("span",de,[re,o(a(V),{modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=e=>k.value=e),placeholder:"Buscar en todos los campos…",class:"p-inputtext-sm",disabled:p.value,"aria-label":"Búsqueda global"},null,8,["modelValue","disabled"])]),t("div",ue,[o(a(X),{modelValue:U.value,"onUpdate:modelValue":n[1]||(n[1]=e=>U.value=e),options:E,optionLabel:"label",optionValue:"field",display:"chip",class:"p-inputtext-sm",maxSelectedLabels:3,placeholder:"Columnas",disabled:p.value},null,8,["modelValue","disabled"])])]),t("div",ce,[o(a(S),{severity:"info",class:"mx-1"},{default:i(()=>[x("Total: "),t("b",null,m(v.value.length),1)]),_:1}),o(a(S),{severity:"success",class:"mx-1"},{default:i(()=>[x("Redimidos: "),t("b",null,m(B.value),1)]),_:1}),o(a(S),{severity:"warning",class:"mx-1"},{default:i(()=>[x("Pendientes: "),t("b",null,m(D.value),1)]),_:1}),o(a(h),{label:"CSV",icon:"pi pi-table",class:"p-button-text p-button-sm mx-1",onClick:G,disabled:p.value||!v.value.length},null,8,["disabled"]),o(a(h),{label:"Excel",icon:"pi pi-download",class:"p-button-help p-button-sm mx-1",onClick:q,loading:I.value,disabled:p.value||!v.value.length},null,8,["loading","disabled"]),o(a(h),{label:"Limpiar filtros",icon:"pi pi-filter-slash",class:"p-button-secondary p-button-sm mx-1",onClick:H,disabled:p.value},null,8,["disabled"]),o(a(h),{label:"Recargar",icon:"pi pi-refresh",class:"p-button-sm mx-1",onClick:P,loading:p.value},null,8,["loading"])])]),t("div",pe,[o(a(Z),{ref_key:"dt",ref:R,filters:r.value,"onUpdate:filters":n[2]||(n[2]=e=>r.value=e),value:v.value,loading:p.value,paginator:"",rowHover:"",stripedRows:"",rows:20,rowsPerPageOptions:[15,20,30,50,100],responsiveLayout:"scroll",filterDisplay:"row",removableSort:"",sortMode:"multiple",dataKey:"code",showGridlines:"",scrollable:"",scrollHeight:"60vh",globalFilterFields:["code","user_name","user_phone","user_address","email"],stateStorage:"local",stateKey:"codes-table-state",rowClass:W,pt:{header:{style:"position: sticky; top: 0; z-index: 1;"}},currentPageReportTemplate:"{first} – {last} de {totalRecords}",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport",emptyMessage:j.value},{default:i(()=>[g("code")?(c(),_(a(C),{key:0,field:"code",header:"Código",sortable:"",filterMatchMode:"contains",class:"py-1",headerStyle:{minWidth:"12rem"}},{body:i(({data:e})=>[t("div",me,[t("span",ve,m(e.code),1),L(o(a(h),{icon:"pi pi-clipboard",class:"p-button-text p-button-rounded p-button-sm","aria-label":`Copiar código ${e.code}`,onClick:d=>$(e.code)},null,8,["aria-label","onClick"]),[[u,"Copiar",void 0,{top:!0}]])])]),filter:i(({filterModel:e,filterCallback:d})=>[o(a(V),{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,onInput:s=>d(),placeholder:"Filtrar",class:"p-column-filter",style:{width:"10rem"}},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1})):f("",!0),g("redimido")?(c(),_(a(C),{key:1,field:"redimido",header:"Redimido",sortable:"",dataType:"boolean",filterMatchMode:"equals",class:"py-1",headerStyle:{minWidth:"10rem"}},{body:i(({data:e})=>[o(a(S),{severity:e.redimido?"success":"secondary"},{default:i(()=>[x(m(e.redimido?"Sí":"No"),1)]),_:2},1032,["severity"])]),filter:i(({filterModel:e,filterCallback:d})=>[o(a(Y),{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,options:A,optionLabel:"label",optionValue:"value",placeholder:"Todos",class:"p-column-filter",onChange:s=>d(),style:{width:"8rem"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):f("",!0),g("user_name")?(c(),_(a(C),{key:2,field:"user_name",header:"Nombre",sortable:"",filterMatchMode:"contains",class:"py-1",headerStyle:{minWidth:"14rem"}},{body:i(({data:e})=>[t("span",be,m(e.user_name),1)]),filter:i(({filterModel:e,filterCallback:d})=>[o(a(V),{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,onInput:s=>d(),placeholder:"Filtrar",class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1})):f("",!0),g("user_phone")?(c(),_(a(C),{key:3,field:"user_phone",header:"Teléfono",sortable:"",filterMatchMode:"contains",class:"py-1",headerStyle:{minWidth:"12rem"}},{body:i(({data:e})=>[t("div",he,[t("span",_e,m(e.user_phone),1),L(o(a(h),{icon:"pi pi-clipboard",class:"p-button-text p-button-rounded p-button-sm","aria-label":`Copiar teléfono ${e.user_phone}`,onClick:d=>$(e.user_phone)},null,8,["aria-label","onClick"]),[[u,"Copiar",void 0,{top:!0}]])])]),filter:i(({filterModel:e,filterCallback:d})=>[o(a(V),{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,onInput:s=>d(),placeholder:"Filtrar",class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1})):f("",!0),g("user_address")?(c(),_(a(C),{key:4,field:"user_address",header:"Dirección",sortable:"",filterMatchMode:"contains",class:"py-1",headerStyle:{minWidth:"16rem"}},{body:i(({data:e})=>[t("span",fe,m(e.user_address),1)]),filter:i(({filterModel:e,filterCallback:d})=>[o(a(V),{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,onInput:s=>d(),placeholder:"Filtrar",class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1})):f("",!0),g("email")?(c(),_(a(C),{key:5,field:"email",header:"Email",sortable:"",filterMatchMode:"contains",class:"py-1",headerStyle:{minWidth:"18rem"}},{body:i(({data:e})=>[t("div",ye,[e.email?(c(),T("a",{key:0,href:`mailto:${e.email}`,class:"link"},m(e.email),9,ge)):(c(),T("span",Ve,"—")),e.email?L((c(),_(a(h),{key:2,icon:"pi pi-clipboard",class:"p-button-text p-button-rounded p-button-sm","aria-label":`Copiar email ${e.email}`,onClick:d=>$(e.email)},null,8,["aria-label","onClick"])),[[u,"Copiar",void 0,{top:!0}]]):f("",!0)])]),filter:i(({filterModel:e,filterCallback:d})=>[o(a(V),{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,onInput:s=>d(),placeholder:"Filtrar",class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1})):f("",!0)]),_:1},8,["filters","value","loading","emptyMessage"])])])}}});const ke=oe(Ce,[["__scopeId","data-v-3b847427"]]);export{ke as default};
