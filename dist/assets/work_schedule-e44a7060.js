import{_ as Ee,f as n,x as Ie,C as Ve,h as Oe,U as w,g as je,r as I,o as v,c as y,d as s,w as u,a as t,l as A,F as te,b as ae,k as V,t as p,n as Fe,a4 as We,y as re,a5 as Ne,p as Me,e as Be}from"./index-46a67493.js";import{u as de,f as ce,s as ue,e as pe,a as Re,b as me,c as ve,d as ye}from"./subMonths-2b0c8d2c.js";import{s as Ae}from"./siteService-24a2257b.js";import{l as He}from"./user-644c17c7.js";const m=H=>(Me("data-v-5a6fe013"),H=H(),Be(),H),qe={key:0},ze={key:0,class:"user-info",style:{display:"flex","flex-direction":"column","align-items":"center"}},Pe=["src"],Je={class:"col-12"},Ke=m(()=>t("b",null,"Nombre:",-1)),Ze=m(()=>t("b",null,"Cargo:",-1)),Ge=m(()=>t("b",null,"Telefono:",-1)),Qe=m(()=>t("b",null,"Contrato",-1)),Xe={class:""},Ye={class:"col-12 p-0 m-0"},et={class:"col-12 p-0 m-0"},tt={class:"col-12 p-0"},at={class:"col-12 p-0"},ot=m(()=>t("p",null,"Desde:",-1)),st=m(()=>t("p",null,"Hasta:",-1)),lt=m(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este día de trabajo y todos sus registros?")],-1)),nt=m(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este registro?")],-1)),it={style:{},class:"p-0 m-0"},rt=m(()=>t("h3",null,"Nuevo dia",-1)),dt={class:"col-12 p-0 m-0 mb-8"},ct={class:"grid p-0 mx-auto"},ut={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},pt={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},mt={class:"col-12 md:col-2 py-2",style:{display:"flex",height:"4rem","justify-content":"end"}},vt={class:"grid"},yt={class:"col-2 p-0",style:{height:"80vh","overflow-y":"auto"}},gt={class:"p-0 text-sm",style:{display:"flex","justify-content":"center"}},ft={style:{display:"flex",gap:"1rem","flex-direction":"column"},class:"pb-3 m-auto"},_t=["onDragstart"],ht=["onClick","src","onError"],wt={class:"my-0 py-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},bt={class:"my-0 py-0",style:{"min-width":"min-content","text-transform":"uppercase","text-align":"center"}},Dt={class:"col-10",style:{height:"80vh","overflow-y":"auto"}},kt={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},xt={class:"col-12 pb-6",style:{}},Ct={style:{display:"flex",gap:"0rem","flex-direction":"column"}},St={class:"py-0 px-4 text-center col-12 m-0 p-0 text",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},Tt={style:{"overflow-x":"auto"}},$t={style:{"min-width":"max-content"}},Lt=["onDrop"],Ut={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},Et=["onClick","src","onError"],It={key:0,class:"text-sm"},Vt={class:"py-0 my-0"},Ot={class:"py-0 my-0"},jt={key:1,class:"text-sm"},Ft={class:"py-0 my-0"},Wt=m(()=>t("p",{class:"py-0 my-0"},[t("b",{style:{color:"green"}},"DESCANSA")],-1)),Nt={class:"",style:{"text-transform":"uppercase"}},Mt=m(()=>t("p",null,"Hora de llegada:",-1)),Bt=m(()=>t("p",null,"Hora de salida:",-1)),Rt={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},At={__name:"work_schedule",setup(H){const q=n(!1),g=n(null),oe=o=>{g.value=o,q.value=!0},O=n(!1),f=n(new Date),b=n(new Date),z=He(),d=Ie(),j=n(!1),P=n(null),k=n(),F=n(),x=n(),C=n(),S=n(!1),_=n(null),W=n(null),T=n(new Date),$=n(new Date),se=Ve(()=>!x.value||!C.value?"":`${ce(x.value,"dd/MM/yyyy")} - ${ce(C.value,"dd/MM/yyyy")}`),ge=()=>{f.value=x.value||new Date,b.value=C.value||new Date,O.value=!0},fe=()=>{O.value=!1},N=()=>{x.value=f.value,C.value=b.value,O.value=!1,E()},X=()=>{const o=new Date;f.value=ue(o,{weekStartsOn:1}),b.value=pe(o,{weekStartsOn:1}),N()},_e=()=>{const o=ue(new Date,{weekStartsOn:1});f.value=Re(o,7),b.value=pe(f.value,{weekStartsOn:1}),N()},he=()=>{const o=new Date;f.value=me(o),b.value=ve(o),N()},we=()=>{const o=new Date;f.value=me(ye(o,1)),b.value=ve(ye(o,1)),N()},be=o=>{P.value=o,j.value=!0},De=async()=>{if(j.value=!1,d.setLoading(!0,"borrando"),!P.value)return;const o=await fetch(`${w}/work_records/${P.value}`,{method:"DELETE"});o.ok?(E(),d.setLoading(!1,"borrando")):(console.error("Error al eliminar el registro:",await o.text()),alert("Hubo un error al eliminar el registro."),d.setLoading(!1,"borrando")),P.value=null},M=n(!1),J=n(null),ke=o=>{J.value=o,M.value=!0},xe=async()=>{if(M.value=!1,!J.value)return;d.setLoading(!0,"borrando"),(await fetch(`${w}/work_days/${J.value}`,{method:"DELETE"})).ok?(Z.value=Z.value.filter(e=>e.id!==J.value),d.setLoading(!1,"borrando")):(alert("Hubo un error al eliminar el día de trabajo."),d.setLoading(!1,"borrando"))},Ce={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},Se=o=>{if(!(o instanceof Date))return console.error("getDayColor: date is not a Date object",o),"#FFFFFF";const e=o.toLocaleDateString("en-US",{weekday:"long"});return Ce[e]},K=n([]),Z=n([]),Y=(o,e)=>{const l={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},r=o==null?void 0:o.trim().toLowerCase();e.target.src=l[r]||l.default},L=n(null),U=n(!1),G=n(new Date);Oe(async()=>{F.value=await Ae.getSites(),k.value=F.value.filter(e=>e.site_id==z.rawUserData.site_id)[0],L.value=F.value.filter(e=>e.site_id==z.rawUserData.site_id)[0];const o=await de.getUsersBySiteId(z.rawUserData.site_id);K.value=o.filter(e=>e.status=="activo"),X(),E(),await fetch(`${w}/work_days_with_records`)}),je(k,async o=>{const e=await de.getUsersBySiteId(o.site_id);K.value=e.filter(l=>l.status=="activo"),L.value=o,X(),E()});const E=async()=>{if(d.setLoading(!0,"cargando horario"),!k.value||!x.value||!C.value){alert("Please select a site and date range.");return}const o=x.value.toISOString().split("T")[0],e=C.value.toISOString().split("T")[0],l=await fetch(`${w}/filtered_work_days?site_id=${k.value.site_id}&start_date=${o}&end_date=${e}`);if(l.ok){d.setLoading(!1,"cargando horario");const r=await l.json();Z.value=r.map(c=>(c.date=new Date(c.date),c.date.setDate(c.date.getDate()+1),c.users=c.records.map(D=>{let Q=K.value.find(h=>h.id===D.employer_id);if(Q){let h={...Q};const B=new Date(`${c.date.toISOString().split("T")[0]}T${D.start_time}`),R=new Date(`${c.date.toISOString().split("T")[0]}T${D.end_time}`);return h.arrivalTime=B,h.departureTime=R,h.hoursWorked=(R-B)/36e5,h}return null}).filter(D=>D!=null),d.setLoading(!1,"cargando horario"),c))}else d.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")},Te=async()=>{if(U.value=!1,d.setLoading(!0,"guardando"),!L.value||!G.value){alert("Please select a site and date.");return}let o=new Date(G.value.getTime());const e=new Date(o.getTime()-o.getTimezoneOffset()*6e4).toISOString().split("T")[0],l=await fetch(`${w}/work_days`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:e,site_id:L.value.site_id})});if(l.ok){const r=await l.json();r.date=new Date(r.date),r.date.setDate(r.date.getDate()+1),d.setLoading(!1,"guardando"),E()}else{const r=await l.json();r.detail&&r.detail==="El día con el mismo site_id ya está registrado."?alert("Este dia ya esta registrado para esta sede"):alert("Failed to add new workday"),d.setLoading(!1,"guardando")}},$e=o=>{_.value=o},Le=o=>{W.value=o,S.value=!0},Ue=async()=>{if(S.value=!1,d.setLoading(!0,"cargando"),!_.value||!W.value)return;if(T.value.getTime()>=$.value.getTime()){alert("La hora de llegada no puede ser mayor o igual a la hora de salida."),d.setLoading(!1,"cargando"),S.value=!0;return}let o=T.value.toISOString().split("T")[1].slice(0,8),e=$.value.toISOString().split("T")[1].slice(0,8);const l={employer_id:_.value.id,work_day_id:W.value.id,start_time:o,end_time:e};await fetch(`${w}/work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),_.value.arrivalTime=T.value,_.value.departureTime=$.value,_.value.hoursWorked=($.value-T.value)/36e5,W.value.users.push(_.value),S.value=!1,_.value=null,W.value=null,d.setLoading(!1,"cargando")};return(o,e)=>{var B,R,le;const l=I("Button"),r=I("Dialog"),c=I("Calendar"),D=I("Dropdown"),Q=I("InputText"),h=I("InputIcon");return v(),y("div",qe,[s(r,{visible:q.value,"onUpdate:visible":e[2]||(e[2]=a=>q.value=a),modal:"",style:{width:"20rem"}},{footer:u(()=>[s(l,{label:"Cerrar",onClick:e[1]||(e[1]=a=>q.value=!1)})]),default:u(()=>{var a;return[t("h3",null,p(g.value.name),1),g.value?(v(),y("div",ze,[t("img",{class:"shadow-3 p-1",src:`${A(w)}/read-product-image/300/employer-${g.value.dni}`,onError:e[0]||(e[0]=i=>Y(g.value.gender,i)),alt:"Foto del empleado",style:{width:"100px",height:"100px","border-radius":"50%","object-fit":"cover"}},null,40,Pe),t("div",Je,[t("p",null,[Ke,V(" "+p(g.value.name),1)]),t("p",null,[Ze,V(" "+p(g.value.position),1)]),t("p",null,[Ge,V(" "+p(g.value.phone),1)]),t("p",null,[Qe,V(" "+p((a=g.value.contract_type)==null?void 0:a.toLowerCase()),1)])])])):Fe("",!0)]}),_:1},8,["visible"]),s(r,{visible:O.value,"onUpdate:visible":e[5]||(e[5]=a=>O.value=a),modal:"",closable:""},{footer:u(()=>[s(l,{severity:"danger",label:"Cancelar",onClick:fe,class:"p-button-text"}),s(l,{severity:"success",label:"Aceptar",onClick:N})]),default:u(()=>[t("div",Xe,[t("div",Ye,[s(l,{class:"col-12",severity:"danger",text:"",label:"Esta semana",onClick:X})]),t("div",et,[s(l,{class:"col-12",severity:"help",text:"",label:"Semana pasada",onClick:_e})]),t("div",tt,[s(l,{class:"col-12",severity:"warning",text:"",label:"Este mes",onClick:he})]),t("div",at,[s(l,{class:"col-12",severity:"primary",text:"",label:"Mes pasado",onClick:we})])]),ot,s(c,{class:"col-12",modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),showIcon:""},null,8,["modelValue"]),st,s(c,{class:"col-12",modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=a=>b.value=a),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),s(r,{visible:M.value,"onUpdate:visible":e[7]||(e[7]=a=>M.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:u(()=>[s(l,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[6]||(e[6]=a=>M.value=!1)}),s(l,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:xe})]),default:u(()=>[lt]),_:1},8,["visible"]),s(r,{visible:j.value,"onUpdate:visible":e[9]||(e[9]=a=>j.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:u(()=>[s(l,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[8]||(e[8]=()=>j.value=!1)}),s(l,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:De})]),default:u(()=>[nt]),_:1},8,["visible"]),t("div",it,[s(r,{visible:U.value,"onUpdate:visible":e[13]||(e[13]=a=>U.value=a),style:{width:"22rem"},modal:"",closeOnEscape:"",onClose:e[14]||(e[14]=a=>U.value=!1)},{footer:u(()=>[s(l,{label:"cancelar",onClick:e[12]||(e[12]=a=>U.value=!1),class:"p-button-danger"}),s(l,{label:"Agregar",onClick:Te,class:"p-button-success"})]),default:u(()=>[rt,s(c,{class:"my-4",modelValue:G.value,"onUpdate:modelValue":e[10]||(e[10]=a=>G.value=a),showIcon:""},null,8,["modelValue"]),s(D,{class:"col-12 p-0",disabled:"",modelValue:L.value,"onUpdate:modelValue":e[11]||(e[11]=a=>L.value=a),options:F.value,optionLabel:"site_name",placeholder:"Select a site"},null,8,["modelValue","options"])]),_:1},8,["visible"]),t("div",dt,[t("div",ct,[t("div",ut,[s(D,{disabled:!((le=A(We)["Horarios de trabajo admin"])!=null&&le.includes((R=(B=A(z))==null?void 0:B.rawUserData)==null?void 0:R.rol)),style:{height:"100%"},class:"col-12 p-0 m-0",modelValue:k.value,"onUpdate:modelValue":e[15]||(e[15]=a=>k.value=a),options:F.value,optionLabel:"site_name"},null,8,["disabled","modelValue","options"])]),t("div",pt,[s(Q,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:se.value,"onUpdate:modelValue":e[16]||(e[16]=a=>se.value=a),onClick:ge},null,8,["modelValue"])]),t("div",mt,[s(l,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:E})])])]),t("div",vt,[t("div",yt,[t("div",gt,[t("div",ft,[(v(!0),y(te,null,ae(K.value,a=>(v(),y("div",{key:a.id,draggable:"true",style:{display:"flex","flex-direction":"column","align-items":"center"},onDragstart:i=>$e(a)},[t("img",{onClick:i=>oe(a),class:"shadow-2 p-1",src:`${A(w)}/read-product-image/96/employer-${a.dni}`,alt:"user.name",onError:i=>Y(a.gender,i),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,ht),t("p",wt,p(a.name.split(" ").slice(0,2).join(" ")),1),t("span",bt,p(a.position),1)],40,_t))),128))])])]),t("div",Dt,[t("div",kt,[s(l,{class:"mb-3",icon:"pi pi-plus",severity:"info",label:"Nueva semana",onClick:e[17]||(e[17]=a=>U.value=!0)})]),t("div",xt,[t("div",Ct,[(v(!0),y(te,null,ae(Z.value,a=>(v(),y("div",{class:"p-0 m-0",key:a.id,style:{position:"relative"}},[t("div",{class:"shadow-2",style:re({"background-color":Se(a.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[t("p",St,p(a.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"}))+" ",1)],4),t("div",Tt,[s(l,{style:{position:"absolute",right:"-1rem",top:"-1rem"},icon:"pi pi-trash text-2xl ",class:"p-button-rounded p-button-danger shadow-5",onClick:i=>ke(a.id)},null,8,["onClick"]),t("div",$t,[t("div",{class:"shadow-5 p-3 m-0",style:{"border-radius":"0 0 0.5rem 0.5rem",display:"flex","overflow-x":"auto","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"},onDragover:e[18]||(e[18]=Ne(()=>{},["prevent"])),onDrop:i=>Le(a)},[(v(!0),y(te,null,ae(a.users,i=>{var ne,ie;return v(),y("div",{class:"shadow-2 p-3",key:i.id,style:re([{"text-align":"center",width:"7rem","aspect-ratio":"1 / 1","background-color":"white",color:"black",position:"relative","border-radius":"0.5rem"},i.rest?"background-color: #68cc497a;  ":"background-color: white;"])},[t("p",Ut,p(i.name.split(" ").slice(0,1).join(" ")),1),t("img",{class:"shadow-2 p-1",onClick:ee=>oe(i),src:`${A(w)}/read-product-image/96/employer-${i.dni}`,alt:"user.name",onError:ee=>Y(i.gender,ee),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,Et),i.rest?(v(),y("div",jt,[t("p",Ft,[t("b",null,p((ie=i.contract_type)==null?void 0:ie.toLowerCase().slice(0,13)),1)]),Wt])):(v(),y("div",It,[t("p",Vt,[t("b",null,p((ne=i.contract_type)==null?void 0:ne.toLowerCase().slice(0,13)),1)]),t("p",Ot,p(new Date(i.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).split(":")[0])+" - "+p(new Date(i.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).split(":")[0]),1)])),s(l,{style:{position:"absolute",top:"-1rem",right:"-1rem","font-weight":"bold"},text:"",icon:"pi pi-times ",class:"p-button-rounded p-button-danger",onClick:ee=>be(i.id)},null,8,["onClick"])],4)}),128))],40,Lt)])])]))),128)),V(" ` ")])])])]),s(r,{visible:S.value,"onUpdate:visible":e[21]||(e[21]=a=>S.value=a),style:{width:"20rem"},modal:!0},{header:u(()=>[V(" . ")]),footer:u(()=>[t("div",Rt,[s(l,{severity:"success",label:"Aceptar",onClick:Ue})])]),default:u(()=>[t("h5",Nt,"Cuantas horas trabajo "+p(_.value.name)+"?",1),Mt,s(c,{modelValue:T.value,"onUpdate:modelValue":e[19]||(e[19]=a=>T.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:u(({clickCallback:a})=>[s(h,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"]),Bt,s(c,{modelValue:$.value,"onUpdate:modelValue":e[20]||(e[20]=a=>$.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:u(({clickCallback:a})=>[s(h,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])])}}},Jt=Ee(At,[["__scopeId","data-v-5a6fe013"]]);export{Jt as default};
