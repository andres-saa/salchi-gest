import{_ as ue,G as pe,l as ve,y as _e,j as i,z as me,H as Q,k as be,m as W,U as X,r as c,o as h,c as Y,a,e as t,f as l,A as fe,av as g,h as w,t as u,u as b,p as B,g as D,i as M,F as he,b as ge,N as we,q as ye,x as Te}from"./index-58581f28.js";import{D as Ce}from"./DialogoPedido-a3e704dd.js";import"./formatoPesos-e824e30b.js";import"./formatoPesos-2293ab52.js";const r=V=>(ye("data-v-6593239b"),V=V(),Te(),V),ke={class:"page"},Pe=r(()=>a("header",{class:"page-header"},[a("div",{class:"title-wrap"},[a("i",{class:"pi pi-wallet"}),a("h2",null,"Transferencias por confirmar")])],-1)),Ve={class:"card"},xe=r(()=>a("div",{class:"toolbar-left"},[a("i",{class:"pi pi-list"}),a("span",null,[a("b",null,"Solicitudes")])],-1)),Se={class:"p-input-icon-left",style:{width:"18rem","max-width":"100%"}},Re=r(()=>a("i",{class:"pi pi-search"},null,-1)),De=r(()=>a("div",{class:"empty"},[a("i",{class:"pi pi-inbox"}),a("p",null,"Sin transferencias pendientes por ahora.")],-1)),Ue={class:"action-row"},qe={class:"filters"},Ie={class:"filters-row"},Le={class:"filters-item"},$e=r(()=>a("label",{class:"filters-label"},"Fecha inicio",-1)),ze={class:"filters-item"},Be=r(()=>a("label",{class:"filters-label"},"Fecha fin",-1)),Me={class:"filters-item grow"},je=r(()=>a("label",{class:"filters-label"},"Sedes",-1)),Fe={class:"filters-item"},Oe={class:"table-header-compact"},Ne=r(()=>a("i",{class:"pi pi-chart-bar"},null,-1)),Ae=r(()=>a("div",{class:"empty"},[a("i",{class:"pi pi-folder-open"}),a("p",null,"Sin resultados para los filtros seleccionados.")],-1)),Ee={class:"m-0"},Ge=r(()=>a("h3",null,[a("b",null,"Rechazar orden")],-1)),He={class:"dialog-footer"},Je=r(()=>a("h3",null,[a("b",null,"Aprobar esta orden")],-1)),Ke=r(()=>a("div",{class:"dialog-content"},[a("p",null,"Confirma que la transferencia fue recibida.")],-1)),Qe={class:"dialog-footer"},We=r(()=>a("h3",null,[a("b",null,"El cliente no realizó la transferencia")],-1)),Xe=r(()=>a("div",{class:"dialog-content"},[a("p",null,"Se archivará la solicitud como no confirmada.")],-1)),Ye={class:"dialog-footer"},Ze={__name:"TransferSession",setup(V){const y=pe(),U=ve(),q=_e(),x=i([]),j=i([]),F=i([]),O=i([]),I=i(!1),L=i(!1),N=i(0),T=i(),Z=()=>{T.value={global:{value:null,matchMode:fe.CONTAINS}}};me(()=>Z());const _=i({start_date:new Date,end_date:new Date,sites:[]}),S=i(!1),f=i(!1),C=i(!1),m=i({}),A=i({}),ee=i(0),ae=i(0),se=o=>{q.setVisible("currentOrder",!0),q.setOrder(o)},te=async o=>{const s=U.rawUserData.id;await g.authorizeOrder(o,s),f.value=!1,ee.value++,R()},le=async o=>{const s=U.rawUserData.id;await g.rejectOrder(o,s),C.value=!1,ae.value++,R()},oe=o=>{f.value=!0,m.value.order_id=o},ne=o=>{C.value=!0,A.value.order_id=o},ie=async(o,s,G)=>{const $={authorized:o,responsible_id:U.rawUserData.id,responsible_observation:m.value.reason||"sin observaciones"};await g.resolveCancellationRequest(s,$),f.value=!1,S.value=!1,x.value=await g.getPendientsCancellationRequest()},E=async()=>{L.value=!0;try{const o=await W.post(`${X}/transaction_report/`,{start_date:_.value.start_date,end_date:_.value.end_date,sites:_.value.sites.map(s=>s.site_id)});j.value=o||[],F.value=o!=null&&o[0]?Object.keys(o[0]):[]}finally{L.value=!1}},R=async()=>{I.value=!0;try{x.value=await g.getOrdersTransfer()}finally{I.value=!1}};return Q(()=>q.numberTransferRequests,()=>{R()}),Q(()=>y.params.request_status,async()=>{x.value=await g.getPendientsCancellationRequest()},{deep:!0}),be(async()=>{O.value=await W.get(`${X}/sites/`),await Promise.all([R(),E()])}),(o,s)=>{const G=c("InputText"),$=c("Toolbar"),p=c("Column"),v=c("Button"),H=c("DataTable"),J=c("TabPanel"),K=c("Calendar"),re=c("MultiSelect"),de=c("TabView"),ce=c("Textarea"),z=c("Dialog");return h(),Y("div",ke,[Pe,a("div",Ve,[t(de,{activeIndex:N.value,"onUpdate:activeIndex":s[5]||(s[5]=e=>N.value=e)},{default:l(()=>[t(J,{header:"Básico"},{default:l(()=>[t($,{class:"toolbar"},{start:l(()=>[xe]),end:l(()=>[a("span",Se,[Re,t(G,{modelValue:T.value.global.value,"onUpdate:modelValue":s[0]||(s[0]=e=>T.value.global.value=e),placeholder:"Buscar solicitud...",class:"w-full"},null,8,["modelValue"])])]),_:1}),t(H,{value:x.value,class:"datatable",loading:I.value,paginator:!0,rows:15,rowsPerPageOptions:[5,10,25,100],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} transferencias",scrollable:"",scrollHeight:"65vh",stripedRows:"",showGridlines:"",filters:T.value,"onUpdate:filters":s[1]||(s[1]=e=>T.value=e)},{empty:l(()=>[De]),default:l(()=>[t(p,{field:"order_id",header:"ID orden",style:{"min-width":"max-content"},frozen:""}),t(p,{header:"Monto de la orden"},{body:l(e=>[w(u(b(B)(e.data.total_order_price)),1)]),_:1}),t(p,{header:"Fecha"},{body:l(e=>{var n,d,k,P;return[w(u((P=(k=(d=(n=e.data.latest_status_timestamp)==null?void 0:n.split("T")[0])==null?void 0:d.split("-"))==null?void 0:k.reverse())==null?void 0:P.join("-")),1)]}),_:1}),t(p,{header:"Hora"},{body:l(e=>{var n,d,k,P;return[w(u((P=(k=(d=(n=e.data.latest_status_timestamp)==null?void 0:n.split("T")[1])==null?void 0:d.split(":"))==null?void 0:k.slice(0,2))==null?void 0:P.join(":")),1)]}),_:1}),t(p,{header:"Domicilio"},{body:l(e=>{var n,d;return[w(u(b(B)(((d=(n=e.data.pe_json)==null?void 0:n.delivery)==null?void 0:d.delivery_costoenvio)||0)),1)]}),_:1}),t(p,{header:"Total"},{body:l(e=>{var n,d;return[w(u(b(B)((((d=(n=e.data.pe_json)==null?void 0:n.delivery)==null?void 0:d.delivery_costoenvio)||0)+(e.data.total_order_price||0))),1)]}),_:1}),t(p,{header:"Cliente",style:{"min-width":"16rem"}},{body:l(e=>[w(u(e.data.user_name)+" "+u(e.data.second_name)+" "+u(e.data.first_last_name)+" "+u(e.data.second_last_name),1)]),_:1}),t(p,{field:"user_phone",header:"Teléfono cliente"}),t(p,{header:"Acciones",frozen:"",alignFrozen:"right",class:"px-0",style:{"min-width":"10rem"}},{body:l(e=>[a("div",Ue,[b(y).params.request_status!="aprobadas"?(h(),D(v,{key:0,onClick:n=>se(e.data),icon:"pi pi-eye",style:{width:"2rem",height:"2rem"},severity:"info","aria-label":"Ver"},null,8,["onClick"])):M("",!0),b(y).params.request_status!="aprobadas"?(h(),D(v,{key:1,onClick:n=>oe(e.data.order_id),icon:"pi pi-check",severity:"success","aria-label":"Aprobar",style:{width:"2rem",height:"2rem"}},null,8,["onClick"])):M("",!0),b(y).params.request_status!="aprobadas"?(h(),D(v,{key:2,onClick:n=>ne(e.data.order_id),icon:"pi pi-trash",severity:"danger","aria-label":"Archivar",style:{width:"2rem",height:"2rem"}},null,8,["onClick"])):M("",!0)])]),_:1})]),_:1},8,["value","loading","filters"])]),_:1}),t(J,{header:"Reportes"},{default:l(()=>[a("div",qe,[a("div",Ie,[a("div",Le,[$e,t(K,{modelValue:_.value.start_date,"onUpdate:modelValue":s[2]||(s[2]=e=>_.value.start_date=e),showIcon:""},null,8,["modelValue"])]),a("div",ze,[Be,t(K,{modelValue:_.value.end_date,"onUpdate:modelValue":s[3]||(s[3]=e=>_.value.end_date=e),showIcon:""},null,8,["modelValue"])]),a("div",Me,[je,t(re,{modelValue:_.value.sites,"onUpdate:modelValue":s[4]||(s[4]=e=>_.value.sites=e),options:O.value.filter(e=>e.show_on_web),optionLabel:"site_name",display:"chip",placeholder:"Selecciona sedes",class:"w-full"},null,8,["modelValue","options"])]),a("div",Fe,[t(v,{severity:"help",onClick:E,label:"Buscar",icon:"pi pi-search"})])])]),t(H,{value:j.value,class:"datatable",loading:L.value,paginator:!0,rows:15,rowsPerPageOptions:[5,10,25,100],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} transferencias",scrollable:"",showGridlines:"",stripedRows:""},{header:l(()=>[a("div",Oe,[Ne,a("span",null,[a("b",null,"Transferencias "+u(b(y).params.section),1)])])]),empty:l(()=>[Ae]),default:l(()=>[(h(!0),Y(he,null,ge(F.value,e=>(h(),D(p,{key:e,header:e,class:"py-1",style:{"text-transform":"uppercase"}},{body:l(n=>[a("h6",Ee,u(n.data[e]),1)]),_:2},1032,["header"]))),128))]),_:1},8,["value","loading"])]),_:1})]),_:1},8,["activeIndex"])]),t(z,{visible:S.value,"onUpdate:visible":s[10]||(s[10]=e=>S.value=e),modal:"",closable:!0,draggable:!1,class:"dialog-md"},{header:l(()=>[Ge]),footer:l(()=>[a("div",He,[t(v,{label:"Cancelar",class:"p-button-text",onClick:s[8]||(s[8]=e=>S.value=!1)}),t(v,{label:"Rechazar",type:"submit",class:"p-button-danger",onClick:s[9]||(s[9]=e=>{var n;return(n=o.$el.querySelector("form"))==null?void 0:n.dispatchEvent(new o.Event("submit",{cancelable:!0,bubbles:!0}))})})])]),default:l(()=>[a("form",{onSubmit:s[7]||(s[7]=we(e=>ie(!1,m.value.id,m.value.reason),["prevent"])),class:"dialog-form"},[t(ce,{id:"reason",modelValue:m.value.reason,"onUpdate:modelValue":s[6]||(s[6]=e=>m.value.reason=e),rows:"5",placeholder:"¿Por qué deseas rechazar esta solicitud?",class:"w-full",style:{resize:"none","text-transform":"lowercase"}},null,8,["modelValue"])],32)]),_:1},8,["visible"]),t(z,{visible:f.value,"onUpdate:visible":s[13]||(s[13]=e=>f.value=e),modal:"",closable:!0,draggable:!1,class:"dialog-sm"},{header:l(()=>[Je]),footer:l(()=>[a("div",Qe,[t(v,{label:"Cancelar",class:"p-button-text",onClick:s[11]||(s[11]=e=>f.value=!1)}),t(v,{label:"Aprobar (Transferencia confirmada)",class:"p-button-success",onClick:s[12]||(s[12]=e=>te(m.value.order_id))})])]),default:l(()=>[Ke]),_:1},8,["visible"]),t(z,{visible:C.value,"onUpdate:visible":s[16]||(s[16]=e=>C.value=e),modal:"",closable:!0,draggable:!1,class:"dialog-sm"},{header:l(()=>[We]),footer:l(()=>[a("div",Ye,[t(v,{label:"Cancelar",class:"p-button-text",onClick:s[14]||(s[14]=e=>C.value=!1)}),t(v,{label:"Archivar (Transferencia no confirmada)",class:"p-button-danger",onClick:s[15]||(s[15]=e=>le(A.value.order_id))})])]),default:l(()=>[Xe]),_:1},8,["visible"]),t(Ce)])}}},la=ue(Ze,[["__scopeId","data-v-6593239b"]]);export{la as default};
