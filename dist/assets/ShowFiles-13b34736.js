import{_ as we,bX as xe,r as d,y as Ce,u as Ee,B as $e,l as Z,q as ke,a as h,o as O,c as z,f as a,w as i,d as o,F as ee,U as v,s as E,bY as S,e as Te,t as D,j as I,h as te,bM as oe,n as Se,D as De,p as Ve,i as Ne}from"./index-a2618755.js";import{a as je}from"./dropDownAux-c21131e7.js";import{u as se}from"./sendFileService-d7e3c729.js";import{u as Pe}from"./ShowFiles.vue_vue_type_style_index_0_scoped_136eff2d_lang-9a38b80e.js";const n=V=>(Ve("data-v-136eff2d"),V=V(),Ne(),V),Le=n(()=>o("h3",null,"Tipos de archivo",-1)),Ue=n(()=>o("p",{class:"text-xl",style:{"font-weight":"bold"},for:"type_name"},"Nuevo",-1)),Oe={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},ze=n(()=>o("p",{class:"text-xl my-4",style:{"font-weight":"bold"},for:"type_name"},"Editar exixtentes",-1)),Ie={class:"col-12 p-0",style:{display:"flex",gap:"1rem","justify-content":"space-between"}},Re=n(()=>o("i",{class:"fa-solid fa-trash-can text-2xl"},null,-1)),Ae=n(()=>o("div",null,null,-1)),Fe={class:"col-12 p-0 m-auto",style:{}},qe={class:""},Be={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},Je={class:"mt-4 col-12 md:col-6 xl:col-4 p-0",style:{display:"flex","max-width":"35rem","justify-content":"end",gap:"1rem"}},Me=n(()=>o("i",{class:"fa-solid fa-plus mr-2 text-2xl"},null,-1)),He=n(()=>o("i",{class:"fa-solid fa-file mr-2 text-2xl"},null,-1)),Ge=n(()=>o("i",{class:"fa-solid fa-plus mr-2 text-2xl"},null,-1)),Ke=n(()=>o("i",{class:"fa-solid fa-house mr-2 text-2xl"},null,-1)),Xe=n(()=>o("i",{class:"fa-solid fa-plus mr-2 text-2xl"},null,-1)),Ye=n(()=>o("i",{class:"fa-solid fa-font"},null,-1)),Qe={style:{"min-width":"max-content"}},We=n(()=>o("span",{class:"p-column-title"},"Category",-1)),Ze={style:{"min-width":"max-content"}},et={style:{display:"flex"}},tt=n(()=>o("i",{class:"fa-solid fa-file-arrow-down"},null,-1)),ot=n(()=>o("i",{class:"fa-solid fa-pen-to-square"},null,-1)),st=n(()=>o("i",{class:"fa-solid fa-trash"},null,-1)),at={class:"col-12 p-0",style:{}},lt=n(()=>o("label",{for:"position"},"FECHA DE RENOVACION",-1)),nt={class:"p-3",style:{"background-color":"rgba(115, 255, 76, 0.306)"}},it=n(()=>o("i",{class:"pi pi-check",style:{color:"slateblue"}},null,-1)),rt={class:"grid",style:{display:"flex","justify-content":"space-between"}},dt={class:"col-12 xl:col-6"},ct={class:"col-12 xl:col-6"},ut={class:"grid",style:{}},pt={class:"col-12"},mt=n(()=>o("label",{for:"position"},"TIPO DE DOCUMENTO",-1)),ft={class:"col-12"},yt=n(()=>o("label",{for:"position"},"FECHA DE RENOVACION",-1)),vt={class:"p-3",style:{"background-color":"rgba(19, 164, 0, 0.306)"}},_t=n(()=>o("i",{class:"pi pi-check",style:{color:"slateblue"}},null,-1)),ht={class:"",style:{display:"flex","justify-content":"space-between",gap:"1rem","flex-direction":"column"}},gt=n(()=>o("h3",null,"Nueva Sede",-1)),bt={class:""},wt=n(()=>o("p",{class:"mt-4"},"Nombre de la Sede:",-1)),xt=n(()=>o("p",{class:"mt-4"},"Dirección:",-1)),Ct=n(()=>o("p",{class:"mt-4"},"Teléfono:",-1)),Et={key:0,style:{"margin-top":"20px"}},$t=["src"],kt=n(()=>o("i",{class:"fa-solid fa-camera"},null,-1)),Tt={__name:"ShowFiles",setup(V){const R=Pe(),M=xe(),A=d(!1),$=d(""),ae=async()=>{if(!$.value){alert("Por favor, ingrese un nombre para el tipo de documento.");return}try{const t=await fetch(`${v}/site-file-type`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type_name:$.value})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();console.log("Tipo de documento agregado:",e),$.value="",N()}catch(t){console.error("Error al agregar el tipo de documento:",t)}},p=Ce(),le=d([]),c=d(),b=d(),k=d([]),F=d(),_=d(""),m=d(""),q=Ee(),T=d({}),f=$e();le.value=F.value;const H=t=>{const e=t.target.files[0];e&&(console.log("Archivo seleccionado:",e),c.value=e)},N=async()=>{try{const t=await fetch(`${v}/site-file-types`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();k.value=e}catch(t){console.error("Error al obtener los tipos de documentos:",t)}},ne=t=>{M.require({target:event.currentTarget,message:`Esta seguro de eliminar ${t.document_name}`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-info p-button-outlined p-button-sm",acceptClass:"p-button-sm p-button-danger",rejectLabel:"Cancelar",acceptLabel:"Eliminar",accept:()=>{ie(t)},reject:()=>{}})},ie=async t=>{try{if(!(await fetch(`${v}/site_document/${t.document_id}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar el documento");w(),f.add({severity:"success",summary:"Documento eliminado",detail:"El documento ha sido eliminado correctamente.",life:3e3})}catch(e){console.error("Error al eliminar el documento:",e),f.add({severity:"error",summary:"Error al eliminar",detail:"No se pudo eliminar el documento.",life:3e3})}},re=async t=>{if(!c.value){alert("seleccione un archivo");return}let e="post";const l=`${v}/site-document/`,r={method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return(await fetch(l,r)).json()},w=async()=>{var t;try{const e=((t=R==null?void 0:R.currentSite)==null?void 0:t.site_id)||1,l=`${v}/get-site-documents-info/${e}`,r=await fetch(l);if(console.log(r),!r.ok)return;const y=await r.json();F.value=y}catch(e){console.error("Error al enviar la solicitud:",e)}},de=async t=>{if(!m.value){alert("la recha de renovacion es obligatoria");return}let e="put";const l={...t},r=`${v}/site-document/${l.document_id}`;l.renovation_date=m.value;const y={method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)};try{const u=await fetch(r,y);if(!u.ok)throw new Error(`Error en la solicitud: ${u.status}`);const x=await u.json();return w(),B(),f.add({severity:"success",summary:"Actualización exitosa",detail:"Documento actualizado correctamente",life:3e3}),x}catch(u){f.add({severity:"error",summary:"Error en la actualización",detail:u.message,life:3e3})}};Z(()=>{w(),p.setLoading(!0),p.setLoading(!1),N()}),ke(()=>q.params.site_id,()=>{w(),p.setLoading(!0),p.setLoading(!1)}),Z(()=>{const t=localStorage.getItem("currentSiteFiles");t&&(T.value=JSON.parse(t))});const ce=async t=>{try{const e=await fetch(`${v}/site-file-type/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({type_name:t.type_name})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const l=await e.json();console.log("Tipo de documento actualizado:",l),f.add({severity:"success",summary:"Actualizado",detail:"Tipo de archivo actualizado con éxito",life:3e3})}catch(e){console.error("Error al actualizar el tipo de documento:",e),f.add({severity:"error",summary:"Error al actualizar",detail:"No se pudo actualizar el tipo de archivo.",life:3e3})}},j=d(!1),P=d(!1),ue=(t,e,l)=>{var y;if(!m.value){alert("la fecha de renovacion es obligatoria");return}if(!((y=_.value)!=null&&y.type_name)){alert("debe elegir un tipo de archivo");return}if(!t){alert("debe subir un  archivo");return}const r={document_name:`${T.value.site_name} ${_.value.type_name}`,document_type:_.value.type_name,renovation_date:m.value,site_id:q.params.site_id};p.setLoading(!0,"enviando"),re(r).then(u=>{p.setLoading(!1,"enviando"),console.log(u),se(t,u.document_id,_.value.type_name),w()}),f.add({severity:"success",summary:"hecho",detail:"",life:3e3}),B(),p.setLoading(!1,"enviando")},pe=(t,e)=>{if(!m.value){alert("la fecha de renovecion es obligatoria");return}`${b.value.document_name}`,b.value.document_type,m.value,q.params.site_id,console.log(e),de(e),se(t,e.document_id,e.document_type),f.add({severity:"success",summary:"hecho",detail:"",life:3e3}),B()},me=t=>{j.value=!0,b.value=t},fe=t=>{P.value=!0,b.value=t},B=()=>{j.value=!1,P.value=!1,c.value=null,w()},L=d(null),U=d(!1),g=d({site_name:"",site_address:"",site_phone:"",site_business_hours:""}),J=d(null);d(null);const ye=()=>{U.value=!0,L.value=null},ve=t=>{const e=t.target.files[0];J.value=e,e&&(L.value=URL.createObjectURL(e))},_e=async()=>{try{const t=await fetch(`${v}/site`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g.value)});if(!t.ok)throw new Error("Error al crear la sede");const l=(await t.json()).site_id;if(J.value){const r=new FormData;r.append("file",J.value),await fetch(`${v}/upload-product-image/site-${l}`,{method:"POST",body:r})}U.value=!1}catch(t){console.error("Error al crear la sede:",t)}},he=async t=>{M.require({target:event.currentTarget,message:"¿Está seguro de que desea eliminar este tipo de archivo?",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-info p-button-outlined p-button-sm",acceptClass:"p-button-sm p-button-danger",rejectLabel:"Cancelar",acceptLabel:"Eliminar",accept:async()=>{try{if(p.setLoading(!0,"eliminando"),!(await fetch(`${v}/site-file-type/${t}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar el tipo de archivo");k.value=k.value.filter(l=>l.type_id!==t),f.add({severity:"success",summary:"Eliminado",detail:"Tipo de archivo eliminado con éxito",life:3e3}),p.setLoading(!1,"eliminando"),N()}catch(e){p.setLoading(!1,"eliminando"),console.error("Error al eliminar el tipo de archivo:",e),f.add({severity:"error",summary:"Error al eliminar",detail:"No se pudo eliminar el tipo de archivo.",life:3e3}),N()}}})};return(t,e)=>{var K,X,Y,Q,W;const l=h("Button"),r=h("Dialog"),y=h("Toast"),u=h("ConfirmPopup"),x=h("Column"),ge=h("DataTable"),G=h("Calendar"),be=h("Dropdown");return O(),z(ee,null,[a(r,{visible:A.value,"onUpdate:visible":e[1]||(e[1]=s=>A.value=s),style:{width:"450px"},modal:!0},{header:i(()=>[Le]),default:i(()=>[o("div",null,[Ue,a(E(S),{class:"col-12",id:"type_name",modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=s=>$.value=s)},null,8,["modelValue"])]),o("div",Oe,[a(l,{class:"my-4",label:"Agregar",onClick:ae})]),ze,(O(!0),z(ee,null,Te(k.value,s=>(O(),z("div",{class:"my-2 col-12 p-0",key:s.type_id},[o("div",Ie,[a(E(S),{class:"col-11",modelValue:s.type_name,"onUpdate:modelValue":C=>s.type_name=C,onBlur:C=>ce(s)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),a(l,{rounded:"",style:{"aspect-ratio":"1 / 1",width:"3rem",height:"3rem",display:"flex","justify-content":"center"},severity:"danger",text:"",class:"pi-button-rounded",onClick:C=>he(s.id)},{default:i(()=>[Re]),_:2},1032,["onClick"])])]))),128)),Ae]),_:1},8,["visible"]),a(y),o("div",Fe,[a(y),a(u),o("div",qe,[a(ge,{ref:"dt",value:F.value,dataKey:"id",paginator:!0,rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} products",responsiveLayout:"scroll",frozenValue:t.lockedCustomers},{header:i(()=>[]),default:i(()=>[o("div",Be,[o("div",Je,[a(l,{size:"small ",style:{width:"100%","font-weight":"bold",display:"flex","align-items":"center","justify-content":"center"},rounded:"",class:"p-button-info py-2",onClick:e[2]||(e[2]=s=>fe())},{default:i(()=>[Me,He]),_:1}),a(l,{size:"small ",ico:"",style:{width:"100%","font-weight":"bold",display:"flex","align-items":"center","justify-content":"center"},rounded:"",class:"p-button-warning py-2",onClick:ye},{default:i(()=>[Ge,Ke]),_:1}),a(l,{size:"small ",style:{width:"100%","font-weight":"bold",display:"flex","align-items":"center","justify-content":"center"},rounded:"",class:"p-button-success py-2",onClick:e[3]||(e[3]=s=>A.value=!0)},{default:i(()=>[Xe,Ye]),_:1})])]),a(x,{class:"",field:"name",header:"Tipo",sortable:!0,headerStyle:"width:20rem; min-width:max-content; "},{body:i(s=>[o("p",Qe,D(s.data.document_type),1)]),_:1}),a(x,{class:"py-0",field:"position",header:"Nombre ",sortable:!0,headerStyle:"width:20rem; min-width:10rem;"},{body:i(s=>[We,o("p",Ze,D(s.data.document_name),1)]),_:1}),a(x,{class:"p-0",field:"birth_date",header:"Renovacion",sortable:!0,headerStyle:"width:5rem; min-width:10rem;"},{body:i(s=>[I(D(s.data.renovation_date),1)]),_:1}),a(x,{style:{},class:"py-0",header:"Acciones",fieldheaderStyle:"width:10rem; min-width:max-content",frozen:"",alignFrozen:"right"},{body:i(s=>[o("div",et,[a(l,{text:"",size:"large",style:{"aspect-ratio":"1 / 1"},class:"p-button-success mr-2 mb-2 p-0 text-3xl",onClick:C=>E(je)(s.data.document_id,s.data.document_type)},{default:i(()=>[tt]),_:2},1032,["onClick"]),a(l,{text:"",size:"large",style:{},class:"p-button-info mr-2 mb-2 p-0 text-3xl",onClick:C=>me(s.data)},{default:i(()=>[ot]),_:2},1032,["onClick"]),a(l,{text:"",size:"large",style:{},class:"p-button-danger mr-2 mb-2 p-0 text-3xl",onClick:C=>ne(s.data)},{default:i(()=>[st]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["value","frozenValue"]),a(r,{class:"p-0",closable:!0,header:` RENOVAR ${(K=b.value)==null?void 0:K.document_type} PARA ${(X=T.value.site_name)==null?void 0:X.toUpperCase()}`,visible:j.value,"onUpdate:visible":e[7]||(e[7]=s=>j.value=s),style:{width:"500px"},modal:!0},{default:i(()=>[o("input",{ref:"fileInput",type:"file",onChange:H,style:{display:"none"}},null,544),o("div",at,[lt,a(G,{id:"entry_date",style:{width:"100%",margin:"20px 0"},modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=s=>m.value=s),required:"true",autofocus:""},null,8,["modelValue"])]),te(o("p",nt,[it,I(" "+D(c.value?`${c.value.name} : si este no es
                    su documento por
                    favor carguelo`:""),1)],512),[[oe,c.value]]),o("div",rt,[o("div",dt,[a(l,{severity:"help",label:"Seleccionar documento",class:"col-12",style:{},onClick:e[5]||(e[5]=s=>{t.$refs.fileInput.click()})})]),o("div",ct,[a(l,{class:"col-12",severity:"success",label:"Enviar",onClick:e[6]||(e[6]=s=>pe(c.value,b.value))})])])]),_:1},8,["header","visible"]),a(r,{header:` CARGAR ${((Y=_.value)==null?void 0:Y.type_name)||""} PARA ${(W=(Q=T.value)==null?void 0:Q.site_name)==null?void 0:W.toUpperCase()}`,visible:P.value,"onUpdate:visible":e[12]||(e[12]=s=>P.value=s),style:{width:"450px"},modal:!0},{default:i(()=>[o("div",ut,[o("div",pt,[mt,a(be,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=s=>_.value=s),modelModifiers:{trim:!0},options:k.value,optionLabel:"type_name",placeholder:"",required:"true",class:Se({"p-invalid":t.submitted}),style:{width:"100%",margin:"20px 0"}},null,8,["modelValue","options","class"])]),o("div",ft,[yt,a(G,{id:"entry_date",style:{width:"100%",margin:"20px 0"},modelValue:m.value,"onUpdate:modelValue":e[9]||(e[9]=s=>m.value=s),required:"true",autofocus:""},null,8,["modelValue"])])]),o("input",{ref:"fileInput",type:"file",onChange:H,style:{display:"none"}},null,544),te(o("p",vt,[_t,I(" "+D(c.value?`${c.value.name} : verifique si
                    este es su documeto
                    antes de envirlo`:""),1)],512),[[oe,c.value]]),o("div",ht,[a(l,{class:"",severity:"help",label:"Seleccionar documento",style:{width:"100%"},onClick:e[10]||(e[10]=s=>{t.$refs.fileInput.click()})}),a(l,{label:"Enviar",style:{width:"100%"},severity:"success",onClick:e[11]||(e[11]=s=>ue(c.value,_.value,T.value.site_id))})])]),_:1},8,["header","visible"])])]),a(r,{visible:U.value,"onUpdate:visible":e[17]||(e[17]=s=>U.value=s),style:{width:"450px",padding:"0px"},modal:!0},{header:i(()=>[gt]),footer:i(()=>[a(l,{onClick:_e},{default:i(()=>[I("Crear Sede")]),_:1})]),default:i(()=>[o("div",bt,[wt,a(E(S),{class:"col-12",modelValue:g.value.site_name,"onUpdate:modelValue":e[13]||(e[13]=s=>g.value.site_name=s)},null,8,["modelValue"])]),o("div",null,[xt,a(E(S),{class:"col-12",modelValue:g.value.site_address,"onUpdate:modelValue":e[14]||(e[14]=s=>g.value.site_address=s)},null,8,["modelValue"])]),o("div",null,[Ct,a(E(S),{class:"col-12",modelValue:g.value.site_phone,"onUpdate:modelValue":e[15]||(e[15]=s=>g.value.site_phone=s)},null,8,["modelValue"])]),L.value?(O(),z("div",Et,[o("img",{src:L.value,alt:"Vista previa de la imagen",style:{"max-width":"100%","max-height":"300px"}},null,8,$t)])):De("",!0),a(l,{class:"my-5",onClick:e[16]||(e[16]=s=>t.$refs.imageInput.click())},{default:i(()=>[kt]),_:1}),o("input",{type:"file",ref:"imageInput",onChange:ve,style:{display:"none"}},null,544)]),_:1},8,["visible"])],64)}}},jt=we(Tt,[["__scopeId","data-v-136eff2d"]]);export{jt as default};
