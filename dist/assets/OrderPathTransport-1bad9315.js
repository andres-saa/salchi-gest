import{_ as ke,x as Ce,r as c,l as Te,i as je,a as b,o as W,c as K,d as o,w as r,b as a,F as ae,B as Fe,s as f,t as p,e as Se,E as R,L as Ae,M as Ee,D as Oe,p as Ue,g as $e}from"./index-46f5b0d8.js";import{s as Me}from"./siteService-79317d44.js";import"./sass.default-a1d89e71.js";import{p as w}from"./purchaseOrderService-9ab03e7d.js";import{u as F,w as se}from"./xlsx-4f9172c7.js";import{E as qe,F as oe}from"./FileSaver.min-af960175.js";import{f as le}from"./format-36e25dfb.js";import{e as ne}from"./es-e43b915c.js";import"./_commonjsHelpers-23102255.js";const v=q=>(Ue("data-v-92862b39"),q=q(),$e(),q),Ie={class:"grid"},Ne={class:"col-12 px-0 mx-0"},Pe={class:"col-12",style:{display:"flex","flex-direction":"column"}},Ve=v(()=>a("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),Re={class:"col-12",style:{display:"flex","flex-direction":"column"}},Le=v(()=>a("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),Be={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},He={class:"col-12",style:{display:"flex","justify-content":"center"}},ze=v(()=>a("p",null,"Desea ageregar notas?",-1)),Ge={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},Qe=v(()=>a("b",null,"Autor de la nota: ",-1)),We=v(()=>a("b",null,"Fecha: ",-1)),Ke={style:{border:"1px solid","border-radius":"0.3rem"},class:"p-2"},Je=v(()=>a("b",null,"Contenido de la Observacion: ",-1)),Ye=v(()=>a("br",null,null,-1)),Xe={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},Ze={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},et={class:"m-0 p-0"},tt=v(()=>a("b",null,"Autorizada por:",-1)),at={class:"m-0 p-0"},st=v(()=>a("b",null,"Sede:",-1)),ot={class:"mt-0 p-0"},lt=v(()=>a("b",null,"Fecha de autorizacion:",-1)),nt={style:{display:"flex","flex-direction":"column","align-items":"start",gap:"0.5rem"}},it={style:{display:"flex","align-items":"center",gap:"1rem"}},rt={class:"text-right"},dt=["onChange","max","onUpdate:modelValue"],ct={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},ut={class:"m-auto",style:{"max-width":"1024px"}},pt={class:"col-12 px-3 mt-4 pack-butons",style:{display:"flex","justify-content":"end",gap:"1rem"}},mt={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},ht={class:"grid",style:{"align-items":"center"}},vt=v(()=>a("div",{class:"col-12 md:col-6 p-3"},[a("span",{class:"text-xl",style:{width:"100%"}}," Ordenes pendientes por Transportar")],-1)),_t={class:"col-12 md:col-6 p-3"},yt={style:{"min-width":"max-content"}},ft={style:{"min-width":"max-content"}},gt={class:"m-0 p-0",style:{display:"flex",width:"min-content","justify-content":"start","align-items":"center",gap:"0.5rem"}},bt={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},wt=v(()=>a("br",null,null,-1)),xt={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},Dt={class:"m-0"},kt={class:"m-0"},Ct={key:0},Tt=v(()=>a("b",null,"Notas",-1)),jt={style:{display:"flex",gap:"1rem"}},ie=3,Ft={__name:"OrderPathTransport",setup(q){const k=Ce(),I=c(!1),S=c([]),A=c(!1),L=c({}),re=l=>{if(l.some(t=>!t.ajustment&&t.ajustment!==0)){alert("por favor complete todos los campos");return}if(l.some(t=>t.ajustment>t.quantity_adjusted)){alert("No puedes enviar mas de lo solicitado");return}A.value=!0},B=c(""),_=c({}),H=c(!1),z=c(!1),J=c([]),de=async l=>{z.value=!0,J.value=await w.getPurchaseOrderHistory(l)},ce=()=>{S.value.forEach(l=>{l.ajustment=l.quantity_adjusted})},N=c(!1),ue=l=>{I.value=!0,_.value=l},pe=async l=>{N.value=!0,S.value=await w.getpurchaseOrderEntriesBypurchaseOrderID(l)},me={Generada:"#FF0000",Lista:"#FFA500","Entregada al transportista":"#FFFF00",Completada:"#00FF00"},he=[{color:"#7fffd4",description:"Esta todo bien"},{color:"rgb(251 53 146)",description:"Cuidado estan enviando mas de lo que reportan"},{color:" rgb(255, 175, 51)",description:"Recibiste menos de lo reportado"}],Y=Te(),X=c([]),Z=c([{}]),E=c(!1),C=c(new Date(new Date().setDate(new Date().getDate()-7))),x=c(new Date),O=c(new Date(new Date().setDate(new Date().getDate()-7))),U=c(new Date),T=c(),D=c(),ve=(l,t)=>{O.value=l,U.value=t},$=l=>{const t=new Date,s=new Date(t);s.setDate(s.getDate()+1);const d=new Date(t);d.setDate(t.getDate()-l),C.value=d,l==1?(x.value=t,U.value=x.value,O.value=C.value,E.value=!1):(x.value=s,O.value=C.value,U.value=x.value,E.value=!1),_e()};je(async()=>{X.value=await Me.getSites(),Z.value=X.value,T.value=await w.getPurchaseOrderByLap_id(ie)}),(()=>{D.value={global:{value:null,matchMode:Fe.CONTAINS}}})();function ee(l){const t=new Date(l),s=t.getFullYear(),d=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0");return`${s}-${d}-${i}`}const _e=async()=>{const l=Z.value.map(d=>d.site_id);Y.rawUserData.id;const t=ee(O.value),s=ee(U.value);T.value=await w.getAllpurchaseOrderReportsFiltered(l,t,s)},M=c([]),ye=async(l,t,s)=>{M.value=await w.getpurchaseOrderEntriesBypurchaseOrderID(l);const d=M.value.map(g=>({Producto:g.item_name,Cantidad:g.quantity,"Unidad de medida":g.unit_measure})),i=F.json_to_sheet(d);i["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const h=F.book_new();F.book_append_sheet(h,i,"Usuarios"),se(h,`Orden_de_compra_${t}_${s} .xlsx`)},fe=l=>l.map(s=>{if(s.quantity!=s.ajustment)return{order_purchase_entry_id:s.entry_id,quantity_adjusted:s.ajustment}}).filter(s=>s),ge=async l=>{if(l.some(s=>!s.ajustment&&s.ajustment!==0)){alert("por favor complete todos los campos");return}k.setLoading(!0,"Transportando orden");const t={purchase_order_id:_.value.purchase_order_id,lap_id:_.value.lap_id,responsible_id:Y.rawUserData.id,ajusts:fe(l),order_purchase_notes:B.value};await w.PreparePurchaserOrder(t),T.value=await w.getPurchaseOrderByLap_id(ie),I.value=!1,N.value=!1,k.setLoading(!1,"Transportando orden"),H.value=!1,A.value=!1},be=async()=>{k.setLoading(!0,"generando descargas");const l=T.value,t=[];for(const e of l){const n=await w.getpurchaseOrderEntriesBypurchaseOrderID(e.purchase_order_id);t.push(...n)}const s={};t.forEach(e=>{const n=e.site_name,u=e.item_name,j=e.quantity,Q=e.unit_measure;s[u]||(s[u]={unit_measure:Q}),s[u][n]||(s[u][n]=0),s[u][n]+=j});const d=[...new Set(t.map(e=>e.site_name))],i=[],h=le(O.value,"dd-MMMM-yyyy",{locale:ne}),g=le(U.value,"dd-MMMM-yyyy",{locale:ne});h==g?i.push([`ORDENES DE COMPRA DEL ${h.toUpperCase()}`,...Array(d.length+2).fill("")]):i.push([`ORDENES DE COMPRA DEL${h.toUpperCase()} AL ${g.toUpperCase()}`,...Array(d.length+2).fill("")]);const P=["PRODUCTO","UNIDAD DE MEDIDA",...d,"TOTAL"];i.push(P);for(const[e,n]of Object.entries(s)){const u=[e,n.unit_measure];let j=0;for(const Q of d){const te=n[Q]||0;u.push(te),j+=te}u.push(j),i.push(u)}const m=new qe.Workbook,y=m.addWorksheet("Inventario por Sede");i.forEach((e,n)=>{const u=y.addRow(e);n===0?(u.height=40,u.font={name:"Arial",bold:!0,size:14},u.alignment={horizontal:"center",vertical:"middle",wrapText:!0},y.mergeCells(`A1:${y.getColumn(d.length+3).letter}1`),y.getRow(1).eachCell(j=>{j.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF00"}}})):n===1&&(u.font={name:"Arial",bold:!0})}),y.columns.forEach((e,n)=>{e.width=n===0?30:n===1?25:15,e.eachCell(u=>{u.font={name:"Arial"},u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),y.getRow(2).eachCell(e=>{e.font={name:"Arial",bold:!0}}),y.getRow(1).eachCell(e=>{e.font={name:"Arial",bold:!0,size:16}}),y.views=[{showGridLines:!1}];const G=await m.xlsx.writeBuffer(),V=new Blob([G],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});h==g?oe.saveAs(V,`Reporte de inventario del ${h}.xlsx`):oe.saveAs(V,`Reporte de inventario del ${h} al ${g} .xlsx`),k.setLoading(!1,"generando descargas")},we=async()=>{k.setLoading(!0,"generando descargas");const l=T.value;for(const i of l){const h=await w.getpurchaseOrderEntriesBypurchaseOrderID(i.purchase_order_id);M.value.push(...h)}console.log(M.value);const t=M.value.map(i=>({Fecha:i.date.split("T")[0],Hora:i.date.split("T")[1],Sede:i.site_name,Producto:i.item_name,Cantidad:i.quantity,"Unidad de medida":i.unit_measure})),s=F.json_to_sheet(t);s["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const d=F.book_new();F.book_append_sheet(d,s,"Usuarios"),se(d,"Compras de todas las sedes.xlsx"),k.setLoading(!1,"generando descargas")};function xe(l){l.key===","&&(alert("Por favor usa punto ( . ) para los decimales, gracias"),l.preventDefault())}const De=l=>{l.ajustment>l.quantity&&(alert("Estas seguro de que hay mas de lo reportado?"),l.ajustment==l.quantity)};return(l,t)=>{const s=b("Button"),d=b("Calendar"),i=b("Dialog"),h=b("Textarea"),g=b("router-link"),P=b("Tag"),m=b("Column"),y=b("DataTable"),G=b("InputText"),V=b("Timeline");return W(),K(ae,null,[o(i,{class:"mx-2",visible:E.value,"onUpdate:visible":t[8]||(t[8]=e=>E.value=e),modal:"",header:"Periodo",style:{width:"25rem"}},{default:r(()=>[a("div",Ie,[a("div",Ne,[o(s,{text:"",label:"Hoy",onClick:t[0]||(t[0]=e=>$(0)),class:"p-button-text col-12 p-1 m-0"}),o(s,{text:"",label:"Ayer",onClick:t[1]||(t[1]=e=>$(1)),class:"p-button-text col-12 p-1 m-0"}),o(s,{text:"",label:"Últimos 7 días",onClick:t[2]||(t[2]=e=>$(7)),class:"p-button-text col-12 p-1 m-0"}),o(s,{text:"",label:"Últimos 14 días",onClick:t[3]||(t[3]=e=>$(14)),class:"p-button-text col-12 p-1"}),o(s,{text:"",label:"Últimos 28 días",onClick:t[4]||(t[4]=e=>$(28)),class:"p-button-text col-12 p-0"})]),a("div",Pe,[Ve,o(d,{style:{"min-width":"max-content"},modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=e=>C.value=e)},null,8,["modelValue"])]),a("div",Re,[Le,o(d,{style:{"min-width":"max-content"},modelValue:x.value,"onUpdate:modelValue":t[6]||(t[6]=e=>x.value=e),showWeek:""},null,8,["modelValue"])]),a("div",Be,[a("div",He,[o(s,{onClick:t[7]||(t[7]=()=>{ve(C.value,x.value),E.value=!1})},{default:r(()=>[f("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),o(i,{class:"mx-2",visible:A.value,"onUpdate:visible":t[12]||(t[12]=e=>A.value=e),modal:"",header:"Notas de Transporte de orden",style:{width:"25rem"}},{footer:r(()=>[a("div",Ge,[o(s,{text:"",onClick:t[10]||(t[10]=e=>A.value=!1),severity:"danger",label:"cancelar"}),o(s,{onClick:t[11]||(t[11]=e=>ge(S.value.filter(n=>n.quantity!=0))),severity:"help",label:"Alistar orden"})])]),default:r(()=>[ze,a("div",null,[o(h,{modelValue:B.value,"onUpdate:modelValue":t[9]||(t[9]=e=>B.value=e),style:{width:"100%",resize:"none",height:"10rem"}},null,8,["modelValue"])])]),_:1},8,["visible"]),o(i,{class:"mx-2",visible:H.value,"onUpdate:visible":t[13]||(t[13]=e=>H.value=e),modal:"",header:"Notas de la orden",style:{width:"28rem"}},{default:r(()=>[a("div",null,[a("p",null,[Qe,f(p(L.value.item.name),1)]),a("p",null,[We,f(p(L.value.item.status_timestamp.split("T")[0]),1)]),a("p",Ke,[Je,f(),Ye,f(p(L.value.item.notes),1)])])]),_:1},8,["visible"]),o(i,{class:"mx-2",visible:I.value,"onUpdate:visible":t[17]||(t[17]=e=>I.value=e),modal:"",header:"Interactuar con la orden",style:{width:"25rem"}},{default:r(()=>[a("div",Xe,[o(g,{to:`/purchase-order/recorrido/purchase-order-view/${_.value.purchase_order_id}`},{default:r(()=>[o(s,{text:"",style:{width:"100%"},severity:"help",class:"",label:"Ver detalles",icon:"pi pi-eye"})]),_:1},8,["to"]),o(s,{text:"",label:"Descargar en excel",style:{},onClick:t[14]||(t[14]=e=>{var n;return ye(_.value.purchase_order_id,_.value.site_name,(n=_.value.expedition_date)==null?void 0:n.split("T")[0])}),severity:"success",class:"",icon:"pi pi-download"}),o(s,{onClick:t[15]||(t[15]=e=>de(_.value.purchase_order_id)),text:"",label:"Ver Historial",style:{},severity:"warning",class:"",icon:"pi pi-history p-0 m-0"}),o(s,{onClick:t[16]||(t[16]=e=>pe(_.value.purchase_order_id)),label:"Transportar orden",style:{},severity:"help",class:"",icon:"pi  p-0 m-0"})])]),_:1},8,["visible"]),o(i,{class:"px-2",visible:N.value,"onUpdate:visible":t[20]||(t[20]=e=>N.value=e),modal:"",header:"Transportar orden",style:{width:"max-content","max-width":"100vw"}},{footer:r(()=>[a("div",ct,[o(s,{outlined:"",onClick:ce,severity:"help",label:"Todo esta completo"}),o(s,{onClick:t[19]||(t[19]=e=>re(S.value.filter(n=>n.quantity!=0))),severity:"help",label:"Transportar orden"})])]),default:r(()=>[a("div",Ze,[a("p",et,[tt,f(" "+p(_.value.responsible_lap),1)]),a("p",at,[st,f(" "+p(_.value.site_name),1)]),a("p",ot,[lt,f(" "+p(_.value.status_timestamp.split("T")[0]),1)]),a("div",nt,[(W(),K(ae,null,Se(he,e=>a("div",it,[o(P,{style:R([`background-color:${e.color}`,{height:"2rem","aspect-ratio":"4 / 3"}])},null,8,["style"]),a("span",null,p(e.description),1)])),64))]),o(y,{showGridlines:"",style:{"max-width":"1024px"},stripedRows:"",filters:D.value,"onUpdate:filters":t[18]||(t[18]=e=>D.value=e),class:"col-12 m-auto p-0 m-0",value:S.value.filter(e=>e.quantity!=0),tableStyle:"min-width: 50rem;"},{default:r(()=>[o(m,{class:"py-0",field:"item_id",header:"id"}),o(m,{class:"py-0",field:"item_name",header:"Item"},{body:r(e=>[a("p",{style:R(e.data.ajustment===0?"text-decoration: line-through;background-color:#ffc9d1":"")},p(e.data.item_name),5)]),_:1}),o(m,{class:"py-0",field:"quantity_adjusted",header:"cant. Aprobada en despacho"},{body:r(e=>[a("p",rt,p(e.data.quantity_adjusted),1)]),_:1}),o(m,{class:"py-0 px-0",field:"quantity",header:"cant. realmente recibida"},{body:r(e=>[Ae(a("input",{onChange:n=>De(e.data),onKeydown:xe,class:"text-right",max:e.data.quantity,min:0,"onUpdate:modelValue":n=>e.data.ajustment=n,style:R([{"background-color":"transparent",height:"2rem",width:"100%",border:"none"},e.data.quantity_adjusted===e.data.ajustment?"background-color: aquamarine;":e.data.ajustment===0?"background-color:#ffc9d1":e.data.ajustment<e.data.quantity?"background-color:#FFAF33;border:2px solid #FF7A33":e.data.ajustment>e.data.quantity?"background-color:#FF3393;border:2px solid #FF3342":""]),type:"number"},null,44,dt),[[Ee,e.data.ajustment]])]),_:1}),o(m,{class:"py-0",field:"unit_measure",header:"Und. de medida"}),o(m,{class:"py-0",field:"quantity",header:"interactuar"},{body:r(e=>[o(s,{onClick:n=>e.data.ajustment=e.data.quantity_adjusted,style:{"min-width":"max-content"},text:"",class:"px-0 py-1",label:"Esta completo"},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value"])])]),_:1},8,["visible"]),a("div",ut,[a("div",pt,[o(s,{severity:"help",icon:"pi pi-download",label:"Descargar Todo",onClick:we}),o(s,{severity:"help",icon:"pi pi-download",label:"Descargar Informe",onClick:be})])]),a("div",mt,[o(y,{showGridlines:"",style:{"max-width":"1024px"},filters:D.value,"onUpdate:filters":t[22]||(t[22]=e=>D.value=e),class:"col-12 m-auto",value:T.value,tableStyle:"min-width: 50rem;"},{header:r(()=>[a("div",ht,[vt,a("div",_t,[o(G,{style:{width:"100%"},class:"",modelValue:D.value.global.value,"onUpdate:modelValue":t[21]||(t[21]=e=>D.value.global.value=e),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:r(()=>[o(m,{class:"py-1",field:"purchase_order_id",header:"ID"}),o(m,{class:"py-1",field:"responsible_lap",header:"Autorizada por"}),o(m,{class:"py-1",field:"site_name",header:"Sede"}),o(m,{class:"py-1",field:"date",header:"Fecha de autorizacion"},{body:r(e=>{var n;return[a("p",yt,p((n=e.data.status_timestamp)==null?void 0:n.split("T")[0]),1)]}),_:1}),o(m,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:r(e=>{var n;return[a("span",ft,p((n=e.data.status_timestamp)==null?void 0:n.split("T")[1]),1)]}),_:1}),o(m,{class:"py-1",field:"date",header:"Estado actual"},{body:r(e=>[o(P,{style:R([{width:"100%",height:"2.7rem"},`background-color:${me[e.data.current_status]}`])},{default:r(()=>[f(p(e.data.current_status),1)]),_:2},1032,["style"])]),_:1}),o(m,{style:{width:"20px"},class:"py-1 mx-0 px-0",field:"date",header:"Acciones"},{body:r(e=>[a("div",gt,[o(s,{label:"Interactuar",onClick:n=>ue(e.data),severity:"help",class:"",icon:"pi "},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])]),o(i,{class:"mx-2",visible:z.value,"onUpdate:visible":t[23]||(t[23]=e=>z.value=e),modal:"",header:"Historial de la orden",style:{width:"min-content"}},{default:r(()=>[o(V,{value:J.value},{opposite:r(e=>{var n;return[a("p",bt,p(e.item.status_timestamp.split("T")[0]),1),f(),wt,a("p",xt,p((n=e.item.status_timestamp.split("T")[1])==null?void 0:n.split(":").slice(0,2).join(":")),1)]}),content:r(e=>[a("p",Dt,[a("b",null,p(e.item.lap_name),1)]),a("p",kt,p(e.item.name),1),e.item.notes?(W(),K("p",Ct,[Tt,f(" "+p(e.item.notes),1)])):Oe("",!0),a("div",jt,[o(s,{disabled:!e.item.notes,style:{height:"2rem",opacity:"0","border-radius":"0.3rem"},cla:"",severity:"help",class:"",label:"Notas"},null,8,["disabled"]),o(s,{disabled:!e.item.conflict,style:{height:"2rem","border-radius":"0.3rem"},severity:"danger",class:"mb-4",label:"Conflictos"},null,8,["disabled"])])]),_:1},8,["value"])]),_:1},8,["visible"])],64)}}},Pt=ke(Ft,[["__scopeId","data-v-92862b39"]]);export{Pt as default};
