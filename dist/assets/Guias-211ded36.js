import{_ as $e,x as Ve,f as n,Q as De,h as Pe,B as Ae,u as Fe,r as V,o as L,c as D,d as o,w as i,F as Ue,R as Ne,U as f,a as s,a4 as K,q as T,l as x,P as S,k as g,t as m,a2 as je,J as Be,n as ue,y as Ie,p as He,e as Re}from"./index-7972d487.js";import{_ as Oe}from"./file-4fa33ca9.js";const _=U=>(He("data-v-3fa968cd"),U=U(),Re(),U),ze=_(()=>s("p",{class:"mb-2 text-4xl text-center px-4",style:{"font-weight":"bold","text-transform":"capitalize"}},[s("i",{class:"fa-solid fa-person-chalkboard"}),g(" Gestion de guias ")],-1)),Me=_(()=>s("h4",null,"Seleccione el elemento a eliminar:",-1)),qe={style:{display:"flex",gap:"1rem"}},Ge=_(()=>s("p",null,"¿Estás seguro de que quieres eliminar este archivo?",-1)),Je=["onSubmit"],Ke={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},Qe=["onSubmit"],We={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},Xe={class:"grid col-12 m-0 p-0 gap-3 text-center",style:{}},Ye={class:"grid col-12 p-0 gap-3 my-4 m-0"},Ze={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ea={key:0,class:"m-0 text-2xl my-4"},aa={key:1,class:"m-0 text-2xl my-4"},ta={key:2,class:"m-0 text-2xl my-4"},oa={key:3,class:"m-0 text-2xl my-4"},sa={class:"block mt-2 md:mt-0 p-input-icon-left"},la=_(()=>s("i",{class:"pi pi-search"},null,-1)),ra=_(()=>s("span",{class:"p-column-title"},"Code",-1)),na={class:"",style:{position:"relative",display:"flex","justify-content":"center"}},ia={style:{color:"white","font-size":"0.7rem",position:"absolute","font-weight":"bold",bottom:"0.9rem","text-transform":"uppercase"}},da=_(()=>s("span",{class:"p-column-title"},"Code",-1)),ca=_(()=>s("span",{class:"p-column-title"},"Code",-1)),ua=_(()=>s("span",{class:"p-column-title"},"Code",-1)),pa=_(()=>s("span",{class:"p-column-title"},"Code",-1)),ma={class:"text-right"},va={class:"text-right"},fa=["onSubmit"],ha={class:"field my-3",style:{display:"flex",gap:"1rem","justify-content":"end","flex-direction":"column"}},ya={key:0,style:{"background-color":"var(--green-100)","border-radius":"0.2rem"},class:"col-12 my-4"},ga={style:{display:"flex",gap:"1rem","justify-content":"end"}},_a={__name:"Guias",setup(U){const l=Ve(),pe={pdf:"#E74C3C",doc:"#3498DB",docx:"#3498DB",xls:"#27AE60",xlsx:"#27AE60",ppt:"#E67E22",pptx:"#E67E22",psd:"#34495E",ai:"#F39C12",indd:"#EB4D4B",jpg:"#F1C40F",jpeg:"#F1C40F",png:"#1ABC9C",gif:"#F39C12",bmp:"#2ECC71",tiff:"#D35400",svg:"#9B59B6",mp3:"#2ECC71",wav:"#3498DB",aac:"#9B59B6",flac:"#E74C3C",ogg:"#E67E22",csv:"#27AE60"},N=n(!1),P=n(null),Q=n([]),me=()=>{P.value=null},j=async()=>{await M().then(e=>C.value=e),await G().then(e=>{w.value=e}),await J().then(e=>{k.value=e}),Q.value=[...w.value.map(e=>({id:e.id_area,name:e.area_name,type:"area"})),...k.value.map(e=>({id:e.id_type,name:e.type_name,type:"type"}))]},ve=async()=>{if(!P.value)return;const{id:e,type:a}=P.value;let v=`${f}/`;a==="area"?v+=`area/${e}`:a==="type"&&(v+=`archived-file-type/${e}`);try{const r=await fetch(v,{method:"DELETE"});if(!r.ok)throw new Error(`HTTP error! Status: ${r.status}`);y.add({severity:"success",summary:"Éxito",detail:`${a==="area"?"Área":"Tipo"} eliminado correctamente`,life:3e3}),a==="area"?G().then(c=>{w.value=c,j()}):J().then(c=>{j(),k.value=c}),N.value=!1}catch(r){y.add({severity:"error",summary:"Error",detail:r.message,life:3e3})}},B=n(!1),I=n({area_name:""}),H=n(!1),R=n({type_name:""}),fe=()=>{I.value={area_name:""}},he=()=>{R.value={type_name:""}},W=async()=>{l.setLoading(!0,"creando area");try{const e=await fetch(`${f}/area`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I.value)});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);y.add({severity:"success",summary:"Éxito",detail:"Área creada correctamente",life:3e3}),G().then(a=>w.value=a),B.value=!1,l.setLoading(!1,"cargando archivos")}catch(e){y.add({severity:"error",summary:"Error",detail:e.message,life:3e3}),l.setLoading(!1,"cargando archivos")}},X=async()=>{l.setLoading(!0,"creando tipo");try{const e=await fetch(`${f}/archived-file-type`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R.value)});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);y.add({severity:"success",summary:"Éxito",detail:"Tipo de archivo creado correctamente",life:3e3}),J().then(a=>k.value=a),H.value=!1,l.setLoading(!1,"cargando archivos")}catch(e){y.add({severity:"error",summary:"Error",detail:e.message,life:3e3}),l.setLoading(!1,"cargando archivos")}},w=n([]),k=n([]),A=n(!1),O=n(null),ye=e=>{O.value=e,A.value=!0},ge=async()=>{if(l.setLoading(!0,"borrando archivo"),!!O.value)try{const e=await fetch(`${f}/archived-file/${O.value}`,{method:"DELETE"});if(e.ok)l.setLoading(!1,"borrando archivo"),y.add({severity:"success",summary:"Éxito",detail:"Archivo eliminado correctamente",life:3e3}),M().then(a=>C.value=a);else throw new Error(`Error al eliminar el archivo: ${e.statusText}`)}catch(e){l.setLoading(!1,"borrando archivo"),y.add({severity:"error",summary:"Error",detail:e.message,life:3e3})}finally{l.setLoading(!1,"borrando archivo"),A.value=!1,O.value=null}},d=n(k.value[0]),u=n(w.value[0]),h=n({}),_e=n({}),C=n([]),Y=n(null),F=n(!1),$=n({archived_file_id:"",custom_filename:"",file:null}),we=()=>{F.value=!0},Z=()=>{F.value=!1,$.value={archived_file_id:"",custom_filename:"",file:null}},be=e=>{$.value.file=e.target.files[0]},ee=async()=>{if($.value.file){const e=new FormData;e.append("file",$.value.file),e.append("id_area",h.value.area.id_area),e.append("id_type",h.value.type.id_type),e.append("file_name",h.value.file_name);try{const a=await fetch(`${f}/upload-archived-file/`,{method:"POST",body:e});if(a.ok){const v=await a.json();y.add({severity:"success",summary:"Éxito",detail:"Archivo subido correctamente",life:3e3}),Z(),M().then(r=>C.value=r)}else throw new Error(`Error al subir el archivo: ${a.statusText}`)}catch(a){y.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}}else y.add({severity:"warn",summary:"Advertencia",detail:"Por favor, selecciona un archivo",life:3e3})},ae=n();n([]);const z=n(null),xe=()=>{z.value={global:{value:null,matchMode:Ne.CONTAINS}}};De(()=>{xe()});const ke=(e,a,v)=>{const r=`${f}/get-archived-file/${e}/${a}/${v.split(".")[0]}`;fetch(r).then(c=>{if(c.ok)return c.blob();throw new Error("Network response was not ok.")}).then(c=>{const E=window.URL.createObjectURL(c),p=document.createElement("a");p.href=E,p.download=v,document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(E)}).catch(c=>console.error("Error downloading the file:",c))};async function M(){l.setLoading(!0,"cargando archivos");try{const e=await fetch(`${f}/archived-files`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return l.setLoading(!1,"cargando archivos"),a}catch(e){l.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function G(){l.setLoading(!0,"cargando areas");try{const e=await fetch(`${f}/areas`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return l.setLoading(!1,"cargando archivos"),a}catch(e){l.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function J(){l.setLoading(!0,"cargando tipos");try{const e=await fetch(`${f}/archived-file-types    `);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return l.setLoading(!1,"cargando archivos"),a}catch(e){l.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}Pe(()=>{j()});async function Ce(){if(l.setLoading(!0,"cargando archivos"),!u.value){l.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${f}/archived-files/area/${u.value.id_area}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return l.setLoading(!1,"cargando archivos"),a}catch(e){l.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function Ee(){if(l.setLoading(!0,"cargando archivos"),!d.value){l.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${f}/archived-files/type/${d.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return l.setLoading(!1,"cargando archivos"),a}catch(e){l.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function Le(){if(l.setLoading(!0,"cargando archivos"),!d.value||!u.value){l.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${f}/archived-files/${u.value.id_area}/${d.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return l.setLoading(!1,"cargando archivos"),a}catch(e){console.error("Error al obtener usuarios agrupados por sede:",e),l.setLoading(!1,"cargando archivos")}}const Te=()=>{u.value&&d.value?Le().then(e=>C.value=e):!u.value&&d.value?Ce().then(e=>C.value=e):u.value&&!d.value?Ee().then(e=>C.value=e):M()},y=Ae();return Fe(),(e,a)=>{var te,oe,se,le;const v=V("Dropdown"),r=V("Button"),c=V("Dialog"),E=V("InputText"),p=V("Column"),Se=V("DataTable");return L(),D(Ue,null,[ze,o(c,{visible:N.value,"onUpdate:visible":a[1]||(a[1]=t=>N.value=t),header:"Eliminar área o tipo",modal:"",closable:!0,onHide:me},{default:i(()=>[s("div",null,[Me,s("div",qe,[o(v,{style:{width:"60%"},modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=t=>P.value=t),options:Q.value,optionLabel:"name",placeholder:"Seleccione un área o tipo"},null,8,["modelValue","options"]),o(r,{style:{width:"40%"},label:"Eliminar",icon:"pi pi-check",class:"p-button-danger",onClick:ve})])])]),_:1},8,["visible"]),o(c,{visible:A.value,"onUpdate:visible":a[3]||(a[3]=t=>A.value=t),header:"Confirmar eliminación",modal:"",closable:!1},{default:i(()=>[Ge,o(r,{label:"No",icon:"pi pi-times",onClick:a[2]||(a[2]=t=>A.value=!1),class:"p-button-text"}),o(r,{label:"Sí",icon:"pi pi-check",onClick:ge,class:"p-button-danger"})]),_:1},8,["visible"]),o(c,{visible:B.value,"onUpdate:visible":a[5]||(a[5]=t=>B.value=t),header:"Crear nueva área",modal:"",closable:!0,onHide:fe},{default:i(()=>[s("form",{onSubmit:K(W,["prevent"])},[o(E,{modelValue:I.value.area_name,"onUpdate:modelValue":a[4]||(a[4]=t=>I.value.area_name=t),placeholder:"Nombre del área",class:"w-full"},null,8,["modelValue"]),s("div",Ke,[o(r,{rounded:"",class:"mt-4",label:"Crear",icon:"pi pi-check",onClick:W})])],40,Je)]),_:1},8,["visible"]),o(c,{visible:H.value,"onUpdate:visible":a[7]||(a[7]=t=>H.value=t),header:"Crear nuevo tipo de archivo",modal:"",closable:!0,onHide:he},{default:i(()=>[s("form",{onSubmit:K(X,["prevent"])},[o(E,{modelValue:R.value.type_name,"onUpdate:modelValue":a[6]||(a[6]=t=>R.value.type_name=t),placeholder:"Nombre del tipo de archivo",class:"w-full"},null,8,["modelValue"]),s("div",We,[o(r,{rounded:"",class:"mt-4",label:"Crear",icon:"pi pi-check",onClick:X})])],40,Qe)]),_:1},8,["visible"]),o(Se,{class:"card mb-4 p-5 my-3 shadow-4",grid:"",style:{"background-color":"white","max-width":"1024px",border:"none",margin:"auto"},ref:"dt",value:C.value,selection:ae.value,"onUpdate:selection":a[15]||(a[15]=t=>ae.value=t),dataKey:"id",paginator:!0,rows:10,filters:z.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} archivos"},{header:i(()=>{var t,q,re,ne,ie,de,ce;return[s("div",Xe,[o(r,{class:"col",style:{height:"2.5rem","min-width":"max-content"},onClick:a[8]||(a[8]=b=>F.value=!0),severity:"success"},{default:i(()=>[s("i",{class:T([x(S).UPLOAD,"pr-3"])},null,2),g(" Nuevo archivo")]),_:1}),o(r,{class:"col text-center",style:{height:"2.5rem","min-width":"max-content"},severity:"warning",onClick:a[9]||(a[9]=b=>B.value=!0)},{default:i(()=>[s("i",{class:T([x(S).PLUS,"pr-3"])},null,2),g(" Nueva area ")]),_:1}),o(r,{class:"col",style:{height:"2.5rem","min-width":"max-content"},severity:"info",onClick:a[10]||(a[10]=b=>H.value=!0)},{default:i(()=>[s("i",{class:T([x(S).PLUS,"pr-3"])},null,2),g(" Nuevo tipo de archivo ")]),_:1}),o(r,{class:"col",style:{height:"2.5rem","min-width":"max-content"},severity:"danger",onClick:a[11]||(a[11]=()=>{N.value=!0,j()})},{default:i(()=>[s("i",{class:T([x(S).TRASH,"pr-3"])},null,2),g(" Eliminar área o tipo ")]),_:1})]),s("div",Ye,[o(v,{style:{height:"3rem","text-justify":"center"},class:"col-12 lg:col-5 p-0",optionLabel:"area_name",modelValue:u.value,"onUpdate:modelValue":a[12]||(a[12]=b=>u.value=b),options:w.value,placeholder:"Area de la empresa"},null,8,["modelValue","options"]),o(v,{style:{height:"3rem","text-justify":"center"},class:"col-12 lg:col-5 p-0",modelValue:d.value,"onUpdate:modelValue":a[13]||(a[13]=b=>d.value=b),optionLabel:"type_name",options:k.value,placeholder:"Tipo de archivo"},null,8,["modelValue","options"]),o(r,{onClick:Te,style:{height:"3rem","border-radius":"50%","aspect-ratio":"1/1",display:"flex","align-items":"center","justify-content":"center"},class:"text-center",severity:"help",size:"small"},{default:i(()=>[s("i",{class:T(x(S).SEARCH)},null,2)]),_:1})]),s("div",Ze,[!d.value&&!u.value?(L(),D("p",ea,m((t=d.value)==null?void 0:t.type_name)+" Todos los tipos de archivos de todas las areas "+m((q=u.value)==null?void 0:q.area_name),1)):d.value&&!u.value?(L(),D("p",aa,m((re=d.value)==null?void 0:re.type_name)+" de todas las areas ",1)):!d.value&&u.value?(L(),D("p",ta,m((ne=d.value)==null?void 0:ne.type_name)+" Todos los tipos de archivos del area "+m((ie=u.value)==null?void 0:ie.area_name),1)):(L(),D("p",oa,m((de=d.value)==null?void 0:de.type_name)+" del area de "+m((ce=u.value)==null?void 0:ce.area_name),1)),x(je)()==_e.value.creator_id?(L(),Be(r,{key:4,label:"Subir archivo",icon:"pi pi-upload",class:"p-button-success ml-4 p-2",onClick:we})):ue("",!0),s("span",sa,[la,o(E,{class:"",modelValue:z.value.global.value,"onUpdate:modelValue":a[14]||(a[14]=b=>z.value.global.value=b),placeholder:"Buscar..."},null,8,["modelValue"])])])]}),default:i(()=>[o(p,{class:"p-2",selectionMode:"multiple",headerStyle:"width: 3rem; ",frozen:""}),o(p,{class:"p-2",field:"id",header:"Id",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ra,g(" "+m(t.data.id_file),1)]),_:1}),o(p,{class:"p-2",field:"id",header:"",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[s("div",na,[s("img",{style:Ie([{height:"3.5rem","aspect-ratio":"1 / 1","object-fit":"contain","border-radius":"0.5rem"},`background-color:${pe[t.data.file_extension]} `]),class:"p-1",src:Oe,alt:""},null,4),s("span",ia,m(t.data.file_extension.slice(0,4)),1)])]),_:1}),o(p,{class:"p-2",field:"file_name",header:"Nombre",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[da,g(" "+m(t.data.file_name),1)]),_:1}),o(p,{class:"p-2",field:"type",header:"Tipo",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ca,g(" "+m(t.data.type_name),1)]),_:1}),o(p,{class:"p-2",field:"type",header:"Area",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ua,g(" "+m(t.data.area_name),1)]),_:1}),o(p,{class:"p-2",field:"upload_date",header:"Fecha",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[pa,g(" "+m(t.data.upload_date),1)]),_:1}),o(p,{class:"p-2",field:"location",header:"Acciones",sortable:!0,frozen:"",alignFrozen:"right",headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[o(r,{text:"",class:"p-0 mx-2",severity:"success",onClick:q=>ke(t.data.id_area,t.data.id_type,t.data.file_name)},{default:i(()=>[s("span",ma,[s("i",{class:T(x(S).DOWNLOAD)},null,2)])]),_:2},1032,["onClick"]),o(r,{text:"",class:"p-0 mx-2",severity:"danger",onClick:q=>ye(t.data.id_file)},{default:i(()=>[s("span",va,[s("i",{class:T(x(S).TRASH)},null,2)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),o(c,{visible:F.value,"onUpdate:visible":a[20]||(a[20]=t=>F.value=t),style:{width:"450px"},header:`Subir ${(oe=(te=h.value)==null?void 0:te.type)==null?void 0:oe.type_name} para el area de ${(le=(se=h.value)==null?void 0:se.area)==null?void 0:le.area_name}`,modal:"",closable:!0,onHide:Z},{default:i(()=>[s("form",{onSubmit:K(ee,["prevent"]),enctype:"multipart/form-data"},[o(E,{optionLabel:"area_name",placeholder:"Nombre del archivo",class:"col-12 my-0",style:{padding:"0.8rem 10px"},modelValue:h.value.file_name,"onUpdate:modelValue":a[16]||(a[16]=t=>h.value.file_name=t),options:w.value},null,8,["modelValue","options"]),o(v,{optionLabel:"area_name",placeholder:"Area de la empresa",class:"col-12 p-0 my-3",modelValue:h.value.area,"onUpdate:modelValue":a[17]||(a[17]=t=>h.value.area=t),options:w.value},null,8,["modelValue","options"]),o(v,{class:"col-12 p-0",placeholder:"Tipo de archivo",modelValue:h.value.type,"onUpdate:modelValue":a[18]||(a[18]=t=>h.value.type=t),optionLabel:"type_name",options:k.value},null,8,["modelValue","options"]),s("div",ha,[$.value.file?(L(),D("div",ya,m($.value.file.name),1)):ue("",!0),s("div",ga,[s("input",{type:"file",id:"file",ref_key:"fileInput",ref:Y,onChange:be,required:"",style:{display:"none"}},null,544),o(r,{rounded:"",onClick:a[19]||(a[19]=()=>{Y.value.click()})},{default:i(()=>[g(" Cargar archivo")]),_:1}),o(r,{rounded:"",severity:"success",label:"Enviar",class:"",onClick:ee})])])],40,fa)]),_:1},8,["visible","header"])],64)}}},xa=$e(_a,[["__scopeId","data-v-3fa968cd"]]);export{xa as default};
