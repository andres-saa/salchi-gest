import{a as p,u as $}from"./site-1fa2dfca.js";import{O as P,a9 as S,U as w,y as b,l as D}from"./index-2fc8df2c.js";import{u as R}from"./ventas-69a07ec1.js";const U=P("client",{persist:{key:"client",storage:localStorage,paths:["user"]},state:()=>({user:{name:"",neigborhood:"",address:"",phone_number:"",payment_method_option:""}}),getters:{fucion:e=>0},actions:{async func(){return func}}}),n=R(),o=p(),d=$(),t=U(),A=()=>{var m,g,h,f,y,v;t.user.was_reserva=!1,o.sending_order=!0;const e=o.cart,r=D(),s=d.location.site.site_id,l=d.location.site.pe_site_id,i=(m=t.user.payment_method_option)==null?void 0:m.id,u=(g=t.user.order_type)==null?void 0:g.id;if(!u){alert("Error: Debe seleccionar un método de entrega.");return}const a=t.user.placa,c=i===7?0:d.location.neigborhood.delivery_price;if(u===2&&s===33&&(!a||a.trim()==="")){alert("Error: Debe proporcionar la placa del vehículo para recogida.");return}let N=((h=o==null?void 0:o.cart)==null?void 0:h.order_notes)??"";const O={user_name:t.user.name,user_phone:(f=t.user.phone_number)==null?void 0:f.split(" ").join(""),user_address:` ${t.user.address} ${(v=(y=d.location)==null?void 0:y.neigborhood)==null?void 0:v.name}`||"",email:t.user.email};return{order_products:[],site_id:s,pe_site_id:l,order_type_id:u,placa:a,delivery_person_id:4,payment_method_id:i,delivery_price:c,order_notes:N||"SIN NOTAS",user_data:O,order_aditionals:[],pe_json:e,total:0,inserted_by:r.rawUserData.id}},j=()=>{var a,c;t.user.was_reserva=!0,o.sending_order=!0;const e=o.cart.products.map(_=>({product_instance_id:_.product.id,quantity:_.quantity})),r=d.location.siteReservas.site_id,s=(a=t.user.payment_method_option)==null?void 0:a.id,l=o.cart.order_notes,i={user_name:t.user.name,user_phone:(c=t.user.phone_number)==null?void 0:c.split(" ").join(""),user_address:"Debe ir a la sede",email:t.user.email};return{order_products:e,site_id:r,delivery_person_id:4,payment_method_id:s,delivery_price:0,order_notes:l||"SIN NOTAS",user_data:i,order_aditionals:[]}},E={async sendOrder(){const e=A(),r=p();if(!L(e))return r.sending_order=!1,null;try{n.setLoading(!0,`enviando tu pedido ${t.user.name}`);const s=await S.post(`${w}/order`,e);if(s.status===200)r.sending_order=!1,r.last_order=s.data,n.setLoading(!0,"enviando tu pedido"),b.push("/call-center-vender/gracias");else return console.error("An error occurred while sending the order:",s.status),alert("An error occurred while sending the order. Please try again."),n.setLoading(!1,"enviando tu pedido"),r.sending_order=!1,null}catch(s){return console.error("An error occurred while sending the order:",s),n.setLoading(!1,"enviando tu pedido"),r.sending_order=!1,alert("An error occurred while sending the order. Please check your internet connection and try again."),r.sending_order=!1,null}},preparar_orden(){A()},async sendOrderReserva(){const e=j(),r=p();if(t.user.was_reserva=!0,!L(e))return r.sending_order=!1,null;try{n.setLoading(!0,`enviando tu pedido ${t.user.name}`);const s=await S.post(`${w}/order`,e);if(s.status===200)r.sending_order=!1,r.last_order=s.data,n.setLoading(!1,"enviando tu pedido"),b.push("/gracias");else return console.error("An error occurred while sending the order:",s.status),alert("An error occurred while sending the order. Please try again."),n.setLoading(!1,"enviando tu pedido"),r.sending_order=!1,null}catch(s){return console.error("An error occurred while sending the order:",s),n.setLoading(!1,"enviando tu pedido"),r.sending_order=!1,alert("An error occurred while sending the order. Please check your internet connection and try again."),r.sending_order=!1,null}}};function L(e){return!e.user_data.user_name||e.user_data.user_name.trim()==""||!e.user_data.user_phone||e.user_data.user_phone.trim()==""||!e.user_data.user_address||e.user_data.user_address.trim()==""||e.user_data.email.trim()==""?(alert("Sus datos estan incompletos por favor reviselos"),o.sending_order=!1,!1):!e.site_id||e.delivery_price==null?(alert("Site information is missing. Please select a valid site."),o.sending_order=!1,!1):!0}export{E as o,U as u};
