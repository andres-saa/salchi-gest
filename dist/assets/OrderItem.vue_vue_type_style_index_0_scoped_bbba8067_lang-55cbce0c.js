import{_ as ne,g as v,h as W,i as D,U as P,Z as ae,H as X,e as k,o as u,c as g,a as e,b as i,f as m,P as I,u as s,a2 as C,m as y,t as r,x as T,j as O,d as ie,F as R,r as N,p as de,k as ce}from"./index-94da6d1e.js";import{f as x}from"./formatoPesos-8aa989a0.js";const n=V=>(de("data-v-de9ad6fd"),V=V(),ce(),V),ue=n(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),pe=n(()=>e("span",{for:"responsible"},"Responsable",-1)),me=n(()=>e("span",{for:"reason"},"Razón",-1)),_e=n(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),be=n(()=>e("span",{class:"advert",style:{"text-transform":"lowercase",color:"red","font-weight":"bold"}}," Desde el 16 de mayo de 2024, la cancelación de órdenes requerirá autorización.",-1)),ve=n(()=>e("span",{for:"responsible"},"Responsable",-1)),ye=n(()=>e("span",{for:"reason"},"Razón",-1)),he={style:{"text-transform":"capitalize"}},ge={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},fe={class:""},we={id:"factura",style:{width:"100%"}},Oe=n(()=>e("i",{class:"pi pi-whatsapp mr-2"},null,-1)),xe=n(()=>e("br",null,null,-1)),ke={class:"",style:{width:"auto"}},Ce={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},Ve={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},Me={style:{padding:"0",color:"black","text-align":"center",margin:"auto","margin-bottom":"1rem",width:"max-content","min-width":"max-content",display:"flex","justify-content":"center","flex-direction":"column"}},$e=n(()=>e("div",{class:"",style:{"font-weight":"bold",color:"white",margin:"0","background-color":"black","align-items":"center",display:"grid","grid-template-columns":"auto auto"}},[e("div",{style:{width:"100%"}},[e("b",null," productos")]),e("div",null,[e("p",{style:{"text-align":"end","font-weight":"bold"}},[e("b",null," total ")])])],-1)),Ee={style:{display:"grid","grid-template-columns":"auto auto"}},ze={class:"p-0 m-0"},De=n(()=>e("br",null,null,-1)),Pe={key:0,style:{"text-align":"end",color:"black"}},Te={key:1,style:{"text-align":"end",color:"black"}},Re={key:0,class:"p-0 m-0"},Se=n(()=>e("b",null,"COMBO INCLUYE",-1)),Ie=[Se],Ne={class:"p-0 m-0 ml-5",style:{}},je={style:{display:"flex",width:"","justify-content":"space-between"},class:"p-0 m-0"},Ue={class:"p-0 m-0",style:{}},Le={class:"p-0 m-0",style:{"text-align":"end"}},Be=n(()=>e("div",{style:{"background-color":"rgba(0, 0, 0, 0.286)",height:"1px"}},null,-1)),Ae={class:"",style:{display:"grid",color:"","margin-top":"0.5rem","grid-template-columns":"auto auto"}},Fe=n(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Subtotal")])],-1)),He={class:""},qe={style:{"text-align":"end","font-weight":"bold",color:"black"}},Ze=n(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Domicilio")])],-1)),Ge={class:""},Ye={style:{"text-align":"end","font-weight":"bold",color:"black"}},Je=n(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold",color:"black"}},[e("b",null,"Total")])],-1)),Ke={class:""},Qe={style:{"text-align":"end",color:"black","font-weight":"bold"}},We=n(()=>e("div",{class:""},null,-1)),Xe=n(()=>e("p",{style:{"font-weight":"bold","background-color":"black",color:"white",padding:"0",margin:"0","margin-top":"0.5rem"}},[e("b",null,"Notas")],-1)),et={class:"notas",style:{border:"1px solid",margin:"0",color:"black",padding:"0.5rem"}},tt=n(()=>e("p",{style:{"background-color":"black","font-weight":"bold","margin-top":"1rem",color:"white"}},[e("b",null,"cliente")],-1)),ot={style:{display:"grid","grid-template-columns":"auto auto"}},st=n(()=>e("div",{class:"",style:{}},[e("span",null,[e("b",null,"NOMBRE")])],-1)),lt={class:""},rt={style:{"text-align":"end",color:"black"}},nt=n(()=>e("div",{style:{}},[e("span",null,[e("b",null,"telefono")])],-1)),at={style:{"text-align":"end",color:"black"}},it=n(()=>e("div",{style:{}},[e("span",null,[e("b",null,"direccion ")])],-1)),dt={style:{"text-align":"end",color:"black"}},ct=n(()=>e("div",null,[e("span",null,[e("b",null,"metodo de pago")])],-1)),ut={style:{"text-align":"end",color:"black"}},pt={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},mt={class:"mt-3"},_t=n(()=>e("h3",null,[e("b",null,"Cambiar Método de Pago")],-1)),bt=n(()=>e("span",{for:"paymentMethod"},"Método de Pago actual",-1)),vt={for:"paymentMethod"},yt=n(()=>e("span",{for:"paymentMethod"},"Nuevo método de Pago",-1)),ht={__name:"DialogoPedido",setup(V){const M=v(!1),$=v(null),j=v([]);W(async()=>{try{const a=await D.get(`${P}/payment_methods`);j.value=a}catch(a){console.error("Error al obtener métodos de pago:",a)}o.currentOrder.value=o.currentOrder,U.value=await D.get(`${P}/sites`)});const ee=async()=>{if($.value)try{await D.put(`${P}/change-method/${o.currentOrder.order_id}/${$.value}`,`Cambiando método de pago para la orden ${o.currentOrder.order_id}`),M.value=!1,o.visibles.currentOrder=!1,console.log("Método de pago cambiado exitosamente")}catch(a){console.error("Error al cambiar el método de pago:",a)}},te=a=>{var _,b,d,h;const t=(h=(d=(b=(_=a.latest_status_timestamp)==null?void 0:_.split("T")[1])==null?void 0:b.split(":"))==null?void 0:d.slice(0,2))==null?void 0:h.join(":");switch(a.current_status){case"enviada":return`El pedido fue enviado a su domicilio a las ${t}`;case"cancelada":return`El pedido fue cancelado a las ${t}
Responsable: ${a.responsible}
Razón: ${a.reason}`;case"en preparacion":return`El pedido está en preparación desde las ${t} y será enviado en breve.`;case"generada":return`Hemos recibido su pedido a las ${t} y empezaremos a prepararlo en breve. Gracias por su espera.`;default:return""}};v(0);const E=v(!1),o=ae(),oe=X(()=>o.currentOrder.pe_json.listaPedidos.reduce((a,t)=>{var b;let _=t.pedido_cantidad*t.pedido_precio;if(t.modificadorseleccionList&&t.modificadorseleccionList.length>0){const h=((b=t.modificadorseleccionList)==null?void 0:b.filter(w=>w.pedido_productoid==t.pedido_productoid)).reduce((w,l)=>w+l.modificadorseleccion_cantidad*l.pedido_precio,0);_+=h}return a+_},0));X(()=>oe.value+o.currentOrder.delivery_price);const se=async()=>{var t;const a={order_id:o.currentOrder.order_id,responsible:(t=p.value.responsible)==null?void 0:t.name,reason:p.value.reason};await C.create_cancellling_request(a),E.value=!1,o.Notification.pause(),o.Notification.currentTime=0},z=v(!1),le=()=>{const a=document.getElementById("factura").innerHTML,t=window.open("","_blank");t.document.write("<html><head><title>Factura</title>");const _=document.getElementsByTagName("style");for(let b=0;b<_.length;b++)t.document.write(_[b].outerHTML);t.document.write("<style>  @media print { html{height: min-content;}  *{text-transform:uppercase;align-items:center; width:100%; font-family: sans-serif;padding:0;margin:0; font-size:o.9rem !IMPORTANT} body { padding:0; -webkit-print-color-adjust: exact; /* Chrome, Safari */ color-adjust: exact; /* Firefox */ } }  </style>"),t.document.write("</head><body>"),t.document.write(a),t.document.write("</body></html>"),t.document.close(),t.print(),setTimeout(()=>{t.close()},.01)},U=v([]);W(async()=>{o.currentOrder.value=o.currentOrder,U.value=await D.get(`${P}/sites`)});const S=v(!1);v(!1);const p=v({responsible:null,reason:"Sin razon"}),L=v([{name:"Restaurante",value:"restaurant"},{name:"Cliente",value:"client"}]),re=()=>{p.value.responsible&&C.cancelOrder(o.currentOrder.order_id,p.value.reason,p.value.responsible.name).then(a=>{a&&(S.value=!1,console.log("Order canceled successfully"))}).catch(a=>{console.error("Failed to cancel order:",a)})};return(a,t)=>{const _=k("Dropdown"),b=k("Textarea"),d=k("Button"),h=k("Dialog"),w=k("Tag");return u(),g(R,null,[e("div",null,[i(h,{visible:S.value,"onUpdate:visible":t[2]||(t[2]=l=>S.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:m(()=>[ue]),default:m(()=>[e("form",{onSubmit:I(re,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[pe,i(_,{style:{width:"100%"},id:"responsible",modelValue:p.value.responsible,"onUpdate:modelValue":t[0]||(t[0]=l=>p.value.responsible=l),options:L.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),me,i(b,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:p.value.reason,"onUpdate:modelValue":t[1]||(t[1]=l=>p.value.reason=l),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),i(d,{style:{width:"100%","border-radius":"0.5rem"},label:"cancelar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),i(h,{visible:E.value,"onUpdate:visible":t[5]||(t[5]=l=>E.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:m(()=>[_e]),default:m(()=>[e("form",{onSubmit:I(se,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[be,ve,i(_,{style:{width:"100%"},id:"responsible",modelValue:p.value.responsible,"onUpdate:modelValue":t[3]||(t[3]=l=>p.value.responsible=l),options:L.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),ye,i(b,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:p.value.reason,"onUpdate:modelValue":t[4]||(t[4]=l=>p.value.reason=l),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),i(d,{style:{width:"100%","border-radius":"0.5rem"},label:"solicitar cancelacion",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),i(h,{closable:!1,style:{width:"30rem"},modal:"",visible:z.value,"onUpdate:visible":t[8]||(t[8]=l=>z.value=l)},{footer:m(()=>[e("div",ge,[i(d,{text:"",size:"small",onClick:t[6]||(t[6]=()=>{s(C).deliveryZero(s(o).currentOrder.order_id),z.value=!1}),style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"si"}),i(d,{onClick:t[7]||(t[7]=l=>z.value=!1),size:"small",style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"no"})])]),default:m(()=>[e("span",he,[y(" Esta seguro de llevar a $0.00 el valor del domicilio para la orden "),e("b",null,r(s(o).currentOrder.order_id),1),y(" del cliente "),e("b",null,r(s(o).currentOrder.user_name),1),y("? ")])]),_:1},8,["visible"]),i(h,{class:"mx-3",closeOnEscape:"",closable:!1,visible:s(o).visibles.currentOrder,"onUpdate:visible":t[14]||(t[14]=l=>s(o).visibles.currentOrder=l),modal:"",style:{"max-height":"95vh",width:"35rem",position:"relative"}},{footer:m(()=>[e("div",pt,[s(o).currentOrder.current_status=="generada"?(u(),T(d,{key:0,size:"small",onClick:t[9]||(t[9]=l=>s(C).prepareOrder(s(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"Preparar"})):O("",!0),s(o).currentOrder.current_status=="en preparacion"?(u(),T(d,{key:1,size:"small",onClick:t[10]||(t[10]=l=>s(C).sendOrder(s(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"enviar"})):O("",!0),i(d,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:le,severity:"warning",label:"imprimir"}),i(d,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:t[11]||(t[11]=l=>E.value=!0),severity:"danger",label:"CANCELAR "})]),e("div",mt,[i(d,{onClick:t[12]||(t[12]=l=>M.value=!0),label:"Cambiar metodo de pago",severity:"success"})])]),default:m(()=>{var l,B,A,F,H,q,Z,G,Y,J;return[e("div",fe,[e("div",null,[e("p",{class:ie(`estado ${(B=(l=s(o).currentOrder)==null?void 0:l.current_status)==null?void 0:B.split(" ")[0]}`)},r(te(s(o).currentOrder)),3)])]),e("div",we,[s(o).currentOrder.responsible_id?(u(),T(w,{key:0,style:{},class:"tag mb-2",severity:"success"},{default:m(()=>[Oe,y(" TRANSFERENCIA APROBADA")]),_:1})):O("",!0),y(),xe,s(o).currentOrder.responsible_id?(u(),T(w,{key:1,class:"tag",severity:"success"},{default:m(()=>[y(r(s(o).currentOrder.name),1)]),_:1})):O("",!0),e("div",ke,[e("p",Ce," ID:"+r(s(o).currentOrder.order_id),1),e("p",Ve,r(s(o).currentOrder.user_name),1),e("p",Me,[e("b",null," fecha: "+r((A=s(o).currentOrder.latest_status_timestamp)==null?void 0:A.split("T")[0]),1),e("b",null," Hora: "+r((Z=(q=(H=(F=s(o).currentOrder.latest_status_timestamp)==null?void 0:F.split("T")[1])==null?void 0:H.split(":"))==null?void 0:q.slice(0,2))==null?void 0:Z.join(":")),1)]),$e,(u(!0),g(R,null,N((J=(Y=(G=s(o))==null?void 0:G.currentOrder)==null?void 0:Y.pe_json)==null?void 0:J.listaPedidos,c=>{var K,Q;return u(),g("div",null,[e("div",Ee,[e("p",ze,[y(" ( "+r(c.pedido_cantidad)+" ) "+r(c.pedido_nombre_producto)+" ",1),De]),e("div",null,[c.pedido_base_price?(u(),g("p",Pe,r(s(x)(c.pedido_base_price*c.pedido_cantidad)),1)):(u(),g("p",Te,r(s(x)(c.pedido_precio)),1))])]),((K=c.lista_productocombo)==null?void 0:K.length)>0?(u(),g("p",Re,Ie)):O("",!0),c.lista_productocombo?(u(!0),g(R,{key:1},N(c.lista_productocombo,f=>(u(),g("p",Ne,[y(" -- "),e("b",null,r(f.pedido_cantidad),1),y(" "+r(f.pedido_nombre),1)]))),256)):O("",!0),(u(!0),g(R,null,N((Q=c.modificadorseleccionList)==null?void 0:Q.filter(f=>f.pedido_productoid==c.pedido_productoid),f=>(u(),g("div",je,[e("p",Ue,[y(" - ( "+r(c.pedido_cantidad)+" ) ",1),e("b",null,r(f.modificadorseleccion_cantidad/c.pedido_cantidad),1),y(" "+r(f.modificador_nombre),1)]),e("p",Le,r(s(x)(f.pedido_precio*f.modificadorseleccion_cantidad)),1)]))),256)),Be])}),256)),e("div",Ae,[Fe,e("div",He,[e("p",qe,[e("b",null,r(s(x)(s(o).currentOrder.pe_json.delivery.delivery_pagocon-s(o).currentOrder.delivery_price)),1)])]),Ze,e("div",Ge,[e("p",Ye,[e("b",null,r(s(x)(s(o).currentOrder.delivery_price)),1)])]),Je,e("div",Ke,[e("p",Qe,[e("b",null,r(s(x)(s(o).currentOrder.pe_json.delivery.delivery_pagocon)),1)])]),We]),Xe,e("p",et,r(s(o).currentOrder.order_notes),1),tt,e("div",ot,[st,e("div",lt,[e("p",rt,r(s(o).currentOrder.user_name),1)]),nt,e("div",null,[e("p",at,r(s(o).currentOrder.user_phone),1)]),it,e("div",null,[e("p",dt,r(s(o).currentOrder.user_address),1)]),ct,e("div",null,[e("p",ut,r(s(o).currentOrder.payment_method),1)])])])]),i(d,{class:"shadow-4",onClick:t[13]||(t[13]=c=>s(o).setVisible("currentOrder",!1)),icon:"pi pi-times",rounded:"",severity:"danger",style:{position:"absolute",top:"-1rem","border-radius":"50%",right:"-1rem"}})]}),_:1},8,["visible"])]),i(h,{visible:M.value,"onUpdate:visible":t[16]||(t[16]=l=>M.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:m(()=>[_t]),default:m(()=>[e("form",{onSubmit:I(ee,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[bt,i(w,{class:"px-4",severity:"warning"},{default:m(()=>[e("span",vt,[e("b",null,r(s(o).currentOrder.payment_method),1)])]),_:1}),yt,i(_,{style:{width:"100%"},id:"paymentMethod",modelValue:$.value,"onUpdate:modelValue":t[15]||(t[15]=l=>$.value=l),options:j.value,optionLabel:"name",optionValue:"id",placeholder:"Selecciona un método de pago",required:""},null,8,["modelValue","options"]),i(d,{style:{width:"100%","border-radius":"0.5rem"},label:"Cambiar",type:"submit",class:"p-button-help"})],32)]),_:1},8,["visible"])],64)}}},wt=ne(ht,[["__scopeId","data-v-de9ad6fd"]]);export{wt as D};
