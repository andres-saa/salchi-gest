import{_ as ue,H as pe,l as ve,z as _e,r as i,A as me,I as W,q as be,s as z,U as B,a as c,o as h,b as X,d as a,i as t,h as l,B as fe,j as g,t as u,u as b,x as M,g as D,k as j,F as he,e as ge,N as we,p as ye,m as Ce,av as P}from"./index-e0d1eab6.js";import{D as Te}from"./DialogoPedido-fb8603ca.js";import"./formatoPesos-2bac1853.js";import"./formatoPesos-2293ab52.js";const r=V=>(ye("data-v-81b0839b"),V=V(),Ce(),V),ke={class:"page"},Pe=r(()=>a("header",{class:"page-header"},[a("div",{class:"title-wrap"},[a("i",{class:"pi pi-wallet"}),a("h2",null,"Transferencias por confirmadas")])],-1)),Ve={class:"card"},xe=r(()=>a("div",{class:"toolbar-left"},[a("i",{class:"pi pi-list"}),a("span",null,[a("b",null,"Solicitudes")])],-1)),Se={class:"p-input-icon-left",style:{width:"18rem","max-width":"100%"}},Re=r(()=>a("i",{class:"pi pi-search"},null,-1)),De=r(()=>a("div",{class:"empty"},[a("i",{class:"pi pi-inbox"}),a("p",null,"Sin transferencias pendientes por ahora.")],-1)),Ie={class:"action-row"},Ue={class:"filters"},qe={class:"filters-row"},Le={class:"filters-item"},$e=r(()=>a("label",{class:"filters-label"},"Fecha inicio",-1)),ze={class:"filters-item"},Be=r(()=>a("label",{class:"filters-label"},"Fecha fin",-1)),Me={class:"filters-item grow"},je=r(()=>a("label",{class:"filters-label"},"Sedes",-1)),Fe={class:"filters-item"},Ne={class:"table-header-compact"},Oe=r(()=>a("i",{class:"pi pi-chart-bar"},null,-1)),Ae=r(()=>a("div",{class:"empty"},[a("i",{class:"pi pi-folder-open"}),a("p",null,"Sin resultados para los filtros seleccionados.")],-1)),Ee={class:"m-0"},He=r(()=>a("h3",null,[a("b",null,"Rechazar orden")],-1)),Ge={class:"dialog-footer"},Je=r(()=>a("h3",null,[a("b",null,"Aprobar esta orden")],-1)),Ke=r(()=>a("div",{class:"dialog-content"},[a("p",null,"Confirma que la transferencia fue recibida.")],-1)),Qe={class:"dialog-footer"},We=r(()=>a("h3",null,[a("b",null,"El cliente no realizó la transferencia")],-1)),Xe=r(()=>a("div",{class:"dialog-content"},[a("p",null,"Se archivará la solicitud como no confirmada.")],-1)),Ye={class:"dialog-footer"},Ze={__name:"TransferSessionConfirmed",setup(V){const w=pe(),I=ve(),U=_e(),x=i([]),F=i([]),N=i([]),O=i([]),Y=i(!1),q=i(!1),A=i(0),y=i(),Z=()=>{y.value={global:{value:null,matchMode:fe.CONTAINS}}};me(()=>Z());const _=i({start_date:new Date,end_date:new Date,sites:[]}),S=i(!1),f=i(!1),C=i(!1),m=i({}),E=i({}),ee=i(0),ae=i(0),se=o=>{U.setVisible("currentOrder",!0),U.setOrder(o)},te=async o=>{const s=I.rawUserData.id;await P.authorizeOrder(o,s),f.value=!1,ee.value++,R()},le=async o=>{const s=I.rawUserData.id;await P.rejectOrder(o,s),C.value=!1,ae.value++,R()},oe=o=>{f.value=!0,m.value.order_id=o},ne=o=>{C.value=!0,E.value.order_id=o},ie=async(o,s,G)=>{const L={authorized:o,responsible_id:I.rawUserData.id,responsible_observation:m.value.reason||"sin observaciones"};await P.resolveCancellationRequest(s,L),f.value=!1,S.value=!1,x.value=await P.getPendientsCancellationRequest()},H=async()=>{q.value=!0;try{const o=await z.post(`${B}/transaction_report/`,{start_date:_.value.start_date,end_date:_.value.end_date,sites:_.value.sites.map(s=>s.site_id)});F.value=o||[],N.value=o!=null&&o[0]?Object.keys(o[0]):[]}finally{q.value=!1}},R=async()=>{x.value=await z.get(`${B}/order-to-transfer-confirmed`)};return W(()=>U.numberTransferRequests,()=>{R()}),W(()=>w.params.request_status,async()=>{x.value=await P.getPendientsCancellationRequest()},{deep:!0}),be(async()=>{O.value=await z.get(`${B}/sites/`),await Promise.all([R(),H()])}),(o,s)=>{const G=c("InputText"),L=c("Toolbar"),p=c("Column"),v=c("Button"),J=c("DataTable"),K=c("TabPanel"),Q=c("Calendar"),re=c("MultiSelect"),de=c("TabView"),ce=c("Textarea"),$=c("Dialog");return h(),X("div",ke,[Pe,a("div",Ve,[t(de,{activeIndex:A.value,"onUpdate:activeIndex":s[5]||(s[5]=e=>A.value=e)},{default:l(()=>[t(K,{header:"Básico"},{default:l(()=>[t(L,{class:"toolbar"},{start:l(()=>[xe]),end:l(()=>[a("span",Se,[Re,t(G,{modelValue:y.value.global.value,"onUpdate:modelValue":s[0]||(s[0]=e=>y.value.global.value=e),placeholder:"Buscar solicitud...",class:"w-full"},null,8,["modelValue"])])]),_:1}),t(J,{value:x.value,class:"datatable",loading:Y.value,paginator:!0,rows:15,rowsPerPageOptions:[5,10,25,100],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} transferencias",scrollable:"",scrollHeight:"65vh",stripedRows:"",showGridlines:"",filters:y.value,"onUpdate:filters":s[1]||(s[1]=e=>y.value=e)},{empty:l(()=>[De]),default:l(()=>[t(p,{field:"order_id",header:"ID orden",style:{"min-width":"max-content"},frozen:""}),t(p,{header:"Monto de la orden"},{body:l(e=>[g(u(b(M)(e.data.total_order_price)),1)]),_:1}),t(p,{header:"Fecha"},{body:l(e=>{var n,d,T,k;return[g(u((k=(T=(d=(n=e.data.latest_status_timestamp)==null?void 0:n.split("T")[0])==null?void 0:d.split("-"))==null?void 0:T.reverse())==null?void 0:k.join("-")),1)]}),_:1}),t(p,{header:"Hora"},{body:l(e=>{var n,d,T,k;return[g(u((k=(T=(d=(n=e.data.latest_status_timestamp)==null?void 0:n.split("T")[1])==null?void 0:d.split(":"))==null?void 0:T.slice(0,2))==null?void 0:k.join(":")),1)]}),_:1}),t(p,{header:"Domicilio"},{body:l(e=>{var n,d;return[g(u(b(M)(((d=(n=e.data.pe_json)==null?void 0:n.delivery)==null?void 0:d.delivery_costoenvio)||0)),1)]}),_:1}),t(p,{header:"Total"},{body:l(e=>{var n,d;return[g(u(b(M)((((d=(n=e.data.pe_json)==null?void 0:n.delivery)==null?void 0:d.delivery_costoenvio)||0)+(e.data.total_order_price||0))),1)]}),_:1}),t(p,{header:"Cliente",style:{"min-width":"16rem"}},{body:l(e=>[g(u(e.data.user_name)+" "+u(e.data.second_name)+" "+u(e.data.first_last_name)+" "+u(e.data.second_last_name),1)]),_:1}),t(p,{field:"user_phone",header:"Teléfono cliente"}),t(p,{header:"Acciones",frozen:"",alignFrozen:"right",class:"px-0",style:{"min-width":"10rem"}},{body:l(e=>[a("div",Ie,[b(w).params.request_status!="aprobadas"?(h(),D(v,{key:0,onClick:n=>se(e.data),icon:"pi pi-eye",style:{width:"2rem",height:"2rem"},severity:"info","aria-label":"Ver"},null,8,["onClick"])):j("",!0),b(w).params.request_status!="aprobadas"?(h(),D(v,{key:1,onClick:n=>oe(e.data.order_id),icon:"pi pi-check",severity:"success","aria-label":"Aprobar",style:{width:"2rem",height:"2rem"}},null,8,["onClick"])):j("",!0),b(w).params.request_status!="aprobadas"?(h(),D(v,{key:2,onClick:n=>ne(e.data.order_id),icon:"pi pi-trash",severity:"danger","aria-label":"Archivar",style:{width:"2rem",height:"2rem"}},null,8,["onClick"])):j("",!0)])]),_:1})]),_:1},8,["value","loading","filters"])]),_:1}),t(K,{header:"Reportes"},{default:l(()=>[a("div",Ue,[a("div",qe,[a("div",Le,[$e,t(Q,{modelValue:_.value.start_date,"onUpdate:modelValue":s[2]||(s[2]=e=>_.value.start_date=e),showIcon:""},null,8,["modelValue"])]),a("div",ze,[Be,t(Q,{modelValue:_.value.end_date,"onUpdate:modelValue":s[3]||(s[3]=e=>_.value.end_date=e),showIcon:""},null,8,["modelValue"])]),a("div",Me,[je,t(re,{modelValue:_.value.sites,"onUpdate:modelValue":s[4]||(s[4]=e=>_.value.sites=e),options:O.value.filter(e=>e.show_on_web),optionLabel:"site_name",display:"chip",placeholder:"Selecciona sedes",class:"w-full"},null,8,["modelValue","options"])]),a("div",Fe,[t(v,{severity:"help",onClick:H,label:"Buscar",icon:"pi pi-search"})])])]),t(J,{value:F.value,class:"datatable",loading:q.value,paginator:!0,rows:15,rowsPerPageOptions:[5,10,25,100],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} transferencias",scrollable:"",showGridlines:"",stripedRows:""},{header:l(()=>[a("div",Ne,[Oe,a("span",null,[a("b",null,"Transferencias "+u(b(w).params.section),1)])])]),empty:l(()=>[Ae]),default:l(()=>[(h(!0),X(he,null,ge(N.value,e=>(h(),D(p,{key:e,header:e,class:"py-1",style:{"text-transform":"uppercase"}},{body:l(n=>[a("h6",Ee,u(n.data[e]),1)]),_:2},1032,["header"]))),128))]),_:1},8,["value","loading"])]),_:1})]),_:1},8,["activeIndex"])]),t($,{visible:S.value,"onUpdate:visible":s[10]||(s[10]=e=>S.value=e),modal:"",closable:!0,draggable:!1,class:"dialog-md"},{header:l(()=>[He]),footer:l(()=>[a("div",Ge,[t(v,{label:"Cancelar",class:"p-button-text",onClick:s[8]||(s[8]=e=>S.value=!1)}),t(v,{label:"Rechazar",type:"submit",class:"p-button-danger",onClick:s[9]||(s[9]=e=>{var n;return(n=o.$el.querySelector("form"))==null?void 0:n.dispatchEvent(new o.Event("submit",{cancelable:!0,bubbles:!0}))})})])]),default:l(()=>[a("form",{onSubmit:s[7]||(s[7]=we(e=>ie(!1,m.value.id,m.value.reason),["prevent"])),class:"dialog-form"},[t(ce,{id:"reason",modelValue:m.value.reason,"onUpdate:modelValue":s[6]||(s[6]=e=>m.value.reason=e),rows:"5",placeholder:"¿Por qué deseas rechazar esta solicitud?",class:"w-full",style:{resize:"none","text-transform":"lowercase"}},null,8,["modelValue"])],32)]),_:1},8,["visible"]),t($,{visible:f.value,"onUpdate:visible":s[13]||(s[13]=e=>f.value=e),modal:"",closable:!0,draggable:!1,class:"dialog-sm"},{header:l(()=>[Je]),footer:l(()=>[a("div",Qe,[t(v,{label:"Cancelar",class:"p-button-text",onClick:s[11]||(s[11]=e=>f.value=!1)}),t(v,{label:"Aprobar (Transferencia confirmada)",class:"p-button-success",onClick:s[12]||(s[12]=e=>te(m.value.order_id))})])]),default:l(()=>[Ke]),_:1},8,["visible"]),t($,{visible:C.value,"onUpdate:visible":s[16]||(s[16]=e=>C.value=e),modal:"",closable:!0,draggable:!1,class:"dialog-sm"},{header:l(()=>[We]),footer:l(()=>[a("div",Ye,[t(v,{label:"Cancelar",class:"p-button-text",onClick:s[14]||(s[14]=e=>C.value=!1)}),t(v,{label:"Archivar (Transferencia no confirmada)",class:"p-button-danger",onClick:s[15]||(s[15]=e=>le(E.value.order_id))})])]),default:l(()=>[Xe]),_:1},8,["visible"]),t(Te)])}}},la=ue(Ze,[["__scopeId","data-v-81b0839b"]]);export{la as default};
