import{_ as Ue,f as n,x as Ie,C as Ve,h as Ee,U as w,g as Oe,r as V,o as v,c as y,d as o,w as p,a as e,l as A,F as X,b as ae,k as E,t as c,n as je,a4 as Fe,y as We,a5 as Me,p as Ne,e as Be}from"./index-90c38b00.js";import{u as re,f as de,s as ce,e as ue,a as Re,b as pe,c as me,d as ve}from"./subMonths-8dda982b.js";import{s as Ae}from"./siteService-5d5fe0f8.js";import{l as He}from"./user-801cd779.js";const m=H=>(Ne("data-v-51b2c5e5"),H=H(),Be(),H),ze={key:0,class:"user-info",style:{display:"flex","flex-direction":"column","align-items":"center"}},qe=["src"],Pe={class:"col-12"},Je=m(()=>e("b",null,"Nombre:",-1)),Ke=m(()=>e("b",null,"Cargo:",-1)),Ze=m(()=>e("b",null,"Telefono:",-1)),Ge=m(()=>e("b",null,"Contrato",-1)),Qe={class:""},Xe={class:"col-12 p-0 m-0"},Ye={class:"col-12 p-0 m-0"},et={class:"col-12 p-0"},tt={class:"col-12 p-0"},at=m(()=>e("p",null,"Desde:",-1)),st=m(()=>e("p",null,"Hasta:",-1)),ot=m(()=>e("div",{class:"confirmation-content"},[e("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),e("span",null,"¿Estás seguro de que quieres eliminar este día de trabajo y todos sus registros?")],-1)),lt=m(()=>e("div",{class:"confirmation-content"},[e("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),e("span",null,"¿Estás seguro de que quieres eliminar este registro?")],-1)),nt={style:{},class:"p-0 m-0"},it=m(()=>e("h3",null,"Nuevo dia",-1)),rt={class:"col-12 p-0 m-0 mb-8"},dt={class:"grid p-0 mx-auto"},ct={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},ut={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},pt={class:"col-12 md:col-2 py-2",style:{display:"flex",height:"4rem","justify-content":"end"}},mt={class:"grid"},vt={class:"col-2",style:{height:"80vh","overflow-y":"auto"}},yt={class:"p-0",style:{display:"flex","justify-content":"center"}},gt={style:{display:"flex",gap:"1rem","flex-direction":"column"},class:"pb-3 m-auto"},ft=["onDragstart"],_t=["onClick","src","onError"],ht={class:"my-0 py-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},wt={class:"my-0 py-0",style:{"min-width":"min-content","text-transform":"uppercase","text-align":"center"}},bt={class:"col-10",style:{height:"80vh","overflow-y":"auto"}},Dt={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},kt={class:"col-12 pb-6",style:{}},xt={style:{display:"flex",gap:"3rem","flex-direction":"column"}},Ct={style:{"overflow-x":"auto"}},St={style:{"min-width":"max-content","background-color":"#f4f1d6"}},Tt={class:"py-0 px-4 text-center col-12 text-xl",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},$t=["onDrop"],Lt={class:"py-0 my-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},Ut={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","text-transform":"uppercase"}},It=["onClick","src","onError"],Vt={key:0},Et={class:"py-0 my-0"},Ot={class:"py-0 my-0"},jt={class:"py-0 my-0"},Ft={class:"py-0 my-0"},Wt={key:1},Mt=m(()=>e("p",{class:"py-0 my-0"},[e("b",{style:{color:"green"}},".")],-1)),Nt=m(()=>e("p",{class:"py-0 my-0"},[e("b",{style:{color:"green"}},".")],-1)),Bt={class:"py-0 my-0"},Rt={class:"",style:{"text-transform":"uppercase"}},At=m(()=>e("p",null,"Hora de llegada:",-1)),Ht=m(()=>e("p",null,"Hora de salida:",-1)),zt={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},qt={__name:"work_schedule",setup(H){const z=n(!1),g=n(null),se=s=>{g.value=s,z.value=!0},O=n(!1),f=n(new Date),b=n(new Date),q=He(),d=Ie(),j=n(!1),P=n(null),k=n(),F=n(),x=n(),C=n(),S=n(!1),_=n(null),W=n(null),T=n(new Date),$=n(new Date),oe=Ve(()=>!x.value||!C.value?"":`${de(x.value,"dd/MM/yyyy")} - ${de(C.value,"dd/MM/yyyy")}`),ye=()=>{f.value=x.value||new Date,b.value=C.value||new Date,O.value=!0},ge=()=>{O.value=!1},M=()=>{x.value=f.value,C.value=b.value,O.value=!1,I()},Y=()=>{const s=new Date;f.value=ce(s,{weekStartsOn:1}),b.value=ue(s,{weekStartsOn:1}),M()},fe=()=>{const s=ce(new Date,{weekStartsOn:1});f.value=Re(s,7),b.value=ue(f.value,{weekStartsOn:1}),M()},_e=()=>{const s=new Date;f.value=pe(s),b.value=me(s),M()},he=()=>{const s=new Date;f.value=pe(ve(s,1)),b.value=me(ve(s,1)),M()},we=s=>{P.value=s,j.value=!0},be=async()=>{if(j.value=!1,d.setLoading(!0,"borrando"),!P.value)return;const s=await fetch(`${w}/work_records/${P.value}`,{method:"DELETE"});s.ok?(I(),d.setLoading(!1,"borrando")):(console.error("Error al eliminar el registro:",await s.text()),alert("Hubo un error al eliminar el registro."),d.setLoading(!1,"borrando")),P.value=null},N=n(!1),J=n(null),De=s=>{J.value=s,N.value=!0},ke=async()=>{if(N.value=!1,!J.value)return;d.setLoading(!0,"borrando"),(await fetch(`${w}/work_days/${J.value}`,{method:"DELETE"})).ok?(Z.value=Z.value.filter(t=>t.id!==J.value),d.setLoading(!1,"borrando")):(alert("Hubo un error al eliminar el día de trabajo."),d.setLoading(!1,"borrando"))},xe={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},Ce=s=>{if(!(s instanceof Date))return console.error("getDayColor: date is not a Date object",s),"#FFFFFF";const t=s.toLocaleDateString("en-US",{weekday:"long"});return xe[t]},K=n([]),Z=n([]),ee=(s,t)=>{const l={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},r=s==null?void 0:s.trim().toLowerCase();t.target.src=l[r]||l.default},L=n(null),U=n(!1),G=n(new Date);Ee(async()=>{F.value=await Ae.getSites(),k.value=F.value.filter(t=>t.site_id==q.rawUserData.site_id)[0],L.value=F.value.filter(t=>t.site_id==q.rawUserData.site_id)[0];const s=await re.getUsersBySiteId(q.rawUserData.site_id);K.value=s.filter(t=>t.status=="activo"),Y(),I(),await fetch(`${w}/work_days_with_records`)}),Oe(k,async s=>{const t=await re.getUsersBySiteId(s.site_id);K.value=t.filter(l=>l.status=="activo"),L.value=s,Y(),I()});const I=async()=>{if(d.setLoading(!0,"cargando horario"),!k.value||!x.value||!C.value){alert("Please select a site and date range.");return}const s=x.value.toISOString().split("T")[0],t=C.value.toISOString().split("T")[0],l=await fetch(`${w}/filtered_work_days?site_id=${k.value.site_id}&start_date=${s}&end_date=${t}`);if(l.ok){d.setLoading(!1,"cargando horario");const r=await l.json();Z.value=r.map(u=>(u.date=new Date(u.date),u.date.setDate(u.date.getDate()+1),u.users=u.records.map(D=>{let Q=K.value.find(h=>h.id===D.employer_id);if(Q){let h={...Q};const B=new Date(`${u.date.toISOString().split("T")[0]}T${D.start_time}`),R=new Date(`${u.date.toISOString().split("T")[0]}T${D.end_time}`);return h.arrivalTime=B,h.departureTime=R,h.hoursWorked=(R-B)/36e5,h}return null}).filter(D=>D!=null),d.setLoading(!1,"cargando horario"),u))}else d.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")},Se=async()=>{if(U.value=!1,d.setLoading(!0,"guardando"),!L.value||!G.value){alert("Please select a site and date.");return}let s=new Date(G.value.getTime());const t=new Date(s.getTime()-s.getTimezoneOffset()*6e4).toISOString().split("T")[0],l=await fetch(`${w}/work_days`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:t,site_id:L.value.site_id})});if(l.ok){const r=await l.json();r.date=new Date(r.date),r.date.setDate(r.date.getDate()+1),d.setLoading(!1,"guardando"),I()}else{const r=await l.json();r.detail&&r.detail==="El día con el mismo site_id ya está registrado."?alert("Este dia ya esta registrado para esta sede"):alert("Failed to add new workday"),d.setLoading(!1,"guardando")}},Te=s=>{_.value=s},$e=s=>{W.value=s,S.value=!0},Le=async()=>{if(S.value=!1,d.setLoading(!0,"cargando"),!_.value||!W.value)return;if(T.value.getTime()>=$.value.getTime()){alert("La hora de llegada no puede ser mayor o igual a la hora de salida."),d.setLoading(!1,"cargando"),S.value=!0;return}let s=T.value.toISOString().split("T")[1].slice(0,8),t=$.value.toISOString().split("T")[1].slice(0,8);const l={employer_id:_.value.id,work_day_id:W.value.id,start_time:s,end_time:t};await fetch(`${w}/work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),_.value.arrivalTime=T.value,_.value.departureTime=$.value,_.value.hoursWorked=($.value-T.value)/36e5,W.value.users.push(_.value),S.value=!1,_.value=null,W.value=null,d.setLoading(!1,"cargando")};return(s,t)=>{var B,R,le;const l=V("Button"),r=V("Dialog"),u=V("Calendar"),D=V("Dropdown"),Q=V("InputText"),h=V("InputIcon");return v(),y(X,null,[o(r,{visible:z.value,"onUpdate:visible":t[2]||(t[2]=a=>z.value=a),modal:"",style:{width:"20rem"}},{footer:p(()=>[o(l,{label:"Cerrar",onClick:t[1]||(t[1]=a=>z.value=!1)})]),default:p(()=>{var a;return[e("h3",null,c(g.value.name),1),g.value?(v(),y("div",ze,[e("img",{class:"shadow-3 p-1",src:`${A(w)}/read-product-image/300/employer-${g.value.dni}`,onError:t[0]||(t[0]=i=>ee(g.value.gender,i)),alt:"Foto del empleado",style:{width:"100px",height:"100px","border-radius":"50%","object-fit":"cover"}},null,40,qe),e("div",Pe,[e("p",null,[Je,E(" "+c(g.value.name),1)]),e("p",null,[Ke,E(" "+c(g.value.position),1)]),e("p",null,[Ze,E(" "+c(g.value.phone),1)]),e("p",null,[Ge,E(" "+c((a=g.value.contract_type)==null?void 0:a.toLowerCase()),1)])])])):je("",!0)]}),_:1},8,["visible"]),o(r,{visible:O.value,"onUpdate:visible":t[5]||(t[5]=a=>O.value=a),modal:"",closable:""},{footer:p(()=>[o(l,{severity:"danger",label:"Cancelar",onClick:ge,class:"p-button-text"}),o(l,{severity:"success",label:"Aceptar",onClick:M})]),default:p(()=>[e("div",Qe,[e("div",Xe,[o(l,{class:"col-12",severity:"danger",text:"",label:"Esta semana",onClick:Y})]),e("div",Ye,[o(l,{class:"col-12",severity:"help",text:"",label:"Semana pasada",onClick:fe})]),e("div",et,[o(l,{class:"col-12",severity:"warning",text:"",label:"Este mes",onClick:_e})]),e("div",tt,[o(l,{class:"col-12",severity:"primary",text:"",label:"Mes pasado",onClick:he})])]),at,o(u,{class:"col-12",modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=a=>f.value=a),showIcon:""},null,8,["modelValue"]),st,o(u,{class:"col-12",modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=a=>b.value=a),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),o(r,{visible:N.value,"onUpdate:visible":t[7]||(t[7]=a=>N.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:p(()=>[o(l,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[6]||(t[6]=a=>N.value=!1)}),o(l,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:ke})]),default:p(()=>[ot]),_:1},8,["visible"]),o(r,{visible:j.value,"onUpdate:visible":t[9]||(t[9]=a=>j.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:p(()=>[o(l,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[8]||(t[8]=()=>j.value=!1)}),o(l,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:be})]),default:p(()=>[lt]),_:1},8,["visible"]),e("div",nt,[o(r,{visible:U.value,"onUpdate:visible":t[13]||(t[13]=a=>U.value=a),style:{width:"22rem"},modal:"",closeOnEscape:"",onClose:t[14]||(t[14]=a=>U.value=!1)},{footer:p(()=>[o(l,{label:"cancelar",onClick:t[12]||(t[12]=a=>U.value=!1),class:"p-button-danger"}),o(l,{label:"Agregar",onClick:Se,class:"p-button-success"})]),default:p(()=>[it,o(u,{class:"my-4",modelValue:G.value,"onUpdate:modelValue":t[10]||(t[10]=a=>G.value=a),showIcon:""},null,8,["modelValue"]),o(D,{class:"col-12 p-0",disabled:"",modelValue:L.value,"onUpdate:modelValue":t[11]||(t[11]=a=>L.value=a),options:F.value,optionLabel:"site_name",placeholder:"Select a site"},null,8,["modelValue","options"])]),_:1},8,["visible"]),e("div",rt,[e("div",dt,[e("div",ct,[o(D,{disabled:!((le=A(Fe)["Horarios de trabajo admin"])!=null&&le.includes((R=(B=A(q))==null?void 0:B.rawUserData)==null?void 0:R.rol)),style:{height:"100%"},class:"col-12 p-0 m-0",modelValue:k.value,"onUpdate:modelValue":t[15]||(t[15]=a=>k.value=a),options:F.value,optionLabel:"site_name"},null,8,["disabled","modelValue","options"])]),e("div",ut,[o(Q,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:oe.value,"onUpdate:modelValue":t[16]||(t[16]=a=>oe.value=a),onClick:ye},null,8,["modelValue"])]),e("div",pt,[o(l,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:I})])])]),e("div",mt,[e("div",vt,[e("div",yt,[e("div",gt,[(v(!0),y(X,null,ae(K.value,a=>(v(),y("div",{key:a.id,draggable:"true",style:{display:"flex","flex-direction":"column","align-items":"center"},onDragstart:i=>Te(a)},[e("img",{onClick:i=>se(a),class:"shadow-2 mb-3 p-1",src:`${A(w)}/read-product-image/96/employer-${a.dni}`,alt:"user.name",onError:i=>ee(a.gender,i),style:{width:"4rem","object-fit":"cover",height:"4rem","border-radius":"50%"}},null,40,_t),e("p",ht,c(a.name.split(" ").slice(0,2).join(" ")),1),e("span",wt,c(a.position),1)],40,ft))),128))])])]),e("div",bt,[e("div",Dt,[o(l,{class:"mb-3",icon:"pi pi-plus",severity:"info",label:"Nuevo dia",onClick:t[17]||(t[17]=a=>U.value=!0)})]),e("div",kt,[e("div",xt,[(v(!0),y(X,null,ae(Z.value,a=>(v(),y("div",{class:"",key:a.id,style:{position:"relative"}},[e("div",Ct,[o(l,{style:{position:"absolute",right:"-1rem",top:"-1rem"},icon:"pi pi-trash text-2xl ",class:"p-button-rounded p-button-danger shadow-5",onClick:i=>De(a.id)},null,8,["onClick"]),e("div",St,[e("div",{class:"p-2 shadow-2",style:We({"background-color":Ce(a.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[e("p",Tt,c(a.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"}))+" ",1)],4),e("div",{class:"shadow-5 p-5",style:{"min-height":"15rem","border-radius":"0 0 0.5rem 0.5rem",display:"flex","overflow-x":"auto","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"},onDragover:t[18]||(t[18]=Me(()=>{},["prevent"])),onDrop:i=>$e(a)},[(v(!0),y(X,null,ae(a.users,i=>{var ne,ie;return v(),y("div",{class:"shadow-2 p-3",key:i.id,style:{"text-align":"center",width:"10rem","aspect-ratio":"1 / 1","background-color":"white",position:"relative","border-radius":"0.5rem"}},[e("p",Lt,c(i.name.split(" ").slice(0,1).join(" "))+" ` ",1),e("p",Ut,c(i.position.slice(0,15)),1),e("img",{class:"shadow-2 mb-3 p-1",onClick:te=>se(i),src:`${A(w)}/read-product-image/96/employer-${i.dni}`,alt:"user.name",onError:te=>ee(i.gender,te),style:{width:"4rem","object-fit":"cover",height:"4rem","border-radius":"50%"}},null,40,It),i.rest?(v(),y("div",Wt,[Mt,Nt,e("p",Bt,[e("b",null,c((ie=i.contract_type)==null?void 0:ie.toLowerCase().slice(0,13)),1)])])):(v(),y("div",Vt,[e("p",Et,"De: "+c(new Date(i.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1),e("p",Ot,"A: "+c(new Date(i.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1),e("p",jt,"por: "+c(i.hoursWorked.toFixed(2))+" hrs",1),e("p",Ft,[e("b",null,c((ne=i.contract_type)==null?void 0:ne.toLowerCase().slice(0,13)),1)])])),o(l,{size:"small",style:{position:"absolute",top:"-1rem",right:"-1rem"},icon:"pi pi-trash text-2xl",class:"p-button-rounded p-button-danger shadow-3",onClick:te=>we(i.id)},null,8,["onClick"])])}),128))],40,$t)])])]))),128)),E(" ` ")])])])]),o(r,{visible:S.value,"onUpdate:visible":t[21]||(t[21]=a=>S.value=a),style:{width:"20rem"},modal:!0},{header:p(()=>[E(" . ")]),footer:p(()=>[e("div",zt,[o(l,{severity:"success",label:"Aceptar",onClick:Le})])]),default:p(()=>[e("h5",Rt,"Cuantas horas trabajo "+c(_.value.name)+"?",1),At,o(u,{modelValue:T.value,"onUpdate:modelValue":t[19]||(t[19]=a=>T.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:p(({clickCallback:a})=>[o(h,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"]),Ht,o(u,{modelValue:$.value,"onUpdate:modelValue":t[20]||(t[20]=a=>$.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:p(({clickCallback:a})=>[o(h,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])],64)}}},Gt=Ue(qt,[["__scopeId","data-v-51b2c5e5"]]);export{Gt as default};
