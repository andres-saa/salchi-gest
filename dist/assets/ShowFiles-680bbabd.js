import{_ as J,f as d,u as H,B as Y,h as I,r as y,o as K,c as Q,d as a,a as s,w as m,F as W,U as E,k as f,t as b,l as X,v as Z,b$ as P,bT as T,q as ee,p as te,e as oe}from"./index-6bf37d47.js";import{_ as se}from"./document_image-852a5261.js";import{b as ae}from"./dropDownAux-405097ab.js";import{u as N}from"./sendFileService-e27d81d2.js";/* empty css                                                                  */const c=g=>(te("data-v-5bed12d9"),g=g(),oe(),g),le={class:"grid col-12 m-auto",style:{"box-shadow":"0 0 20px rgba(0, 0, 0, 0.26)","border-radius":"1rem",overflow:"hidden"}},ne={class:"col-12 p-0"},ie={class:""},re=c(()=>s("span",{class:"p-column-title"},"Image",-1)),de=c(()=>s("img",{src:se,class:"shadow-2",width:"100"},null,-1)),ce=c(()=>s("div",null,null,-1)),ue=c(()=>s("span",{class:"p-column-title"},"name",-1)),pe=c(()=>s("span",{class:"p-column-title"},"Category",-1)),me={class:"col-12 p-0",style:{"max-width":""}},ve=c(()=>s("label",{for:"position"},"FECHA DE RENOVACION",-1)),_e={class:"p-3",style:{"background-color":"rgba(115, 255, 76, 0.306)"}},ye=c(()=>s("i",{class:"pi pi-check",style:{color:"slateblue"}},null,-1)),he={class:"grid",style:{display:"flex","justify-content":"space-between"}},fe={class:"col-12 xl:col-6"},be={class:"col-12 xl:col-6"},ge={class:"grid",style:{display:"flex",padding:"0",margin:"0"}},we={class:"col-12 xl:col-6"},Ce=c(()=>s("label",{for:"position"},"TIPO DE DOCUMENTO",-1)),Se={class:"col-12 xl:col-6"},ke=c(()=>s("label",{for:"position"},"FECHA DE RENOVACION",-1)),De={class:"p-3",style:{"background-color":"rgba(19, 164, 0, 0.306)"}},Oe=c(()=>s("i",{class:"pi pi-check",style:{color:"slateblue"}},null,-1)),Re={style:{display:"flex","justify-content":"space-between"}},$e={__name:"ShowFiles",setup(g){const x=d([]),i=d(),u=d(),V=d(["CÁMARA DE COMERCIO","USO DE SUELOS","RUT","BOMBEROS","CONCEPTO SANITARIO","SAYCO Y ACIMPRO"]),O=d(),v=d(""),_=d(""),R=H(),h=d({}),w=Y();x.value=O.value;const A=t=>{const e=t.target.files[0];e&&(console.log("Archivo seleccionado:",e),i.value=e)},U=async t=>{let e="post";const r=`${E}/site-document/`,l={method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return(await fetch(r,l)).json()},C=async()=>{try{const t=`${E}/get-site-documents-info/${R.params.site_id}`,e=await fetch(t);if(console.log(e),!e.ok)return;const r=await e.json();O.value=r}catch(t){console.error("Error al enviar la solicitud:",t)}},F=async t=>{let e="put";const r={...t},l=`${E}/site-document/${r.document_id}`;r.renovation_date=_.value;const n={method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)};try{const p=await fetch(l,n);if(!p.ok)throw new Error(`Error en la solicitud: ${p.status}`);const D=await p.json();return C(),$(),w.add({severity:"success",summary:"Actualización exitosa",detail:"Documento actualizado correctamente",life:3e3}),D}catch(p){w.add({severity:"error",summary:"Error en la actualización",detail:p.message,life:3e3})}};I(()=>{C()}),I(()=>{const t=localStorage.getItem("currentSiteFiles");t&&(h.value=JSON.parse(t))});const S=d(!1),k=d(!1),M=(t,e,r)=>{const l={document_name:`${h.value.site_name} ${v.value}`,document_type:v.value,renovation_date:_.value,site_id:R.params.site_id};U(l).then(n=>{console.log(n),N(t,n.document_id,v.value),C()}),w.add({severity:"success",summary:"hecho",detail:"",life:3e3}),$()},q=(t,e)=>{console.log(x,v.value),`${u.value.document_name}`,u.value.document_type,_.value,R.params.site_id,console.log(e),F(e),N(t,e.document_id,e.document_type),w.add({severity:"success",summary:"hecho",detail:"",life:3e3}),$()},z=t=>{S.value=!0,u.value=t},B=t=>{k.value=!0,u.value=t},$=()=>{S.value=!1,k.value=!1,i.value=null,C()};return(t,e)=>{const r=y("Toast"),l=y("Button"),n=y("Column"),p=y("Calendar"),D=y("Dialog"),L=y("Dropdown"),j=y("DataTable");return K(),Q(W,null,[a(r),s("div",le,[s("div",ne,[s("div",ie,[a(j,{ref:"dt",value:O.value,dataKey:"id",paginator:!0,rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} products",responsiveLayout:"scroll",scrollable:"","scroll-height":"62vh",frozenValue:t.lockedCustomers},{header:m(()=>[a(l,{label:"SUBIR UN DOCUMENTO",style:{width:"max-content"},class:"p-button-rounded p-button-danger mr-0 mt-5",onClick:e[0]||(e[0]=o=>B())})]),default:m(()=>[a(n,{header:"",headerStyle:"width:0%; min-width:5rem;"},{body:m(o=>[re,de,ce]),_:1}),a(n,{field:"name",header:"Tipo de  Documento",sortable:!0,headerStyle:"width:30%; min-width:5rem; "},{body:m(o=>[ue,f(" "+b(o.data.document_type),1)]),_:1}),a(n,{field:"position",header:"Nombre ",sortable:!0,headerStyle:"width:30%; min-width:10rem;"},{body:m(o=>[pe,f(" "+b(o.data.document_name),1)]),_:1}),a(n,{field:"birth_date",header:"Fecha de renovacion",sortable:!0,headerStyle:"width:12%; min-width:10rem;"},{body:m(o=>[f(b(o.data.renovation_date),1)]),_:1}),a(n,{fieldheaderStyle:"width:30%; min-width:10rem;",frozen:"",alignFrozen:"right"},{body:m(o=>[a(l,{label:"DESCARGAR",style:{width:"100%"},class:"p-button-rounded p-button-success mr-2 mb-2",onClick:G=>X(ae)(o.data.document_id,o.data.document_type)},null,8,["onClick"]),a(l,{label:"RENOVAR",style:{width:"100%"},class:"p-button-rounded p-button-danger mr-0",onClick:G=>z(o.data)},null,8,["onClick"])]),_:1}),a(D,{class:"p-0",closable:!0,style:Z([{"max-width":"500px"},{width:"30vw",padding:"0px"}]),header:` CARGAR ${u.value?u.value.document_type:""} PARA ${h.value.site_name}`,visible:S.value,"onUpdate:visible":e[4]||(e[4]=o=>S.value=o),breakpoints:{"960px":"75vw"},modal:!0},{default:m(()=>[s("input",{ref:"fileInput",type:"file",onChange:A,style:{display:"none"}},null,544),s("div",me,[ve,a(p,{id:"entry_date",style:{width:"100%",margin:"20px 0"},modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=o=>_.value=o),required:"true",autofocus:""},null,8,["modelValue"])]),P(s("p",_e,[ye,f(" "+b(i.value?`${i.value.name} :    si este no es su documento por favor carguelo`:""),1)],512),[[T,i.value]]),s("div",he,[s("div",fe,[a(l,{label:"Seleccionar documento",class:"col-12",style:{"background-color":"var(--primary-color)"},onClick:e[2]||(e[2]=o=>{t.$refs.fileInput.click()})})]),s("div",be,[a(l,{class:"col-12",label:"Enviar",style:{"background-color":"var(--primary-color)"},onClick:e[3]||(e[3]=o=>q(i.value,u.value))})])])]),_:1},8,["header","visible"]),a(D,{header:` CARGAR ${u.value?u.value:""} PARA ${h.value.site_name}`,visible:k.value,"onUpdate:visible":e[9]||(e[9]=o=>k.value=o),breakpoints:{"960px":"75vw"},style:{width:"50vw",padding:"50p0x"},modal:!0},{default:m(()=>[s("div",ge,[s("div",we,[Ce,a(L,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=o=>v.value=o),modelModifiers:{trim:!0},options:V.value,placeholder:"",required:"true",class:ee({"p-invalid":t.submitted}),style:{width:"100%",margin:"20px 0"}},null,8,["modelValue","options","class"])]),s("div",Se,[ke,a(p,{id:"entry_date",style:{width:"100%",margin:"20px 0"},modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=o=>_.value=o),required:"true",autofocus:""},null,8,["modelValue"])])]),s("input",{ref:"fileInput",type:"file",onChange:A,style:{display:"none"}},null,544),P(s("p",De,[Oe,f(" "+b(i.value?`${i.value.name} :    verifique si este es su documeto antes de envirlo`:""),1)],512),[[T,i.value]]),s("div",Re,[a(l,{label:"Seleccionar documento",style:{width:"40%","background-color":"var(--primary-color)"},onClick:e[7]||(e[7]=o=>{t.$refs.fileInput.click()})}),a(l,{label:"Enviar",style:{width:"40%","background-color":"var(--primary-color)"},onClick:e[8]||(e[8]=o=>M(i.value,v.value,h.value.site_id))})])]),_:1},8,["header","visible"])]),_:1},8,["value","frozenValue"])])])])],64)}}},Te=J($e,[["__scopeId","data-v-5bed12d9"]]);export{Te as default};
