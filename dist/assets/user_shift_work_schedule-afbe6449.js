import{_ as fe,f as l,x as we,C as De,h as Se,U as L,g as ke,r as V,o as w,c as D,d as n,w as b,a,k as N,t as S,F as R,b as q,y as G,a5 as be,l as Q,a2 as xe,n as Te,p as Ce,e as Ie}from"./index-3d82eed8.js";import{u as X,f as Y,s as $,e as W,a as Oe,b as ee,c as te,d as ae}from"./subMonths-1076765e.js";import{s as Ue}from"./siteService-d9991053.js";import{l as Le}from"./user-7af26c2d.js";const x=F=>(Ce("data-v-fec8a333"),F=F(),Ie(),F),Ve={class:""},Fe={class:"col-12 p-0 m-0 my-2"},$e={class:"col-12 p-0 m-0 my-2"},We={class:"col-12 p-0 m-0 my-2"},Ee={class:"col-12 p-0 m-0 my-2"},je={class:"col-12 p-0 my-2"},Me={class:"col-12 p-0 my-2"},Be=x(()=>a("p",{class:"col-12 m-0 p-0 py-2"},"Desde:",-1)),Ne=x(()=>a("p",{class:"col-12 m-0 p-0 py-2"},"Hasta:",-1)),Re={style:{},class:"p-0 m-0"},Ae={class:"col-12 p-0 m-0"},He={class:"grid p-0 mx-auto",style:{"max-width":"700px"}},Pe={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},Je={class:"col-12 md:col-2 py-2 md:mb-8",style:{display:"flex",height:"4rem","justify-content":"end"}},ze={class:"p-3 text-2xl text-center my-2",style:{"font-weight":"bold",color:"black","text-transform":"uppercase"}},Ke=x(()=>a("i",{class:"fa-solid fa-folder-open"},null,-1)),Ze={class:"col-12 pb-6",style:{}},qe={style:{display:"flex",gap:"0rem","flex-direction":"column"}},Ge={class:"py-0 px-4 text-center col-12 m-0 p-0 text",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},Qe={style:{"overflow-x":"auto"}},Xe={style:{"min-width":"max-content"}},Ye=["onDrop"],et={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},tt=["onClick","src","onError"],at={key:0,class:"text-sm"},st={class:"py-0 my-0"},ot={class:"py-0 my-0 text-sm text-center"},lt={key:1,class:"text-sm"},nt=x(()=>a("p",{style:{opacity:"0"},class:"py-0 my-0 text-sm text-center"}," . ",-1)),it={class:"py-0 my-0"},rt=x(()=>a("p",{class:"py-0 my-0"},[a("b",{style:{color:"green"}},"DESCANSA")],-1)),ct={key:2,style:{position:"absolute","background-color":"green","border-radius":"50%",width:"1.5rem",height:"1.5rem",top:"-0.5rem",right:"-0.5rem","font-weight":"bold"},icon:"pi pi-times fw-bold",class:"p-button-rounded p-button-danger p-0 texto-parpadeante"},dt={class:"",style:{"text-transform":"uppercase"}},ut=x(()=>a("p",null,"Hora de llegada:",-1)),pt=x(()=>a("p",null,"Hora de salida:",-1)),mt={class:"col-12 p-0",style:{display:"flex","justify-content":"space-between"}},vt={__name:"user_shift_work_schedule",setup(F){const se=l(!1),oe=l(null),le=e=>{oe.value=e,se.value=!0},I=l(!1),d=l(new Date),u=l(new Date),E=Le(),m=we();l(!1),l(null);const O=l(),j=l(),T=l(),C=l(),h=l(!1),i=l(null),v=l(null),_=l(new Date),y=l(new Date),A=De(()=>!T.value||!C.value?"":`${Y(T.value,"dd/MM/yyyy")} - ${Y(C.value,"dd/MM/yyyy")}`),ne=()=>{d.value=T.value||new Date,u.value=C.value||new Date,I.value=!0},ie=()=>{I.value=!1},k=()=>{T.value=d.value,C.value=u.value,I.value=!1,B()},H=()=>{const e=new Date;d.value=$(e,{weekStartsOn:1}),u.value=W(e,{weekStartsOn:1}),k()},re=()=>{const e=$(new Date,{weekStartsOn:1});d.value=Oe(e,7),u.value=W(d.value,{weekStartsOn:1}),k()},ce=()=>{const e=new Date;d.value=ee(e),u.value=te(e),k()},de=()=>{const e=new Date;d.value=ee(ae(e,1)),u.value=te(ae(e,1)),k()};l(!1),l(null);const ue={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},pe=()=>{const e=new Date,t=new Date(e.setDate(e.getDate()+(7-e.getDay())+1));d.value=$(t,{weekStartsOn:1}),u.value=W(t,{weekStartsOn:1}),k()},me=()=>{const e=new Date,t=new Date(e.setDate(e.getDate()+(7-e.getDay())+8));d.value=$(t,{weekStartsOn:1}),u.value=W(t,{weekStartsOn:1}),k()},ve=e=>{if(!(e instanceof Date))return console.error("getDayColor: date is not a Date object",e),"#FFFFFF";const t=e.toLocaleDateString("en-US",{weekday:"long"});return ue[t]},M=l([]),P=l([]),_e=(e,t)=>{const o={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},g=e==null?void 0:e.trim().toLowerCase();t.target.src=o[g]||o.default},J=l(null);l(!1),l(new Date),Se(async()=>{j.value=await Ue.getSites(),O.value=j.value.filter(t=>t.site_id==E.rawUserData.site_id)[0],J.value=j.value.filter(t=>t.site_id==E.rawUserData.site_id)[0];const e=await X.getUsersBySiteId(E.rawUserData.site_id);M.value=e.filter(t=>t.status=="activo"),await fetch(`${L}/shift_work_days_with_records`)}),ke(O,async e=>{const t=await X.getUsersBySiteId(e.site_id);M.value=t.filter(o=>o.status=="activo"),J.value=e,H(),B()});const B=async()=>{if(m.setLoading(!0,"cargando horario"),!O.value||!T.value||!C.value){alert("Please select a site and date range.");return}const e=T.value.toISOString().split("T")[0],t=C.value.toISOString().split("T")[0],o=await fetch(`${L}/shift_filtered_work_days?site_id=${O.value.site_id}&start_date=${e}&end_date=${t}`);if(o.ok){m.setLoading(!1,"cargando horario");const g=await o.json();P.value=g.map(c=>(c.date=new Date(c.date),c.date.setDate(c.date.getDate()+1),c.users=c.records.map(f=>{let U=M.value.find(p=>p.id===f.employer_id);if(U){let p={...U};const s=new Date(`${c.date.toISOString().split("T")[0]}T${f.start_time}`),r=new Date(`${c.date.toISOString().split("T")[0]}T${f.end_time}`);return p.arrivalTime=s,p.departureTime=r,p.hoursWorked=(r-s)/36e5,p.rest=f.rest,p}return null}).filter(f=>f!=null),m.setLoading(!1,"cargando horario"),c))}else m.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")},ye=e=>{v.value=e,h.value=!0},he=async()=>{if(h.value=!1,m.setLoading(!0,"cargando"),!i.value||!v.value)return;if(_.value.getTime()>=y.value.getTime()){alert("La hora de llegada no puede ser mayor o igual a la hora de salida."),m.setLoading(!1,"cargando"),h.value=!0;return}let e=_.value.toISOString().split("T")[1].slice(0,8),t=y.value.toISOString().split("T")[1].slice(0,8);const o={employer_id:i.value.id,work_day_id:v.value.id,start_time:e,end_time:t};await fetch(`${L}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),i.value.arrivalTime=_.value,i.value.departureTime=y.value,i.value.hoursWorked=(y.value-_.value)/36e5,v.value.users.push(i.value),h.value=!1,i.value=null,v.value=null,m.setLoading(!1,"cargando")},ge=async()=>{if(h.value=!1,m.setLoading(!0,"cargando"),!i.value||!v.value)return;let e=_.value.toISOString().split("T")[1].slice(0,8),t=y.value.toISOString().split("T")[1].slice(0,8);const o={employer_id:i.value.id,work_day_id:v.value.id,start_time:e,end_time:t,rest:!0};await fetch(`${L}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),i.value.arrivalTime=_.value,i.value.departureTime=y.value,i.value.hoursWorked=(y.value-_.value)/36e5,i.value.rest=!0,v.value.users.push(i.value),h.value=!1,i.value=null,v.value=null,m.setLoading(!1,"cargando")};return(e,t)=>{var p;const o=V("Button"),g=V("Calendar"),c=V("Dialog"),f=V("InputText"),U=V("InputIcon");return w(),D(R,null,[n(c,{visible:I.value,"onUpdate:visible":t[2]||(t[2]=s=>I.value=s),modal:"",closable:""},{footer:b(()=>[n(o,{severity:"danger",label:"Cancelar",onClick:ie,class:"p-button-text"}),n(o,{severity:"success",label:"Aceptar",onClick:k})]),default:b(()=>[a("div",Ve,[a("div",Fe,[n(o,{class:"col-12 p-1",severity:"success",label:"Semana entrante",onClick:pe})]),a("div",$e,[n(o,{class:"col-12 p-1",severity:"secondary",label:"Dentro de 2 semanas",onClick:me})]),a("div",We,[n(o,{class:"col-12 p-1",severity:"danger",label:"Esta semana",onClick:H})]),a("div",Ee,[n(o,{class:"col-12 p-1",severity:"help",label:"Semana pasada",onClick:re})]),a("div",je,[n(o,{class:"col-12 p-1",severity:"warning",label:"Este mes",onClick:ce})]),a("div",Me,[n(o,{class:"col-12 p-1",severity:"primary",label:"Mes pasado",onClick:de})])]),Be,n(g,{class:"col-12 m-0 p-0",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=s=>d.value=s),showIcon:""},null,8,["modelValue"]),Ne,n(g,{class:"col-12 m-0 p-0",modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),a("div",Re,[a("div",Ae,[a("div",He,[a("div",Pe,[n(f,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:A.value,"onUpdate:modelValue":t[3]||(t[3]=s=>A.value=s),onClick:ne},null,8,["modelValue"])]),a("div",Je,[n(o,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:B})])])]),a("p",ze,[Ke,N(" Calendario de trabajo "+S((p=O.value)==null?void 0:p.site_name),1)]),a("div",Ze,[a("div",qe,[(w(!0),D(R,null,q(P.value,s=>(w(),D("div",{class:"p-0 m-0",key:s.id,style:{position:"relative"}},[a("div",{class:"shadow-2",style:G({"background-color":ve(s.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[a("p",Ge,S(s.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"}))+" ",1)],4),a("div",Qe,[a("div",Xe,[a("div",{class:"shadow-5 p-3 m-0 p-4",style:{"border-radius":"0 0 0.5rem 0.5rem",display:"flex","overflow-x":"auto","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"},onDragover:t[4]||(t[4]=be(()=>{},["prevent"])),onDrop:r=>ye(s)},[(w(!0),D(R,null,q(s.users,r=>{var z,K;return w(),D("div",{class:"shadow-2 p-2",key:r.id,style:G([{"text-align":"center",width:"7rem","aspect-ratio":"1 / 1","background-color":"white",color:"black",position:"relative","border-radius":"0.5rem"},r.rest?"box-shadow:0 0 10px green !important ":"background-color: white;"])},[a("p",et,S(r.name.split(" ").slice(0,1).join(" ")),1),a("img",{class:"shadow-2 p-1",onClick:Z=>le(r),src:`${Q(L)}/read-product-image/96/employer-${r.dni}`,alt:"user.name",onError:Z=>_e(r.gender,Z),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,tt),r.rest?(w(),D("div",lt,[nt,a("p",it,[a("b",null,S((K=r.contract_type)==null?void 0:K.toLowerCase().slice(0,13)),1)]),rt])):(w(),D("div",at,[a("p",st,[a("b",null,S((z=r.contract_type)==null?void 0:z.toLowerCase().split(" ").slice(0,2).join(" ")),1)]),a("p",ot," De: "+S(new Date(r.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}))+" A: "+S(new Date(r.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)])),Q(xe)()==r.id?(w(),D("div",ct)):Te("",!0)],4)}),128))],40,Ye)])])]))),128)),N(" ` ")])]),n(c,{visible:h.value,"onUpdate:visible":t[7]||(t[7]=s=>h.value=s),style:{width:"20rem"},modal:!0},{header:b(()=>[N(" . ")]),footer:b(()=>[a("div",mt,[n(o,{severity:"help",label:"Descansa",onClick:ge}),n(o,{severity:"success",label:"Aceptar",onClick:he})])]),default:b(()=>[a("h5",dt,"Cuantas horas trabajo "+S(i.value.name)+"?",1),ut,n(g,{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=s=>_.value=s),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:b(({clickCallback:s})=>[n(U,{class:"pi pi-clock cursor-pointer",onClick:s},null,8,["onClick"])]),_:1},8,["modelValue"]),pt,n(g,{modelValue:y.value,"onUpdate:modelValue":t[6]||(t[6]=s=>y.value=s),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:b(({clickCallback:s})=>[n(U,{class:"pi pi-clock cursor-pointer",onClick:s},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])],64)}}},ft=fe(vt,[["__scopeId","data-v-fec8a333"]]);export{ft as default};
