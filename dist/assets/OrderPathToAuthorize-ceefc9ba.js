import{_ as be,M as xe,r as u,l as De,i as ke,a as w,o as W,c as te,g as s,w as r,b as a,F as Ce,s as Ae,m as g,t as m,f as ae,k as K,I as Te,a2 as Se,e as Fe,p as je,h as Oe}from"./index-961bb091.js";import{s as Pe}from"./siteService-d2a90441.js";import"./sass.default-a5b7a582.js";import{p as x}from"./purchaseOrderService-8ad49f4f.js";import{u as F,a as se}from"./xlsx-4cca7150.js";import{E as Ue}from"./exceljs.min-4b158bf5.js";import{F as oe}from"./FileSaver.min-cc8488c4.js";import{f as le}from"./format-8cf56335.js";import{e as ne}from"./es-f6133d36.js";import"./_commonjsHelpers-23102255.js";const v=$=>(je("data-v-296d4d47"),$=$(),Oe(),$),qe=v(()=>a("b",null,"Autor de la nota: ",-1)),Me=v(()=>a("b",null,"Fecha: ",-1)),$e=v(()=>a("b",null,"Contenido de la Observacion: ",-1)),Ee=v(()=>a("br",null,null,-1)),Re=v(()=>a("p",null,"Desea ageregar notas?",-1)),Ie={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},Le={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},Ne=v(()=>a("br",null,null,-1)),Ve={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},Be={class:"m-0"},ze={class:"m-0"},He={key:0},Ge=v(()=>a("b",null,"Notas",-1)),We={style:{display:"flex",gap:"1rem"}},Ke={class:"grid"},Je={class:"col-12 px-0 mx-0"},Qe={class:"col-12",style:{display:"flex","flex-direction":"column"}},Ye=v(()=>a("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),Xe={class:"col-12",style:{display:"flex","flex-direction":"column"}},Ze=v(()=>a("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),et={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},tt={class:"col-12",style:{display:"flex","justify-content":"center"}},at={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},st={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},ot={class:"m-0 p-0"},lt=v(()=>a("b",null,"Alistada por:",-1)),nt={class:"m-0 p-0"},it=v(()=>a("b",null,"Sede:",-1)),rt={class:"mt-0 p-0"},dt=v(()=>a("b",null,"Fecha de Alistamiento:",-1)),ut={class:"text-right"},ct=["max","onUpdate:modelValue"],pt={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},mt={class:"m-auto",style:{"max-width":"1024px"}},ht={class:"col-12 px-3 mt-4 pack-butons",style:{display:"flex","justify-content":"end",gap:"1rem"}},vt={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},yt={class:"grid",style:{"align-items":"center"}},_t=v(()=>a("div",{class:"col-12 md:col-6 p-3"},[a("span",{class:"text-xl",style:{width:"100%"}}," Ordenes pendientes por alistar")],-1)),ft={class:"col-12 md:col-6 p-3"},gt={style:{"min-width":"max-content"}},wt={style:{"min-width":"max-content"}},bt={class:"m-0 p-0",style:{display:"flex",width:"100%","justify-content":"center","align-items":"center",gap:"0.5rem"}},ie=2,xt={__name:"OrderPathToAuthorize",setup($){const C=xe(),E=u(!1),j=u([]),R=u(!1),N=u(""),y=u({}),V=u(!1),B=u({}),re=()=>{j.value.forEach(n=>{n.ajustment=n.quantity})},de=n=>{if(n.some(t=>!t.ajustment&&t.ajustment!==0)){alert("por favor complete todos los campos");return}R.value=!0},I=u(!1),ue=n=>{E.value=!0,y.value=n},ce=async n=>{I.value=!0,j.value=await x.getpurchaseOrderEntriesBypurchaseOrderID(n)},pe={Generada:"#FF0000",Lista:"#FFA500","Entregada al transportista":"#FFFF00",Completada:"#00FF00"},z=u(!1),J=u([]),me=async n=>{z.value=!0,J.value=await x.getPurchaseOrderHistory(n)},Q=De(),Y=u([]),X=u([{}]),O=u(!1),A=u(new Date(new Date().setDate(new Date().getDate()-7))),D=u(new Date),P=u(new Date(new Date().setDate(new Date().getDate()-7))),U=u(new Date),T=u(),k=u(),he=(n,t)=>{P.value=n,U.value=t},q=n=>{const t=new Date,i=new Date(t);i.setDate(i.getDate()+1);const c=new Date(t);c.setDate(t.getDate()-n),A.value=c,n==1?(D.value=t,U.value=D.value,P.value=A.value,O.value=!1):(D.value=i,P.value=A.value,U.value=D.value,O.value=!1),ve()};ke(async()=>{Y.value=await Pe.getSites(),X.value=Y.value,T.value=await x.getPurchaseOrderByLap_id(ie)}),(()=>{k.value={global:{value:null,matchMode:Ae.CONTAINS}}})();function Z(n){const t=new Date(n),i=t.getFullYear(),c=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${i}-${c}-${o}`}const ve=async()=>{const n=X.value.map(c=>c.site_id);Q.rawUserData.id;const t=Z(P.value),i=Z(U.value);T.value=await x.getAllpurchaseOrderReportsFiltered(n,t,i)},M=u([]),ye=async(n,t,i)=>{M.value=await x.getpurchaseOrderEntriesBypurchaseOrderID(n);const c=M.value.map(_=>({Producto:_.item_name,Cantidad:_.quantity,"Unidad de medida":_.unit_measure})),o=F.json_to_sheet(c);o["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const h=F.book_new();F.book_append_sheet(h,o,"Usuarios"),se(h,`Orden_de_compra_${t}_${i} .xlsx`)},_e=async n=>{if(n.some(i=>!i.ajustment&&i.ajustment!==0&&i.quantity_adjusted<i.quantity)){alert("Debe aceptar los ajustes antes de Autorizar");return}C.setLoading(!0,"Autorizando orden");const t={purchase_order_id:y.value.purchase_order_id,lap_id:y.value.lap_id,responsible_id:Q.rawUserData.id,ajusts:[],order_purchase_notes:N.value};await x.PreparePurchaserOrder(t),T.value=await x.getPurchaseOrderByLap_id(ie),E.value=!1,I.value=!1,C.setLoading(!1,"Autorizando orden"),V.value=!1},fe=async()=>{C.setLoading(!0,"generando descargas");const n=T.value,t=[];for(const e of n){const l=await x.getpurchaseOrderEntriesBypurchaseOrderID(e.purchase_order_id);t.push(...l)}const i={};t.forEach(e=>{const l=e.site_name,d=e.item_name,b=e.quantity,S=e.unit_measure;i[d]||(i[d]={unit_measure:S}),i[d][l]||(i[d][l]=0),i[d][l]+=b});const c=[...new Set(t.map(e=>e.site_name))],o=[],h=le(P.value,"dd-MMMM-yyyy",{locale:ne}),_=le(U.value,"dd-MMMM-yyyy",{locale:ne});h==_?o.push([`ORDENES DE COMPRA DEL ${h.toUpperCase()}`,...Array(c.length+2).fill("")]):o.push([`ORDENES DE COMPRA DEL${h.toUpperCase()} AL ${_.toUpperCase()}`,...Array(c.length+2).fill("")]);const H=["PRODUCTO","UNIDAD DE MEDIDA",...c,"TOTAL"];o.push(H);for(const[e,l]of Object.entries(i)){const d=[e,l.unit_measure];let b=0;for(const S of c){const ee=l[S]||0;d.push(ee),b+=ee}d.push(b),o.push(d)}const p=new Ue.Workbook,f=p.addWorksheet("Inventario por Sede");o.forEach((e,l)=>{const d=f.addRow(e);l===0?(d.height=40,d.font={name:"Arial",bold:!0,size:14},d.alignment={horizontal:"center",vertical:"middle",wrapText:!0},f.mergeCells(`A1:${f.getColumn(c.length+3).letter}1`),f.getRow(1).eachCell(b=>{b.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF00"}}})):l===1&&(d.font={name:"Arial",bold:!0})}),f.columns.forEach((e,l)=>{e.width=l===0?30:l===1?25:15,e.eachCell(d=>{d.font={name:"Arial"},d.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),f.getRow(2).eachCell(e=>{e.font={name:"Arial",bold:!0}}),f.getRow(1).eachCell(e=>{e.font={name:"Arial",bold:!0,size:16}}),f.views=[{showGridLines:!1}];const G=await p.xlsx.writeBuffer(),L=new Blob([G],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});h==_?oe.saveAs(L,`Reporte de inventario del ${h}.xlsx`):oe.saveAs(L,`Reporte de inventario del ${h} al ${_} .xlsx`),C.setLoading(!1,"generando descargas")},ge=async()=>{C.setLoading(!0,"generando descargas");const n=T.value;for(const o of n){const h=await x.getpurchaseOrderEntriesBypurchaseOrderID(o.purchase_order_id);M.value.push(...h)}console.log(M.value);const t=M.value.map(o=>({Fecha:o.date.split("T")[0],Hora:o.date.split("T")[1],Sede:o.site_name,Producto:o.item_name,Cantidad:o.quantity,"Unidad de medida":o.unit_measure})),i=F.json_to_sheet(t);i["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const c=F.book_new();F.book_append_sheet(c,i,"Usuarios"),se(c,"Compras de todas las sedes.xlsx"),C.setLoading(!1,"generando descargas")};function we(n){n.key===","&&(alert("Por favor usa punto ( . ) para los decimales, gracias"),n.preventDefault())}return(n,t)=>{const i=w("Dialog"),c=w("Textarea"),o=w("Button"),h=w("Timeline"),_=w("Calendar"),H=w("router-link"),p=w("Column"),f=w("DataTable"),G=w("InputText"),L=w("Tag");return W(),te(Ce,null,[s(i,{class:"mx-2",visible:V.value,"onUpdate:visible":t[0]||(t[0]=e=>V.value=e),modal:"",header:"Notas de la orden",style:{width:"28rem"}},{default:r(()=>[a("div",null,[a("p",null,[qe,g(m(B.value.item.name),1)]),a("p",null,[Me,g(m(B.value.item.status_timestamp.split("T")[0]),1)]),a("p",null,[$e,g(),Ee,g(m(B.value.item.notes),1)])])]),_:1},8,["visible"]),s(i,{class:"mx-2",visible:R.value,"onUpdate:visible":t[4]||(t[4]=e=>R.value=e),modal:"",header:"Notas de alistamientos",style:{width:"25rem"}},{footer:r(()=>[a("div",Ie,[s(o,{text:"",onClick:t[2]||(t[2]=e=>R.value=!1),severity:"danger",label:"cancelar"}),s(o,{onClick:t[3]||(t[3]=e=>_e(j.value.filter(l=>l.quantity!=0))),severity:"help",label:"Alistar orden"})])]),default:r(()=>[Re,a("div",null,[s(c,{modelValue:N.value,"onUpdate:modelValue":t[1]||(t[1]=e=>N.value=e),style:{width:"100%",resize:"none",height:"10rem"}},null,8,["modelValue"])])]),_:1},8,["visible"]),s(i,{class:"mx-2",visible:z.value,"onUpdate:visible":t[5]||(t[5]=e=>z.value=e),modal:"",header:"Historial de la orden",style:{width:"min-content"}},{default:r(()=>[s(h,{value:J.value},{opposite:r(e=>{var l;return[a("p",Le,m(e.item.status_timestamp.split("T")[0]),1),g(),Ne,a("p",Ve,m((l=e.item.status_timestamp.split("T")[1])==null?void 0:l.split(":").slice(0,2).join(":")),1)]}),content:r(e=>[a("p",Be,[a("b",null,m(e.item.lap_name),1)]),a("p",ze,m(e.item.name),1),e.item.notes?(W(),te("p",He,[Ge,g(" "+m(e.item.notes),1)])):ae("",!0),a("div",We,[s(o,{disabled:!e.item.notes,style:{height:"2rem",opacity:"0","border-radius":"0.3rem"},cla:"",severity:"help",class:"",label:"Notas"},null,8,["disabled"]),s(o,{disabled:!e.item.conflict,style:{height:"2rem","border-radius":"0.3rem"},severity:"danger",class:"mb-4",label:"Conflictos"},null,8,["disabled"])])]),_:1},8,["value"])]),_:1},8,["visible"]),s(i,{class:"mx-2",visible:O.value,"onUpdate:visible":t[14]||(t[14]=e=>O.value=e),modal:"",header:"Periodo",style:{width:"25rem"}},{default:r(()=>[a("div",Ke,[a("div",Je,[s(o,{text:"",label:"Hoy",onClick:t[6]||(t[6]=e=>q(0)),class:"p-button-text col-12 p-1 m-0"}),s(o,{text:"",label:"Ayer",onClick:t[7]||(t[7]=e=>q(1)),class:"p-button-text col-12 p-1 m-0"}),s(o,{text:"",label:"Últimos 7 días",onClick:t[8]||(t[8]=e=>q(7)),class:"p-button-text col-12 p-1 m-0"}),s(o,{text:"",label:"Últimos 14 días",onClick:t[9]||(t[9]=e=>q(14)),class:"p-button-text col-12 p-1"}),s(o,{text:"",label:"Últimos 28 días",onClick:t[10]||(t[10]=e=>q(28)),class:"p-button-text col-12 p-0"})]),a("div",Qe,[Ye,s(_,{style:{"min-width":"max-content"},modelValue:A.value,"onUpdate:modelValue":t[11]||(t[11]=e=>A.value=e)},null,8,["modelValue"])]),a("div",Xe,[Ze,s(_,{style:{"min-width":"max-content"},modelValue:D.value,"onUpdate:modelValue":t[12]||(t[12]=e=>D.value=e),showWeek:""},null,8,["modelValue"])]),a("div",et,[a("div",tt,[s(o,{onClick:t[13]||(t[13]=()=>{he(A.value,D.value),O.value=!1})},{default:r(()=>[g("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),s(i,{class:"mx-2",visible:E.value,"onUpdate:visible":t[18]||(t[18]=e=>E.value=e),modal:"",header:"Interactuar con la orden",style:{width:"25rem"}},{default:r(()=>[a("div",at,[s(H,{to:`/purchase-order/recorrido/purchase-order-view/${y.value.purchase_order_id}`},{default:r(()=>[s(o,{text:"",style:{width:"100%"},severity:"help",class:"",label:"Ver detalles",icon:"pi pi-eye"})]),_:1},8,["to"]),s(o,{text:"",label:"Descargar en excel",style:{},onClick:t[15]||(t[15]=e=>{var l;return ye(y.value.purchase_order_id,y.value.site_name,(l=y.value.expedition_date)==null?void 0:l.split("T")[0])}),severity:"success",class:"",icon:"pi pi-download"}),s(o,{onClick:t[16]||(t[16]=e=>me(y.value.purchase_order_id)),text:"",label:"Ver Historial",style:{},severity:"warning",class:"",icon:"pi pi-history p-0 m-0"}),s(o,{onClick:t[17]||(t[17]=e=>ce(y.value.purchase_order_id)),label:"Autorizar esta orden",style:{},severity:"help",class:"",icon:"pi  p-0 m-0"})])]),_:1},8,["visible"]),s(i,{class:"px-2",visible:I.value,"onUpdate:visible":t[21]||(t[21]=e=>I.value=e),modal:"",header:"Autorizar orden",style:{width:"max-content","max-width":"100vw"}},{footer:r(()=>[a("div",pt,[s(o,{outlined:"",onClick:re,severity:"help",label:"Aprobar todo"}),s(o,{onClick:t[20]||(t[20]=e=>de(j.value.filter(l=>l.quantity!=0))),severity:"help",label:"Alistar orden"})])]),default:r(()=>[a("div",st,[a("p",ot,[lt,g(" "+m(y.value.responsible_lap),1)]),a("p",nt,[it,g(" "+m(y.value.site_name),1)]),a("p",rt,[dt,g(" "+m(y.value.status_timestamp.split("T")[0]),1)]),s(f,{showGridlines:"",style:{"max-width":"1024px"},stripedRows:"",filters:k.value,"onUpdate:filters":t[19]||(t[19]=e=>k.value=e),class:"col-12 m-auto p-0 m-0",value:j.value.filter(e=>e.quantity!=0),tableStyle:"min-width: 50rem;"},{default:r(()=>[s(p,{class:"py-0",field:"item_id",header:"id"}),s(p,{class:"py-0",field:"item_name",header:"Item"},{body:r(e=>[a("p",{style:K(e.data.ajustment===0?"text-decoration: line-through;background-color:#ffc9d1":"")},m(e.data.item_name),5)]),_:1}),s(p,{class:"py-0",field:"quantity",header:"cant. Solicitada por la sede"},{body:r(e=>[a("p",ut,m(e.data.quantity),1)]),_:1}),s(p,{class:"py-0 px-0",field:"quantity",header:"cant. despachada por quien alista"},{body:r(e=>[Te(a("input",{readonly:"",onKeydown:we,class:"text-right",max:e.data.quantity,min:0,"onUpdate:modelValue":l=>e.data.quantity_adjusted=l,style:K([{"background-color":"transparent",height:"2rem",width:"100%",border:"none"},e.data.quantity===e.data.ajustment&&e.data.quantity_adjusted<e.data.quantity?"background-color: aquamarine;":e.data.ajustment===0?"background-color:#ffc9d1":e.data.quantity_adjusted<e.data.quantity?"background-color:#FFAF33;border:2px solid #FF7A33":""]),type:"number"},null,44,ct),[[Se,e.data.quantity_adjusted]])]),_:1}),s(p,{class:"py-0",field:"unit_measure",header:"Und. de medida"}),s(p,{class:"py-0",field:"quantity",header:"interactuar"},{body:r(e=>[e.data.quantity_adjusted<e.data.quantity?(W(),Fe(o,{key:0,onClick:l=>e.data.ajustment=e.data.quantity,style:{"min-width":"max-content"},text:"",class:"px-0 py-1",label:"Aprobar"},null,8,["onClick"])):ae("",!0)]),_:1})]),_:1},8,["filters","value"])])]),_:1},8,["visible"]),a("div",mt,[a("div",ht,[s(o,{severity:"help",icon:"pi pi-download",label:"Descargar Todo",onClick:ge}),s(o,{severity:"help",icon:"pi pi-download",label:"Descargar Informe",onClick:fe})])]),a("div",vt,[s(f,{stripedRows:"",showGridlines:"",style:{"max-width":"1024px"},filters:k.value,"onUpdate:filters":t[23]||(t[23]=e=>k.value=e),class:"col-12 m-auto",value:T.value,tableStyle:"min-width: 50rem;",paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reportes"},{header:r(()=>[a("div",yt,[_t,a("div",ft,[s(G,{style:{width:"100%"},class:"",modelValue:k.value.global.value,"onUpdate:modelValue":t[22]||(t[22]=e=>k.value.global.value=e),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:r(()=>[s(p,{class:"py-1",field:"purchase_order_id",header:"ID"}),s(p,{class:"py-1",field:"employer_name",header:"Solicitante"}),s(p,{class:"py-1",field:"site_name",header:"Sede"}),s(p,{class:"py-1",field:"date",header:"Fecha"},{body:r(e=>{var l;return[a("p",gt,m((l=e.data.expedition_date)==null?void 0:l.split("T")[0]),1)]}),_:1}),s(p,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:r(e=>{var l,d,b,S;return[a("span",wt,m((S=(b=(d=(l=e.data.expedition_date)==null?void 0:l.split("T")[1])==null?void 0:d.split(":"))==null?void 0:b.slice(0,2))==null?void 0:S.join(" : ")),1)]}),_:1}),s(p,{class:"py-1",field:"date",header:"Estado actual"},{body:r(e=>[s(L,{style:K([{width:"100%"},`background-color:${pe[e.data.current_status]}`])},{default:r(()=>[g(m(e.data.current_status),1)]),_:2},1032,["style"])]),_:1}),s(p,{style:{"justify-content":"center"},class:"py-0 mx-0 px-0",field:"date",header:"Actuar"},{body:r(e=>[a("div",bt,[s(o,{label:"",style:{width:"min-content"},text:"",onClick:l=>ue(e.data),severity:"",class:"text-center p-1",icon:"fa-solid fa-hand"},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])])],64)}}},qt=be(xt,[["__scopeId","data-v-296d4d47"]]);export{qt as default};
