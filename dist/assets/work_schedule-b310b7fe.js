import{_ as Ve,r as n,l as je,H as Fe,y as We,h as Ne,k as Me,ab as le,U as x,a as O,o as p,c as m,d as o,w as c,b as t,u as V,F as ne,e as ie,q as C,t as v,m as re,Z as Be,s as ue,a4 as Re,p as Ae,g as He}from"./index-f909ff43.js";import{u as pe,e as Y,s as qe,a as me,b as ve,c as ye}from"./userService-b18489db.js";import{s as ze}from"./siteService-803c8911.js";import{f as ge,s as ee}from"./format-8cf56335.js";const y=z=>(Ae("data-v-9c5ef172"),z=z(),He(),z),Pe={key:0},Je={key:0,class:"user-info",style:{display:"flex","flex-direction":"column","align-items":"center"}},Ze=["src"],Ke={class:"col-12 p-0 mt-4"},Ge={key:0},Qe={key:0,class:"p-0 my-1"},Xe=y(()=>t("b",null," Desde: ",-1)),Ye={key:1,class:"p-0 my-1"},et=y(()=>t("b",null," Hasta: ",-1)),tt={key:2,class:"p-0 my-1 text-xl",style:{color:"green"}},st=y(()=>t("b",null," Descansa ",-1)),at=[st],ot={class:"p-0 my-1"},lt=y(()=>t("b",null,"Cargo:",-1)),nt={class:"p-0 my-1"},it=y(()=>t("b",null,"Telefono:",-1)),rt={class:"p-0 my-1"},dt=y(()=>t("b",null,"Contrato",-1)),ct={class:""},ut={class:"col-12 p-0 m-0 my-2"},pt={class:"col-12 p-0 m-0 my-2"},mt={class:"col-12 p-0 m-0 my-2"},vt={class:"col-12 p-0 m-0 my-2"},yt={class:"col-12 p-0 my-2"},gt={class:"col-12 p-0 my-2"},_t=y(()=>t("p",{class:"col-12 m-0 p-0 py-2"},"Desde:",-1)),ft=y(()=>t("p",{class:"col-12 m-0 p-0 py-2"},"Hasta:",-1)),ht=y(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este día de trabajo y todos sus registros?")],-1)),wt=y(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este registro?")],-1)),bt={style:{"margin-top":"6rem"},class:"p-0 mx-0"},Dt=y(()=>t("h3",null,"Nuevo dia",-1)),kt={class:"col-12 p-0 m-0 mb-8"},xt={class:"grid p-0 mx-auto"},St={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},Ct={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},Tt={class:"col-12 md:col-2 py-2",style:{display:"flex",height:"4rem","justify-content":"end"}},Lt={class:"grid px-4"},Ut={class:"col-2 p-0",style:{height:"80vh","max-width":"min-content","overflow-y":"auto"}},$t={class:"p-0 text-sm",style:{display:"flex","justify-content":"center"}},It={style:{display:"flex",gap:"1rem","flex-direction":"column"},class:"pb-3 m-auto"},Et=["onClick","onDragstart"],Ot=["onClick","src","onError"],Vt={class:"my-0 py-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},jt={class:"my-0 py-0",style:{"min-width":"min-content","text-transform":"uppercase","text-align":"center"}},Ft={class:"col",style:{height:"80vh","overflow-y":"auto"}},Wt={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},Nt={class:"col-12 pb-6",style:{}},Mt={style:{display:"flex",gap:"0rem","flex-direction":"column"}},Bt={class:"py-0 px-4 text-center col-12 m-0 p-0 text",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},Rt={style:{"overflow-x":"auto"}},At={style:{"min-width":"max-content"}},Ht=["onDrop"],qt={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},zt=["onClick","src","onError"],Pt={key:0,class:"text-sm"},Jt={class:"py-0 my-0 text-sm text-center"},Zt={key:1,class:"text-sm"},Kt={class:"py-0 my-0"},Gt=y(()=>t("p",{class:"py-0 my-0"},[t("b",{style:{color:"green"}},"DESCANSA")],-1)),Qt={class:"",style:{"text-transform":"uppercase"}},Xt=y(()=>t("p",null,"Hora de llegada:",-1)),Yt=y(()=>t("p",null,"Hora de salida:",-1)),es={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},ts={__name:"work_schedule",setup(z){const P=n(!1),u=n(null),te=a=>{u.value=a,P.value=!0},T=n(null),L=n(!1),J=n(new Date),j=n(!1),g=n(new Date),h=n(new Date),Z=je(),d=Fe(),F=n(!1),K=n(null),_=n(),W=n(),U=n(),$=n(),N=n(!1),b=n(null),M=n(null),B=n(new Date),R=n(new Date),de=We(()=>!U.value||!$.value?"":`${ge(U.value,"dd/MM/yyyy")} - ${ge($.value,"dd/MM/yyyy")}`),_e=()=>{g.value=U.value||new Date,h.value=$.value||new Date,j.value=!0},fe=()=>{j.value=!1},S=()=>{U.value=g.value,$.value=h.value,j.value=!1,I()},se=()=>{const a=new Date;g.value=ee(a,{weekStartsOn:1}),h.value=Y(a,{weekStartsOn:1}),S()},he=()=>{const a=ee(new Date,{weekStartsOn:1});g.value=qe(a,7),h.value=Y(g.value,{weekStartsOn:1}),S()},we=()=>{const a=new Date;g.value=me(a),h.value=ve(a),S()},be=()=>{const a=new Date;g.value=me(ye(a,1)),h.value=ve(ye(a,1)),S()},De=a=>{K.value=a,F.value=!0},ke=async()=>{if(F.value=!1,d.setLoading(!0,"borrando"),!K.value)return;const a=await fetch(`${x}/work_records/${K.value}`,{method:"DELETE"});a.ok?(I(),d.setLoading(!1,"borrando")):(console.error("Error al eliminar el registro:",await a.text()),alert("Hubo un error al eliminar el registro."),d.setLoading(!1,"borrando")),K.value=null},A=n(!1),G=n(null),xe=a=>{G.value=a,A.value=!0},Se=async()=>{if(A.value=!1,!G.value)return;d.setLoading(!0,"borrando"),(await fetch(`${x}/work_days/${G.value}`,{method:"DELETE"})).ok?(X.value=X.value.filter(e=>e.id!==G.value),d.setLoading(!1,"borrando")):(alert("Hubo un error al eliminar el día de trabajo."),d.setLoading(!1,"borrando"))},Ce={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},Te=a=>{if(!(a instanceof Date))return console.error("getDayColor: date is not a Date object",a),"#FFFFFF";const e=a.toLocaleDateString("en-US",{weekday:"long"});return Ce[e]},Q=n([]),X=n([]),ae=(a,e)=>{const l={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},i=a==null?void 0:a.trim().toLowerCase();e.target.src=l[i]||l.default};Ne(async()=>{W.value=await ze.getSites(),_.value=W.value.filter(e=>e.site_id==Z.rawUserData.site_id)[0],T.value=W.value.filter(e=>e.site_id==Z.rawUserData.site_id)[0];const a=await pe.getUsersBySiteId(Z.rawUserData.site_id);Q.value=a.filter(e=>e.status=="activo"),se(),I()}),Me(_,async(a,e)=>{var l,i;if(le()==1104&&((l=_.value.site_name)==null?void 0:l.toLowerCase())!="kennedy"&&((i=_.value.site_name)==null?void 0:i.toLowerCase())!="montes"){alert("No tienes permiso para administrar esta sede"),_.value=e;return}else{const w=await pe.getUsersBySiteId(a.site_id);Q.value=w.filter(E=>E.status=="activo"),T.value=a,se(),I()}});const I=async()=>{var i,w;if(le()==1104&&((i=_.value.site_name)==null?void 0:i.toLowerCase())!="kennedy"&&((w=_.value.site_name)==null?void 0:w.toLowerCase())!="montes")return;if(d.setLoading(!0,"cargando horario"),!_.value||!U.value||!$.value){alert("Please select a site and date range.");return}const a=U.value.toISOString().split("T")[0],e=$.value.toISOString().split("T")[0],l=await fetch(`${x}/filtered_work_days?site_id=${_.value.site_id}&start_date=${a}&end_date=${e}`);if(l.ok){d.setLoading(!1,"cargando horario");const E=await l.json();X.value=E.map(f=>(f.date=new Date(f.date),f.date.setDate(f.date.getDate()+1),f.users=f.records.map(k=>{let H=Q.value.find(D=>D.id===k.employer_id);if(H){let D={...H};const q=new Date(`${f.date.toISOString().split("T")[0]}T${k.start_time}`),s=new Date(`${f.date.toISOString().split("T")[0]}T${k.end_time}`);return D.arrivalTime=q,D.departureTime=s,D.hoursWorked=(s-q)/36e5,D}return null}).filter(k=>k!=null),d.setLoading(!1,"cargando horario"),f))}else d.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")},Le=async()=>{if(L.value=!1,d.setLoading(!0,"guardando"),!T.value||!J.value){alert("Please select a site and date.");return}let a=new Date(J.value.getTime());const e=new Date(a.getTime()-a.getTimezoneOffset()*6e4).toISOString().split("T")[0],l=await fetch(`${x}/work_days`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:e,site_id:T.value.site_id})});if(l.ok){const i=await l.json();i.date=new Date(i.date),i.date.setDate(i.date.getDate()+1),d.setLoading(!1,"guardando"),I()}else{const i=await l.json();i.detail&&i.detail==="El día con el mismo site_id ya está registrado."?alert("Este dia ya esta registrado para esta sede"):alert("Failed to add new workday"),d.setLoading(!1,"guardando")}},Ue=()=>{const a=new Date,e=new Date(a.setDate(a.getDate()+(7-a.getDay())+1));g.value=ee(e,{weekStartsOn:1}),h.value=Y(e,{weekStartsOn:1}),S()},$e=()=>{const a=new Date,e=new Date(a.setDate(a.getDate()+(7-a.getDay())+8));g.value=ee(e,{weekStartsOn:1}),h.value=Y(e,{weekStartsOn:1}),S()},Ie=a=>{b.value=a},Ee=a=>{M.value=a,N.value=!0},Oe=async()=>{if(N.value=!1,d.setLoading(!0,"cargando"),!b.value||!M.value)return;let a=B.value.toISOString().split("T")[1].slice(0,8),e=R.value.toISOString().split("T")[1].slice(0,8);const l={employer_id:b.value.id,work_day_id:M.value.id,start_time:a,end_time:e};await fetch(`${x}/work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),b.value.arrivalTime=B.value,b.value.departureTime=R.value,b.value.hoursWorked=(R.value-B.value)/36e5,M.value.users.push(b.value),N.value=!1,b.value=null,M.value=null,d.setLoading(!1,"cargando")};return(a,e)=>{var H,D,q;const l=O("Button"),i=O("Dialog"),w=O("Calendar"),E=O("Dropdown"),f=O("InputText"),k=O("InputIcon");return p(),m("div",Pe,[o(i,{visible:P.value,"onUpdate:visible":e[2]||(e[2]=s=>P.value=s),modal:"",style:{width:"30rem"}},{footer:c(()=>[o(l,{label:"Cerrar",onClick:e[1]||(e[1]=s=>P.value=!1)})]),default:c(()=>{var s;return[t("h4",null,v(u.value.name),1),u.value?(p(),m("div",Je,[t("img",{class:"shadow-3",src:`${V(x)}/read-product-image/300/employer-${u.value.dni}`,onError:e[0]||(e[0]=r=>ae(u.value.gender,r)),alt:"Foto del empleado",style:{width:"100%","aspect-ratio":"1 / 1","border-radius":"0.5rem","object-fit":"cover"}},null,40,Ze),t("div",Ke,[u.value.arrivalTime&&u.value.departureTime?(p(),m("div",Ge,[u.value.rest?re("",!0):(p(),m("p",Qe,[Xe,C(v(new Date(u.value.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)])),u.value.rest?(p(),m("p",tt,at)):(p(),m("p",Ye,[et,C(" "+v(new Date(u.value.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)]))])):re("",!0),t("p",ot,[lt,C(" "+v(u.value.position),1)]),t("p",nt,[it,C(" "+v(u.value.phone),1)]),t("p",rt,[dt,C(" "+v((s=u.value.contract_type)==null?void 0:s.toLowerCase()),1)])])])):re("",!0)]}),_:1},8,["visible"]),o(i,{visible:j.value,"onUpdate:visible":e[5]||(e[5]=s=>j.value=s),modal:"",closable:""},{footer:c(()=>[o(l,{severity:"danger",label:"Cancelar",onClick:fe,class:"p-button-text"}),o(l,{severity:"success",label:"Aceptar",onClick:S})]),default:c(()=>[t("div",ct,[t("div",ut,[o(l,{class:"col-12 p-1",severity:"success",label:"Semana entrante",onClick:Ue})]),t("div",pt,[o(l,{class:"col-12 p-1",severity:"secondary",label:"Dentro de 2 semanas",onClick:$e})]),t("div",mt,[o(l,{class:"col-12 p-1",severity:"danger",label:"Esta semana",onClick:se})]),t("div",vt,[o(l,{class:"col-12 p-1",severity:"help",label:"Semana pasada",onClick:he})]),t("div",yt,[o(l,{class:"col-12 p-1",severity:"warning",label:"Este mes",onClick:we})]),t("div",gt,[o(l,{class:"col-12 p-1",severity:"primary",label:"Mes pasado",onClick:be})])]),_t,o(w,{class:"col-12 m-0 p-0",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s),showIcon:""},null,8,["modelValue"]),ft,o(w,{class:"col-12 m-0 p-0",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),o(i,{visible:A.value,"onUpdate:visible":e[7]||(e[7]=s=>A.value=s),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:c(()=>[o(l,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[6]||(e[6]=s=>A.value=!1)}),o(l,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:Se})]),default:c(()=>[ht]),_:1},8,["visible"]),o(i,{visible:F.value,"onUpdate:visible":e[9]||(e[9]=s=>F.value=s),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:c(()=>[o(l,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[8]||(e[8]=()=>F.value=!1)}),o(l,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:ke})]),default:c(()=>[wt]),_:1},8,["visible"]),t("div",bt,[o(i,{visible:L.value,"onUpdate:visible":e[13]||(e[13]=s=>L.value=s),style:{width:"22rem"},modal:"",closeOnEscape:"",onClose:e[14]||(e[14]=s=>L.value=!1)},{footer:c(()=>[o(l,{label:"cancelar",onClick:e[12]||(e[12]=s=>L.value=!1),class:"p-button-danger"}),o(l,{label:"Agregar",onClick:Le,class:"p-button-success"})]),default:c(()=>[Dt,o(w,{class:"my-4",modelValue:J.value,"onUpdate:modelValue":e[10]||(e[10]=s=>J.value=s),showIcon:""},null,8,["modelValue"]),o(E,{class:"col-12 p-0",disabled:"",modelValue:T.value,"onUpdate:modelValue":e[11]||(e[11]=s=>T.value=s),options:W.value,optionLabel:"site_name",placeholder:"Select a site"},null,8,["modelValue","options"])]),_:1},8,["visible"]),t("div",kt,[t("div",xt,[t("div",St,[o(E,{disabled:!((q=V(Be)["Horarios de trabajo admin"])!=null&&q.includes((D=(H=V(Z))==null?void 0:H.rawUserData)==null?void 0:D.rol))&&V(le)()!=1104,style:{height:"100%"},class:"col-12 p-0 m-0",modelValue:_.value,"onUpdate:modelValue":e[15]||(e[15]=s=>_.value=s),options:W.value,optionLabel:"site_name"},null,8,["disabled","modelValue","options"])]),t("div",Ct,[o(f,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:de.value,"onUpdate:modelValue":e[16]||(e[16]=s=>de.value=s),onClick:_e},null,8,["modelValue"])]),t("div",Tt,[o(l,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:I})])])]),t("div",Lt,[t("div",Ut,[t("div",$t,[t("div",It,[(p(!0),m(ne,null,ie(Q.value,s=>(p(),m("div",{onClick:r=>te(s),key:s.id,draggable:"true",style:{display:"flex","flex-direction":"column","align-items":"center"},onDragstart:r=>Ie(s)},[t("img",{onClick:r=>te(s),class:"shadow-2 p-1",src:`${V(x)}/read-product-image/96/employer-${s.dni}`,alt:"user.name",onError:r=>ae(s.gender,r),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,Ot),t("p",Vt,v(s.name.split(" ").slice(0,2).join(" ")),1),t("span",jt,v(s.position),1)],40,Et))),128))])])]),t("div",Ft,[t("div",Wt,[o(l,{class:"mb-3",icon:"pi pi-plus",severity:"info",label:"Nuevo dia",onClick:e[17]||(e[17]=s=>L.value=!0)})]),t("div",Nt,[t("div",Mt,[(p(!0),m(ne,null,ie(X.value,s=>(p(),m("div",{class:"p-0 m-0",key:s.id,style:{position:"relative"}},[t("div",{class:"shadow-2",style:ue({"background-color":Te(s.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[t("p",Bt,v(s.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"})),1)],4),t("div",Rt,[o(l,{style:{position:"absolute",right:"-1rem",top:"-1rem"},icon:"pi pi-trash text-2xl ",class:"p-button-rounded p-button-danger shadow-5",onClick:r=>xe(s.id)},null,8,["onClick"]),t("div",At,[t("div",{class:"shadow-5 p-3 m-0",style:{"border-radius":"0 0 0.5rem 0.5rem",display:"flex","overflow-x":"auto","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"},onDragover:e[18]||(e[18]=Re(()=>{},["prevent"])),onDrop:r=>Ee(s)},[(p(!0),m(ne,null,ie(s.users,r=>{var ce;return p(),m("div",{class:"shadow-2 p-2",key:r.id,style:ue([{"text-align":"center",width:"7rem","aspect-ratio":"1 / 1","background-color":"white",color:"black",position:"relative","border-radius":"0.5rem"},r.rest?"outline:2px solid green;  ":"background-color: white;"])},[t("p",qt,v(r.name.split(" ").slice(0,1).join(" ")),1),t("img",{class:"shadow-2 p-1",onClick:oe=>te(r),src:`${V(x)}/read-product-image/96/employer-${r.dni}`,alt:"user.name",onError:oe=>ae(r.gender,oe),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,zt),r.rest?(p(),m("div",Zt,[t("p",Kt,[t("b",null,v((ce=r.contract_type)==null?void 0:ce.toLowerCase().slice(0,13)),1)]),Gt])):(p(),m("div",Pt,[t("p",Jt," De: "+v(new Date(r.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}))+" A: "+v(new Date(r.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)])),o(l,{style:{position:"absolute",width:"1.5rem",height:"1.5rem",top:"-0.5rem",right:"-0.5rem","font-weight":"bold"},icon:"pi pi-times fw-bold",class:"p-button-rounded p-button-danger p-0",onClick:oe=>De(r.id)},null,8,["onClick"])],4)}),128))],40,Ht)])])]))),128)),C(" ` ")])])])]),o(i,{visible:N.value,"onUpdate:visible":e[21]||(e[21]=s=>N.value=s),style:{width:"20rem"},modal:!0},{header:c(()=>[C(" . ")]),footer:c(()=>[t("div",es,[o(l,{severity:"success",label:"Aceptar",onClick:Oe})])]),default:c(()=>[t("h5",Qt,"Cuantas horas trabajo "+v(b.value.name)+"?",1),Xt,o(w,{modelValue:B.value,"onUpdate:modelValue":e[19]||(e[19]=s=>B.value=s),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:c(({clickCallback:s})=>[o(k,{class:"pi pi-clock cursor-pointer",onClick:s},null,8,["onClick"])]),_:1},8,["modelValue"]),Yt,o(w,{modelValue:R.value,"onUpdate:modelValue":e[20]||(e[20]=s=>R.value=s),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:c(({clickCallback:s})=>[o(k,{class:"pi pi-clock cursor-pointer",onClick:s},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])])}}},ns=Ve(ts,[["__scopeId","data-v-9c5ef172"]]);export{ns as default};
