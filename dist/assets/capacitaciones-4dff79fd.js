import{_ as de,g as r,h as B,q as F,z as ue,C as pe,e as p,o as v,c as g,a as s,b as o,j as I,f as i,n as me,s as he,a9 as N,U as x,x as _e,F as H,r as M,t as _,m as f,d as R,u as L,T as G,p as fe,k as ye,y as ve}from"./index-4a640845.js";import{g as ge}from"./dropDownAux-2031dd13.js";const l=S=>(fe("data-v-52035726"),S=S(),ye(),S),be={class:"col-12 m-auto my-8 px-2"},we={key:0,class:"col-12",style:{display:"flex","flex-direction":"column","pointer-events":"none","align-items":"center","justify-content":"center",position:"fixed","z-index":"1000",left:"0",top:"0",height:"100%","background-color":"rgba(0, 0, 0, 0.5)"}},xe=l(()=>s("p",{class:"text-3xl",style:{"font-weight":"bold",color:"white","text-shadow":"0 0 10px rgba(0, 0, 0, 0.551)"}},"CARGANDO CAPACITACIONES",-1)),Se={style:{display:"flex"}},Ce={style:{display:"flex"}},ke=l(()=>s("div",{style:{display:"flex"}},null,-1)),Ve={class:"grid"},Te={class:"col-12 lg:col-6"},Pe=l(()=>s("p",{class:"col-12 text-3xl",style:{"font-weight":"bold",color:"black"}}," Configuración ",-1)),Ue={class:"col-12 m-auto pb-2 p-4",style:{"background-color":"","box-shadow":"0 0 10px rgba(0, 0, 0, 0.137)",height:"max-content","border-radius":".5rem"}},Ee=l(()=>s("div",{class:"col-12 m-0 mb-0",style:{}},[s("p",{class:"text-2xl",style:{"font-weight":"bold","text-transform":"capitalize",color:"white"}})],-1)),Ie={class:"flex flex-column gap-2 mb-4"},De=l(()=>s("h6",{for:"username"},"Nombre de la capacitacion",-1)),Ae={class:"flex flex-column gap-2 my-4"},$e=l(()=>s("h6",{for:"username"},"Tematica",-1)),Be={class:"flex flex-column gap-2 my-4"},Ne=l(()=>s("h6",{for:"switch-incluir-link"},"¿Incluir enlace de la reunión?",-1)),Re={key:0,class:"flex flex-column gap-2 my-4"},Le=l(()=>s("h6",{for:"input-enlace-reunion"},"Enlace de la reunión",-1)),Oe={class:"flex flex-column gap-2 my-4"},ze=l(()=>s("h6",{for:"username"},"Ubicacion",-1)),je={class:"flex flex-column gap-2 my-4"},Fe=l(()=>s("h6",{for:"username"},"Fecha de la capacitacion",-1)),He=l(()=>s("span",{class:"col-12 p-0"},"Agendar",-1)),Me={class:"col-12 lg:col-6"},Ge=l(()=>s("p",{class:"col-12 my-0 text-3xl",style:{"font-weight":"bold"}}," Asistentes ",-1)),We={class:"col-12",style:{display:"flex"}},qe={key:0,class:"col-12 p-0 ml-3",style:{display:"flex",gap:"1rem","align-items":"center"}},Je=l(()=>s("span",{class:"",style:{"font-weight":"bold"}},"TODOS ",-1)),Ke={class:"col-12 m-auto pb-4 p-5",style:{"background-color":"rgba(255, 255, 255, 0)",height:"100%","border-radius":".3rem","height overflow":"hidden"}},Ye={class:"grid",style:{height:"60vh","overflow-y":"auto"}},Qe={class:"col-12 grid py-4",style:{"border-bottom":"2px solid rgba(0, 0, 0, 0.375)"}},Xe={class:"col-12 p-1",style:{display:"flex",gap:"1rem","align-items":"center"}},Ze={style:{"font-weight":"bold"}},et={class:"col-12 p-1",style:{display:"flex","min-width":"max-content",gap:"1rem","align-items":"center","justify-content":"start"}},tt={class:"",style:{"font-weight":""}},at={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},st={class:"m-0 text-2xl my-4"},ot={class:"block mt-2 md:mt-0 p-input-icon-left"},nt=l(()=>s("i",{class:"pi pi-search"},null,-1)),lt=l(()=>s("span",{class:"p-column-title"},"Code",-1)),it=l(()=>s("span",{class:"p-column-title"},"Code",-1)),rt=l(()=>s("span",{class:"p-column-title"},"Code",-1)),ct=l(()=>s("span",{class:"p-column-title"},"Code",-1)),dt=l(()=>s("span",{class:"p-column-title"},"Code",-1)),ut=l(()=>s("span",{class:"p-column-title"},"Code",-1)),pt=l(()=>s("span",{class:"p-column-title"},"Code",-1)),mt=l(()=>s("span",{class:"p-column-title"},"Code",-1)),ht={class:"text-right"},_t={class:"text-right",style:{}},ft={__name:"capacitaciones",setup(S){const C=r(!1),D=r(),O=r(),k=r(null),W=()=>{k.value={global:{value:null,matchMode:he.CONTAINS}}},z=async()=>{const a=await N();try{const e=await fetch(`${x}/trainings/by-creator/${a}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return await e.json()}catch(e){throw console.error("Error al obtener las capacitaciones:",e),e}};B(()=>{z().then(a=>D.value=a)}),F(()=>{W()});const b=r(!1),V=r(!1),T=ue();pe();const A=r(!1),w=r([]),q=r([]);r({});const J=a=>{try{return new URL(a),!0}catch{return!1}},u=r({}),P=r(!0);r(!1);const K=(a,e)=>{const n=w.value.find(c=>c.site_name===a);if(!n)return;let d=[...m.value];n.employers.forEach(c=>{const h=d.indexOf(c.id);e&&h===-1?d.push(c.id):!e&&h!==-1&&d.splice(h,1)}),m.value=d},Y=a=>{a?m.value=w.value.reduce((e,n)=>e.concat(n.employers.map(d=>d.id)),[]):m.value=[]},j=a=>{const e=w.value.find(n=>n.site_name===a);return e?e.employers.every(n=>m.value.includes(n.id)):!1};r({}),r([]);const m=r([]),Q=a=>({attendees:m.value.map(e=>({training_id:a,attendee_id:e,assigned:!1,attendance_time:new Date().toISOString()}))}),X=async a=>{const e=Q(a);try{const n=await fetch(`${x}/training/attendees`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const d=await n.json();T.add({severity:"success",summary:"asistentes modificados",detail:"hecho",life:3e3}),console.log("Respuesta del servidor:",d),ve.push(`capacitacion/${a}/configuracion`),b.value=!1}catch(n){console.error("Error al enviar los datos de los asistentes:",n)}};async function Z(){try{const a=await fetch(`${x}/employers/grouped-by-site`);if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);let e=await a.json();e=e.map(n=>{const d=n.employers.reduce((c,h)=>(c[h.position]=c[h.position]||[],c[h.position].push(h),c),{});return{...n,positions:d}}),w.value=e,P.value=!1}catch(a){console.error("Error al obtener usuarios agrupados por sede:",a)}}async function ee(){try{const a=await fetch(`${x}/employers/grouped-by-position`);if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);q.value=await a.json()}catch(a){console.error("Error al obtener usuarios agrupados por posición:",a)}}const te=r([]);F(()=>{ge().then(a=>te.value=a)}),B(async()=>{await Z(),await ee()});const ae=a=>{const e=m.value.indexOf(a);e>-1?m.value.splice(e,1):m.value.push(a)},se=a=>m.value.includes(a),oe=async()=>{b.value=!0;const a={...u.value};if(a.creator_id=await N(),a.status="Agendada",!V.value||!a.material_url)a.material_url=null;else if(!J(a.material_url)){T.add({severity:"error",summary:"Error",detail:"El enlace de la reunión no es válido",life:3e3}),b.value=!1;return}if(!a.name||!a.topic||!a.location||!a.scheduled_time){T.add({severity:"warn",summary:"Advertencia",detail:"Por favor, completa todos los campos requeridos.",life:3e3}),b.value=!1;return}try{const e=await fetch(`${x}/training/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const d=(await e.json()).training_id;await X(d),console.log("Capacitación actualizada con éxito",e),T.add({severity:"success",summary:"Capacitación actualizada",detail:"Hecho",life:3e3}),z().then(c=>D.value=c),ne.value=!1}catch(e){console.error("Error al actualizar la capacitación:",e)}},ne=r(!1);return B(()=>{}),(a,e)=>{const n=p("ProgressSpinner"),d=p("Dialog"),c=p("InputText"),h=p("InputSwitch"),le=p("Calendar"),U=p("Button"),$=p("Checkbox"),y=p("Column"),ie=p("Tag"),re=p("RouterLink"),ce=p("DataTable");return v(),g("div",be,[P.value?(v(),g("div",we,[xe,s("div",Se,[o(n,{style:{width:"100px",height:"100px"},strokeWidth:"4",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])])):I("",!0),o(d,{visible:b.value,"onUpdate:visible":e[0]||(e[0]=t=>b.value=t),modal:"",header:"Enviando datos",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:i(()=>[s("div",Ce,[o(n,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])]),_:1},8,["visible"]),o(d,{style:me([{"max-width":"1024px"},{width:"90%"}]),visible:C.value,"onUpdate:visible":e[9]||(e[9]=t=>C.value=t),modal:"",header:"Agendar capacitacion",breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:i(()=>[ke,s("div",Ve,[s("div",Te,[Pe,s("div",Ue,[Ee,s("div",Ie,[De,o(c,{id:"username",modelValue:u.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.name=t),"aria-describedby":"username-help"},null,8,["modelValue"])]),s("div",Ae,[$e,o(c,{id:"username",modelValue:u.value.topic,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.topic=t),"aria-describedby":"username-help"},null,8,["modelValue"])]),s("div",Be,[Ne,o(h,{id:"switch-incluir-link",modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=t=>V.value=t)},null,8,["modelValue"])]),V.value?(v(),g("div",Re,[Le,o(c,{id:"input-enlace-reunion",modelValue:u.value.material_url,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.material_url=t)},null,8,["modelValue"])])):I("",!0),s("div",Oe,[ze,o(c,{id:"username",modelValue:u.value.location,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.location=t),"aria-describedby":"username-help"},null,8,["modelValue"])]),s("div",je,[Fe,o(le,{id:"username",modelValue:u.value.scheduled_time,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.scheduled_time=t),"aria-describedby":"username-help"},null,8,["modelValue"])])]),o(U,{onClick:oe,class:"my-6 col-12",severity:"help"},{default:i(()=>[He]),_:1})]),s("div",Me,[Ge,s("div",We,[P.value?(v(),_e(n,{key:0,style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})):I("",!0)]),P.value?I("",!0):(v(),g("div",qe,[o($,{class:"mt-3",style:{"margin-left":"3px"},modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=t=>A.value=t),binary:!0,onChange:e[8]||(e[8]=t=>Y(A.value))},null,8,["modelValue"]),Je])),s("div",Ke,[s("div",Ye,[(v(!0),g(H,null,M(w.value,t=>(v(),g("div",Qe,[s("div",Xe,[o($,{style:{},binary:!0,modelValue:j(t.site_name),onChange:E=>K(t.site_name,!j(t.site_name))},null,8,["modelValue","onChange"]),s("span",Ze,_(t.site_name),1)]),(v(!0),g(H,null,M(t.employers,E=>(v(),g("div",et,[o($,{class:"",style:{},binary:!0,modelValue:se(E.id),onChange:()=>ae(E.id)},null,8,["modelValue","onChange"]),s("p",tt,_(E.name),1)]))),256))]))),256))])])])])]),_:1},8,["visible"]),o(ce,{ref:"dt",value:D.value,selection:O.value,"onUpdate:selection":e[12]||(e[12]=t=>O.value=t),dataKey:"id",paginator:!0,rows:10,filters:k.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Capacitaciones",responsiveLayout:"scroll",scrollable:"","scroll-height":"62vh",frozenValue:a.lockedCustomers},{header:i(()=>[s("div",at,[s("p",st,[f("Capacitaciones "),o(U,{severity:"help",onClick:e[10]||(e[10]=t=>C.value=!C.value),class:"ml-3 p-2"},{default:i(()=>[f(" Agendar nueva")]),_:1})]),s("span",ot,[nt,o(c,{class:"",modelValue:k.value.global.value,"onUpdate:modelValue":e[11]||(e[11]=t=>k.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:i(()=>[o(y,{class:"p-2",field:"id",header:"Id",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[lt,f(" "+_(t.data.id),1)]),_:1}),o(y,{class:"p-2",field:"creator_id",header:"Responsable",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[it,f(" "+_(t.data.creator_id),1)]),_:1}),o(y,{class:"p-2",field:"name",header:"Nombre",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[rt,f(" "+_(t.data.name),1)]),_:1}),o(y,{class:"p-2",field:"name",header:"Tema",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ct,f(" "+_(t.data.topic),1)]),_:1}),o(y,{class:"p-2",field:"location",header:"Ubicacion",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[dt,f(" "+_(t.data.location),1)]),_:1}),o(y,{class:"p-2",field:"location",header:"Fecha de la capacitacion",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ut,f(" "+_(t.data.scheduled_time),1)]),_:1}),o(y,{class:"p-2",field:"location",header:"Fecha de creacion",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[pt,f(" "+_(t.data.created_at),1)]),_:1}),o(y,{class:"p-2",field:"location",header:"Estado",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[mt,o(ie,{class:R(["p-2 text-center",t.data.status])},{default:i(()=>[f(_(t.data.status),1)]),_:2},1032,["class"])]),_:1}),o(y,{class:"p-2",field:"location",header:"Detalles",sortable:!0,frozen:"",alignFrozen:"right",headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[o(re,{to:L(N)()==t.data.creator_id?`capacitacion/${t.data.id}/configuracion`:`capacitacion/${t.data.id}/archivos`},{default:i(()=>[o(U,{text:"",class:"p-0 mx-2",severity:"success",style:{width:"100"}},{default:i(()=>[s("span",ht,[s("i",{class:R(L(G).EYE)},null,2)])]),_:1})]),_:2},1032,["to"]),o(U,{text:"",class:"p-0 mx-2",severity:"danger",style:{width:"100"}},{default:i(()=>[s("span",_t,[s("i",{class:R(L(G).TRASH)},null,2)])]),_:1})]),_:1})]),_:1},8,["value","selection","filters","frozenValue"])])}}},gt=de(ft,[["__scopeId","data-v-52035726"]]);export{gt as default};
