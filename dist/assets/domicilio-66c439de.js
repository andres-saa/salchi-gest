import{_ as le,z as ne,f as s,g as B,h as E,Q as T,B as ie,u as re,r as v,o as U,c as N,d as l,w as r,a as n,F as z,U as u,R as de,b as ce,J as ue,q as F,l as A,P as O,n as pe,k as q,t as me,p as he,e as ve}from"./index-ca9851e9.js";import{g as fe}from"./dropDownAux-50cc8843.js";const w=C=>(he("data-v-5b9e1443"),C=C(),ve(),C),ye=w(()=>n("p",null,"¿Estás seguro de que quieres eliminar este barrio?",-1)),ge={class:"grid",style:{}},_e={class:"col-6 pr-2 pl-3"},be={class:"col-6 pl-2 pr-3"},we={class:"my-2",style:{width:"100%",display:"flex",gap:"1rem"}},Ce={class:"col-12 pl-0"},ke={class:"col-12 m-auto p-0",style:{"max-width":"900px"}},Ve={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Le={class:"m-0 text-2xl my-4 my-0 py-0"},Pe={class:"block mt-2 md:mt-0 p-input-icon-left"},xe=w(()=>n("i",{class:"pi pi-search"},null,-1)),Se=w(()=>n("span",{class:"p-column-title"},"Code",-1)),Ue=w(()=>n("span",{class:"p-column-title"},"Code",-1)),Be=w(()=>n("span",{class:"p-column-title"},"Code",-1)),Ee={__name:"domicilio",setup(C){const i=ne();s(!1);const d=s([{}]),H=e=>{d.value.length>1&&d.value.splice(e,1)},f=s(!1);s({neighborhood_id:0,name:"",delivery_price:0,site_id:0,city_id:0});const k=s(0),p=s(0);B(p,(e,o)=>{e!=o&&X().then(a=>{x.value=a,k.value=x.value[0]})}),B(f,(e,o)=>{e==!0&&(p.value={},d.value=[{}])});const J=async()=>{f.value=!1,i.setLoading(!0,"guardando barrios");try{await Promise.all(d.value.map(async e=>{if(e.site_id=k.value.site_id,e.city_id=p.value.city_id,!(await fetch(`${u}/neighborhood`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error(`Error creating neighborhood: ${e.name}`)})),P.add({severity:"success",summary:"Created",detail:"All neighborhoods created successfully",life:3e3}),d.value=[{}],await V().then(e=>g.value=e),i.setLoading(!1,"guardando barrios")}catch(e){console.error("Request error:",e),P.add({severity:"error",summary:"Error",detail:"Failed to create some neighborhoods",life:3e3}),i.setLoading(!1,"guardando barrios")}},$=s([]),G=async()=>{try{const e=await fetch(`${u}/cities`);if(e.ok)return await e.json()}catch{}},K=async()=>{const e={method:"DELETE"};try{if(!(await fetch(`${u}/neighborhood/${D.value.neighborhood_id}`,e)).ok)throw new Error("Error al eliminar el barrio");await V().then(a=>g.value=a),_.value=!1,P.add({severity:"success",summary:"Eliminado",detail:"Barrio eliminado con éxito",life:3e3})}catch(o){console.error("Error en la petición:",o),P.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el barrio",life:3e3})}};E(async()=>{G().then(e=>$.value=e)});const g=s([]),Q=s(!1),_=s(!1),D=s({}),W=e=>{D.value=e,_.value=!0},V=async()=>{const e=R.params.site_id;try{i.setLoading(!0,"cargando barrios");const o=await fetch(`${u}/neighborhoods/by-site/${e}`);if(o.ok||(Q.value=!1,i.setLoading(!1,"cargando barrios")),o.ok){const a=await o.json();return i.setLoading(!1,"cargando barrios"),a}}catch{i.setLoading(!1,"cargando barrios")}},X=async()=>{var o;if(!((o=p.value)!=null&&o.city_id))return;const e=p.value.city_id;try{const a=await fetch(`${u}/sites/city/${e}`);if(a.ok||i.setLoading(!1,"cargando barrios"),a.ok){const y=await a.json();return i.setLoading(!1,"cargando barrios"),y}}catch{i.setLoading(!1,"cargando barrios")}};E(async()=>{V().then(e=>{g.value=e})}),T(()=>{i.setLoading(!1)});const I=s(),L=s(null),Y=()=>{L.value={global:{value:null,matchMode:de.CONTAINS}}};T(()=>{Y()}),s(!1),s(!1);const P=ie(),R=re();s(!1);const Z=s([]),ee=s([]);s({}),s({});const oe=s(!0);s(!1),s([]);const j=async e=>{const o={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};fetch(`${u}/neighborhood/${e.neighborhood_id}`,o).then(a=>{if(!a.ok)throw new Error("La petición ha fallado");return a.json()}).then(a=>{console.log("Respuesta del servidor:",a)}).catch(a=>{console.error("Error en la petición:",a)})};async function te(){try{const e=await fetch(`${u}/employers/grouped-by-site`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let o=await e.json();o=o.map(a=>{const y=a.employers.reduce((m,c)=>(m[c.position]=m[c.position]||[],m[c.position].push(c),m),{});return{...a,positions:y}}),Z.value=o,oe.value=!1}catch(e){console.error("Error al obtener usuarios agrupados por sede:",e)}}async function ae(){try{const e=await fetch(`${u}/employers/grouped-by-position`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);ee.value=await e.json()}catch(e){console.error("Error al obtener usuarios agrupados por posición:",e)}}const x=s([]);return T(()=>{fe().then(e=>x.value=e)}),E(async()=>{await te(),await ae()}),B(()=>R.path,()=>{V().then(e=>{g.value=e})}),(e,o)=>{const a=v("Button"),y=v("Dialog"),m=v("Dropdown"),c=v("InputText"),M=v("InputNumber"),b=v("Column"),se=v("DataTable");return U(),N(z,null,[l(y,{visible:_.value,"onUpdate:visible":o[1]||(o[1]=t=>_.value=t),style:{width:"auto"},header:"Confirmar eliminación",modal:!0,closable:!1},{default:r(()=>[ye,l(a,{label:"Cancelar",onClick:o[0]||(o[0]=t=>_.value=!1),class:"p-button-text"}),l(a,{label:"Eliminar",onClick:K,class:"p-button-danger"})]),_:1},8,["visible"]),l(y,{visible:f.value,"onUpdate:visible":o[6]||(o[6]=t=>f.value=t),header:"Crear Nuevo Barrio",modal:!0,closable:!1},{footer:r(()=>[l(a,{label:"Cancelar",onClick:o[5]||(o[5]=t=>f.value=!1),class:"p-button-text"}),l(a,{label:"Crear",onClick:J,class:"p-button-text"})]),default:r(()=>[n("div",ge,[n("div",_e,[l(m,{style:{width:"100%"},modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=t=>p.value=t),options:$.value,optionLabel:"city_name",placeholder:"Ciudad"},null,8,["modelValue","options"])]),n("div",be,[l(m,{style:{width:"100%"},modelValue:k.value,"onUpdate:modelValue":o[3]||(o[3]=t=>k.value=t),options:x.value,optionLabel:"site_name",placeholder:"Sede"},null,8,["modelValue","options"])])]),(U(!0),N(z,null,ce(d.value,(t,h)=>(U(),N("div",{key:h},[n("div",we,[l(c,{modelValue:t.name,"onUpdate:modelValue":S=>t.name=S,placeholder:"Nombre del Barrio"},null,8,["modelValue","onUpdate:modelValue"]),l(M,{modelValue:t.delivery_price,"onUpdate:modelValue":S=>t.delivery_price=S,placeholder:"Precio del Domicilio"},null,8,["modelValue","onUpdate:modelValue"]),d.value.length>1?(U(),ue(a,{key:0,text:"",class:"p-0",size:"small",severity:"danger",onClick:S=>H(h)},{default:r(()=>[n("i",{class:F(["text-xl",A(O).TRASH])},null,2)]),_:2},1032,["onClick"])):pe("",!0)])]))),128)),n("div",Ce,[l(a,{text:"",class:"p-0",onClick:o[4]||(o[4]=()=>{d.value.push({})})},{default:r(()=>[n("i",{class:F(["text-4xl",A(O).PLUS_CIRCLE])},null,2)]),_:1})])]),_:1},8,["visible"]),n("div",ke,[l(se,{ref:"dt",value:g.value,selection:I.value,"onUpdate:selection":o[9]||(o[9]=t=>I.value=t),dataKey:"id",paginator:!0,rows:10,filters:L.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} neighborhoods",responsiveLayout:"scroll",scrollable:"","scroll-height":"62vh",frozenValue:e.lockedCustomers},{header:r(()=>[n("div",Ve,[n("p",Le,[q("Precios Domicilios "),l(a,{class:"p-2 ml-4",label:"Nuevo Barrio",onClick:o[7]||(o[7]=t=>f.value=!0)})]),n("span",Pe,[xe,l(c,{class:"",modelValue:L.value.global.value,"onUpdate:modelValue":o[8]||(o[8]=t=>L.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:r(()=>[l(b,{class:"p-2",selectionMode:"multiple",headerStyle:"width: 3rem; ",frozen:""}),l(b,{class:"p-2",field:"id",header:"Id",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:r(t=>[Se,q(" "+me(t.data.neighborhood_id),1)]),_:1}),l(b,{class:"p-2",field:"name",header:"Barrio",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:r(t=>[Ue,l(c,{onchange:()=>j(t.data),style:{width:"100%"},modelValue:t.data.name,"onUpdate:modelValue":h=>t.data.name=h},null,8,["onchange","modelValue","onUpdate:modelValue"])]),_:1}),l(b,{class:"p-2",field:"delivery_price",header:"Precio del domicilio",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:r(t=>[Be,l(M,{style:{width:"100%"},modelValue:t.data.delivery_price,"onUpdate:modelValue":[h=>t.data.delivery_price=h,()=>j(t.data)]},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(b,{field:"actions",header:"Acciones"},{body:r(t=>[l(a,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:h=>W(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters","frozenValue"])])],64)}}},$e=le(Ee,[["__scopeId","data-v-5b9e1443"]]);export{$e as default};
