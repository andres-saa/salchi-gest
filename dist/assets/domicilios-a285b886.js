import{_ as G,C as L,G as H,j as s,H as B,k as M,B as A,r as u,o as d,c,a,e as r,f as E,g as R,t as z,i as f,U as S,q as J,x as K,h as Q}from"./index-58581f28.js";const _=y=>(J("data-v-54546110"),y=y(),K(),y),W={class:"col-12 p-3"},X=_(()=>a("p",{class:"text-4xl text-center px-4",style:{"font-weight":"bold","margin-top":"6rem"}},[a("i",{class:"fa-solid fa-truck-arrow-right"}),Q(" Domicilios ")],-1)),Y={class:"actions-bar"},Z={class:"p-fluid form-grid"},ee={class:"p-field"},oe=_(()=>a("label",{for:"name"},"Nombre del Barrio",-1)),ie={key:0,class:"p-error"},ae={class:"p-field"},te=_(()=>a("label",{for:"delivery_price"},"Precio de Domicilio",-1)),le={key:0,class:"p-error"},se={class:"p-field"},re=_(()=>a("label",{for:"site"},"Sede",-1)),ne={key:0,class:"p-error"},de={class:"p-field"},ue=_(()=>a("label",{for:"city"},"Ciudad",-1)),ce={key:0,class:"p-error"},_e={style:{"max-width":"700px"},class:"m-auto"},pe={style:{display:"flex",gap:"1rem","align-items":"center"}},ve={key:0,class:"error-box"},me=_(()=>a("i",{class:"pi pi-exclamation-triangle"},null,-1)),he={__name:"domicilios",setup(y){const w=L(),x=H(),p=s([]),C=s([]),v=s(null),m=s(!0),V=s(!1),b=s(""),g=s(!1),l=s(!1),e=s({neighborhood_id:0,name:"",delivery_price:null,site_id:null,city_id:null});function U(){l.value=!1,e.value={neighborhood_id:0,name:"",delivery_price:null,site_id:null,city_id:null}}function q(){U(),g.value=!0}function D(){g.value=!1}async function F(){if(l.value=!0,!e.value.name||!Number.isFinite(e.value.delivery_price)||!e.value.site_id||!e.value.city_id){w.add({severity:"warn",summary:"Faltan datos",detail:"Completa los campos requeridos.",life:3e3});return}try{if(V.value=!0,!(await fetch(`${S}/neighborhoods`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.value)})).ok)throw new Error("Error al crear el barrio");w.add({severity:"success",summary:"Guardado",detail:"Barrio agregado con éxito.",life:2500}),D()}catch(o){console.error(o),w.add({severity:"error",summary:"Error",detail:"No se pudo guardar el barrio.",life:3500})}finally{V.value=!1}}const T=async()=>{const o=await fetch(`${S}/sites`);if(!o.ok)throw new Error("No se pudieron cargar las sedes");return await o.json()},O=async()=>{const o=await fetch(`${S}/cities`);if(!o.ok)throw new Error("No se pudieron cargar las ciudades");return await o.json()};function I(o){const i=p.value.find(n=>String(n.site_id)===String(o));v.value=i||null}return B(v,o=>{if(o&&o.site_id!=null){const i=`/domicilios/${o.site_id}`;x.path!==i&&A.push(i)}}),B(()=>x.params.site_id,o=>{m.value||I(o)}),M(async()=>{m.value=!0,b.value="";try{const[o,i]=await Promise.all([T(),O().catch(()=>[])]);p.value=Array.isArray(o)?o:[],C.value=Array.isArray(i)?i:[];const n=x.params.site_id;if(n)I(n);else{const h=p.value.find(k=>k.show_on_web);h&&(v.value=h,A.replace(`/domicilios/${h.site_id}`))}}catch(o){console.error(o),b.value="Hubo un problema cargando la información. Intenta de nuevo."}finally{m.value=!1}}),(o,i)=>{const n=u("Button"),h=u("InputText"),k=u("InputNumber"),N=u("Dropdown"),$=u("Dialog"),j=u("Skeleton"),P=u("RouterView");return d(),c("div",W,[X,a("div",Y,[r(n,{icon:"pi pi-plus",label:"Agregar barrio",onClick:q,disabled:m.value},null,8,["disabled"])]),r($,{visible:g.value,"onUpdate:visible":i[4]||(i[4]=t=>g.value=t),header:"Agregar Nuevo Barrio",modal:!0,closable:!1,style:{width:"32rem","max-width":"95vw"}},{footer:E(()=>[r(n,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:D}),r(n,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:F,loading:V.value},null,8,["loading"])]),default:E(()=>[a("div",Z,[a("div",ee,[oe,r(h,{id:"name",modelValue:e.value.name,"onUpdate:modelValue":i[0]||(i[0]=t=>e.value.name=t),modelModifiers:{trim:!0},invalid:l.value&&!e.value.name},null,8,["modelValue","invalid"]),l.value&&!e.value.name?(d(),c("small",ie,"Requerido")):f("",!0)]),a("div",ae,[te,r(k,{id:"delivery_price",modelValue:e.value.delivery_price,"onUpdate:modelValue":i[1]||(i[1]=t=>e.value.delivery_price=t),mode:"currency",currency:"COP",locale:"es-CO",min:0,invalid:l.value&&!Number.isFinite(e.value.delivery_price),maxFractionDigits:0},null,8,["modelValue","invalid"]),l.value&&!Number.isFinite(e.value.delivery_price)?(d(),c("small",le,"Requerido")):f("",!0)]),a("div",se,[re,r(N,{id:"site",modelValue:e.value.site_id,"onUpdate:modelValue":i[2]||(i[2]=t=>e.value.site_id=t),options:p.value.filter(t=>t.show_on_web),optionLabel:"site_name",optionValue:"site_id",placeholder:"Selecciona una Sede",showClear:"",filter:"",invalid:l.value&&!e.value.site_id},null,8,["modelValue","options","invalid"]),l.value&&!e.value.site_id?(d(),c("small",ne,"Requerido")):f("",!0)]),a("div",de,[ue,r(N,{id:"city",modelValue:e.value.city_id,"onUpdate:modelValue":i[3]||(i[3]=t=>e.value.city_id=t),options:C.value,optionLabel:"name",optionValue:"city_id",placeholder:"Selecciona una Ciudad",showClear:"",filter:"",invalid:l.value&&!e.value.city_id},null,8,["modelValue","options","invalid"]),l.value&&!e.value.city_id?(d(),c("small",ce,"Requerido")):f("",!0)])])]),_:1},8,["visible"]),a("div",_e,[a("div",pe,[m.value?(d(),R(j,{key:0,height:"3rem",width:"100%"})):(d(),R(N,{key:1,style:{width:"100%"},filter:"",showClear:"",modelValue:v.value,"onUpdate:modelValue":i[5]||(i[5]=t=>v.value=t),options:p.value.filter(t=>t.show_on_web),placeholder:"SEDE",optionLabel:"site_name",virtualScrollerOptions:{itemSize:38}},null,8,["modelValue","options"]))]),b.value?(d(),c("div",ve,[me,a("span",null,z(b.value),1)])):f("",!0),r(P)])])}}},ye=G(he,[["__scopeId","data-v-54546110"]]);export{ye as default};
