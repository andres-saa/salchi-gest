import{O as d,U as i}from"./index-2e8d2194.js";const h=d("reportes-ventas",{persist:{key:"reportes-ventas",storage:localStorage,paths:["dateRange","salesReport","selectedSites","order_status","visibleNotifications"]},state:()=>({dateRange:{startDate:new Date(new Date().setDate(new Date().getDate()-7)),endDate:new Date},loading:{visible:!1,tittle:"Cargando"},currentSesion:1}),getters:{lastWeek:a=>{const t=new Date,s=new Date;return s.setDate(t.getDate()-7),{startDate:s,endDate:t}},lastMidMonth:a=>{const t=new Date,s=new Date;return s.setDate(t.getDate()-14),{startDate:s,endDate:t}},lastMonth:a=>{const t=new Date,s=new Date;return s.setDate(t.getDate()-28),{startDate:s,endDate:t}},dateRangeDifference(a){const t=new Date(a.dateRange.endDate),s=new Date(a.dateRange.startDate),o=Math.abs(t-s),r=Math.ceil(o/(1e3*60*60*24));console.log(r,"dif");let e="";switch(r){case 8:e="Últimos 7 días";break;case 15:e="Últimos 14 días";break;case 29:e="Últimos 28 días";break;default:e=null}return{diffDays:r,rangeName:e}}},actions:{async fetchSalesReport(){if(this.selectedSites.length<1){alert("Selecciones las sedes pare el reporte, gracias.");return}const a=this.formatDate(this.dateRange.startDate),t=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(e=>e.site_id).join(","),o=new URLSearchParams({site_ids:s,status:this.order_status,start_date:a,end_date:t}),r=`${i}/sales_report?${o.toString()}`;try{this.setLoading(!0,"cargando reporte");const e=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw this.setLoading(!1,"cargando reporte"),new Error(`HTTP error! status: ${e.status}`);const n=await e.json();this.salesReport=n,this.fetchDilyReport(),this.fetchDilyOrdersReport(),this.fetchTicketsReport(),console.log(n),this.setLoading(!1,"cargando reporte")}catch(e){console.error("Fetch error:",e),this.setLoading(!1,"cargando reporte")}},formatDate(a){const t=new Date(a),s=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getDate().toString().padStart(2,"0");return`${s}-${o}-${r}`},setDateRange(a,t){this.dateRange.startDate=new Date(a),this.dateRange.endDate=new Date(t)},async fetchDilyReport(){const a=this.formatDate(this.dateRange.startDate),t=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(e=>e.site_id).join(","),o=new URLSearchParams({site_ids:s,status:this.order_status,start_date:a,end_date:t}),r=`${i}/daily_sales?${o.toString()}`;try{const e=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();return this.setChartData(n),n;console.log(n)}catch(e){console.error("Fetch error:",e)}},async fetchDilyOrdersReport(){const a=this.formatDate(this.dateRange.startDate),t=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(e=>e.site_id).join(","),o=new URLSearchParams({site_ids:s,status:this.order_status,start_date:a,end_date:t}),r=`${i}/daily_orders?${o.toString()}`;try{const e=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();return this.setCharOrdersData(n),n;console.log(n)}catch(e){console.error("Fetch error:",e)}},async fetchTicketsReport(){const a=this.formatDate(this.dateRange.startDate),t=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(e=>e.site_id).join(","),o=new URLSearchParams({site_ids:s,status:this.order_status,start_date:a,end_date:t}),r=`${i}/daily_average_ticket?${o.toString()}`;try{const e=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();return this.setCharTicketsData(n),n;console.log(n)}catch(e){console.error("Fetch error:",e)}},setChartData(a){const t=[],s=[];a.forEach(o=>{Object.keys(o).forEach(r=>{t.includes(r)||t.push(r)}),Object.values(o).forEach(r=>{s.push(r)})}),this.ventasCharData={labels:t,datasets:[{label:"Venta",data:s,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharOrdersData(a){const t=[],s=[];a.forEach(o=>{Object.keys(o).forEach(r=>{t.includes(r)||t.push(r)}),Object.values(o).forEach(r=>{s.push(r)})}),this.ordersCharData={labels:t,datasets:[{label:"Venta",data:s,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharTicketsData(a){const t=[],s=[];a.forEach(o=>{Object.keys(o).forEach(r=>{t.includes(r)||t.push(r)}),Object.values(o).forEach(r=>{s.push(r)})}),this.ticketsCharData={labels:t,datasets:[{label:"Venta",data:s,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setSelectedSites(a){this.selectedSites=a,localStorage.setItem("selectedSites",JSON.stringify(a))},setOrderStatus(a){this.order_status=a,localStorage.setItem("orderStatus",a)},toogleVisibleNotifications(a){this.visibleNotifications=!this.visibleNotifications},setLoading(a,t="cargando"){this.loading={visible:a,tittle:t}},setVisibleOrder(a,t={}){a||(this.visibleOrder.order={}),this.visibleOrder={visible:a,order:t}}}});export{h as u};
