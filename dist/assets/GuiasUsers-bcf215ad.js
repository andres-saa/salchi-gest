import{_ as be,x as xe,f as l,Q as Ee,h as Le,B as Ce,u as Te,r as C,o as Z,c as ee,d as s,w as i,F as ke,R as Se,U as p,a as r,a5 as H,k as x,t as b,y as $e,q as ae,l as te,P as oe,n as Ve,p as Fe,e as De}from"./index-6f5f142a.js";import{_ as Pe}from"./file-4fa33ca9.js";const g=S=>(Fe("data-v-32c6f901"),S=S(),De(),S),Ae=g(()=>r("p",{class:"mb-2 my-5 text-4xl text-center px-4",style:{"font-weight":"bold","text-transform":"capitalize"}},[r("i",{class:"fa-solid fa-person-chalkboard"}),x(" Gestion de guias ")],-1)),Ue=g(()=>r("h4",null,"Seleccione el elemento a eliminar:",-1)),je={style:{display:"flex",gap:"1rem"}},Ne=g(()=>r("p",null,"¿Estás seguro de que quieres eliminar este archivo?",-1)),Be=["onSubmit"],Ie={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},He=["onSubmit"],Oe={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},Re={class:"grid col-12 p-0 gap-3 my-4 m-0"},ze={class:"col p-0",style:{display:"flex","justify-content":"end",width:"100%",gap:"1rem"}},Me=g(()=>r("span",{class:"p-column-title"},"Code",-1)),qe={class:"",style:{position:"relative",display:"flex","justify-content":"center"}},Ge={style:{color:"white","font-size":"0.7rem",position:"absolute","font-weight":"bold",bottom:"0.9rem","text-transform":"uppercase"}},Je=g(()=>r("span",{class:"p-column-title"},"Code",-1)),Ke=g(()=>r("span",{class:"p-column-title"},"Code",-1)),Qe=g(()=>r("span",{class:"p-column-title"},"Code",-1)),We=g(()=>r("span",{class:"p-column-title"},"Code",-1)),Xe={class:"text-right"},Ye={class:"text-right"},Ze=["onSubmit"],ea={class:"field my-3",style:{display:"flex",gap:"1rem","justify-content":"end","flex-direction":"column"}},aa={key:0,style:{"background-color":"var(--green-100)","border-radius":"0.2rem"},class:"col-12 my-4"},ta={style:{display:"flex",gap:"1rem","justify-content":"end"}},oa={__name:"GuiasUsers",setup(S){const o=xe(),se={pdf:"#E74C3C",doc:"#3498DB",docx:"#3498DB",xls:"#27AE60",xlsx:"#27AE60",ppt:"#E67E22",pptx:"#E67E22",psd:"#34495E",ai:"#F39C12",indd:"#EB4D4B",jpg:"#F1C40F",jpeg:"#F1C40F",png:"#1ABC9C",gif:"#F39C12",bmp:"#2ECC71",tiff:"#D35400",svg:"#9B59B6",mp3:"#2ECC71",wav:"#3498DB",aac:"#9B59B6",flac:"#E74C3C",ogg:"#E67E22",csv:"#27AE60"},P=l(!1),T=l(null),O=l([]),re=()=>{T.value=null},$=async()=>{await N().then(e=>w.value=e),await B().then(e=>{y.value=e}),await I().then(e=>{_.value=e}),O.value=[...y.value.map(e=>({id:e.id_area,name:e.area_name,type:"area"})),..._.value.map(e=>({id:e.id_type,name:e.type_name,type:"type"}))]},le=()=>{h.value="",f.value=""},ne=async()=>{if(!T.value)return;const{id:e,type:a}=T.value;let u=`${p}/`;a==="area"?u+=`area/${e}`:a==="type"&&(u+=`archived-file-type/${e}`);try{const n=await fetch(u,{method:"DELETE"});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);v.add({severity:"success",summary:"Éxito",detail:`${a==="area"?"Área":"Tipo"} eliminado correctamente`,life:3e3}),a==="area"?B().then(d=>{y.value=d,$()}):I().then(d=>{$(),_.value=d}),P.value=!1}catch(n){v.add({severity:"error",summary:"Error",detail:n.message,life:3e3})}},A=l(!1),V=l({area_name:""}),U=l(!1),F=l({type_name:""}),ie=()=>{V.value={area_name:""}},de=()=>{F.value={type_name:""}},R=async()=>{o.setLoading(!0,"creando area");try{const e=await fetch(`${p}/area`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V.value)});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);v.add({severity:"success",summary:"Éxito",detail:"Área creada correctamente",life:3e3}),B().then(a=>y.value=a),A.value=!1,o.setLoading(!1,"cargando archivos")}catch(e){v.add({severity:"error",summary:"Error",detail:e.message,life:3e3}),o.setLoading(!1,"cargando archivos")}},z=async()=>{o.setLoading(!0,"creando tipo");try{const e=await fetch(`${p}/archived-file-type`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F.value)});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);v.add({severity:"success",summary:"Éxito",detail:"Tipo de archivo creado correctamente",life:3e3}),I().then(a=>_.value=a),U.value=!1,o.setLoading(!1,"cargando archivos")}catch(e){v.add({severity:"error",summary:"Error",detail:e.message,life:3e3}),o.setLoading(!1,"cargando archivos")}},y=l([]),_=l([]),k=l(!1),D=l(null),ce=e=>{D.value=e,k.value=!0},ue=async()=>{if(o.setLoading(!0,"borrando archivo"),!!D.value)try{const e=await fetch(`${p}/archived-file/${D.value}`,{method:"DELETE"});if(e.ok)o.setLoading(!1,"borrando archivo"),v.add({severity:"success",summary:"Éxito",detail:"Archivo eliminado correctamente",life:3e3}),N().then(a=>w.value=a);else throw new Error(`Error al eliminar el archivo: ${e.statusText}`)}catch(e){o.setLoading(!1,"borrando archivo"),v.add({severity:"error",summary:"Error",detail:e.message,life:3e3})}finally{o.setLoading(!1,"borrando archivo"),k.value=!1,D.value=null}},f=l(_.value[0]),h=l(y.value[0]),m=l({});l({});const w=l([]),M=l(null),j=l(!1),E=l({archived_file_id:"",custom_filename:"",file:null}),q=()=>{j.value=!1,E.value={archived_file_id:"",custom_filename:"",file:null}},pe=e=>{E.value.file=e.target.files[0]},G=async()=>{if(E.value.file){const e=new FormData;e.append("file",E.value.file),e.append("id_area",m.value.area.id_area),e.append("id_type",m.value.type.id_type),e.append("file_name",m.value.file_name);try{const a=await fetch(`${p}/upload-archived-file/`,{method:"POST",body:e});if(a.ok){const u=await a.json();v.add({severity:"success",summary:"Éxito",detail:"Archivo subido correctamente",life:3e3}),q(),N().then(n=>w.value=n)}else throw new Error(`Error al subir el archivo: ${a.statusText}`)}catch(a){v.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}}else v.add({severity:"warn",summary:"Advertencia",detail:"Por favor, selecciona un archivo",life:3e3})},J=l();l([]);const K=l(null),me=()=>{K.value={global:{value:null,matchMode:Se.CONTAINS}}};Ee(()=>{me()});const ve=(e,a,u)=>{const n=`${p}/get-archived-file/${e}/${a}/${u.split(".")[0]}`;fetch(n).then(d=>{if(d.ok)return d.blob();throw new Error("Network response was not ok.")}).then(d=>{const L=window.URL.createObjectURL(d),c=document.createElement("a");c.href=L,c.download=u,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(L)}).catch(d=>console.error("Error downloading the file:",d))};async function N(){o.setLoading(!0,"cargando archivos");try{const e=await fetch(`${p}/archived-files`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function B(){o.setLoading(!0,"cargando areas");try{const e=await fetch(`${p}/areas`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function I(){o.setLoading(!0,"cargando tipos");try{const e=await fetch(`${p}/archived-file-types    `);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}Le(()=>{$()});async function fe(){if(console.log(3),o.setLoading(!0,"cargando archivos"),!h.value){o.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${p}/archived-files/area/${h.value.id_area}`);if(!e.ok)throw o.setLoading(!1,"cargando archivos"),new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function he(){if(o.setLoading(!0,"cargando archivos"),!f.value){o.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${p}/archived-files/type/${f.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function ye(){if(o.setLoading(!0,"cargando archivos"),!f.value||!h.value){o.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${p}/archived-files/${h.value.id_area}/${f.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){console.error("Error al obtener usuarios agrupados por sede:",e),o.setLoading(!1,"cargando archivos")}}const ge=()=>{h.value&&f.value?ye().then(e=>w.value=e):!h.value&&f.value?he().then(e=>w.value=e):h.value&&!f.value?fe().then(e=>w.value=e):$()},v=Ce();return Te(),(e,a)=>{var Q,W,X,Y;const u=C("Dropdown"),n=C("Button"),d=C("Dialog"),L=C("InputText"),c=C("Column"),_e=C("DataTable");return Z(),ee(ke,null,[Ae,s(d,{visible:P.value,"onUpdate:visible":a[1]||(a[1]=t=>P.value=t),header:"Eliminar área o tipo",modal:"",closable:!0,onHide:re},{default:i(()=>[r("div",null,[Ue,r("div",je,[s(u,{style:{width:"60%"},modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=t=>T.value=t),options:O.value,optionLabel:"name",placeholder:"Seleccione un área o tipo"},null,8,["modelValue","options"]),s(n,{style:{width:"40%"},label:"Eliminar",icon:"pi pi-check",class:"p-button-danger",onClick:ne})])])]),_:1},8,["visible"]),s(d,{visible:k.value,"onUpdate:visible":a[3]||(a[3]=t=>k.value=t),header:"Confirmar eliminación",modal:"",closable:!1},{default:i(()=>[Ne,s(n,{label:"No",icon:"pi pi-times",onClick:a[2]||(a[2]=t=>k.value=!1),class:"p-button-text"}),s(n,{label:"Sí",icon:"pi pi-check",onClick:ue,class:"p-button-danger"})]),_:1},8,["visible"]),s(d,{visible:A.value,"onUpdate:visible":a[5]||(a[5]=t=>A.value=t),header:"Crear nueva área",modal:"",closable:!0,onHide:ie},{default:i(()=>[r("form",{onSubmit:H(R,["prevent"])},[s(L,{modelValue:V.value.area_name,"onUpdate:modelValue":a[4]||(a[4]=t=>V.value.area_name=t),placeholder:"Nombre del área",class:"w-full"},null,8,["modelValue"]),r("div",Ie,[s(n,{rounded:"",class:"mt-4",label:"Crear",icon:"pi pi-check",onClick:R})])],40,Be)]),_:1},8,["visible"]),s(d,{visible:U.value,"onUpdate:visible":a[7]||(a[7]=t=>U.value=t),header:"Crear nuevo tipo de archivo",modal:"",closable:!0,onHide:de},{default:i(()=>[r("form",{onSubmit:H(z,["prevent"])},[s(L,{modelValue:F.value.type_name,"onUpdate:modelValue":a[6]||(a[6]=t=>F.value.type_name=t),placeholder:"Nombre del tipo de archivo",class:"w-full"},null,8,["modelValue"]),r("div",Oe,[s(n,{rounded:"",class:"mt-4",label:"Crear",icon:"pi pi-check",onClick:z})])],40,He)]),_:1},8,["visible"]),s(_e,{class:"card mb-4 my-3 md:shadow-5 md:p-5",style:{"max-width":"1024px",border:"none",margin:"auto",padding:"0"},ref:"dt",value:w.value,selection:J.value,"onUpdate:selection":a[10]||(a[10]=t=>J.value=t),dataKey:"id",paginator:!0,rows:10,filters:K.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} archivos"},{header:i(()=>[r("div",Re,[s(u,{style:{height:"3rem","text-justify":"center"},class:"col-12 lg:col-5 p-0",optionLabel:"area_name",modelValue:h.value,"onUpdate:modelValue":a[8]||(a[8]=t=>h.value=t),options:y.value,placeholder:"Area de la empresa"},null,8,["modelValue","options"]),s(u,{style:{height:"3rem","text-justify":"center"},class:"col-12 lg:col-4 p-0",modelValue:f.value,"onUpdate:modelValue":a[9]||(a[9]=t=>f.value=t),optionLabel:"type_name",options:_.value,placeholder:"Tipo de archivo"},null,8,["modelValue","options"]),r("div",ze,[s(n,{onClick:le,icon:"fa-solid fa-broom text-2xl",style:{height:"3rem","border-radius":"50%","aspect-ratio":"1/1",display:"flex","align-items":"center","justify-content":"center"},class:"text-center text-4xl",severity:"danger",size:"small"}),s(n,{onClick:ge,style:{height:"3rem","border-radius":"50%","aspect-ratio":"1/1",display:"flex","align-items":"center","justify-content":"center"},class:"text-center text-2xl",severity:"help",size:"small",icon:"text-2xl pi pi-search"})])])]),default:i(()=>[s(c,{class:"p-2",selectionMode:"multiple",headerStyle:"width: 3rem; ",frozen:""}),s(c,{class:"p-2",field:"id",header:"Id",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[Me,x(" "+b(t.data.id_file),1)]),_:1}),s(c,{class:"p-2",field:"id",header:"",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[r("div",qe,[r("img",{style:$e([{height:"3.5rem","aspect-ratio":"1 / 1","object-fit":"contain","border-radius":"0.5rem"},`background-color:${se[t.data.file_extension]} `]),class:"p-1",src:Pe,alt:""},null,4),r("span",Ge,b(t.data.file_extension.slice(0,4)),1)])]),_:1}),s(c,{class:"p-2",field:"file_name",header:"Nombre",sortable:!0,headerStyle:"width:min-content; min-width:20rem; "},{body:i(t=>[Je,x(" "+b(t.data.file_name),1)]),_:1}),s(c,{class:"p-2",field:"type",header:"Tipo",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[Ke,x(" "+b(t.data.type_name),1)]),_:1}),s(c,{class:"p-2",field:"type",header:"Area",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[Qe,x(" "+b(t.data.area_name),1)]),_:1}),s(c,{class:"p-2",field:"upload_date",header:"Fecha",sortable:!0,headerStyle:"width:10rem; min-width:7rem; "},{body:i(t=>[We,x(" "+b(t.data.upload_date),1)]),_:1}),s(c,{class:"p-2",field:"location",header:"Acciones",sortable:!0,frozen:"",alignFrozen:"right",headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[s(n,{text:"",class:"p-0 mx-2",severity:"success",onClick:we=>ve(t.data.id_area,t.data.id_type,t.data.file_name)},{default:i(()=>[r("span",Xe,[r("i",{class:ae(te(oe).DOWNLOAD)},null,2)])]),_:2},1032,["onClick"]),s(n,{text:"",class:"p-0 mx-2",severity:"danger",onClick:we=>ce(t.data.id_file)},{default:i(()=>[r("span",Ye,[r("i",{class:ae(te(oe).TRASH)},null,2)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),s(d,{visible:j.value,"onUpdate:visible":a[15]||(a[15]=t=>j.value=t),style:{width:"450px"},header:`Subir ${(W=(Q=m.value)==null?void 0:Q.type)==null?void 0:W.type_name} para el area de ${(Y=(X=m.value)==null?void 0:X.area)==null?void 0:Y.area_name}`,modal:"",closable:!0,onHide:q},{default:i(()=>[r("form",{onSubmit:H(G,["prevent"]),enctype:"multipart/form-data"},[s(L,{optionLabel:"area_name",placeholder:"Nombre del archivo",class:"col-12 my-0",style:{padding:"0.8rem 10px"},modelValue:m.value.file_name,"onUpdate:modelValue":a[11]||(a[11]=t=>m.value.file_name=t),options:y.value},null,8,["modelValue","options"]),s(u,{optionLabel:"area_name",placeholder:"Area de la empresa",class:"col-12 p-0 my-3",modelValue:m.value.area,"onUpdate:modelValue":a[12]||(a[12]=t=>m.value.area=t),options:y.value},null,8,["modelValue","options"]),s(u,{class:"col-12 p-0",placeholder:"Tipo de archivo",modelValue:m.value.type,"onUpdate:modelValue":a[13]||(a[13]=t=>m.value.type=t),optionLabel:"type_name",options:_.value},null,8,["modelValue","options"]),r("div",ea,[E.value.file?(Z(),ee("div",aa,b(E.value.file.name),1)):Ve("",!0),r("div",ta,[r("input",{type:"file",id:"file",ref_key:"fileInput",ref:M,onChange:pe,required:"",style:{display:"none"}},null,544),s(n,{rounded:"",onClick:a[14]||(a[14]=()=>{M.value.click()})},{default:i(()=>[x(" Cargar archivo")]),_:1}),s(n,{rounded:"",severity:"success",label:"Enviar",class:"",onClick:G})])])],40,Ze)]),_:1},8,["visible","header"])],64)}}},la=be(oa,[["__scopeId","data-v-32c6f901"]]);export{la as default};
