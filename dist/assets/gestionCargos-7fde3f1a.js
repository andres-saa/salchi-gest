import{_ as O,l as j,r as y,A as W,B as q,q as H,a as m,o as v,b as h,i as n,h as c,d as e,s as V,U as A,t as g,F as B,e as U,f as J,N as L,j as M,n as K,p as Q,m as X}from"./index-e0d1eab6.js";const b=f=>(Q("data-v-99fb7963"),f=f(),X(),f),Y=b(()=>e("div",{class:"dialog-header"},[e("i",{class:"pi pi-shield text-3xl"}),e("div",{class:"titles"},[e("h3",{class:"m-0 p-0"},[e("b",null,"Gestión de permisos")]),e("small",{class:"opacity-80"},"Administra accesos por grupo y permiso individual")])],-1)),Z={class:"role-chip"},ee=b(()=>e("span",{class:"label"},"Accesos para:",-1)),se={key:0,class:"loading-zone"},le=b(()=>e("p",{class:"mt-2"},"Cargando grupos de permisos…",-1)),ae={key:1,class:"groups"},oe=["onClick"],te=["title"],ne={class:"right"},ie={class:"perm-list"},de={class:"perm-name"},ce={class:"container mx-auto mb-4 page-wrap"},re={class:"hero"},_e={class:"hero-card shadow-1"},pe=b(()=>e("div",{class:"hero-left"},[e("i",{class:"pi pi-sitemap text-3xl"}),e("div",null,[e("h2",{class:"m-0 p-0"},[e("b",null,"Gestión de cargos y accesos")]),e("small",{class:"opacity-80"},"Encuentra el cargo y ajusta sus permisos")])],-1)),ue={class:"hero-right"},me={class:"table-wrap"},ve=b(()=>e("div",{class:"table-header"},[e("h3",{class:"m-0 p-0"},[e("b",null,"Cargos")])],-1)),he={class:"cell-role"},ge=b(()=>e("i",{class:"pi pi-user"},null,-1)),ye={class:"role-text"},be={class:"actions"},fe={__name:"gestionCargos",setup(f){j();const r=y({}),S=y([]),w=y([]),$=y(!1),C=y(null),P=y("");W(()=>N());const N=()=>{C.value={global:{value:null,matchMode:q.CONTAINS}}},R=async()=>{S.value=await V.get(`${A}/get-all-rol`)};H(async()=>{await R()});const D=async(o,l)=>{P.value=l,$.value=!0;const i=await V.get(`${A}/get_all-permission-group-by-group`,"Cargando"),_=await V.get(`${A}/get-all-rol-by-rol-id/${o}`,"Cargando"),p=_.map(t=>t.permission_id);i.forEach(t=>{t.permissions.forEach(u=>{var x;u.enrolled=p.includes(u.id),u.permission_rol_id=(x=_.find(k=>k.permission_id===u.id))==null?void 0:x.id}),t.enrolledAll=t.permissions.every(u=>u.enrolled),r.value[t.name]=!0}),w.value=i},E=async o=>{const l=o.enrolledAll;for(const i of o.permissions)i.enrolled!==l&&(i.enrolled=l,await I(i,l))},I=async(o,l)=>{const i={rol_id:P.value.id,permission_id:o.id,status:l,permission_rol_id:o.permission_rol_id};await V.put(`${A}/toggle_permision/${o.permission_rol_id||1}/${l}`,i,"Cargando");const _=w.value.find(p=>p.permissions.some(t=>t.id===o.id));if(_){const p=_.permissions.every(t=>t.enrolled);_.enrolledAll=p}},F=o=>{r.value[o.name]=!r.value[o.name]};return(o,l)=>{const i=m("Tag"),_=m("ProgressSpinner"),p=m("InputSwitch"),t=m("Button"),u=m("Dialog"),x=m("InputText"),k=m("Column"),G=m("DataTable");return v(),h("div",null,[n(u,{visible:$.value,"onUpdate:visible":l[1]||(l[1]=d=>$.value=d),modal:"",style:{width:"52rem",maxWidth:"95vw"},class:"perm-dialog"},{header:c(()=>[Y]),default:c(()=>{var d;return[e("div",Z,[ee,n(i,{severity:"help",class:"px-3 py-2 text-sm"},{default:c(()=>{var s;return[e("b",null,g(((s=P.value)==null?void 0:s.name)||"—"),1)]}),_:1})]),(d=w.value)!=null&&d.length?(v(),h("div",ae,[(v(!0),h(B,null,U(w.value,(s,z)=>(v(),h("div",{key:`${s.name}-${z}`,class:J(["group-card",{active:s.enrolledAll}])},[e("div",{class:"group-head",onClick:a=>F(s)},[e("div",{class:"left",onClick:l[0]||(l[0]=L(()=>{},["stop"]))},[n(p,{modelValue:s.enrolledAll,"onUpdate:modelValue":a=>s.enrolledAll=a,onChange:a=>E(s),pt:{root:{class:"switch-root"}}},null,8,["modelValue","onUpdate:modelValue","onChange"]),e("h5",{class:"m-0 p-0 name",title:s.name},[e("b",null,g(s.name),1)],8,te),n(i,{class:"count-chip",severity:s.enrolledAll?"success":"secondary"},{default:c(()=>[M(g(s.permissions.filter(a=>a.enrolled).length)+"/"+g(s.permissions.length),1)]),_:2},1032,["severity"])]),e("div",ne,[n(t,{text:"",rounded:"",class:"chev",icon:r.value[s.name]?"pi pi-chevron-up":"pi pi-chevron-down",onClick:L(a=>r.value[s.name]=!r.value[s.name],["stop"]),"aria-label":r.value[s.name]?"Contraer":"Expandir"},null,8,["icon","onClick","aria-label"])])],8,oe),e("div",{class:"group-body",style:K(r.value[s.name]?"":"height:0;overflow:hidden;padding:0")},[e("div",ie,[(v(!0),h(B,null,U(s.permissions,a=>(v(),h("div",{key:a.id,class:"perm-row"},[n(p,{modelValue:a.enrolled,"onUpdate:modelValue":T=>a.enrolled=T,onChange:T=>I(a,a.enrolled)},null,8,["modelValue","onUpdate:modelValue","onChange"]),e("h6",de,g(a.name),1),n(i,{class:"state-chip",severity:a.enrolled?"success":"danger"},{default:c(()=>[M(g(a.enrolled?"Activo":"Inactivo"),1)]),_:2},1032,["severity"])]))),128))])],4)],2))),128))])):(v(),h("div",se,[n(_,{strokeWidth:"6"}),le]))]}),_:1},8,["visible"]),e("div",ce,[e("div",re,[e("div",_e,[pe,e("div",ue,[n(x,{modelValue:C.value.global.value,"onUpdate:modelValue":l[2]||(l[2]=d=>C.value.global.value=d),placeholder:"Buscar cargo...",class:"search"},null,8,["modelValue"])])])]),e("div",me,[n(G,{value:S.value,paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Roles",rowsPerPageOptions:[5,10,25,100],scrollable:"",showGridlines:"",scrollHeight:"60vh",stripedRows:"",filters:C.value,class:"p-datatable-sm pretty-table"},{header:c(()=>[ve]),default:c(()=>[n(k,{header:"Cargo",field:"name",style:{width:"75%"}},{body:c(d=>[e("div",he,[ge,e("span",ye,g(d.data.name),1)])]),_:1}),n(k,{header:"Acción",style:{width:"25%","text-align":"right"}},{body:c(d=>[e("div",be,[n(t,{label:"Accesos",icon:"pi pi-eye",text:"",class:"p-button-plain",onClick:s=>D(d.data.id,d.data)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","filters"])])])])}}},Ce=O(fe,[["__scopeId","data-v-99fb7963"]]);export{Ce as default};
