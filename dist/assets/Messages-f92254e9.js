import{J as fe,_ as ye,h as d,C as me,I as re,D as ne,i as be,G as we,g as ie,o as s,c as _,d as V,k as v,a as u,F as ge,r as ke,n as S,j as $,H as C,K as T,t as L,p as Me,m as xe}from"./index-25fedaca.js";const Se=fe("chat",{persist:{key:"client",storage:localStorage,paths:["user","last_messages"]},state:()=>({last_messages:{"3226892988":[{user_id:10,nombre:"andres saa",fecha_ultimo_mensaje:"12/04/2025",hora_ultimo_mensaje:"08:01 PM",abreviatura:"hoy",mensaje_truncado:"nuevo mensaje brother",wa_id:"573226892988"},{user_id:11,nombre:"Kathe üòâ",fecha_ultimo_mensaje:"10/04/2025",hora_ultimo_mensaje:"08:41 PM",abreviatura:"anteayer",mensaje_truncado:"Mi amor precioso",wa_id:"573225958424"}]}}),getters:{fucion:x=>0},actions:{async func(){return func}}});const M=x=>(Me("data-v-2f867794"),x=x(),xe(),x),$e={style:{height:"100%",position:"relative",display:"flex","justify-content":"center"}},Ce={style:{position:"relative",height:"100%",width:"100%"}},Be={style:{margin:"0",color:"white","font-weight":"400"}},je={style:{color:"white",margin:"0","font-weight":"300"}},He=["innerHTML"],Ie=["innerHTML"],Te=["onClick"],Le={style:{color:"white",margin:"0","font-weight":"300",position:"absolute","min-width":"max-content",bottom:".5rem",right:"1rem",display:"flex",gap:".5rem"}},ze={style:{opacity:".5"}},Re={key:0,style:{color:"greenyellow"},class:"fa-solid fa-check-double"},Ae={key:1,style:{color:"greenyellow"},class:"fa-solid fa-check"},Ee={key:2,style:{color:"gray"},class:"fa-solid fa-check"},Ve={key:0,style:{position:"absolute",left:"-8px",top:"0",color:"#2f2f41"},viewBox:"0 0 8 13",height:"13",width:"8",preserveAspectRatio:"xMidYMid meet"},We=M(()=>u("title",null,"tail-in",-1)),Pe=M(()=>u("path",{opacity:"0.13",fill:"#0000000",d:"M1.533,3.568L8,12.193V1H2.812 C1.042,1,0.474,2.156,1.533,3.568z"},null,-1)),Ne=M(()=>u("path",{fill:"currentColor",d:"M1.533,2.568L8,11.193V0L2.812,0C1.042,0,0.474,1.156,1.533,2.568z"},null,-1)),Oe=[We,Pe,Ne],Ue={key:1,style:{position:"absolute",right:"-8px",top:"0",color:"#0a3744"},viewBox:"0 0 8 13",height:"13",width:"8",preserveAspectRatio:"xMidYMid meet"},De=M(()=>u("title",null,"tail-out",-1)),Fe=M(()=>u("path",{opacity:"0.13",d:"M5.188,1H0v11.193l6.467-8.625 C7.526,2.156,6.958,1,5.188,1z"},null,-1)),Ge=M(()=>u("path",{fill:"currentColor",d:"M5.188,0H0v11.193l6.467-8.625C7.526,1.156,6.958,0,5.188,0z"},null,-1)),Ke=[De,Fe,Ge],Ye={key:1,style:{height:"100%",width:"3rem","min-width":"3rem","aspect-ratio":"1/1","background-color":"rgb(3 88 95 / 53%)","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase"}},Je={style:{margin:"0",color:"white","font-weight":"400"}},qe={__name:"Messages",emits:["down"],setup(x,{expose:le}){Se();const se=async t=>{if(!(t.message_data.current_status_id>=3||t._marking)){t._marking=!0;try{await $.post(`${C}/read-message/${t.message_data.id}/${c.params.restaurant_id}`,!1),t.message_data.current_status_id=3}catch(o){console.error("No se pudo marcar como le√≠do",o)}}},ce=()=>{if(!n.value)return;const t=n.value.getBoundingClientRect();i.value.forEach((o,r)=>{if(o.message_data.employer_id||o.message_data.current_status_id>=3)return;const a=n.value.children[r];if(!a)return;const e=a.getBoundingClientRect();e.top>=t.top&&e.bottom<=t.bottom&&se(o)})};d(!1);const c=me(),W=t=>{if(!t)return"";const o=t.split(" "),r=Array.from(o[0])[0],a=o[1]?Array.from(o[1])[0]:"";return r+a},z=d(!0),i=d([]),B=d({}),n=d(null),y=d(!1),f=d(0),j=d(0),P=d(100),H=d(!1),R=d(!1),m=d(!1),A=d({});d({});const de=t=>{A.value[t]=!A.value[t]},N=t=>!!A.value[t],O=t=>{if(!t)return"";let o=t.replace(/\n/g,"<br/>");return o=o.replace(/\*([^*]+)\*/g,"<strong>$1</strong>"),o},ue=re(()=>({position:"absolute",zIndex:"300000",height:"3rem",width:"3rem",borderRadius:"50%",bottom:"5rem",right:"2rem",backgroundColor:m.value?"rgb(33, 150, 243)":"rgba(255, 255, 255,.1)",color:"white",border:"none",padding:"0.5rem 1rem",cursor:"pointer"})),_e=re(()=>({position:"absolute",zIndex:"300000",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center",width:"2rem",borderRadius:"50%",bottom:"5rem",right:"1rem",backgroundColor:"rgb(156, 39, 176)",color:"white",border:"none",padding:"0.5rem 1rem",cursor:"pointer"})),U=async(t=!0)=>{var o,r,a,e;if(t){j.value=0,R.value=!1;const l=await $.get(`${C}/conversation/${c.params.restaurant_id}/${c.params.user_id}/${j.value}/20`,t);i.value=((o=l==null?void 0:l[0])==null?void 0:o.messages)||[],B.value=((r=l==null?void 0:l[0])==null?void 0:r.user)||{},await T(),z.value&&(w(),z.value=!1)}else{const l=i.value.length>0?i.value[i.value.length-1].message_data.id:0,p=await $.get(`${C}/conversation/${c.params.user_id}/new?lastMessageId=${l}`,t),b=(((a=p==null?void 0:p[0])==null?void 0:a.messages)||[]).filter(k=>!i.value.some(I=>I.message_data.id===k.message_data.id));i.value=[...i.value,...b],y.value=!0,m.value=!0,B.value=((e=p==null?void 0:p[0])==null?void 0:e.user)||{},await T()}};ne(m,t=>{t||(f.value=0)});const pe=async()=>{var e,l,p,g;i.value.length>0&&i.value[i.value.length-1].message_data.id;const t=await $.get(`${C}/conversation-last-message/${c.params.restaurant_id}/${c.params.user_id}/`,!1),o=((e=t==null?void 0:t[0])==null?void 0:e.messages)||[],r=((l=t==null?void 0:t[0])==null?void 0:l.wa_id)||[],a=o.filter(b=>!i.value.some(k=>k.message_data.id===b.message_data.id&&!b.employer_id));i.value=[...i.value,...a],await T(),w(),a&&(a!=null&&a[0])&&!((g=(p=a==null?void 0:a[0])==null?void 0:p.message_data)!=null&&g.employer_id)&&r==c.params.user_id&&(f.value++,m.value=!0,y.value=!0)},he=async()=>{var e;if(H.value||R.value)return;H.value=!0;const t=n.value?n.value.scrollHeight:0,o=j.value+P.value,r=await $.get(`${C}/conversation/${c.params.restaurant_id}/${c.params.user_id}/${o}/${P.value}`,!1),a=((e=r==null?void 0:r[0])==null?void 0:e.messages)||[];if(a.length===0)R.value=!0;else{i.value=[...a,...i.value],j.value=o,await T();const l=n.value.scrollHeight;n.value.scrollTop=l-t}H.value=!1},D=()=>{if(ce(),!n.value)return;const{scrollTop:t,scrollHeight:o,clientHeight:r}=n.value;t<50&&he(),t+r>=o-50?(y.value=!1,m.value=!1):y.value=!0},ve=()=>{n.value&&(n.value.scrollTo({bottom:0,behavior:"smooth"}),y.value=!1,m.value=!1),f.value=0},w=()=>{n.value&&(n.value.scrollTo({top:n.value.scrollHeight,behavior:"smooth"}),y.value=!1,m.value=!1),f.value=0};let h=null;const E=()=>{var o;if(!c.params.user_id)return;const t=`wss://sockets-service.salchimonster.com/ws/${(o=c==null?void 0:c.params)==null?void 0:o.user_id}`;h=new WebSocket(t),h.onopen=()=>{console.log("Conexi√≥n WebSocket establecida a:",t)},h.onmessage=r=>{console.log("Mensaje recibido por WebSocket:",r.data),r.data===`actualizar-${c.params.user_id}`&&pe()},h.onerror=r=>{console.error("Error en el WebSocket:",r)},h.onclose=()=>{console.warn("WebSocket cerrado. Se intentar√° reconectar en 5 segundos..."),setTimeout(()=>E(),5e3)}};return be(()=>{U(),E(),n.value&&n.value.addEventListener("scroll",D)}),we(()=>{h&&h.close(),n.value&&n.value.removeEventListener("scroll",D)}),ne(()=>c.params,()=>{z.value=!0,U(),h&&h.close(),w(),E(),f.value=0}),le({scrollToBottom:ve,scrollToBottomNoSmooth:w}),(t,o)=>{const r=ie("ProgressSpinner"),a=ie("Button");return s(),_("div",$e,[H.value?(s(),V(r,{key:0,style:{width:"50px",height:"50px",position:"absolute","z-index":"100",color:"white"},strokeWidth:"8",fill:"transparent",animationDuration:".3s","aria-label":"Custom ProgressSpinner"})):v("",!0),u("div",Ce,[u("div",{ref_key:"messagesContainer",ref:n,style:{padding:"1rem",display:"flex","flex-direction":"column",gap:"0rem","overflow-y":"auto","max-height":"100%","padding-bottom":"4rem"}},[(s(!0),_(ge,null,ke(i.value,e=>{var l,p,g,b,k,I,F,G,K,Y,J,q,Q,X,Z,ee,te,oe;return s(),_("div",{key:(l=e==null?void 0:e.message_data)==null?void 0:l.id,style:S([{width:"100%",display:"flex",gap:"1rem","padding-bottom":"1rem"},(p=e==null?void 0:e.message_data)!=null&&p.employer_id?"justify-content: end;":"justify-content: start;"])},[(g=e==null?void 0:e.message_data)!=null&&g.employer_id?v("",!0):(s(),_("div",{key:0,style:S([`background-color:${(b=B.value)==null?void 0:b.color}`,{height:"100%",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase"}])},[u("h5",Be,L(W((k=B.value)==null?void 0:k.name)),1)],4)),u("div",{style:S([(I=e==null?void 0:e.message_data)!=null&&I.employer_id?"background-color: #0a3744; border-radius: .5rem 0 .5rem .5rem;":"background-color: #2f2f41; border-radius: 0 .5rem .5rem .5rem;",{padding:"1rem 1rem 2.5rem 1rem","overflow-wrap":"break-word","word-break":"break-word","max-width":"60%","min-width":"10rem",position:"relative"}])},[u("h6",je,[N((F=e==null?void 0:e.message_data)==null?void 0:F.id)?(s(),_("span",{key:1,innerHTML:O((Y=e==null?void 0:e.message_data)==null?void 0:Y.content)},null,8,Ie)):(s(),_("span",{key:0,innerHTML:O(((G=e==null?void 0:e.message_data)==null?void 0:G.content.substring(0,200))+(((K=e==null?void 0:e.message_data)==null?void 0:K.content.length)>200?"...":""))},null,8,He)),((J=e==null?void 0:e.message_data)==null?void 0:J.content.length)>200?(s(),_("button",{key:2,onClick:Xe=>{var ae;return de((ae=e==null?void 0:e.message_data)==null?void 0:ae.id)},style:{background:"none",border:"none",color:"rgb(33, 150, 243)",cursor:"pointer",padding:"0 0.5rem"}}," Ver "+L(N((q=e==null?void 0:e.message_data)==null?void 0:q.id)?"menos":"m√°s"),9,Te)):v("",!0)]),u("h6",Le,[u("span",ze,L(e.time),1),(e==null?void 0:e.message_data.current_status_id)==3&&((Q=e==null?void 0:e.message_data)!=null&&Q.employer_id)?(s(),_("i",Re)):v("",!0),(e==null?void 0:e.message_data.current_status_id)==2&&((X=e==null?void 0:e.message_data)!=null&&X.employer_id)?(s(),_("i",Ae)):v("",!0),(e==null?void 0:e.message_data.current_status_id)==1&&((Z=e==null?void 0:e.message_data)!=null&&Z.employer_id)?(s(),_("i",Ee)):v("",!0)]),(ee=e==null?void 0:e.message_data)!=null&&ee.employer_id?(s(),_("svg",Ue,Ke)):(s(),_("svg",Ve,Oe))],4),(te=e==null?void 0:e.message_data)!=null&&te.employer_id?(s(),_("div",Ye,[u("h5",Je,L(W((oe=e==null?void 0:e.message_data)==null?void 0:oe.employer_name)),1)])):v("",!0)],4)}),128))],512),y.value||f.value>0?(s(),V(a,{key:0,icon:"pi pi-angle-down",onClick:w,style:S(ue.value)},null,8,["style"])):v("",!0),f.value>0?(s(),V(a,{key:1,label:f.value,onClick:w,style:S(_e.value)},null,8,["label","style"])):v("",!0)])])}}},Qe=ye(qe,[["__scopeId","data-v-2f867794"]]),et=Object.freeze(Object.defineProperty({__proto__:null,default:Qe},Symbol.toStringTag,{value:"Module"}));export{Qe as M,et as a,Se as u};
