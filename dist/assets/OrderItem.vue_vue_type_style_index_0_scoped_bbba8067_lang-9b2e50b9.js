import{_ as ce,Y as ue,h as v,i as ee,j as D,U as $,H as te,g as k,o as d,c as p,b as a,f as u,a as e,P as S,t as n,u as l,a1 as P,q as g,e as R,k as f,d as pe,F as U,r as L,p as me,m as _e}from"./index-03a193b1.js";import{f as x}from"./formatoPesos-8aa989a0.js";const r=M=>(me("data-v-88788f88"),M=M(),_e(),M),be=r(()=>e("h3",null,[e("b",null,"Cambiar Valor del Domicilio")],-1)),ve=r(()=>e("span",null,"Valor actual del domicilio",-1)),ye=r(()=>e("span",null,"Nuevo valor del domicilio",-1)),he=r(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),ge=r(()=>e("span",{for:"responsible"},"Responsable",-1)),fe=r(()=>e("span",{for:"reason"},"Razón",-1)),we=r(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),Oe=r(()=>e("span",{class:"advert",style:{"text-transform":"lowercase",color:"red","font-weight":"bold"}}," Desde el 16 de mayo de 2024, la cancelación de órdenes requerirá autorización.",-1)),xe=r(()=>e("span",{for:"responsible"},"Responsable",-1)),ke=r(()=>e("span",{for:"reason"},"Razón",-1)),Ce={style:{"text-transform":"capitalize"}},Ve={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},De={class:""},$e={id:"factura",style:{width:"100%"}},Pe=r(()=>e("i",{class:"pi pi-whatsapp mr-2"},null,-1)),Me=r(()=>e("br",null,null,-1)),Ee={class:"",style:{width:"auto"}},ze={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},Ne={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},Te={style:{padding:"0",color:"black","text-align":"center",margin:"auto","margin-bottom":"1rem",width:"max-content","min-width":"max-content",display:"flex","justify-content":"center","flex-direction":"column"}},Ie=r(()=>e("div",{class:"",style:{"font-weight":"bold",color:"white",margin:"0","background-color":"black","align-items":"center",display:"grid","grid-template-columns":"auto auto"}},[e("div",{style:{width:"100%"}},[e("b",null," productos")]),e("div",null,[e("p",{style:{"text-align":"end","font-weight":"bold"}},[e("b",null," total ")])])],-1)),Se={style:{display:"grid","grid-template-columns":"auto auto"}},Re={class:"p-0 m-0"},Ue=r(()=>e("br",null,null,-1)),je={key:0,style:{"text-align":"end",color:"black"}},Le={key:1,style:{"text-align":"end",color:"black"}},Be={key:0,class:"p-0 m-0"},Ae=r(()=>e("b",null,"COMBO INCLUYE",-1)),Fe=[Ae],qe={class:"p-0 m-0 ml-5",style:{}},He={style:{display:"flex",width:"","justify-content":"space-between"},class:"p-0 m-0"},Ye={class:"p-0 m-0",style:{}},Ge={class:"p-0 m-0",style:{"text-align":"end"}},Ze=r(()=>e("div",{style:{"background-color":"rgba(0, 0, 0, 0.286)",height:"1px"}},null,-1)),Je={class:"",style:{display:"grid",color:"","margin-top":"0.5rem","grid-template-columns":"auto auto"}},Ke=r(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Subtotal")])],-1)),Qe={class:""},We={style:{"text-align":"end","font-weight":"bold",color:"black"}},Xe=r(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Domicilio")])],-1)),et={class:""},tt={style:{"text-align":"end","font-weight":"bold",color:"black"}},ot=r(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold",color:"black"}},[e("b",null,"Total")])],-1)),lt={class:""},st={style:{"text-align":"end",color:"black","font-weight":"bold"}},rt=r(()=>e("div",{class:""},null,-1)),nt=r(()=>e("p",{style:{"font-weight":"bold","background-color":"black",color:"white",padding:"0",margin:"0","margin-top":"0.5rem"}},[e("b",null,"Notas")],-1)),at={class:"notas",style:{border:"1px solid",margin:"0",color:"black",padding:"0.5rem"}},it=r(()=>e("p",{style:{"background-color":"black","font-weight":"bold","margin-top":"1rem",color:"white"}},[e("b",null,"cliente")],-1)),dt={style:{display:"grid","grid-template-columns":"auto auto"}},ct=r(()=>e("div",{class:"",style:{}},[e("span",null,[e("b",null,"NOMBRE")])],-1)),ut={class:""},pt={style:{"text-align":"end",color:"black"}},mt=r(()=>e("div",{class:"",style:{}},[e("span",null,[e("b",null,"Metodo de entrega")])],-1)),_t={class:""},bt={style:{"text-align":"end",color:"black"}},vt={key:0,class:"",style:{}},yt=r(()=>e("span",null,[e("b",null,"Placa del vehiculo")],-1)),ht=[yt],gt={key:1,class:""},ft={style:{"text-align":"end",color:"black"}},wt=r(()=>e("div",{style:{}},[e("span",null,[e("b",null,"telefono")])],-1)),Ot={style:{"text-align":"end",color:"black"}},xt={key:2,style:{}},kt=r(()=>e("span",null,[e("b",null,"direccion ")],-1)),Ct=[kt],Vt={key:3},Dt={style:{"text-align":"end",color:"black"}},$t=r(()=>e("div",null,[e("span",null,[e("b",null,"metodo de pago")])],-1)),Pt={style:{"text-align":"end",color:"black"}},Mt={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},Et={class:"mt-4",style:{display:"flex","align-items":"center",gap:"1rem"}},zt=r(()=>e("h3",null,[e("b",null,"Cambiar Método de Pago")],-1)),Nt=r(()=>e("span",{for:"paymentMethod"},"Método de Pago actual",-1)),Tt={for:"paymentMethod"},It=r(()=>e("span",{for:"paymentMethod"},"Nuevo método de Pago",-1)),St={__name:"DialogoPedido",setup(M){const o=ue(),C=v(!1),E=v(o.currentOrder.delivery_price),oe=async()=>{const i=E.value;await D.put(`${$}/changue-delivery/${o.currentOrder.order_id}`,{price:i}),C.value=!1,o.numberOders==1?o.numberOders=2:o.numberOders=1,o.visibles.currentOrder=!1},z=v(!1),N=v(null),B=v([]);ee(async()=>{try{const i=await D.get(`${$}/payment_methods`);B.value=i}catch(i){console.error("Error al obtener métodos de pago:",i)}o.currentOrder.value=o.currentOrder,A.value=await D.get(`${$}/sites`)});const le=async()=>{if(N.value)try{await D.put(`${$}/change-method/${o.currentOrder.order_id}/${N.value}`,`Cambiando método de pago para la orden ${o.currentOrder.order_id}`),z.value=!1,o.visibles.currentOrder=!1,console.log("Método de pago cambiado exitosamente")}catch(i){console.error("Error al cambiar el método de pago:",i)}},se=i=>{var _,y,c,h;const t=(h=(c=(y=(_=i.latest_status_timestamp)==null?void 0:_.split("T")[1])==null?void 0:y.split(":"))==null?void 0:c.slice(0,2))==null?void 0:h.join(":");switch(i.current_status){case"enviada":return`El pedido fue enviado a su domicilio a las ${t}`;case"cancelada":return`El pedido fue cancelado a las ${t}
Responsable: ${i.responsible}
Razón: ${i.reason}`;case"en preparacion":return`El pedido está en preparación desde las ${t} y será enviado en breve.`;case"generada":return`Hemos recibido su pedido a las ${t} y empezaremos a prepararlo en breve. Gracias por su espera.`;default:return""}};v(0);const T=v(!1),re=te(()=>o.currentOrder.pe_json.listaPedidos.reduce((i,t)=>{var y;let _=t.pedido_cantidad*t.pedido_precio;if(t.modificadorseleccionList&&t.modificadorseleccionList.length>0){const h=((y=t.modificadorseleccionList)==null?void 0:y.filter(w=>w.pedido_productoid==t.pedido_productoid)).reduce((w,V)=>w+V.modificadorseleccion_cantidad*V.pedido_precio,0);_+=h}return i+_},0));te(()=>re.value+o.currentOrder.delivery_price);const ne=async()=>{var t;const i={order_id:o.currentOrder.order_id,responsible:(t=m.value.responsible)==null?void 0:t.name,reason:m.value.reason};await P.create_cancellling_request(i),T.value=!1,o.Notification.pause(),o.Notification.currentTime=0},I=v(!1),ae=()=>{const i=document.getElementById("factura").innerHTML,t=window.open("","_blank");t.document.write("<html><head><title>Factura</title>");const _=document.getElementsByTagName("style");for(let y=0;y<_.length;y++)t.document.write(_[y].outerHTML);t.document.write("<style>  @media print { html{height: min-content;}  *{text-transform:uppercase;align-items:center; width:100%; font-family: sans-serif;padding:0;margin:0; font-size:o.9rem !IMPORTANT} body { padding:0; -webkit-print-color-adjust: exact; /* Chrome, Safari */ color-adjust: exact; /* Firefox */ } }  </style>"),t.document.write("</head><body>"),t.document.write(i),t.document.write("</body></html>"),t.document.close(),t.print(),setTimeout(()=>{t.close()},.01)},A=v([]);ee(async()=>{o.currentOrder.value=o.currentOrder,A.value=await D.get(`${$}/sites`)});const j=v(!1);v(!1);const m=v({responsible:null,reason:"Sin razon"}),F=v([{name:"Restaurante",value:"restaurant"},{name:"Cliente",value:"client"}]),ie=()=>{m.value.responsible&&P.cancelOrder(o.currentOrder.order_id,m.value.reason,m.value.responsible.name).then(i=>{i&&(j.value=!1,console.log("Order canceled successfully"))}).catch(i=>{console.error("Failed to cancel order:",i)})},de=()=>{console.log(`Orden: ${o.currentOrder.order_id}, Nuevo Valor de Domicilio: ${E.value}`),C.value=!1};return(i,t)=>{const _=k("Tag"),y=k("InputNumber"),c=k("Button"),h=k("Dialog"),w=k("Dropdown"),V=k("Textarea");return d(),p(U,null,[a(h,{visible:C.value,"onUpdate:visible":t[2]||(t[2]=s=>C.value=s),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:u(()=>[be]),default:u(()=>[e("form",{onSubmit:S(de,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[ve,a(_,{class:"px-4",severity:"warning"},{default:u(()=>[e("b",null,n(l(x)(l(o).currentOrder.delivery_price)),1)]),_:1}),ye,a(y,{style:{width:"100%"},modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=s=>E.value=s),mode:"currency",currency:"COP",locale:"es-CO",maxFractionalDigits:"0",placeholder:"Ingresa el nuevo valor",required:""},null,8,["modelValue"]),a(c,{style:{width:"100%","border-radius":"0.5rem"},label:"Cambiar",type:"submit",class:"p-button-help",onClick:t[1]||(t[1]=s=>oe())})],32)]),_:1},8,["visible"]),e("div",null,[a(h,{visible:j.value,"onUpdate:visible":t[5]||(t[5]=s=>j.value=s),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:u(()=>[he]),default:u(()=>[e("form",{onSubmit:S(ie,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[ge,a(w,{style:{width:"100%"},id:"responsible",modelValue:m.value.responsible,"onUpdate:modelValue":t[3]||(t[3]=s=>m.value.responsible=s),options:F.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),fe,a(V,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:m.value.reason,"onUpdate:modelValue":t[4]||(t[4]=s=>m.value.reason=s),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),a(c,{style:{width:"100%","border-radius":"0.5rem"},label:"cancelar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),a(h,{visible:T.value,"onUpdate:visible":t[8]||(t[8]=s=>T.value=s),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:u(()=>[we]),default:u(()=>[e("form",{onSubmit:S(ne,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[Oe,xe,a(w,{style:{width:"100%"},id:"responsible",modelValue:m.value.responsible,"onUpdate:modelValue":t[6]||(t[6]=s=>m.value.responsible=s),options:F.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),ke,a(V,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:m.value.reason,"onUpdate:modelValue":t[7]||(t[7]=s=>m.value.reason=s),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),a(c,{style:{width:"100%","border-radius":"0.5rem"},label:"solicitar cancelacion",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),a(h,{closable:!1,style:{width:"30rem"},modal:"",visible:I.value,"onUpdate:visible":t[11]||(t[11]=s=>I.value=s)},{footer:u(()=>[e("div",Ve,[a(c,{text:"",size:"small",onClick:t[9]||(t[9]=()=>{l(P).deliveryZero(l(o).currentOrder.order_id),I.value=!1}),style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"si"}),a(c,{onClick:t[10]||(t[10]=s=>I.value=!1),size:"small",style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"no"})])]),default:u(()=>[e("span",Ce,[g(" Esta seguro de llevar a $0.00 el valor del domicilio para la orden "),e("b",null,n(l(o).currentOrder.order_id),1),g(" del cliente "),e("b",null,n(l(o).currentOrder.user_name),1),g("? ")])]),_:1},8,["visible"]),a(h,{class:"mx-3",closeOnEscape:"",closable:!1,visible:l(o).visibles.currentOrder,"onUpdate:visible":t[18]||(t[18]=s=>l(o).visibles.currentOrder=s),modal:"",style:{"max-height":"95vh",width:"35rem",position:"relative"}},{footer:u(()=>[e("div",Mt,[l(o).currentOrder.current_status=="generada"?(d(),R(c,{key:0,size:"small",onClick:t[12]||(t[12]=s=>l(P).prepareOrder(l(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"Preparar"})):f("",!0),l(o).currentOrder.current_status=="en preparacion"?(d(),R(c,{key:1,size:"small",onClick:t[13]||(t[13]=s=>l(P).sendOrder(l(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"enviar"})):f("",!0),a(c,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:ae,severity:"warning",label:"imprimir"}),a(c,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:t[14]||(t[14]=s=>T.value=!0),severity:"danger",label:"CANCELAR "})]),e("div",Et,[a(c,{style:{width:"100%"},icon:"pi pi-sync",onClick:t[15]||(t[15]=s=>z.value=!0),label:" metodo de pago",severity:"success"}),a(c,{icon:"pi pi-sync",onClick:t[16]||(t[16]=s=>C.value=!0),label:" Domicilio",class:"p-button-warning",style:{width:"100%"}})])]),default:u(()=>{var s,q,H,Y,G,Z,J,K,Q,W;return[e("div",De,[e("div",null,[e("p",{class:pe(`estado ${(q=(s=l(o).currentOrder)==null?void 0:s.current_status)==null?void 0:q.split(" ")[0]}`)},n(se(l(o).currentOrder)),3)])]),e("div",$e,[l(o).currentOrder.responsible_id?(d(),R(_,{key:0,style:{},class:"tag mb-2",severity:"success"},{default:u(()=>[Pe,g(" TRANSFERENCIA APROBADA")]),_:1})):f("",!0),g(),Me,l(o).currentOrder.responsible_id?(d(),R(_,{key:1,class:"tag",severity:"success"},{default:u(()=>[g(n(l(o).currentOrder.name),1)]),_:1})):f("",!0),e("div",Ee,[e("p",ze," ID:"+n(l(o).currentOrder.order_id),1),e("p",Ne,n(l(o).currentOrder.user_name),1),e("p",Te,[e("b",null," fecha: "+n((H=l(o).currentOrder.latest_status_timestamp)==null?void 0:H.split("T")[0]),1),e("b",null," Hora: "+n((J=(Z=(G=(Y=l(o).currentOrder.latest_status_timestamp)==null?void 0:Y.split("T")[1])==null?void 0:G.split(":"))==null?void 0:Z.slice(0,2))==null?void 0:J.join(":")),1)]),Ie,(d(!0),p(U,null,L((W=(Q=(K=l(o))==null?void 0:K.currentOrder)==null?void 0:Q.pe_json)==null?void 0:W.listaPedidos,b=>{var X;return d(),p("div",null,[e("div",Se,[e("p",Re,[g(" ( "+n(b.pedido_cantidad)+" ) "+n(b.pedido_nombre_producto)+" ",1),Ue]),e("div",null,[b.pedido_base_price?(d(),p("p",je,n(l(x)(b.pedido_base_price*b.pedido_cantidad)),1)):(d(),p("p",Le,n(l(x)(b.pedido_precio)),1))])]),((X=b.lista_productocombo)==null?void 0:X.length)>0?(d(),p("p",Be,Fe)):f("",!0),b.lista_productocombo?(d(!0),p(U,{key:1},L(b.lista_productocombo,O=>(d(),p("p",qe,[g(" -- "),e("b",null,n(O.pedido_cantidad),1),g(" "+n(O.pedido_nombre),1)]))),256)):f("",!0),(d(!0),p(U,null,L(b.modificadorseleccionList,O=>(d(),p("div",He,[e("p",Ye,[g(" - ( "+n(b.pedido_cantidad)+" ) ",1),e("b",null,n(O.modificadorseleccion_cantidad),1),g(" "+n(O.modificadorseleccion_nombre),1)]),e("p",Ge,n(l(x)(O.pedido_precio*O.modificadorseleccion_cantidad*b.pedido_cantidad)),1)]))),256)),Ze])}),256)),e("div",Je,[Ke,e("div",Qe,[e("p",We,[e("b",null,n(l(x)(l(o).currentOrder.pe_json.delivery.delivery_pagocon-l(o).currentOrder.delivery_price)),1)])]),Xe,e("div",et,[e("p",tt,[e("b",null,n(l(x)(l(o).currentOrder.delivery_price)),1)])]),ot,e("div",lt,[e("p",st,[e("b",null,n(l(x)(l(o).currentOrder.pe_json.delivery.delivery_pagocon)),1)])]),rt]),nt,e("p",at,n(l(o).currentOrder.order_notes),1),it,e("div",dt,[ct,e("div",ut,[e("p",pt,n(l(o).currentOrder.user_name),1)]),mt,e("div",_t,[e("p",bt,n(l(o).currentOrder.order_type),1)]),l(o).currentOrder.placa?(d(),p("div",vt,ht)):f("",!0),l(o).currentOrder.placa?(d(),p("div",gt,[e("p",ft,n(l(o).currentOrder.placa),1)])):f("",!0),wt,e("div",null,[e("p",Ot,n(l(o).currentOrder.user_phone),1)]),l(o).currentOrder.order_type!="Pasar a recoger"?(d(),p("div",xt,Ct)):f("",!0),l(o).currentOrder.order_type!="Pasar a recoger"?(d(),p("div",Vt,[e("p",Dt,n(l(o).currentOrder.user_address),1)])):f("",!0),$t,e("div",null,[e("p",Pt,n(l(o).currentOrder.payment_method),1)])])])]),a(c,{class:"shadow-4",onClick:t[17]||(t[17]=b=>l(o).setVisible("currentOrder",!1)),icon:"pi pi-times",rounded:"",severity:"danger",style:{position:"absolute",top:"-1rem","border-radius":"50%",right:"-1rem"}})]}),_:1},8,["visible"])]),a(h,{visible:z.value,"onUpdate:visible":t[20]||(t[20]=s=>z.value=s),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:u(()=>[zt]),default:u(()=>[e("form",{onSubmit:S(le,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[Nt,a(_,{class:"px-4",severity:"warning"},{default:u(()=>[e("span",Tt,[e("b",null,n(l(o).currentOrder.payment_method),1)])]),_:1}),It,a(w,{style:{width:"100%"},id:"paymentMethod",modelValue:N.value,"onUpdate:modelValue":t[19]||(t[19]=s=>N.value=s),options:B.value,optionLabel:"name",optionValue:"id",placeholder:"Selecciona un método de pago",required:""},null,8,["modelValue","options"]),a(c,{style:{width:"100%","border-radius":"0.5rem"},label:"Cambiar",type:"submit",class:"p-button-help"})],32)]),_:1},8,["visible"])],64)}}},jt=ce(St,[["__scopeId","data-v-88788f88"]]);export{jt as D};
