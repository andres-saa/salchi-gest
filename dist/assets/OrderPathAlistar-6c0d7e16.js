import{_ as ve,E as he,j as p,l as ye,k as fe,r as g,o as _e,c as ge,e as s,f as c,a as n,F as we,A as xe,h as I,t as D,n as z,w as be,Z as De,q as ke,x as Ce}from"./index-58581f28.js";import{s as Se}from"./siteService-5cb43e6b.js";import"./sass.default-a5b7a582.js";import{p as w}from"./purchaseOrderService-d29e7382.js";import{u as A,a as J}from"./xlsx-4cca7150.js";import{E as Ae}from"./exceljs.min-4b158bf5.js";import{F as Y}from"./FileSaver.min-cc8488c4.js";import{f as Z}from"./format-8cf56335.js";import{e as X}from"./es-f6133d36.js";import"./_commonjsHelpers-23102255.js";const T=R=>(ke("data-v-fecc37ad"),R=R(),Ce(),R),Te={class:"grid"},je={class:"col-12 px-0 mx-0"},Ee={class:"col-12",style:{display:"flex","flex-direction":"column"}},Fe=T(()=>n("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),Pe={class:"col-12",style:{display:"flex","flex-direction":"column"}},Ue=T(()=>n("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),Me={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},Oe={class:"col-12",style:{display:"flex","justify-content":"center"}},$e={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},Ie=T(()=>n("p",null,"Desea ageregar notas?",-1)),Re={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},qe={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},Le={class:"m-0 p-0"},Ve=T(()=>n("b",null,"Solicitante:",-1)),Be={class:"m-0 p-0"},Ne=T(()=>n("b",null,"Sede:",-1)),ze={class:"mt-0 p-0"},Ge=T(()=>n("b",null,"Fecha de Expedicion:",-1)),He=["max","onUpdate:modelValue"],Qe={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},We={class:"m-auto",style:{"max-width":"1024px"}},Ke={class:"col-12 px-3 mt-4 pack-butons",style:{display:"flex","justify-content":"end",gap:"1rem"}},Je={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},Ye={class:"grid",style:{"align-items":"center"}},Ze={class:"col-12 md:col-6 p-3"},Xe={style:{"min-width":"max-content"}},et={style:{"min-width":"max-content"}},tt={class:"m-0 p-0",style:{display:"flex",width:"100%","justify-content":"center","align-items":"center",gap:"0.5rem"}},ee=1,at={__name:"OrderPathAlistar",setup(R){const k=he(),q=p(!1),j=p([]),V=p(""),h=p({}),E=p(!1),te=l=>{if(l.some(e=>!e.ajustment&&e.ajustment!==0)){alert("por favor complete todos los campos");return}E.value=!0},ae=()=>{j.value.forEach(l=>{l.ajustment=l.quantity})},L=p(!1),se=l=>{q.value=!0,h.value=l},oe=async l=>{L.value=!0,j.value=await w.getpurchaseOrderEntriesBypurchaseOrderID(l)},le={Generada:"#FF0000",Lista:"#FFA500","Entregada al transportista":"#FFFF00",Completada:"#00FF00"},G=ye(),H=p([]),Q=p([{}]),F=p(!1),C=p(new Date(new Date().setDate(new Date().getDate()-7))),x=p(new Date),P=p(new Date(new Date().setDate(new Date().getDate()-7))),U=p(new Date),S=p(),b=p(),ne=(l,e)=>{P.value=l,U.value=e},M=l=>{const e=new Date,a=new Date(e);a.setDate(a.getDate()+1);const r=new Date(e);r.setDate(e.getDate()-l),C.value=r,l==1?(x.value=e,U.value=x.value,P.value=C.value,F.value=!1):(x.value=a,P.value=C.value,U.value=x.value,F.value=!1),ie()};fe(async()=>{H.value=await Se.getSites(),Q.value=H.value,S.value=await w.getPurchaseOrderByLap_id(ee)}),(()=>{b.value={global:{value:null,matchMode:xe.CONTAINS}}})();function W(l){const e=new Date(l),a=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0");return`${a}-${r}-${i}`}const ie=async()=>{const l=Q.value.map(r=>r.site_id);G.rawUserData.id;const e=W(P.value),a=W(U.value);S.value=await w.getAllpurchaseOrderReportsFiltered(l,e,a)},O=p([]),re=async(l,e,a)=>{O.value=await w.getpurchaseOrderEntriesBypurchaseOrderID(l);const r=O.value.map(y=>({Producto:y.item_name,Cantidad:y.quantity,"Unidad de medida":y.unit_measure})),i=A.json_to_sheet(r);i["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const v=A.book_new();A.book_append_sheet(v,i,"Usuarios"),J(v,`Orden_de_compra_${e}_${a} .xlsx`)},de=l=>l.map(a=>{if(a.quantity!=a.ajustment)return{order_purchase_entry_id:a.entry_id,quantity_adjusted:a.ajustment}}).filter(a=>a),ce=async l=>{k.setLoading(!0,"Alistando orden");const e={purchase_order_id:h.value.purchase_order_id,lap_id:h.value.lap_id,responsible_id:G.rawUserData.id,ajusts:de(l),order_purchase_notes:V.value};await w.PreparePurchaserOrder(e),S.value=await w.getPurchaseOrderByLap_id(ee),q.value=!1,L.value=!1,E.value=!1,k.setLoading(!1,"Alistando orden")},ue=async()=>{k.setLoading(!0,"generando descargas");const l=S.value,e=[];for(const o of l){const u=await w.getpurchaseOrderEntriesBypurchaseOrderID(o.purchase_order_id);e.push(...u)}const a={};e.forEach(o=>{const u=o.site_name,d=o.item_name,_=o.quantity,N=o.unit_measure;a[d]||(a[d]={unit_measure:N}),a[d][u]||(a[d][u]=0),a[d][u]+=_});const r=[...new Set(e.map(o=>o.site_name))],i=[],v=Z(P.value,"dd-MMMM-yyyy",{locale:X}),y=Z(U.value,"dd-MMMM-yyyy",{locale:X});v==y?i.push([`ORDENES DE COMPRA DEL ${v.toUpperCase()}`,...Array(r.length+2).fill("")]):i.push([`ORDENES DE COMPRA DEL${v.toUpperCase()} AL ${y.toUpperCase()}`,...Array(r.length+2).fill("")]);const m=["PRODUCTO","UNIDAD DE MEDIDA",...r,"TOTAL"];i.push(m);for(const[o,u]of Object.entries(a)){const d=[o,u.unit_measure];let _=0;for(const N of r){const K=u[N]||0;d.push(K),_+=K}d.push(_),i.push(d)}const $=new Ae.Workbook,f=$.addWorksheet("Inventario por Sede");i.forEach((o,u)=>{const d=f.addRow(o);u===0?(d.height=40,d.font={name:"Arial",bold:!0,size:14},d.alignment={horizontal:"center",vertical:"middle",wrapText:!0},f.mergeCells(`A1:${f.getColumn(r.length+3).letter}1`),f.getRow(1).eachCell(_=>{_.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF00"}}})):u===1&&(d.font={name:"Arial",bold:!0})}),f.columns.forEach((o,u)=>{o.width=u===0?30:u===1?25:15,o.eachCell(d=>{d.font={name:"Arial"},d.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),f.getRow(2).eachCell(o=>{o.font={name:"Arial",bold:!0}}),f.getRow(1).eachCell(o=>{o.font={name:"Arial",bold:!0,size:16}}),f.views=[{showGridLines:!1}];const B=await $.xlsx.writeBuffer(),t=new Blob([B],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});v==y?Y.saveAs(t,`Reporte de inventario del ${v}.xlsx`):Y.saveAs(t,`Reporte de inventario del ${v} al ${y} .xlsx`),k.setLoading(!1,"generando descargas")},pe=async()=>{k.setLoading(!0,"generando descargas");const l=S.value;for(const i of l){const v=await w.getpurchaseOrderEntriesBypurchaseOrderID(i.purchase_order_id);O.value.push(...v)}console.log(O.value);const e=O.value.map(i=>({Fecha:i.date.split("T")[0],Hora:i.date.split("T")[1],Sede:i.site_name,Producto:i.item_name,Cantidad:i.quantity,"Unidad de medida":i.unit_measure})),a=A.json_to_sheet(e);a["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const r=A.book_new();A.book_append_sheet(r,a,"Usuarios"),J(r,"Compras de todas las sedes.xlsx"),k.setLoading(!1,"generando descargas")};function me(l){l.key===","&&(alert("Por favor usa punto ( . ) para los decimales, gracias"),l.preventDefault())}return(l,e)=>{const a=g("Button"),r=g("Calendar"),i=g("Dialog"),v=g("router-link"),y=g("Textarea"),m=g("Column"),$=g("DataTable"),f=g("InputText"),B=g("Tag");return _e(),ge(we,null,[s(i,{class:"mx-2",visible:F.value,"onUpdate:visible":e[8]||(e[8]=t=>F.value=t),modal:"",header:"Periodo",style:{width:"25rem"}},{default:c(()=>[n("div",Te,[n("div",je,[s(a,{text:"",label:"Hoy",onClick:e[0]||(e[0]=t=>M(0)),class:"p-button-text col-12 p-1 m-0"}),s(a,{text:"",label:"Ayer",onClick:e[1]||(e[1]=t=>M(1)),class:"p-button-text col-12 p-1 m-0"}),s(a,{text:"",label:"Últimos 7 días",onClick:e[2]||(e[2]=t=>M(7)),class:"p-button-text col-12 p-1 m-0"}),s(a,{text:"",label:"Últimos 14 días",onClick:e[3]||(e[3]=t=>M(14)),class:"p-button-text col-12 p-1"}),s(a,{text:"",label:"Últimos 28 días",onClick:e[4]||(e[4]=t=>M(28)),class:"p-button-text col-12 p-0"})]),n("div",Ee,[Fe,s(r,{style:{"min-width":"max-content"},modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=t=>C.value=t)},null,8,["modelValue"])]),n("div",Pe,[Ue,s(r,{style:{"min-width":"max-content"},modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=t=>x.value=t),showWeek:""},null,8,["modelValue"])]),n("div",Me,[n("div",Oe,[s(a,{onClick:e[7]||(e[7]=()=>{ne(C.value,x.value),F.value=!1})},{default:c(()=>[I("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),s(i,{class:"mx-2",visible:q.value,"onUpdate:visible":e[11]||(e[11]=t=>q.value=t),modal:"",header:"Interactuar con la orden",style:{width:"25rem"}},{default:c(()=>[n("div",$e,[s(v,{to:`/purchase-order/recorrido/purchase-order-view/${h.value.purchase_order_id}`},{default:c(()=>[s(a,{text:"",style:{width:"100%"},severity:"help",class:"",label:"Ver detalles",icon:"pi pi-eye"})]),_:1},8,["to"]),s(a,{text:"",label:"Descargar en excel",style:{},onClick:e[9]||(e[9]=t=>{var o;return re(h.value.purchase_order_id,h.value.site_name,(o=h.value.expedition_date)==null?void 0:o.split("T")[0])}),severity:"success",class:"",icon:"pi pi-download"}),s(a,{onClick:e[10]||(e[10]=t=>oe(h.value.purchase_order_id)),label:"Alistar esta orden",style:{},severity:"help",class:"",icon:"pi  p-0 m-0"})])]),_:1},8,["visible"]),s(i,{class:"mx-2",visible:E.value,"onUpdate:visible":e[15]||(e[15]=t=>E.value=t),modal:"",header:"Notas de alistamientos",style:{width:"25rem"}},{footer:c(()=>[n("div",Re,[s(a,{text:"",onClick:e[13]||(e[13]=t=>E.value=!1),severity:"danger",label:"cancelar"}),s(a,{onClick:e[14]||(e[14]=t=>ce(j.value.filter(o=>o.quantity!=0))),severity:"help",label:"Alistar orden"})])]),default:c(()=>[Ie,n("div",null,[s(y,{modelValue:V.value,"onUpdate:modelValue":e[12]||(e[12]=t=>V.value=t),style:{width:"100%",resize:"none",height:"10rem"}},null,8,["modelValue"])])]),_:1},8,["visible"]),s(i,{class:"px-2",visible:L.value,"onUpdate:visible":e[18]||(e[18]=t=>L.value=t),modal:"",header:"Alistar orden",style:{width:"max-content","max-width":"100vw"}},{footer:c(()=>[n("div",Qe,[s(a,{outlined:"",onClick:ae,severity:"help",label:"Igualar todo"}),s(a,{onClick:e[17]||(e[17]=t=>te(j.value.filter(o=>o.quantity!=0))),severity:"help",label:"Alistar orden"})])]),default:c(()=>[n("div",qe,[n("p",Le,[Ve,I(" "+D(h.value.employer_name),1)]),n("p",Be,[Ne,I(" "+D(h.value.site_name),1)]),n("p",ze,[Ge,I(" "+D(h.value.expedition_date.split("T")[0]),1)]),s($,{showGridlines:"",style:{"max-width":"1024px"},stripedRows:"",filters:b.value,"onUpdate:filters":e[16]||(e[16]=t=>b.value=t),class:"col-12 m-auto p-0 m-0",value:j.value.filter(t=>t.quantity!=0),tableStyle:"min-width: 50rem;"},{default:c(()=>[s(m,{class:"py-0",field:"item_id",header:"id"}),s(m,{class:"py-0",field:"item_name",header:"Item"},{body:c(t=>[n("p",{style:z(t.data.ajustment===0?"text-decoration: line-through;background-color:#ffc9d1":"")},D(t.data.item_name),5)]),_:1}),s(m,{class:"py-0 text-right",field:"quantity",header:"cant. Solicitada"}),s(m,{class:"py-0 px-0",field:"quantity",header:"cant. a enviar"},{body:c(t=>[be(n("input",{onKeydown:me,class:"text-right",max:t.data.quantity,min:0,"onUpdate:modelValue":o=>t.data.ajustment=o,style:z([{"background-color":"transparent",height:"2rem",width:"100%",border:"none"},t.data.quantity===t.data.ajustment?"background-color: aquamarine;":t.data.ajustment===0?"background-color:#ffc9d1":t.data.ajustment>t.data.quantity?"background-color:red":""]),type:"number"},null,44,He),[[De,t.data.ajustment]])]),_:1}),s(m,{class:"py-0",field:"unit_measure",header:"Und. de medida"}),s(m,{class:"py-0",field:"quantity",header:"interactuar"},{body:c(t=>[s(a,{onClick:o=>t.data.ajustment=t.data.quantity,style:{"min-width":"max-content"},text:"",class:"px-0 py-1",label:"Enviar completo"},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value"])])]),_:1},8,["visible"]),n("div",We,[n("div",Ke,[s(a,{severity:"help",icon:"pi pi-download",label:"Descargar Todo",onClick:pe}),s(a,{severity:"help",icon:"pi pi-download",label:"Descargar Informe",onClick:ue})])]),n("div",Je,[s($,{stripedRows:"",showGridlines:"",style:{"max-width":"1024px"},filters:b.value,"onUpdate:filters":e[20]||(e[20]=t=>b.value=t),class:"col-12 m-auto",value:S.value,tableStyle:"min-width: 50rem;",paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reportes"},{header:c(()=>[n("div",Ye,[n("div",Ze,[s(f,{style:{width:"100%"},class:"",modelValue:b.value.global.value,"onUpdate:modelValue":e[19]||(e[19]=t=>b.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:c(()=>[s(m,{class:"py-1",field:"purchase_order_id",header:"ID"}),s(m,{class:"py-1",field:"employer_name",header:"Solicitante"}),s(m,{class:"py-1",field:"site_name",header:"Sede"}),s(m,{class:"py-1",field:"date",header:"Fecha"},{body:c(t=>{var o;return[n("p",Xe,D((o=t.data.expedition_date)==null?void 0:o.split("T")[0]),1)]}),_:1}),s(m,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:c(t=>{var o,u,d,_;return[n("span",et,D((_=(d=(u=(o=t.data.expedition_date)==null?void 0:o.split("T")[1])==null?void 0:u.split(":"))==null?void 0:d.slice(0,2))==null?void 0:_.join(" : ")),1)]}),_:1}),s(m,{class:"py-1",field:"date",header:"Estado actual"},{body:c(t=>[s(B,{style:z([{width:"100%"},`background-color:${le[t.data.current_status]}`])},{default:c(()=>[I(D(t.data.current_status),1)]),_:2},1032,["style"])]),_:1}),s(m,{style:{"justify-content":"center"},class:"py-0 mx-0 px-0",field:"date",header:"Actuar"},{body:c(t=>[n("div",tt,[s(a,{label:"",style:{width:"min-content"},text:"",onClick:o=>se(t.data),severity:"",class:"text-center p-1",icon:"fa-solid fa-hand"},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])])],64)}}},vt=ve(at,[["__scopeId","data-v-fecc37ad"]]);export{vt as default};
