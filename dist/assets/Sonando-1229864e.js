import{_ as ue,g as r,h as de,D as ve,e as x,o as d,x as L,f as w,a as t,b as i,c as p,F as Y,r as M,d as J,u as E,U as re,t as S,n as _e,p as pe,k as me,G as ke,H as T,I as $e,J as xe,m as ce,j as Pe,w as Ce,K as A}from"./index-65618ae1.js";import{u as ye}from"./site-e12c75dc.js";const fe=m=>(pe("data-v-fb10a3e2"),m=m(),me(),m),Te={class:"dialog-content"},Ie=fe(()=>t("b",{class:"dialog-title"},null,-1)),De={class:"form-container"},Be={key:0,class:"loading-container"},Ne=fe(()=>t("p",{class:"loading-text"},"Cargando sedes...",-1)),Ee={key:1,class:"sites-grid"},Ve=["onClick"],Re=["src","alt"],qe={class:"site-info"},Ae={class:"site-name"},We={class:"button-container"},Ye={__name:"siteDialogSonando",setup(m){const y=ye(),h=r([]),f=r(!1),_=r(null),O=async()=>{f.value=!0;try{const n=await fetch(`${re}/sites`);if(n.ok){const P=await n.json();h.value=P}else console.error("Error al obtener las sedes:",n.statusText)}catch(n){console.error("Error al obtener las sedes:",n)}finally{f.value=!1}},U=n=>{_.value=n},v=()=>{_.value&&(y.sonando=_.value,y.visibles.sonandoCurrentSite=!1)};return de(()=>{O()}),ve(()=>y.visibles.currentSite,n=>{n&&(_.value=null)}),(n,P)=>{const z=x("ProgressSpinner"),I=x("Button"),c=x("Dialog");return d(),L(c,{class:"dialog-content",style:_e([{"background-color":"#000000ba !important",color:"white","max-width":"94%",padding:"0"},"width: 60rem ; border: 3px solid  red"]),visible:E(y).visibles.sonandoCurrentSite,"onUpdate:visible":P[0]||(P[0]=s=>E(y).visibles.sonandoCurrentSite=s),header:"Selección de sede",modal:!0},{footer:w(()=>[t("div",We,[i(I,{label:"Aplicar",severity:"help",onClick:v,disabled:!_.value,class:"apply-"},null,8,["disabled"])])]),default:w(()=>[t("div",Te,[Ie,t("div",De,[f.value?(d(),p("div",Be,[i(z,{class:"spinner",strokeWidth:"8",fill:"var(--white)",animationDuration:".5s","aria-label":"Cargando sedes"}),Ne])):(d(),p("div",Ee,[(d(!0),p(Y,null,M(h.value.filter(s=>s.show_on_web==!0),s=>{var C;return d(),p("div",{key:s.id,class:J(["site-card",{selected:((C=_.value)==null?void 0:C.site_id)===s.site_id}]),onClick:j=>U(s)},[t("img",{src:`${E(re)}/read-product-image/300/site-${s.site_id}`,alt:s.name,class:"site-image"},null,8,Re),t("div",qe,[t("p",Ae,S(s.site_name),1)])],10,Ve)}),128))]))])])]),_:1},8,["visible"])}}},Oe=ue(Ye,[["__scopeId","data-v-fb10a3e2"]]);const V=m=>(pe("data-v-27ad2df0"),m=m(),me(),m),Ue=["src"],ze={class:"main-container"},je={class:"salchimonster-container",style:{overflow:"hidden"}},Le={class:"text-xl",style:{margin:"0 2rem 0 1rem"}},Me=V(()=>t("i",{class:"fa-solid fa-play",style:{"margin-right":"1rem"}},null,-1)),Je={style:{"min-width":"max-content","max-width":"max-content"}},Fe={style:{display:"flex",gap:"1rem","justify-content":"center"}},Ge={class:"player-wrapper",style:{"pointer-events":"none"}},Qe={key:0,class:"current-song-info"},He={class:"text-xl"},Ke=V(()=>t("strong",null,"Solicitada por:",-1)),Xe={class:"progress-bar-container"},Ze={class:"controls-container"},et={class:"queue-container"},tt=V(()=>t("h3",null,"Cola de Reproducción",-1)),at={class:"queue-list"},ot=["src"],st={class:"song-info"},lt={class:"song-title"},nt={class:"requested-by"},it=V(()=>t("h2",{style:{color:"black"}},"Solicitar una Canción",-1)),rt={class:"queue-list"},ct=["onClick"],ut=["src"],dt={class:"song-info"},vt={style:{color:"black !important"}},_t={class:"dialog-footer"},pt=V(()=>t("h2",{style:{color:"black"}},"Proporciona tu Nombre",-1)),mt={class:"solicitar-nombre-container"},yt={style:{color:"black !important"}},ft=["src"],ht={class:"dialog-footer"},W="https://backend-musica.salchimonster.com",bt="wss://backend-musica.salchimonster.com/ws",gt={__name:"Sonando",setup(m){const y=ye(),h=r(!1),f=r(!1),_=r(!0);function O(){c&&B.isPlayerReady&&(c.pauseVideo(),_.value=!0)}function U(){c&&B.isPlayerReady&&(c.seekTo(s.value.currentTime,!0),c.playVideo(),_.value=!1)}const v=r(null),n=r("");function P(){v.value?f.value=!0:alert("Por favor, selecciona una canción primero.")}async function z(){if(!v.value||!n.value.trim()){alert("Por favor, selecciona una canción y proporciona tu nombre.");return}try{const a={type:"add_song",song_id:v.value.id,requestedBy:n.value.trim()};u&&u.readyState===WebSocket.OPEN?(u.send(JSON.stringify(a)),v.value=null,n.value="",f.value=!1,h.value=!1):alert("No estás conectado al servidor. Intenta recargar la página.")}catch(a){console.error("Error al agregar la canción a la cola:",a)}}const I=r(null);let c=null;const s=r(null),C=r([]),j=r([]),k=r(0),D=r(0),B=ke({isPlayerReady:!1,showPlayButton:!1});function F(a){const e=Math.floor(a/60),o=Math.floor(a%60);return`${e}:${o<10?"0":""}${o}`}T(()=>F(k.value)),T(()=>F(D.value));const he=T(()=>D.value>0?k.value/D.value*100:0),G=T(()=>!s.value||s.value.currentIndex===void 0?0:Math.max(s.value.currentIndex-4,0)),Q=T(()=>C.value.slice(G.value)),$=T(()=>{var a;return((a=y.sonando)==null?void 0:a.site_id)||"default"});let u=null,R=r(null);function H(){u&&(u.close(),u=null);const a=`${bt}/${$.value}`;u=new WebSocket(a),u.onopen=()=>{console.log(`Conectado al WebSocket de la sede: ${$.value}`)},u.onmessage=e=>{try{const o=JSON.parse(e.data);if(o.type==="queue_update"){C.value=o.queue,s.value=o.status,k.value=o.status.currentTime,D.value=o.status.totalDuration;const b=o.status.currentSong?o.status.currentSong.id:null;b!==R.value&&(ee(b),R.value=b),B.showPlayButton=!o.status.isPlaying}}catch(o){console.error("Error al parsear mensaje del WebSocket:",o)}},u.onerror=e=>{console.error("Error en el WebSocket:",e)},u.onclose=()=>{console.warn(`WebSocket cerrado para sede: ${$.value}. Reintentando en 3 segundos...`),setTimeout(()=>{H()},3e3)}}function be(a){if(window.YT&&window.YT.Player){a();return}window.onYouTubeIframeAPIReady=()=>{a()};const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e)}function K(a,e,o,b){return new window.YT.Player(a,{videoId:e,playerVars:{autoplay:1,controls:1,disablekb:0,fs:1,playsinline:1,iv_load_policy:3,modestbranding:1,rel:0},events:{onReady:o,onStateChange:b}})}function X(a){var e;B.isPlayerReady=!0,(e=s.value)!=null&&e.isPlaying?(a.target.playVideo(),k.value>0&&a.target.seekTo(k.value,!0)):(a.target.pauseVideo(),B.showPlayButton=!0)}function Z(a){const e=window.YT.PlayerState;switch(a.data){case e.PLAYING:break;case e.PAUSED:break;case e.ENDED:te();break}}function ee(a){window.YT&&window.YT.Player&&a&&(c?(c.loadVideoById({videoId:a,startSeconds:k.value}),s.value.isPlaying?c.playVideo():c.pauseVideo()):c=K(I.value,a,X,Z))}async function te(){try{await A.post(`${W}/next/${$.value}`)}catch(a){console.error("Error al avanzar a la siguiente canción:",a)}}async function ge(){try{const[a,e,o]=await Promise.all([A.get(`${W}/available`),A.get(`${W}/queue/${$.value}`),A.get(`${W}/current/${$.value}`)]);j.value=a.data,C.value=e.data,s.value=o.data,k.value=s.value.currentTime,D.value=s.value.totalDuration,R.value=s.value.currentSong?s.value.currentSong.id:null,ee(R.value)}catch(a){console.error("Error al cargar datos iniciales:",a)}}function Se(a){const e=Q.value.length;if(e===1)return 1;const o=.2,q=1-o;return o+a/(e-1)*q}return de(()=>{be(()=>{var e,o;const a=((o=(e=s.value)==null?void 0:e.currentSong)==null?void 0:o.id)||"";a&&(c=K(I.value,a,X,Z))}),ve($,async(a,e)=>{console.log(`Cambio de sede: ${e} -> ${a}`),await ge(),H()},{immediate:!0})}),$e(()=>{u&&u.close()}),(a,e)=>{var oe,se,le,ne,ie;const o=x("Button"),b=x("ProgressBar"),q=x("Dialog"),ae=x("InputText"),we=xe("random-hover-color");return d(),p(Y,null,[t("img",{style:{width:"120vw",position:"fixed",left:"-10%",top:"0",height:"100vh","object-fit":"cover","z-index":"-1",filter:"blur(10px)"},src:(se=(oe=s.value)==null?void 0:oe.currentSong)==null?void 0:se.thumbnail,alt:""},null,8,Ue),t("div",ze,[t("div",je,[t("h2",Le,[t("b",null,[Me,ce(" SONANDO EN "),t("span",Je,"SM "+S((ne=(le=E(y))==null?void 0:le.sonando)==null?void 0:ne.site_name),1)])]),t("div",Fe,[i(o,{size:"small",onClick:e[0]||(e[0]=l=>h.value=!0),style:{margin:"1rem 0"},label:"Pedir tema",icon:"fa-solid fa-forward"}),i(o,{size:"small",icon:"fa-solid fa-sync",onClick:e[1]||(e[1]=l=>E(y).visibles.sonandoCurrentSite=!0),style:{margin:"1rem 0"},label:"Cambiar sede"})]),t("div",Ge,[t("div",{ref_key:"playerElement",ref:I,style:{width:"100% !important","max-width":"100% !important"},id:"youtube-player"},null,512)]),(ie=s.value)!=null&&ie.currentSong?(d(),p("div",Qe,[t("h2",He,S(s.value.currentSong.title),1),t("p",null,[Ke,ce(" "+S(s.value.currentSong.requestedBy),1)])])):Pe("",!0),t("div",Xe,[i(b,{value:he.value,"show-value":!1,style:{width:"100%"}},null,8,["value"])]),t("div",Ze,[i(o,{disabled:"",rounded:"",icon:"fa-solid fa-backward",class:"previous-button"}),_.value?(d(),L(o,{key:1,rounded:"",icon:"fa-solid fa-play",onClick:U,label:"Reanudar"})):(d(),L(o,{key:0,rounded:"",icon:"fa-solid fa-pause",onClick:O,label:"Pausa"})),i(o,{disabled:"",rounded:"",icon:"fa-solid fa-forward",onClick:te,class:"next-button"})]),t("div",et,[tt,t("ul",at,[(d(!0),p(Y,null,M(Q.value,(l,g)=>{var N;return d(),p("li",{key:`${l.id}-${g}`,class:J({"current-song":G.value+g===((N=s.value)==null?void 0:N.currentIndex)}),style:_e({opacity:Se(g),transition:"opacity 0.5s ease"})},[t("img",{src:l.thumbnail,alt:"Thumbnail",class:"thumbnail"},null,8,ot),t("div",st,[t("span",lt,S(l.title),1),t("span",nt,"Solicitada por: "+S(l.requestedBy),1)])],6)}),128))])])])]),i(q,{visible:h.value,"onUpdate:visible":e[3]||(e[3]=l=>h.value=l),modal:"",style:{"max-width":"94%",width:"40rem",border:"none"}},{header:w(()=>[it]),footer:w(()=>[t("div",_t,[i(o,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:e[2]||(e[2]=l=>h.value=!1)}),i(o,{label:"Solicitar",severity:"help",icon:"pi pi-check",disabled:!v.value,onClick:P,class:"p-button"},null,8,["disabled"])])]),default:w(()=>[t("ul",rt,[(d(!0),p(Y,null,M(j.value,(l,g)=>Ce((d(),p("li",{class:J(["song",{"selected-song":v.value===l}]),style:{transition:"all none"},key:`${l.id}-${g}`,onClick:N=>v.value=l},[t("img",{src:l.thumbnail,alt:"Thumbnail",class:"thumbnail"},null,8,ut),t("div",dt,[t("span",vt,S(l.title),1)])],10,ct)),[[we,{opacity:.239}]])),128))])]),_:1},8,["visible"]),i(q,{visible:f.value,"onUpdate:visible":e[6]||(e[6]=l=>f.value=l),modal:"",style:{"max-width":"94%",width:"30rem"}},{header:w(()=>[pt]),footer:w(()=>[t("div",ht,[i(o,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:e[5]||(e[5]=l=>f.value=!1)}),i(o,{label:"Solicitar",icon:"pi pi-check",severity:"help",disabled:!n.value.trim(),onClick:z},null,8,["disabled"])])]),default:w(()=>{var l,g;return[t("div",mt,[t("h3",yt,S((l=v.value)==null?void 0:l.title),1),t("img",{src:(g=v.value)==null?void 0:g.thumbnail,alt:"Thumbnail",class:"thumbnail-large"},null,8,ft),i(ae,{style:{width:"100%",color:"black"},modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=N=>n.value=N),placeholder:"Tu nombre",class:"input-text"},null,8,["modelValue"])])]}),_:1},8,["visible"]),i(Oe)],64)}}},kt=ue(gt,[["__scopeId","data-v-27ad2df0"]]);export{kt as default};
