import{_ as W,r as p,l as X,N as Y,C as Z,k as ee,E as te,i as ae,a5 as c,m as se,a as m,o as P,c as oe,d as a,w as r,b as s,a2 as A,q as ne,t as w,u as R,f as $,y as L,p as le,g as ie}from"./index-e2d818a4.js";import"./index-558f534d.js";import"./_commonjsHelpers-23102255.js";const k=h=>(le("data-v-a483d4f1"),h=h(),ie(),h),re={class:"container"},de=k(()=>s("h3",null,[s("b",null,"Rechazar esta solicitud")],-1)),ce=k(()=>s("h3",null,[s("b",null,"Aprobar esta solicitud")],-1)),ue={class:"grid",style:{"align-items":"center","justify-content":"space-between"}},pe={class:"col-12 md:col-6 p-3"},me={class:"text-xl",style:{width:"100%"}},ve={style:{"text-transform":"capitalize"}},_e={class:"md:mt-0 p-input-icon-right m-3"},he=k(()=>s("i",{class:"pi pi-search"},null,-1)),ye={style:{"min-width":"max-content"}},be={style:{"min-width":"max-content"}},fe={style:{"min-width":"max-content"}},ge={style:{display:"flex",gap:"0.5rem"}},we={__name:"cancellationOrderRequestSesion",setup(h){const y=p(!1),v=p([]),b=p(!1),T=X(),l=p({}),O=new Audio("/sound/pip1.wav"),B=new Audio("/sound/pip2.wav"),U=new Audio("/sound/pip3.wav"),M=Y(),F=p(null),x={revisar:c.getPendientsCancellationRequest,aprobadas:c.getaceptedCancellationAcepted,rechazadas:c.getPendientsCancellationRejected},E={revisar:c.getPendientsCancellationRequestNoLoading,aprobadas:c.getaceptedCancellationAceptedNoLoading,rechazadas:c.getPendientsCancellationRejectedNoLoading};Z(()=>{D()});const N=(o,t)=>{l.value.id=t,o?b.value=!0:y.value=!0},V=async(o,t,u)=>{const i={authorized:o,responsible_id:T.rawUserData.id,responsible_observation:l.value.reason||"sin observaciones"};await c.resolveCancellationRequest(t,i),b.value=!1,y.value=!1,v.value=await x[d.params.request_status]()},z=o=>{const t=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],u=o.split("T"),i=u[0].split("-"),f=i[2],C=parseInt(i[1],10)-1,n=i[0],q=t[C],e=u[1].split(":"),g=parseInt(e[0],10),J=e[1],Q=g>=12,S=g%12||12,G=S<10?`0${S}`:`${S}`,K=Q?"PM":"AM";return{date:`${f}-${q}-${n}`,time:`${G}:${J} ${K}`}},d=ee(),_=p(),D=()=>{_.value={global:{value:null,matchMode:te.CONTAINS}}};D(),ae(async()=>{j(),F.value=setInterval(async()=>{const o=await c.is_recent_order_generated();if(o&&M.numberCancellationRequests!=o){const t=Math.floor(Math.random()*I.length);I[t].play(),M.numberCancellationRequests=o,H()}},1e4)});const j=async()=>{v.value=await x[d.params.request_status]()},I=[O,B,U],H=async()=>{const o=d.params.request_status||"revisar";v.value=await E[o]()};return se(()=>d.params.request_status,async()=>{v.value=await x[d.params.request_status]()},{deep:!0}),(o,t)=>{const u=m("Textarea"),i=m("Button"),f=m("Dialog"),C=m("InputText"),n=m("Column"),q=m("DataTable");return P(),oe("div",re,[a(f,{visible:y.value,"onUpdate:visible":t[2]||(t[2]=e=>y.value=e),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:r(()=>[de]),default:r(()=>[s("form",{onSubmit:t[1]||(t[1]=A(e=>V(!1,l.value.id,l.value.reason),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[a(u,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:l.value.reason,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.reason=e),rows:"5",placeholder:"Porque desea rechazar esta solicitud?"},null,8,["modelValue"]),a(i,{style:{width:"100%","border-radius":"0.5rem"},label:"Rechazar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),a(f,{visible:b.value,"onUpdate:visible":t[5]||(t[5]=e=>b.value=e),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:r(()=>[ce]),default:r(()=>[s("form",{onSubmit:t[4]||(t[4]=A(e=>V(!0,l.value.id,l.value.reason),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[a(u,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:l.value.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.reason=e),rows:"5",placeholder:"Notas para el solicitante"},null,8,["modelValue"]),a(i,{style:{width:"100%","border-radius":"0.5rem"},label:"Aprobar",type:"submit",class:"p-button-success"})],32)]),_:1},8,["visible"]),a(q,{paginator:!0,rows:15,filters:_.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} solicitudes",rowsPerPageOptions:[5,10,25,100],scrollable:"",scrollHeight:"65vh",stripedRows:"",style:{},"onUpdate:filters":t[7]||(t[7]=e=>_.value=e),class:"col-12 m-auto",value:v.value,tableStyle:"min-width: 50rem;"},{header:r(()=>[s("div",ue,[s("div",pe,[s("span",me,[ne(" Solicitudes de cancelacion - "),s("span",ve,w(R(d).params.request_status.split("-").join(" ")),1)])]),s("span",_e,[he,a(C,{class:"",modelValue:_.value.global.value,"onUpdate:modelValue":t[6]||(t[6]=e=>_.value.global.value=e),placeholder:"Buscar Solicitud..."},null,8,["modelValue"])])])]),default:r(()=>[a(n,{style:{},class:"py-1 pl-0",field:"order_id",header:"ID orden",frozen:""},{body:r(e=>[s("p",ye,w(e.data.order_id),1)]),_:1}),a(n,{class:"py-1",field:"site_name",header:"Sede"}),a(n,{class:"py-1",field:"site_name",header:"Fecha"},{body:r(e=>[s("p",be,w(z(e.data.timestamp).date),1)]),_:1}),a(n,{class:"py-1",field:"site_name",header:"Hora"},{body:r(e=>[s("p",fe,w(z(e.data.timestamp).time),1)]),_:1}),a(n,{style:{"min-width":"30rem"},class:"py-1",field:"reason",header:"Motivo"}),a(n,{style:{"min-width":"10rem"},class:"py-1",field:"responsible",header:"Quien solicita?"}),a(n,{style:{"min-width":"20em"},class:"py-1",field:"user_name",header:"Nombre del cliente"}),a(n,{style:{"min-width":"10rem"},class:"py-1",field:"user_phone",header:"Cel. cliente"}),a(n,{style:{},class:"py-1 px-0",field:"date",header:"Action",frozen:"",alignFrozen:"right"},{body:r(e=>[s("div",ge,[R(d).params.request_status!="aprobadas"?(P(),$(i,{key:0,size:"",onClick:g=>N(!0,e.data.id),style:{height:"1.8rem",width:"2rem"},severity:"success",class:"p-1",icon:"pi pi-check"},null,8,["onClick"])):L("",!0),R(d).params.request_status!="rechazadas"?(P(),$(i,{key:1,onClick:g=>N(!1,e.data.id),style:{height:"1.8rem",width:"2rem",background:"var(--primary-color)",border:"none"},severity:"danger",class:"p-1",icon:"pi pi-times"},null,8,["onClick"])):L("",!0)])]),_:1})]),_:1},8,["filters","value"])])}}},Se=W(we,[["__scopeId","data-v-a483d4f1"]]);export{Se as default};
