import{_ as Ee,l as Ve,h as n,G as B,Z as Te,i as Ue,j as N,U as Ce,D as F,o as v,c as b,f as s,e as c,u as t,a as l,F as P,$ as x,q as T,t as f,r as H,d as ke,n as Se,a0 as ae,a1 as E,a2 as te,a3 as C,a4 as R,k as M,a5 as se,a6 as Ie,a7 as $e,p as Le,m as Ne,J as Y}from"./index-6bbd0804.js";import{u as Pe}from"./chat-0bd17500.js";const u=k=>(Le("data-v-a20df188"),k=k(),Ne(),k),Re={style:{height:"100%"}},Ae={style:{display:"grid","grid-template-columns":"repeat(2, 1fr)","max-width":"max-content",gap:".5rem","align-items":"center"}},De=u(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Id plantilla :")],-1)),Oe={class:"m-0 p-0"},je=u(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Nombre plantilla :")],-1)),Be={class:"m-0 p-0"},Fe=u(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Estado :")],-1)),He={class:"m-0 p-0"},Me=u(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Categoria :")],-1)),Ye={class:"m-0 p-0"},Ge=u(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Mensaje :")],-1)),Ke={class:"m-0",style:{"background-color":"#0a3744",padding:"1rem","border-radius":".5rem",color:"white"}},ze=u(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Foto :")],-1)),qe=["src"],Je=u(()=>l("h5",null,[l("strong",null,"Usuarios")],-1)),Qe={class:"statuses",style:{display:"flex",gap:"1rem"}},We={style:{width:"100%",height:"50vh","margin-top":"1rem"}},Ze={class:"p-4 templates-container",style:{margin:"auto","background-color":"white","border-radius":"1rem",transition:"all .3s ease","max-height":"90vh"}},Xe={style:{height:"100%"}},el={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",style:{"align-items":"center"}},ll=u(()=>l("h2",{class:"text-2xl font-bold whitespace-nowrap m-0 p-0",style:{"min-width":"max-content"}},"Plantillas de WhatsApp",-1)),al={class:"p-input-icon-left w-full md:w-80 my-3",style:{height:"100%"}},tl=u(()=>l("i",{class:"pi pi-search"},null,-1)),sl={key:0,style:{display:"flex","justify-content":"center"}},ol=["src"],nl={class:"flex gap-2"},il={class:"space-y-4"},rl={class:"md:grid-cols-2 gap-3"},dl={class:"field"},ul={key:0,style:{position:"relative",width:"300px","margin-top":".5rem"}},cl=["src"],ml={style:{display:"flex","justify-content":"center"}},pl=["src"],vl={class:"field"},fl=u(()=>l("label",{class:"font-medium"},"Nombre",-1)),hl={class:"field"},gl=u(()=>l("label",{class:"font-medium"},"Categoría",-1)),yl={class:"field"},_l=u(()=>l("label",{class:"font-medium"},"Idioma",-1)),bl={class:"font-medium"},wl={class:"opacity-70"},xl={key:0,class:"",style:{display:"flex","flex-direction":"column",gap:"1rem","justify-content":"center"}},El=u(()=>l("h5",{class:"font-medium m-0 p-0 py-3"},"Ejemplos de variables",-1)),Vl={class:"space-y-2"},Tl=u(()=>l("div",{class:"flex items-center my-4",style:{"align-items":"center",gap:"1rem"}},[l("h5",{class:"m-0"},"Botones")],-1)),Ul={style:{display:"flex","flex-direction":"column",gap:"1rem","max-width":"100%",overflow:"hidden"}},Cl={__name:"templates",setup(k){const oe=Ve(),S=Pe();function ne(){z.value=null,q.value=""}n(""),n(!1),n(S.templates);const h=n({}),G=n(!1),I=n(""),$=n(!1);n(!1);const ie=n(null),K=n([]),V=n({name:"",category:"UTILITY",language:"es_ES"}),L=n(""),A=n([]),g=n({}),re=n(null),y=n({}),D=n([{}]);n({label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-triangle-exclamation"});const z=n(null),q=n(""),m=n([]),de=n([{label:"SIN DATOS",bg:"#7f8c8d",icon:"fa-circle-question"},{label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-triangle-exclamation"},{label:"CASUAL",bg:"#e67e22",icon:"fa-person-walking"},{label:"FRECUENTE",bg:"#27ae60",icon:"fa-repeat"},{label:"TOP",bg:"#2980b9",icon:"fa-ranking-star"},{label:"ESTRELLA",bg:"#8e44ad",icon:"fa-star"}]);function ue(o){const a=o.label;if(a==="TODO"){m.value=[];return}const e=m.value.indexOf("TODO");e>-1&&m.value.splice(e,1);const i=m.value.indexOf(a);i===-1?m.value.push(a):m.value.splice(i,1)}const J=B(()=>m.value.length===0?D.value:D.value.filter(o=>m.value.includes(o.clasification)));Te();const U=n(!1),ce=[{label:"AUTHENTICATION",value:"AUTHENTICATION"},{label:"MARKETING",value:"MARKETING"},{label:"UTILITY",value:"UTILITY"}],me=[{label:"Español (CO)",value:"es_CO"},{label:"Español (ES)",value:"es_ES"},{label:"English (US)",value:"en_US"}],pe=[{label:"URL",value:"URL"},{label:"QUICK_REPLY",value:"QUICK_REPLY"}],ve=B(()=>{if(!I.value)return S.templates;const o=I.value.toLowerCase();return S.templates.filter(a=>`${a.name} ${a.category}`.toLowerCase().includes(o))});Ue(async()=>{const o=await N.get(`${Ce}/restaurants`);K.value=o,y.value=o.find(a=>a.id==1),y.value});const fe=o=>{h.value=o,U.value=!0};F(U,()=>{m.value=[]});const O=n([]);F(L,o=>{const a=Array.from(new Set((o.match(/{{\s*([^{}\s]+)\s*}}/g)||[]).map(e=>e.replace(/{{|}}/g,"").trim())));O.value=a,g.value=Object.fromEntries(Object.entries(g.value).filter(([e])=>a.includes(e))),a.forEach(e=>{e in g.value||(g.value[e]="")})});async function he(){G.value=!0;try{S.templates=await N.get(`${Y}/wabas/${y.value.waba_id}/templates/`)}finally{G.value=!1}}const ge=async()=>{D.value=await N.get(`${Y}/wabas/${y.value.waba_id}/templates/users/${y.value.id}`)};F(y,async o=>{o&&(he(),m.value=[],await ge())},{deep:!0});function ye(o){return{APPROVED:"success",PENDING:"warning",REJECTED:"danger"}[o]||"info"}const Q=n({}),_e=B(()=>re.value?"Editar plantilla":"Nueva plantilla");function be(o){var d,w;ie.value=o.id,V.value={name:o.name,category:o.category,language:o.language};const a=o.components.find(r=>r.type==="BODY")||{text:""};L.value=a.text,g.value={},(d=a.example)!=null&&d.body_text_named_params?a.example.body_text_named_params.forEach(({param_name:r,example:p})=>{g.value[r]=p}):(w=a.example)!=null&&w.body_text&&a.example.body_text[0].forEach((r,p)=>{g.value[String(p+1)]=r});const e=o.components.find(r=>r.type==="BUTTONS")||{buttons:[]};A.value=e.buttons.map(r=>({type:r.type,text:r.text,url:r.url||""}));const i=o.components.find(r=>r.type==="HEADER")||{type:"HEADER",format:"IMAGE",example:{header_handle:[]}};Q.value=i==null?void 0:i.example.header_handle[0],$.value=!0}const j=n(!1);async function we(){if(!h.value)return;const o=J.value.map(e=>e.wa_id).filter(e=>!!e&&e.trim().length>0);if(!o.length){console.warn("No hay destinatarios válidos para la difusión");return}const a={messaging_product:"whatsapp",employer_id:oe.rawUserData.id.toString(),restaurant_id:`${y.value.id}`,template:h.value,recipients:o};j.value=!0;try{await N.post(`${Y}/webhook/send/template/bulk/`,a,!1),console.log(`✅ Difusión iniciada para ${o.length} usuarios`),U.value=!1}catch(e){console.error("✗ Error en difusión masiva:",e)}finally{j.value=!1}}return(o,a)=>(v(),b(P,null,[s(t(te),{visible:U.value,"onUpdate:visible":a[1]||(a[1]=e=>U.value=e),modal:"",header:"Difundir Plantilla",style:{width:"100vw","max-width":"80rem","background-color":"white"}},{footer:c(()=>[s(t(x),{label:"Cancelar",text:"",severity:"secondary",onClick:a[0]||(a[0]=e=>U.value=!1)}),s(t(x),{label:"Enviar a todos",severity:"help",icon:"pi pi-broadcast",loading:j.value,onClick:we,autofocus:""},null,8,["loading"])]),default:c(()=>{var e,i,d,w,r,p,W,Z,X,ee,le;return[l("div",Re,[l("div",Ae,[De,T(),l("h6",Oe,f((e=h.value)==null?void 0:e.id),1),je,T(),l("h6",Be,f((i=h.value)==null?void 0:i.name),1),Fe,T(),l("h6",He,f((d=h.value)==null?void 0:d.status),1),Me,T(),l("h6",Ye,f((w=h.value)==null?void 0:w.category),1),Ge,l("h6",Ke,f((W=(p=(r=h.value)==null?void 0:r.components)==null?void 0:p.find(_=>_.type=="BODY"))==null?void 0:W.text),1),ze,l("img",{style:{height:"10rem",width:"10rem","aspect-ratio":"1 / 1","object-fit":"cover","border-radius":".5rem",border:"1px solid"},src:(le=(ee=(X=(Z=h.value)==null?void 0:Z.components)==null?void 0:X.find(_=>_.type=="HEADER"))==null?void 0:ee.example)==null?void 0:le.header_handle[0],alt:""},null,8,qe)]),Je,l("div",Qe,[(v(!0),b(P,null,H(de.value,(_,xe)=>(v(),ke(t(x),{key:xe,style:Se([{height:"2.3rem","border-radius":".3rem",padding:".5rem"},m.value.includes(_.label)?{backgroundColor:_.bg,color:"#fff"}:{backgroundColor:"#ffffff20",color:_.bg}]),text:"",onClick:kl=>ue(_),class:"status",label:_.label},null,8,["onClick","label","style"]))),128))]),l("div",We,[s(t(ae),{rows:10,paginator:"",stripedRows:"",showGridlines:"",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,15,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} clientes",responsiveLayout:"scroll",scrollable:"",value:J.value,header:"clientes"},{default:c(()=>[s(t(E),{class:"py-1",header:"Nombre",field:"nombre"}),s(t(E),{class:"py-1",header:"Número",field:"wa_id"}),s(t(E),{class:"py-1",header:"Clasificación",field:"clasification"})]),_:1},8,["value"])])])]}),_:1},8,["visible"]),l("div",Ze,[l("div",Xe,[l("div",el,[ll,l("span",al,[tl,s(t(C),{modelValue:I.value,"onUpdate:modelValue":a[2]||(a[2]=e=>I.value=e),modelModifiers:{trim:!0},placeholder:"Buscar…",class:"w-full"},null,8,["modelValue"])]),s(t(R),{modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=e=>y.value=e),options:K.value.filter(e=>e.exist),optionLabel:"name",placeholder:"Selecciona un restaurante",class:"w-full md:w-80 my-3"},null,8,["modelValue","options"])]),s(t(ae),{style:{"max-width":"80rem",width:"100%",overflow:"auto"},value:ve.value,dataKey:"id",scrollable:"","scroll-height":"65vh",paginator:"",rows:10,responsiveLayout:"scroll",globalFilterFields:["name","category"],class:"shadow-md rounded-xl overflow-hidden"},{default:c(()=>[s(t(E),{class:"my-1 py-1",field:"name",header:"Nombre",bodyClass:"font-medium"}),s(t(E),{class:"my-1 py-1",header:"Texto"},{body:c(({data:e})=>{var i;return[l("span",null,f((i=e==null?void 0:e.components.find(d=>d.type=="BODY"))==null?void 0:i.text),1)]}),_:1}),s(t(E),{class:"my-1 py-1",header:"Texto"},{body:c(({data:e})=>{var i,d,w,r;return[(d=(i=e==null?void 0:e.components.find(p=>p.type=="HEADER"))==null?void 0:i.example)!=null&&d.header_handle[0]?(v(),b("div",sl,[l("img",{style:{height:"10rem",width:"10rem","aspect-ratio":"1 / 1","object-fit":"cover","border-radius":".5rem",border:"1px solid"},src:(r=(w=e==null?void 0:e.components.find(p=>p.type=="HEADER"))==null?void 0:w.example)==null?void 0:r.header_handle[0]},null,8,ol)])):M("",!0)]}),_:1}),s(t(E),{class:"my-1 py-1",header:"Estado"},{body:c(({data:e})=>[s(t(se),{severity:ye(e.status)},{default:c(()=>[T(f(e.status),1)]),_:2},1032,["severity"])]),_:1}),s(t(E),{class:"my-1 py-1",headerStyle:"width:8rem",header:"Acciones"},{body:c(({data:e})=>[l("div",nl,[s(t(x),{icon:"pi pi-eye",severity:"warning",onClick:i=>be(e)},null,8,["onClick"]),s(t(x),{icon:"pi pi-sync",label:"Difundir",severity:"help",onClick:i=>fe(e)},null,8,["onClick"])])]),_:1})]),_:1},8,["value"]),s(t(te),{visible:$.value,"onUpdate:visible":a[9]||(a[9]=e=>$.value=e),header:_e.value,modal:"",class:"",style:{width:"90vw","max-width":"20rem","min-width":"40rem"}},{footer:c(()=>[s(t(x),{label:"cerrar",text:"",severity:"secondary",onClick:a[8]||(a[8]=e=>$.value=!1)})]),default:c(()=>[l("div",il,[l("div",rl,[l("div",dl,[z.value?(v(),b("div",ul,[l("img",{src:q.value,style:{width:"100%",height:"100%","object-fit":"cover","border-radius":".5rem"}},null,8,cl),s(t(x),{icon:"pi pi-times",severity:"danger",size:"small",style:{position:"absolute",top:".1rem",right:".1rem"},onClick:ne})])):M("",!0)]),l("div",ml,[l("img",{src:Q.value,style:{"max-width":"20rem",margin:"","aspect-ratio":"1 / 1","object-fit":"contain"},alt:""},null,8,pl)]),l("div",vl,[fl,s(t(C),{modelValue:V.value.name,"onUpdate:modelValue":a[4]||(a[4]=e=>V.value.name=e),class:"w-full"},null,8,["modelValue"])]),l("div",hl,[gl,s(t(R),{modelValue:V.value.category,"onUpdate:modelValue":a[5]||(a[5]=e=>V.value.category=e),options:ce,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),l("div",yl,[_l,s(t(R),{modelValue:V.value.language,"onUpdate:modelValue":a[6]||(a[6]=e=>V.value.language=e),options:me,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),l("div",null,[l("h6",bl,[T("Cuerpo del mensaje "),l("small",wl,"(usa "+f(o.param)+" o "+f(1)+")",1)]),s(t(Ie),{"auto-resize":"",modelValue:L.value,"onUpdate:modelValue":a[7]||(a[7]=e=>L.value=e),rows:"6",class:"w-full"},null,8,["modelValue"])]),O.value.length?(v(),b("div",xl,[El,(v(!0),b(P,null,H(O.value,e=>(v(),b("div",{key:e,style:{"align-items":"center",display:"flex",gap:"1rem"},class:""},[s(t(se),{severity:"info",style:{padding:"0 1rem",height:"2.8rem","min-width":"2.8rem"},class:"min-w-[5rem] text-center text-xl"},{default:c(()=>[T(f(e),1)]),_:2},1024),s(t(C),{modelValue:g.value[e],"onUpdate:modelValue":i=>g.value[e]=i,placeholder:`Ejemplo para ${e}`,class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])):M("",!0),l("div",Vl,[Tl,l("div",Ul,[(v(!0),b(P,null,H(A.value,(e,i)=>(v(),b("div",{key:i,class:"",style:{display:"grid","grid-template-columns":"10rem  1fr 1fr 3rem",gap:".5rem"}},[s(t(R),{modelValue:e.type,"onUpdate:modelValue":d=>e.type=d,options:pe,optionLabel:"label",optionValue:"value"},null,8,["modelValue","onUpdate:modelValue"]),s(t(C),{modelValue:e.text,"onUpdate:modelValue":d=>e.text=d,placeholder:"Texto"},null,8,["modelValue","onUpdate:modelValue"]),s(t(C),{modelValue:e.url,"onUpdate:modelValue":d=>e.url=d,placeholder:"URL"},null,8,["modelValue","onUpdate:modelValue"]),s(t(x),{icon:"pi pi-times",severity:"danger",onClick:d=>A.value.splice(i,1)},null,8,["onClick"])]))),128))])])])]),_:1},8,["visible","header"]),s(t($e))])])],64))}},$l=Ee(Cl,[["__scopeId","data-v-a20df188"]]);export{$l as default};
