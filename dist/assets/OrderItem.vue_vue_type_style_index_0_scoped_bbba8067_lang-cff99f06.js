import{_ as re,g as v,h as Q,i as D,U as P,Z as ne,H as W,e as k,o as c,c as g,a as e,b as i,f as m,P as I,u as s,a2 as C,m as y,t as r,x as T,j as O,d as ae,F as R,r as N,p as ie,k as de}from"./index-d24c4870.js";import{f as x}from"./formatoPesos-8aa989a0.js";const n=V=>(ie("data-v-f5c7c79d"),V=V(),de(),V),ce=n(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),ue=n(()=>e("span",{for:"responsible"},"Responsable",-1)),pe=n(()=>e("span",{for:"reason"},"Razón",-1)),me=n(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),_e=n(()=>e("span",{class:"advert",style:{"text-transform":"lowercase",color:"red","font-weight":"bold"}}," Desde el 16 de mayo de 2024, la cancelación de órdenes requerirá autorización.",-1)),be=n(()=>e("span",{for:"responsible"},"Responsable",-1)),ve=n(()=>e("span",{for:"reason"},"Razón",-1)),ye={style:{"text-transform":"capitalize"}},he={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},ge={class:""},fe={id:"factura",style:{width:"100%"}},we=n(()=>e("i",{class:"pi pi-whatsapp mr-2"},null,-1)),Oe=n(()=>e("br",null,null,-1)),xe={class:"",style:{width:"auto"}},ke={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},Ce={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},Ve={style:{padding:"0",color:"black","text-align":"center",margin:"auto","margin-bottom":"1rem",width:"max-content","min-width":"max-content",display:"flex","justify-content":"center","flex-direction":"column"}},Me=n(()=>e("div",{class:"",style:{"font-weight":"bold",color:"white",margin:"0","background-color":"black","align-items":"center",display:"grid","grid-template-columns":"auto auto"}},[e("div",{style:{width:"100%"}},[e("b",null," productos")]),e("div",null,[e("p",{style:{"text-align":"end","font-weight":"bold"}},[e("b",null," total ")])])],-1)),$e={style:{display:"grid","grid-template-columns":"auto auto"}},Ee={class:"p-0 m-0"},ze=n(()=>e("br",null,null,-1)),De={key:0,style:{"text-align":"end",color:"black"}},Pe={key:1,style:{"text-align":"end",color:"black"}},Te={key:0,class:"p-0 m-0"},Re=n(()=>e("b",null,"COMBO INCLUYE",-1)),Se=[Re],Ie={class:"p-0 m-0 ml-5",style:{}},Ne={style:{display:"flex",width:"","justify-content":"space-between"},class:"p-0 m-0"},je={class:"p-0 m-0",style:{}},Ue={class:"p-0 m-0",style:{"text-align":"end"}},Le=n(()=>e("div",{style:{"background-color":"rgba(0, 0, 0, 0.286)",height:"1px"}},null,-1)),Be={class:"",style:{display:"grid",color:"","margin-top":"0.5rem","grid-template-columns":"auto auto"}},Ae=n(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Subtotal")])],-1)),Fe={class:""},He={style:{"text-align":"end","font-weight":"bold",color:"black"}},qe=n(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Domicilio")])],-1)),Ze={class:""},Ge={style:{"text-align":"end","font-weight":"bold",color:"black"}},Ye=n(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold",color:"black"}},[e("b",null,"Total")])],-1)),Je={class:""},Ke={style:{"text-align":"end",color:"black","font-weight":"bold"}},Qe=n(()=>e("div",{class:""},null,-1)),We=n(()=>e("p",{style:{"font-weight":"bold","background-color":"black",color:"white",padding:"0",margin:"0","margin-top":"0.5rem"}},[e("b",null,"Notas")],-1)),Xe={class:"notas",style:{border:"1px solid",margin:"0",color:"black",padding:"0.5rem"}},et=n(()=>e("p",{style:{"background-color":"black","font-weight":"bold","margin-top":"1rem",color:"white"}},[e("b",null,"cliente")],-1)),tt={style:{display:"grid","grid-template-columns":"auto auto"}},ot=n(()=>e("div",{class:"",style:{}},[e("span",null,[e("b",null,"NOMBRE")])],-1)),st={class:""},lt={style:{"text-align":"end",color:"black"}},rt=n(()=>e("div",{style:{}},[e("span",null,[e("b",null,"telefono")])],-1)),nt={style:{"text-align":"end",color:"black"}},at=n(()=>e("div",{style:{}},[e("span",null,[e("b",null,"direccion ")])],-1)),it={style:{"text-align":"end",color:"black"}},dt=n(()=>e("div",null,[e("span",null,[e("b",null,"metodo de pago")])],-1)),ct={style:{"text-align":"end",color:"black"}},ut={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},pt={class:"mt-3"},mt=n(()=>e("h3",null,[e("b",null,"Cambiar Método de Pago")],-1)),_t=n(()=>e("span",{for:"paymentMethod"},"Método de Pago actual",-1)),bt={for:"paymentMethod"},vt=n(()=>e("span",{for:"paymentMethod"},"Nuevo método de Pago",-1)),yt={__name:"DialogoPedido",setup(V){const M=v(!1),$=v(null),j=v([]);Q(async()=>{try{const a=await D.get(`${P}/payment_methods`);j.value=a}catch(a){console.error("Error al obtener métodos de pago:",a)}o.currentOrder.value=o.currentOrder,U.value=await D.get(`${P}/sites`)});const X=async()=>{if($.value)try{await D.put(`${P}/change-method/${o.currentOrder.order_id}/${$.value}`,`Cambiando método de pago para la orden ${o.currentOrder.order_id}`),M.value=!1,o.visibles.currentOrder=!1,console.log("Método de pago cambiado exitosamente")}catch(a){console.error("Error al cambiar el método de pago:",a)}},ee=a=>{var _,b,d,h;const t=(h=(d=(b=(_=a.latest_status_timestamp)==null?void 0:_.split("T")[1])==null?void 0:b.split(":"))==null?void 0:d.slice(0,2))==null?void 0:h.join(":");switch(a.current_status){case"enviada":return`El pedido fue enviado a su domicilio a las ${t}`;case"cancelada":return`El pedido fue cancelado a las ${t}
Responsable: ${a.responsible}
Razón: ${a.reason}`;case"en preparacion":return`El pedido está en preparación desde las ${t} y será enviado en breve.`;case"generada":return`Hemos recibido su pedido a las ${t} y empezaremos a prepararlo en breve. Gracias por su espera.`;default:return""}};v(0);const E=v(!1),o=ne(),te=W(()=>o.currentOrder.pe_json.listaPedidos.reduce((a,t)=>{var b;let _=t.pedido_cantidad*t.pedido_precio;if(t.modificadorseleccionList&&t.modificadorseleccionList.length>0){const h=((b=t.modificadorseleccionList)==null?void 0:b.filter(f=>f.pedido_productoid==t.pedido_productoid)).reduce((f,l)=>f+l.modificadorseleccion_cantidad*l.pedido_precio,0);_+=h}return a+_},0));W(()=>te.value+o.currentOrder.delivery_price);const oe=async()=>{var t;const a={order_id:o.currentOrder.order_id,responsible:(t=u.value.responsible)==null?void 0:t.name,reason:u.value.reason};await C.create_cancellling_request(a),E.value=!1,o.Notification.pause(),o.Notification.currentTime=0},z=v(!1),se=()=>{const a=document.getElementById("factura").innerHTML,t=window.open("","_blank");t.document.write("<html><head><title>Factura</title>");const _=document.getElementsByTagName("style");for(let b=0;b<_.length;b++)t.document.write(_[b].outerHTML);t.document.write("<style>  @media print { html{height: min-content;}  *{text-transform:uppercase;align-items:center; width:100%; font-family: sans-serif;padding:0;margin:0; font-size:o.9rem !IMPORTANT} body { padding:0; -webkit-print-color-adjust: exact; /* Chrome, Safari */ color-adjust: exact; /* Firefox */ } }  </style>"),t.document.write("</head><body>"),t.document.write(a),t.document.write("</body></html>"),t.document.close(),t.print(),setTimeout(()=>{t.close()},.01)},U=v([]);Q(async()=>{o.currentOrder.value=o.currentOrder,U.value=await D.get(`${P}/sites`)});const S=v(!1);v(!1);const u=v({responsible:null,reason:"Sin razon"}),L=v([{name:"Restaurante",value:"restaurant"},{name:"Cliente",value:"client"}]),le=()=>{u.value.responsible&&C.cancelOrder(o.currentOrder.order_id,u.value.reason,u.value.responsible.name).then(a=>{a&&(S.value=!1,console.log("Order canceled successfully"))}).catch(a=>{console.error("Failed to cancel order:",a)})};return(a,t)=>{const _=k("Dropdown"),b=k("Textarea"),d=k("Button"),h=k("Dialog"),f=k("Tag");return c(),g(R,null,[e("div",null,[i(h,{visible:S.value,"onUpdate:visible":t[2]||(t[2]=l=>S.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:m(()=>[ce]),default:m(()=>[e("form",{onSubmit:I(le,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[ue,i(_,{style:{width:"100%"},id:"responsible",modelValue:u.value.responsible,"onUpdate:modelValue":t[0]||(t[0]=l=>u.value.responsible=l),options:L.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),pe,i(b,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:u.value.reason,"onUpdate:modelValue":t[1]||(t[1]=l=>u.value.reason=l),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),i(d,{style:{width:"100%","border-radius":"0.5rem"},label:"cancelar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),i(h,{visible:E.value,"onUpdate:visible":t[5]||(t[5]=l=>E.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:m(()=>[me]),default:m(()=>[e("form",{onSubmit:I(oe,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[_e,be,i(_,{style:{width:"100%"},id:"responsible",modelValue:u.value.responsible,"onUpdate:modelValue":t[3]||(t[3]=l=>u.value.responsible=l),options:L.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),ve,i(b,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:u.value.reason,"onUpdate:modelValue":t[4]||(t[4]=l=>u.value.reason=l),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),i(d,{style:{width:"100%","border-radius":"0.5rem"},label:"solicitar cancelacion",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),i(h,{closable:!1,style:{width:"30rem"},modal:"",visible:z.value,"onUpdate:visible":t[8]||(t[8]=l=>z.value=l)},{footer:m(()=>[e("div",he,[i(d,{text:"",size:"small",onClick:t[6]||(t[6]=()=>{s(C).deliveryZero(s(o).currentOrder.order_id),z.value=!1}),style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"si"}),i(d,{onClick:t[7]||(t[7]=l=>z.value=!1),size:"small",style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"no"})])]),default:m(()=>[e("span",ye,[y(" Esta seguro de llevar a $0.00 el valor del domicilio para la orden "),e("b",null,r(s(o).currentOrder.order_id),1),y(" del cliente "),e("b",null,r(s(o).currentOrder.user_name),1),y("? ")])]),_:1},8,["visible"]),i(h,{class:"mx-3",closeOnEscape:"",closable:!1,visible:s(o).visibles.currentOrder,"onUpdate:visible":t[14]||(t[14]=l=>s(o).visibles.currentOrder=l),modal:"",style:{"max-height":"95vh",width:"35rem",position:"relative"}},{footer:m(()=>[e("div",ut,[s(o).currentOrder.current_status=="generada"?(c(),T(d,{key:0,size:"small",onClick:t[9]||(t[9]=l=>s(C).prepareOrder(s(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"Preparar"})):O("",!0),s(o).currentOrder.current_status=="en preparacion"?(c(),T(d,{key:1,size:"small",onClick:t[10]||(t[10]=l=>s(C).sendOrder(s(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"enviar"})):O("",!0),i(d,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:se,severity:"warning",label:"imprimir"}),i(d,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:t[11]||(t[11]=l=>E.value=!0),severity:"danger",label:"CANCELAR "})]),e("div",pt,[i(d,{onClick:t[12]||(t[12]=l=>M.value=!0),label:"Cambiar metodo de pago",severity:"success"})])]),default:m(()=>{var l,B,A,F,H,q,Z,G,Y,J;return[e("div",ge,[e("div",null,[e("p",{class:ae(`estado ${(B=(l=s(o).currentOrder)==null?void 0:l.current_status)==null?void 0:B.split(" ")[0]}`)},r(ee(s(o).currentOrder)),3)])]),e("div",fe,[s(o).currentOrder.responsible_id?(c(),T(f,{key:0,style:{},class:"tag mb-2",severity:"success"},{default:m(()=>[we,y(" TRANSFERENCIA APROBADA")]),_:1})):O("",!0),y(),Oe,s(o).currentOrder.responsible_id?(c(),T(f,{key:1,class:"tag",severity:"success"},{default:m(()=>[y(r(s(o).currentOrder.name),1)]),_:1})):O("",!0),e("div",xe,[e("p",ke," ID:"+r(s(o).currentOrder.order_id),1),e("p",Ce,r(s(o).currentOrder.user_name),1),e("p",Ve,[e("b",null," fecha: "+r((A=s(o).currentOrder.latest_status_timestamp)==null?void 0:A.split("T")[0]),1),e("b",null," Hora: "+r((Z=(q=(H=(F=s(o).currentOrder.latest_status_timestamp)==null?void 0:F.split("T")[1])==null?void 0:H.split(":"))==null?void 0:q.slice(0,2))==null?void 0:Z.join(":")),1)]),Me,(c(!0),g(R,null,N((J=(Y=(G=s(o))==null?void 0:G.currentOrder)==null?void 0:Y.pe_json)==null?void 0:J.listaPedidos,p=>{var K;return c(),g("div",null,[e("div",$e,[e("p",Ee,[y(" ( "+r(p.pedido_cantidad)+" ) "+r(p.pedido_nombre_producto)+" ",1),ze]),e("div",null,[p.pedido_base_price?(c(),g("p",De,r(s(x)(p.pedido_base_price*p.pedido_cantidad)),1)):(c(),g("p",Pe,r(s(x)(p.pedido_precio)),1))])]),((K=p.lista_productocombo)==null?void 0:K.length)>0?(c(),g("p",Te,Se)):O("",!0),p.lista_productocombo?(c(!0),g(R,{key:1},N(p.lista_productocombo,w=>(c(),g("p",Ie,[y(" -- "),e("b",null,r(w.pedido_cantidad),1),y(" "+r(w.pedido_nombre),1)]))),256)):O("",!0),(c(!0),g(R,null,N(p.modificadorseleccionList,w=>(c(),g("div",Ne,[e("p",je,[y(" - ( "+r(p.pedido_cantidad)+" ) ",1),e("b",null,r(w.modificadorseleccion_cantidad),1),y(" "+r(w.modificadorseleccion_nombre),1)]),e("p",Ue,r(s(x)(w.pedido_precio*w.modificadorseleccion_cantidad*p.pedido_cantidad)),1)]))),256)),Le])}),256)),e("div",Be,[Ae,e("div",Fe,[e("p",He,[e("b",null,r(s(x)(s(o).currentOrder.pe_json.delivery.delivery_pagocon-s(o).currentOrder.delivery_price)),1)])]),qe,e("div",Ze,[e("p",Ge,[e("b",null,r(s(x)(s(o).currentOrder.delivery_price)),1)])]),Ye,e("div",Je,[e("p",Ke,[e("b",null,r(s(x)(s(o).currentOrder.pe_json.delivery.delivery_pagocon)),1)])]),Qe]),We,e("p",Xe,r(s(o).currentOrder.order_notes),1),et,e("div",tt,[ot,e("div",st,[e("p",lt,r(s(o).currentOrder.user_name),1)]),rt,e("div",null,[e("p",nt,r(s(o).currentOrder.user_phone),1)]),at,e("div",null,[e("p",it,r(s(o).currentOrder.user_address),1)]),dt,e("div",null,[e("p",ct,r(s(o).currentOrder.payment_method),1)])])])]),i(d,{class:"shadow-4",onClick:t[13]||(t[13]=p=>s(o).setVisible("currentOrder",!1)),icon:"pi pi-times",rounded:"",severity:"danger",style:{position:"absolute",top:"-1rem","border-radius":"50%",right:"-1rem"}})]}),_:1},8,["visible"])]),i(h,{visible:M.value,"onUpdate:visible":t[16]||(t[16]=l=>M.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:m(()=>[mt]),default:m(()=>[e("form",{onSubmit:I(X,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[_t,i(f,{class:"px-4",severity:"warning"},{default:m(()=>[e("span",bt,[e("b",null,r(s(o).currentOrder.payment_method),1)])]),_:1}),vt,i(_,{style:{width:"100%"},id:"paymentMethod",modelValue:$.value,"onUpdate:modelValue":t[15]||(t[15]=l=>$.value=l),options:j.value,optionLabel:"name",optionValue:"id",placeholder:"Selecciona un método de pago",required:""},null,8,["modelValue","options"]),i(d,{style:{width:"100%","border-radius":"0.5rem"},label:"Cambiar",type:"submit",class:"p-button-help"})],32)]),_:1},8,["visible"])],64)}}},ft=re(yt,[["__scopeId","data-v-f5c7c79d"]]);export{ft as D};
