import{r,H as ue,y as pe,k as ce,h as me,E as ve,a as y,o,c as m,d as s,w as u,b as n,F as S,K as b,U as x,I as ye,f as g,e as J,t as h,m as f,q as E,u as P,s as I}from"./index-c5ed3781.js";import{f as $,a as ee}from"./formatoPesos-8aa989a0.js";import{r as ge,u as F,w as he}from"./xlsx-4f9172c7.js";const fe={class:"m-0 my-3"},we={style:{display:"flex","justify-content":"end"}},_e={class:"grid p-3",style:{"align-items":"center","justify-content":"space-between",display:"flex",gap:"1rem"}},be=n("h3",{class:"px-2"},[n("i",{class:"fa fa-upload"}),E(),n("b",null,"Carga de precios")],-1),xe=n("div",{style:{display:"flex",width:"100%","justify-content":"end","flex-wrap":"wrap",gap:"1rem","align-items":"center"}},null,-1),Ie={class:"p-2",style:{display:"flex","flex-wrap":"wrap","justify-content":"end",gap:"1rem"}},ke={style:{"margin-top":"3rem"}},Pe={class:"grid p-3",style:{"align-items":"center","justify-content":"space-between",display:"flex",gap:"1rem"}},Ve=n("h3",{class:"px-2"},[n("i",{class:"fa fa-carrot"}),E(),n("b",null,"Ingredientes")],-1),Ce={style:{display:"flex",width:"100%","justify-content":"end","flex-wrap":"wrap",gap:"1rem","align-items":"center"}},De=n("h6",{class:"m-0"},[n("b",null," Porcentajes visible")],-1),Ue=n("div",null,null,-1),Le={__name:"pricesCdiTable",setup(Ee){const R=r([]),T=r(null),V=r(!1),K=()=>{V.value=!0,T.value&&(T.value.value="",T.value.click())},te=async a=>{const t=a.target.files[0];if(t)try{const d=await ae(t);R.value=d,V.value=!0,console.log(R.value)}catch(d){console.error("Error al leer el archivo:",d)}},ae=a=>new Promise((t,d)=>{const c=new FileReader;c.onload=_=>{try{const p=new Uint8Array(_.target.result),k=ge(p,{type:"array"}),z=k.SheetNames[0],v=k.Sheets[z],H=F.sheet_to_json(v).filter(e=>e.ID&&e.ID.toString().trim()!=="");t(H)}catch(p){d(p)}},c.onerror=_=>{d(_)},c.readAsArrayBuffer(a)}),Q=ue(),N=r([]),W=r({}),L=r(!1),i=r({}),B=r([{}]),X=r([]),M=r(!1),O=r(!1),le=()=>{M.value=!1,i.value={},L.value=!0},ne=async()=>{const a=W.value.id;await b.delete(`${x}/delete-ingredient/${a}`,"Borrando ingrediente"),O.value=!1,A()},j=r([{percent:"cargando..."}]),Y=[{header:"Id",value:"id",width:"1",frozen:!0},{header:"Nombre ingrediente",value:"name",type:"max-content",width:"",frozen:!0},{header:"UM de compra",value:"unit_measure",width:"10",frozen:!1},{header:"Ultimo precio de compra",value:"last_price_purchase",width:"10",type:"money",frozen:!1},{header:"iva",value:"iva",width:"5",type:"percent",frozen:!1}],se=r([...Y]);pe(()=>{var a;return(a=se.value)==null?void 0:a.map(t=>t.value)});const oe=r([{name:"Nombre del ingrediente",fiel:"name",type:"text"},{name:"Unidad de medida de compra",fiel:"purchasing_unit_measure",type:"drop",Options:r(X),optionLable:"name"},{name:"precio de compra",fiel:"purchasing_price",type:"money"},{name:"Presentacion convertir a gramos",fiel:"net_gross_weight",type:"number"}]);ce(i,async(a,t)=>{var d;i.value.purchasing_unit_measure_id=((d=a.purchasing_unit_measure)==null?void 0:d.id)||null},{deep:!0});const re=async()=>{Q.setLoading(!0,"generando descargas");const a=B.value.map(c=>({ID:c.id,INGREDIENTE:c.name,"IVA (%)":c.iva,"ULTIMO PRECIO DE COMPRA":c.last_price_purchase})),t=F.json_to_sheet(a);t["!cols"]=[{wch:3},{wch:50},{wch:8},{wch:25}];const d=F.book_new();F.book_append_sheet(d,t,"Usuarios"),he(d,"Ultimos precios de compra.xlsx"),Q.setLoading(!1,"generando descargas")},Z=async()=>{const a=i.value;if(!a.name||!a.purchasing_unit_measure_id||!a.purchasing_price||!a.net_gross_weight){alert("Por favor llene todos los campos");return}M.value?await b.post(`${x}/update-ingredient/${i.value.id}`,a,"Editando ingrediente"):await b.post(`${x}/create-ingredient`,a,"creando un nuevo ingrediente"),A(),L.value=!1},ie=async()=>{const a=R.value.map(t=>({ingredient_id:t.ID,iva:t["IVA (%)"]||0,last_price_purchase:parseFloat(t["ULTIMO PRECIO DE COMPRA"])||0}));console.log(a),await b.put(`${x}/update-bulk-last-purchase-price`,a,"cargando precios"),A(),V.value=!1},A=async()=>{B.value=await b.get(`${x}/get-cdi-prices-table`,"cargando ingredientes"),X.value=await b.get(`${x}/daily_inventory_unit_measures`),j.value=await b.get(`${x}/get-prices-cdi-percents`)};me(async()=>{A()});const w=r(null),de=()=>{w.value={global:{value:null,matchMode:ye.CONTAINS}}};return ve(()=>{de()}),(a,t)=>{const d=y("inputText"),c=y("Dropdown"),_=y("InputNumber"),p=y("Button"),k=y("Dialog"),z=y("InputText"),v=y("column"),G=y("DataTable"),H=y("MultiSelect");return o(),m(S,null,[s(k,{style:{width:"30rem"},header:M.value?"Actualizar Ingrediente":"Nuevo Ingrediente",class:"mx-2",visible:L.value,"onUpdate:visible":t[0]||(t[0]=e=>L.value=e),modal:""},{footer:u(()=>[M.value?(o(),g(p,{key:1,onClick:Z,severity:"help",label:"Modificar ingrediente"})):(o(),g(p,{key:0,onClick:Z,severity:"help",label:"Guardar ingrediente"}))]),default:u(()=>[(o(!0),m(S,null,J(oe.value,e=>(o(),m("div",null,[n("h6",fe,h(e.name),1),e.type=="text"?(o(),g(d,{key:0,modelValue:i.value[e.fiel],"onUpdate:modelValue":l=>i.value[e.fiel]=l,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])):f("",!0),e.type=="drop"?(o(),g(c,{key:1,options:e.Options,optionLabel:"name",modelValue:i.value[e.fiel],"onUpdate:modelValue":l=>i.value[e.fiel]=l,style:{width:"100%"}},null,8,["options","modelValue","onUpdate:modelValue"])):f("",!0),e.type=="money"?(o(),g(_,{key:2,modelValue:i.value[e.fiel],"onUpdate:modelValue":l=>i.value[e.fiel]=l,style:{width:"100%"},locale:"es-ES","max-fraction-digits":"3",prefix:"$"},null,8,["modelValue","onUpdate:modelValue"])):f("",!0),e.type=="number"?(o(),g(_,{key:3,modelValue:i.value[e.fiel],"onUpdate:modelValue":l=>i.value[e.fiel]=l,style:{width:"100%"},locale:"es-ES","max-fraction-digits":"3"},null,8,["modelValue","onUpdate:modelValue"])):f("",!0),e.type=="persent"?(o(),g(_,{key:4,modelValue:i.value[e.fiel],"onUpdate:modelValue":l=>i.value[e.fiel]=l,style:{width:"100%"},locale:"es-ES","max-fraction-digits":"3",suffix:"%"},null,8,["modelValue","onUpdate:modelValue"])):f("",!0)]))),256))]),_:1},8,["header","visible"]),s(k,{class:"mx-2",header:"Eliminar ingrediente",visible:O.value,"onUpdate:visible":t[3]||(t[3]=e=>O.value=e),modal:""},{footer:u(()=>[n("div",we,[s(p,{size:"small",label:"cancelar",onClick:t[1]||(t[1]=e=>O.value=!1),severity:"help"}),s(p,{size:"small",onClick:t[2]||(t[2]=e=>ne()),label:"Eliminar ingrediente",severity:"danger",text:""})])]),default:u(()=>[n("h6",null,[E("seguro que desea eliminar el Ingrediente "),n("b",null,h(W.value.ingredient_name),1),E(" ?")])]),_:1},8,["visible"]),s(k,{visible:V.value,"onUpdate:visible":t[6]||(t[6]=e=>V.value=e),modal:"",header:"Actualizar ultimos precios de compra",class:"px-0",style:{"max-width":"60rem",width:"95%"}},{footer:u(()=>[n("div",Ie,[s(p,{size:"small",icon:"pi pi-upload",severity:"help",onClick:K,label:"Cargar otro archivo"}),s(p,{size:"small",onClick:t[5]||(t[5]=e=>ie()),label:"Actualizar (Tener cuidado)",severity:"danger"})])]),default:u(()=>[s(G,{paginator:!0,rows:15,style:{width:"100%"},paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} recetas",rowsPerPageOptions:[5,10,25,100],scrollable:"",showGridlines:"",scrollHeight:"65vh",stripedRows:"",class:"col-12 m-auto",value:R.value,tableStyle:"min-width: 50rem;",filters:w.value},{header:u(()=>[n("div",_e,[be,s(z,{class:"",modelValue:w.value.global.value,"onUpdate:modelValue":t[4]||(t[4]=e=>w.value.global.value=e),placeholder:"Buscar ingrediente ..."},null,8,["modelValue"])]),xe]),default:u(()=>[s(v,{header:"ID",field:"ID",class:"py-1"}),s(v,{header:"INGREDIENTE",field:"INGREDIENTE",class:"py-1"}),s(v,{header:"IVA",field:"IVA (%)",class:"py-1"}),s(v,{header:"ULTIMO PRECIO DE COMPRA",field:"ULTIMO PRECIO DE COMPRA",class:"py-1"},{body:u(e=>[E(h(P($)(e.data["ULTIMO PRECIO DE COMPRA"])),1)]),_:1})]),_:1},8,["value","filters"])]),_:1},8,["visible"]),n("div",ke,[s(G,{paginator:!0,rows:15,style:{width:"100%"},paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} recetas",rowsPerPageOptions:[5,10,25,100],scrollable:"",showGridlines:"",scrollHeight:"65vh",stripedRows:"",class:"col-12 m-auto",value:B.value,tableStyle:"min-width: 50rem;",filters:w.value},{header:u(()=>[n("div",Pe,[Ve,s(z,{class:"",modelValue:w.value.global.value,"onUpdate:modelValue":t[7]||(t[7]=e=>w.value.global.value=e),placeholder:"Buscar ingrediente ..."},null,8,["modelValue"])]),n("div",Ce,[De,s(H,{optionLabel:"percent",modelValue:N.value,"onUpdate:modelValue":t[8]||(t[8]=e=>N.value=e),placeholder:"Columnas visibles",options:j.value},null,8,["modelValue","options"]),s(p,{size:"small",icon:"pi pi-plus",severity:"help",onClick:le,label:"Nuevo ingredinte"}),s(p,{size:"small",icon:"pi pi-download",severity:"help",onClick:re,label:"Descargar plantilla"}),s(p,{size:"small",icon:"pi pi-upload",severity:"danger",onClick:K,label:"Cargar precios"}),n("input",{type:"file",ref_key:"fileInput",ref:T,accept:".xlsx, .csv",style:{display:"none"},onChange:te},null,544)])]),default:u(()=>[(o(),m(S,null,J(Y,e=>s(v,{frozen:e.frozen,header:e.header,style:I(`min-width:${e.width}rem`),field:e.value,class:"py-2"},{body:u(l=>[e.type=="money"?(o(),m("h6",{key:0,style:I([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},h(P($)(l.data[e.value])||"-----------"),5)):e.type=="percent"?(o(),m("h6",{key:1,style:I([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},h(`${P(ee)(l.data[e.value])}%`||"-----------"),5)):e.type=="number"?(o(),m("h6",{key:2,style:I([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},h(P(ee)(l.data[e.value])||"-----------"),5)):e.type!="money"&&e.type!="number"?(o(),m("h6",{key:3,style:I([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},h(l.data[e.value]||"-----------"),5)):f("",!0)]),_:2},1032,["frozen","header","style","field"])),64)),Ue,(o(!0),m(S,null,J(j.value,e=>(o(),m("div",null,[N.value.some(l=>l.percent==e.percent)?(o(),g(v,{key:0,header:`Al ${e.percent}%`,style:"min-width:6rem",field:e.value,class:"py-2"},{body:u(l=>{var C,D,U;return[n("h6",{style:I([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},h(P($)((U=(D=(C=l.data)==null?void 0:C.percent_prices)==null?void 0:D.find(q=>q.hasOwnProperty(e.percent.toString())))==null?void 0:U[e.percent])||"-----------"),5)]}),_:2},1032,["header","field"])):f("",!0),N.value.some(l=>l.percent==e.percent)?(o(),g(v,{key:1,header:`Al ${e.percent}% + IVA`,style:"min-width:10rem",field:e.value,class:"py-2"},{body:u(l=>{var C,D,U;return[n("h6",{style:I([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},h(P($)((U=(D=(C=l.data)==null?void 0:C.percent_prices_iva)==null?void 0:D.find(q=>q.hasOwnProperty(e.percent)))==null?void 0:U[e.percent])||"-----------"),5)]}),_:2},1032,["header","field"])):f("",!0)]))),256))]),_:1},8,["value","filters"])])],64)}}};export{Le as default};
