import{c as V}from"./contestService-3a3ff153.js";import{a9 as ie,U as B,_ as oe,h as c,l as se,D as ne,G as de,s as re,i as ce,y as ue,g as v,o as m,c as R,f as i,e as s,a as o,x as pe,u as j,F as ve,r as me,t as u,d as w,q as b,k as C,b as I,p as _e,m as ye}from"./index-34463bb2.js";import{a as Q}from"./formatDate-262296cf.js";const fe={async uploadImage(x,D,_){const P=`${B}/upload-product-image/${D}-${_}`,g=new FormData;g.append("file",x);try{const h=await ie.post(P,g,{headers:{"Content-Type":"multipart/form-data"}});h.status===200?console.log("Archivo photo cargado con Ã©xito"):console.error("Error al cargar foto de perfil:",h.status,h.statusText)}catch(h){console.error("Error en la solicitud:",h)}}};const ge=x=>(_e("data-v-33a075da"),x=x(),ye(),x),he={action:"",class:""},we=["src"],be={class:"field col-12 mt-3 mb-6 p-0",style:{display:"flex","justify-content":"end"}},Ce={class:"form-container my-2"},xe={style:{}},Ve={style:{display:"flex","justify-content":"space-between"}},De=["for"],ke={style:{width:"100%"}},Se={style:{display:"flex","justify-content":"end"}},Te={class:"container px-0 md:px-3"},Ue=ge(()=>o("h1",{class:"m-auto px-4 py-4"},[o("b",null,"Administrador de concursos")],-1)),Fe={class:"grid p-2",style:{"align-items":"center",display:"flex",gap:"1rem","justify-content":"end"}},Ae=["src"],Ie={style:{"text-transform":"capitalize","min-width":"max-content"}},Pe={style:{display:"flex","align-items":"center",gap:"0"}},Ee={style:{display:"flex","align-items":"center",gap:"0"}},$e={__name:"manageContest",setup(x){const D=c(null),_=c(!1),P=se(),g=c(!1),h=c([]),k=c(),S=c({}),E=c(null),J=l=>{const a=l.target.files[0];a&&(console.log("Archivo seleccionado:",a),D.value=a,E.value=URL.createObjectURL(a))},$=c(!1),t=c({}),p=c({dialogAddContestVisible:!1,deleteContestDialogVisible:!1}),K=l=>{g.value=!0;const a={...l};a.evidence_type_id=S.value.evidences.filter(n=>n.id==a.evidence_type_id)[0],a.contest_winner_type_id=S.value.winner_type.filter(n=>n.id==a.contest_winner_type_id)[0],a.is_site_participation=a.is_site_participation?{name:"Sedes",value:!0}:{name:"Colaboradores",value:!1},t.value=a,p.value.dialogAddContestVisible=!0},W=()=>{g.value=!1,t.value={},p.value.dialogAddContestVisible=!0},L=c([{type:"text",field:"name",name:"Nombre"},{type:"textArea",field:"description",name:"Descripcion"},{type:"textArea",field:"instructions",name:"Instrucciones"},{type:"date",field:"start_date",name:"Fecha de inicio"},{type:"date",field:"end_date",name:"Fecha de finalizacion"},{type:"Dropdown",field:"contest_winner_type_id",name:"Forma de ganar",options_name:"winner_type",delicated:!0,options:[],selected:{}},{type:"Dropdown",field:"evidence_type_id",name:"Tipo de evidencia",delicated:!0,options_name:"evidences",options:[],selected:{}},{type:"Dropdown",field:"is_site_participation",name:"Participantes",options_name:"name",options:[{name:"Sedes",value:!0},{name:"Colaboradores",value:!1}],selected:{}}]);ne(t,(l,a)=>{var n,y;if(((n=l.contest_winner_type_id)==null?void 0:n.id)!==2){$.value=!1;return}t.value.evidence_type_id=(y=L.value.filter(f=>f.field=="evidence_type_id")[0].options)==null?void 0:y.filter(f=>f.id==4)[0],$.value=!0},{deep:!0});const X=()=>{k.value={global:{value:null,matchMode:pe.CONTAINS}}},Y=de(()=>h.value.map(l=>({...l,formattedStartDate:Q(l.start_date),formattedEndDate:Q(l.end_date)})));re(()=>{X()});const N=c({}),Z=l=>{N.value=l,p.value.deleteContestDialogVisible=!0,_.value=!1},T=c({}),z=async()=>{const l=await V.getAllContestAll();l.forEach(a=>{T.value[a.id]=a.visible}),h.value=l},ee=async()=>{var n,y,f,U,F,A;if(_.value=!0,!t.value.name||!t.value.start_date||!t.value.end_date||!t.value.description||!((y=(n=t.value)==null?void 0:n.evidence_type_id)!=null&&y.id)||!((f=t.value)!=null&&f.instructions)||!((F=(U=t.value)==null?void 0:U.contest_winner_type_id)!=null&&F.id)||!((A=t.value)!=null&&A.is_site_participation)){alert("debe llenar todos los campos");return}const l={name:t.value.name||"",start_date:t.value.start_date||"",end_date:t.value.end_date||"",description:t.value.description||"",evidence_type_id:t.value.evidence_type_id.id||"",instructions:t.value.instructions||"",contest_winner_type_id:t.value.contest_winner_type_id.id||"",is_site_participation:t.value.is_site_participation.value||!1},a=g.value?await V.updateContest({...l,id:t.value.id}):await V.createContest(l);p.value.dialogAddContestVisible=!1,D.value&&fe.uploadImage(D.value,"contest",a),z()},te=async l=>{p.value.deleteContestDialogVisible=!1,await V.deleteContest(l),z()};return ce(async()=>{P.rawUserData.id!=1132&&(alert("no autorizado"),ue.push("/concursos")),S.value=await V.getContestEntryOption(),L.value.forEach(l=>{l.type=="Dropdown"&&l.field!="is_site_participation"?l.options=S.value[l.options_name]:l.options=l.options}),await z()}),(l,a)=>{const n=v("Button"),y=v("Tag"),f=v("InputText"),U=v("Textarea"),F=v("Calendar"),A=v("Dropdown"),M=v("Dialog"),r=v("column"),ae=v("InputSwitch"),le=v("DataTable");return m(),R("div",null,[i(M,{class:"mx-2",header:g.value?"Editar concurso":"Nuevo concurso",style:{width:"30rem"},modal:"",visible:p.value.dialogAddContestVisible,"onUpdate:visible":a[3]||(a[3]=e=>p.value.dialogAddContestVisible=e)},{footer:s(()=>[o("div",ke,[i(n,{onClick:a[1]||(a[1]=e=>p.value.dialogAddContestVisible=!1),text:"",severity:"danger",label:"Cancelar"}),i(n,{onClick:a[2]||(a[2]=e=>ee()),label:"Guardar",severity:"help"})])]),default:s(()=>[o("form",he,[o("img",{class:"img-profile-add",style:{width:"100%","object-fit":"contain","border-radius":"0.5rem"},src:E.value?E.value:`${j(B)}/read-product-image/600/contest-${t.value.id}`,alt:""},null,8,we),o("div",be,[o("input",{ref:"fileInput",type:"file",accept:"image/*",onChange:J,style:{display:"none"}},null,544),i(n,{icon:"pi pi-camera",severity:"help",class:"",onClick:a[0]||(a[0]=e=>{l.$refs.fileInput.click()})})]),o("div",Ce,[(m(!0),R(ve,null,me(L.value,e=>(m(),R("div",xe,[o("div",Ve,[o("span",{class:"py-0 my-0",for:e.name},u(e.name),9,De),(t.value[e.field]==null||t.value[e.field]=="")&&_.value?(m(),w(y,{key:0,severity:"danger",class:"pr-1 pl-3",style:{"border-radius":"3rem .7rem 0  0"}},{default:s(()=>[b("Este campo es obligatorio")]),_:1})):C("",!0)]),e.type=="text"?(m(),w(f,{key:0,class:I((t.value[e.field]==null||t.value[e.field]=="")&&_.value?"invalid":""),modelValue:t.value[e.field],"onUpdate:modelValue":d=>t.value[e.field]=d,style:{width:"100%"},id:e.name},null,8,["class","modelValue","onUpdate:modelValue","id"])):C("",!0),e.type=="textArea"?(m(),w(U,{key:1,class:I((t.value[e.field]==null||t.value[e.field]=="")&&_.value?"invalid":""),modelValue:t.value[e.field],"onUpdate:modelValue":d=>t.value[e.field]=d,rows:"4",style:{width:"100%",resize:"none","min-width":"100%","max-width":"100%"}},null,8,["class","modelValue","onUpdate:modelValue"])):C("",!0),e.type=="date"?(m(),w(F,{key:2,class:I((t.value[e.field]==null||t.value[e.field]=="")&&_.value?"invalid":""),showTime:"",dateFormat:"dd/mm/yy",modelValue:t.value[e.field],"onUpdate:modelValue":d=>t.value[e.field]=d,style:{width:"100%"}},null,8,["class","modelValue","onUpdate:modelValue"])):C("",!0),e.type=="Dropdown"?(m(),w(A,{key:3,class:I((t.value[e.field]==null||t.value[e.field]=="")&&_.value?"invalid":""),disabled:e.field==="evidence_type_id"&&$.value||e.delicated&&g.value,showTime:"",modelValue:t.value[e.field],"onUpdate:modelValue":d=>t.value[e.field]=d,optionLabel:"name",options:e.options,style:{width:"100%"}},null,8,["class","disabled","modelValue","onUpdate:modelValue","options"])):C("",!0)]))),256))])])]),_:1},8,["header","visible"]),i(M,{class:"mx-2",header:"Eliminar concurso",style:{width:"25rem"},modal:"",visible:p.value.deleteContestDialogVisible,"onUpdate:visible":a[5]||(a[5]=e=>p.value.deleteContestDialogVisible=e)},{footer:s(()=>[o("div",Se,[i(n,{onClick:a[4]||(a[4]=e=>te(N.value.id)),label:"Eliminar este concurso",severity:"danger"})])]),default:s(()=>[o("div",null,[o("p",null,[b("Esta seguro de eliminar el concurso "),o("b",null,u(N.value.name)+"?",1)])])]),_:1},8,["visible"]),o("div",Te,[Ue,i(le,{paginator:!0,rows:15,filters:k.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} concursos",rowsPerPageOptions:[5,10,25,100],scrollable:"",scrollHeight:"65vh",stripedRows:"",style:{},"onUpdate:filters":a[7]||(a[7]=e=>k.value=e),class:"col-12 m-auto",value:Y.value,tableStyle:"min-width: 50rem;"},{header:s(()=>[o("div",Fe,[i(f,{class:"",style:{width:"100%","max-width":"500px"},modelValue:k.value.global.value,"onUpdate:modelValue":a[6]||(a[6]=e=>k.value.global.value=e),placeholder:"Buscar Concurso..."},null,8,["modelValue"]),i(n,{onClick:W,style:{"min-width":"max-content"},icon:"pi pi-plus",label:"Nuevo concurso",class:"",severity:"help"})])]),default:s(()=>[i(r,{frozen:"",style:{"min-width":"1rem"},class:"py-1 pl-0",header:"Id",field:"id"}),i(r,{style:{"min-width":"1rem"},class:"py-1 pl-0",header:"imagen",field:"id"},{body:s(e=>[o("img",{class:"p-0",style:{width:"100%","aspect-ratio":"3 / 3","border-radius":".3rem","object-fit":"cover"},src:`${j(B)}/read-product-image/96/contest-${e.data.id}`,alt:""},null,8,Ae)]),_:1}),i(r,{style:{"min-width":"20rem"},class:"py-1",header:"Nombre",field:"name"}),i(r,{style:{"min-width":"20rem"},class:"py-1",header:"Participantes",field:"name"},{body:s(e=>[b(u(e.data.is_site_participation?"Sedes":"Colaboradores"),1)]),_:1}),i(r,{style:{"min-width":"13rem"},class:"py-1",header:"Fecha de inicio",field:"formattedStartDate"},{body:s(e=>[b(u(e.data.formattedStartDate),1)]),_:1}),i(r,{style:{"min-width":"13rem"},class:"py-1",header:"Fecha de finalizacion",field:"formattedStartDate"},{body:s(e=>[b(u(e.data.formattedEndDate),1)]),_:1}),i(r,{style:{"min-width":"13rem"},class:"py-1",header:"Forma de ganar",field:"formattedStartDate"},{body:s(e=>[o("span",null,u(e.data.contest_winner_type_name),1)]),_:1}),i(r,{style:{"min-width":"12rem"},class:"py-1",header:"Tipo de evidencia",field:"formattedStartDate"},{body:s(e=>[o("span",null,u(e.data.evidence_type_name),1)]),_:1}),i(r,{style:{"min-width":"12rem"},class:"py-1",header:"Quien va ganando?",field:"formattedStartDate"},{body:s(e=>{var d,O,q,G,H;return[o("p",Ie,u((H=(G=(q=(O=(d=e.data.rbq[0])==null?void 0:d.name)==null?void 0:O.split(" "))==null?void 0:q.slice(0,3))==null?void 0:G.join(" "))==null?void 0:H.toLowerCase()),1)]}),_:1}),i(r,{style:{"min-width":"20rem"},class:"py-1",header:"Instrucciones",field:"formattedStartDate"},{body:s(e=>[o("span",null,u(e.data.instructions),1)]),_:1}),i(r,{style:{"min-width":"5rem"},class:"py-1",header:"Estado",field:"formattedStartDate"},{body:s(e=>[e.data.started?(m(),w(y,{key:0,severity:e.data.vigent?"success":"danger",style:{"border-radius":".3rem","min-width":"max-content"}},{default:s(()=>[b(u(e.data.vigent?"En curso...":"Finalizado"),1)]),_:2},1032,["severity"])):C("",!0),e.data.started?C("",!0):(m(),w(y,{key:1,style:{"border-radius":".3rem","min-width":"max-content"}},{default:s(()=>[b(u(e.data.started?"":"Proximo"),1)]),_:2},1024))]),_:1}),i(r,{alignFrozen:"right",style:{"min-width":"4rem"},class:"py-1 pr-0",header:"Acciones",field:"Visible"},{body:s(e=>[o("div",Pe,[i(n,{onClick:d=>K(e.data),style:{pediting:"0",margin:"0"},severity:"warning",text:"",class:"p-0 m-0 text-2xl",icon:"fa-solid fa-pen-to-square p-0 m-0"},null,8,["onClick"]),i(n,{onClick:d=>Z(e.data),style:{pediting:"0",margin:"0"},severity:"danger",text:"",class:"p-0 m-0 text-2xl",icon:"fa-solid fa-trash  p-0 m-0"},null,8,["onClick"])])]),_:1}),i(r,{frozen:"",alignFrozen:"right",style:{"min-width":"4rem"},class:"py-1 pr-0",header:"Visible",field:"Visible"},{body:s(e=>[o("div",Ee,[i(ae,{onChange:()=>j(V).contestToggleVisible(T.value[e.data.id],e.data.id),modelValue:T.value[e.data.id],"onUpdate:modelValue":d=>T.value[e.data.id]=d},null,8,["onChange","modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["filters","value"])])])}}},Re=oe($e,[["__scopeId","data-v-33a075da"]]);export{Re as default};
