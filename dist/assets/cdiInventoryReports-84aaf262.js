import{_ as se,A as ae,l as le,r as u,j as ne,a as y,o as W,c as G,g as a,w as h,b as s,m as ie,t as q,f as re,F as de,v as ce,q as H,p as pe,h as ue}from"./index-4977c679.js";import{s as me}from"./siteService-81d46538.js";import{c as L}from"./cdiInventoryService-eee4e2a8.js";import{u as k,a as J}from"./xlsx-4cca7150.js";import{E as ve}from"./exceljs.min-4b158bf5.js";import{F as Q}from"./FileSaver.min-cc8488c4.js";import{m as ye}from"./index-558f534d.js";import{f as Y}from"./format-8cf56335.js";import{e as Z}from"./es-f6133d36.js";import"./sass.default-a5b7a582.js";import"./_commonjsHelpers-23102255.js";const A=E=>(pe("data-v-ee3847b8"),E=E(),ue(),E),he={class:"grid"},_e={class:"col-12 px-0 mx-0"},fe={class:"col-12",style:{display:"flex","flex-direction":"column"}},ge=A(()=>s("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),xe={class:"col-12",style:{display:"flex","flex-direction":"column"}},we=A(()=>s("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),be={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},De={class:"col-12",style:{display:"flex","justify-content":"center"}},Ce={class:"m-auto",style:{"max-width":"1024px"}},ke={class:"m-0 col-12 p-3",style:{"align-items":"center"}},Ie={class:"p-0 mb-3",style:{display:"flex",gap:"1rem","align-items":"center","justify-content":"start"}},Se=A(()=>s("span",{class:"text-xl",style:{}},[s("b",null,"Sedes")],-1)),Re={class:"col p-0",style:{display:"flex","justify-content":"start",gap:"1rem","align-items":"center"}},Me=A(()=>s("span",{class:"text-xl"},[s("b",null,"Periodo")],-1)),Ae={class:"col-12 px-3",style:{display:"flex","justify-content":"end",gap:"1rem"}},Ee={class:"text-center p-0 text-white"},$e={class:"mt-3",style:{"min-height":"20vh","flex-direction":"column",display:"flex","justify-content":"center","align-items":"center"}},Pe={class:"grid",style:{"align-items":"center"}},Te=A(()=>s("div",{class:"col-12 md:col-6 p-3"},[s("span",{class:"text-xl",style:{width:"100%"}}," Gestionar reportes de inventario")],-1)),Ue={class:"col-12 md:col-6 p-3"},Fe={style:{"text-transform":"uppercase"}},Ve={style:{display:"flex",gap:"0.5rem"}},Le="America/Bogota",je={__name:"cdiInventoryReports",setup(E){const $=ae(),K=le(),j=u([]),P=u([{}]),g=u(!1),T=ye().tz(Le).toDate(),N=u(!1),I=u(0),x=u(T),_=u(T),w=u(T),b=u(T),U=u(),S=u(),X=(d,e)=>{w.value=d,b.value=e},R=d=>{const e=new Date,o=new Date(e);o.setDate(o.getDate()+1);const l=new Date(e);l.setDate(e.getDate()-d),x.value=l,d==1?(_.value=l,b.value=_.value,w.value=x.value,g.value=!1):(_.value=e,w.value=x.value,b.value=_.value,g.value=!1),B()};ne(async()=>{j.value=await me.getSites(),P.value=j.value,B()}),(()=>{S.value={global:{value:null,matchMode:ce.CONTAINS}}})();function F(d){const e=new Date(d),o=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0");return`${o}-${l}-${n}`}const B=async()=>{const d=P.value.map(l=>l.site_id);K.rawUserData.id;const e=F(w.value),o=F(b.value);U.value=await L.getAllCdiInventoryReportsFiltered(d,e,o)},M=u([]),ee=async(d,e,o)=>{M.value=await L.getCdiInventoryEntriesByCdiInventoryID(d);const l=M.value.map(m=>({Producto:m.item_name,Cantidad:m.quantity,"Unidad de medida":m.unit_measure})),n=k.json_to_sheet(l);n["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const p=k.book_new();k.book_append_sheet(p,n,"Usuarios"),J(p,`Inventario_${e}_${o.split("-").reverse().join("-")} .xlsx`)},te=async()=>{$.setLoading(!0,"generando descargas");const d=U.value,e=[];I.value=0,N.value=!0;for(const i of d){const c=await L.getCdiInventoryEntriesByCdiInventoryID(i.cdi_inventory_id);e.push(...c),I.value+=100/d.length}const o={};e.forEach(i=>{const c=i.site_name,r=i.item_name,C=i.quantity,O=i.unit_measure;o[r]||(o[r]={unit_measure:O}),o[r][c]||(o[r][c]=0),o[r][c]+=C});const l=[...new Set(e.map(i=>i.site_name))],n=[],p=Y(w.value,"dd-MMMM-yyyy",{locale:Z}),m=Y(b.value,"dd-MMMM-yyyy",{locale:Z});p==m?n.push([`REPORTE DE INVENTARIO DEL ${p.toUpperCase()}`,...Array(l.length+2).fill("")]):n.push([`REPORTE DE INVENTARIO DEL ${p.toUpperCase()} AL ${m.toUpperCase()}`,...Array(l.length+2).fill("")]);const f=["PRODUCTO","UNIDAD DE MEDIDA",...l,"TOTAL"];n.push(f);for(const[i,c]of Object.entries(o)){const r=[i,c.unit_measure];let C=0;for(const O of l){const z=c[O]||0;r.push(z),C+=z}r.push(C),n.push(r)}const V=new ve.Workbook,v=V.addWorksheet("Inventario por Sede");n.forEach((i,c)=>{const r=v.addRow(i);c===0?(r.height=40,r.font={name:"Arial",bold:!0,size:14},r.alignment={horizontal:"center",vertical:"middle",wrapText:!0},v.mergeCells(`A1:${v.getColumn(l.length+3).letter}1`),v.getRow(1).eachCell(C=>{C.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF00"}}})):c===1&&(r.font={name:"Arial",bold:!0})}),v.columns.forEach((i,c)=>{i.width=c===0?30:c===1?25:15,i.eachCell(r=>{r.font={name:"Arial"},r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),v.getRow(2).eachCell(i=>{i.font={name:"Arial",bold:!0}}),v.getRow(1).eachCell(i=>{i.font={name:"Arial",bold:!0,size:16}}),v.views=[{showGridLines:!1}];const t=await V.xlsx.writeBuffer(),D=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});p==m?Q.saveAs(D,`Reporte de inventario del ${p}.xlsx`):Q.saveAs(D,`Reporte de inventario del ${p} al ${m} .xlsx`),$.setLoading(!1,"generando descargas"),I.value=0,N.value=!1},oe=async()=>{$.setLoading(!0,"generando descargas");const d=U.value;for(const n of d){const p=await L.getCdiInventoryEntriesByCdiInventoryID(n.cdi_inventory_id);M.value.push(...p)}console.log(M.value);const e=M.value.map(n=>({Fecha:n.date.split("-").reverse().join("-"),Sede:n.site_name,Producto:n.item_name,Cantidad:n.quantity,"Unidad de medida":n.unit_measure})),o=k.json_to_sheet(e);o["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const l=k.book_new();k.book_append_sheet(l,o,"Usuarios"),J(l,"Inventario todas las sedes.xlsx"),$.setLoading(!1,"generando descargas")};return(d,e)=>{const o=y("Button"),l=y("Calendar"),n=y("Dialog"),p=y("MultiSelect"),m=y("InputText"),f=y("Column"),V=y("router-link"),v=y("DataTable");return W(),G(de,null,[a(n,{class:"mx-2",visible:g.value,"onUpdate:visible":e[8]||(e[8]=t=>g.value=t),modal:"",header:"Periodo",style:{width:"25rem"}},{default:h(()=>[s("div",he,[s("div",_e,[a(o,{text:"",label:"Hoy",onClick:e[0]||(e[0]=t=>R(0)),class:"p-button-text col-12 p-1 m-0"}),a(o,{text:"",label:"Ayer",onClick:e[1]||(e[1]=t=>R(1)),class:"p-button-text col-12 p-1 m-0"}),a(o,{text:"",label:"Últimos 7 días",onClick:e[2]||(e[2]=t=>R(7)),class:"p-button-text col-12 p-1 m-0"}),a(o,{text:"",label:"Últimos 14 días",onClick:e[3]||(e[3]=t=>R(14)),class:"p-button-text col-12 p-1"}),a(o,{text:"",label:"Últimos 28 días",onClick:e[4]||(e[4]=t=>R(28)),class:"p-button-text col-12 p-0"})]),s("div",fe,[ge,a(l,{style:{"min-width":"max-content"},modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=t=>x.value=t)},null,8,["modelValue"])]),s("div",xe,[we,a(l,{style:{"min-width":"max-content"},modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=t=>_.value=t),showWeek:""},null,8,["modelValue"])]),s("div",be,[s("div",De,[a(o,{onClick:e[7]||(e[7]=()=>{X(x.value,_.value),g.value=!1})},{default:h(()=>[H("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),s("div",Ce,[s("div",ke,[s("div",Ie,[Se,a(p,{style:{},display:"chip",multiple:"",modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=t=>P.value=t),optionLabel:"site_name",options:j.value.filter(t=>t.site_id!=12&t.site_id!=13),class:"text-sm multi p-0"},null,8,["modelValue","options"])]),s("div",Re,[Me,a(m,{class:"",onClick:e[10]||(e[10]=t=>g.value=!0),style:{height:"2.7rem",width:"16rem"},value:`${F(w.value)}  |  ${F(b.value)}`,placeholder:"periodo"},null,8,["value"]),a(o,{onClick:B,icon:"pi pi-search",severity:"help",class:"text-center p-0 col-12 md:p-0",style:{height:"2.5rem",width:"min-content","aspect-ratio":"1 / 1","font-weight":"bold","border-radius":"50%",display:"flex","justify-content":"center"}})])]),s("div",Ae,[a(o,{severity:"help",icon:"pi pi-download",label:"Descargar Todo",onClick:oe}),a(o,{severity:"help",icon:"pi pi-download",label:"Descargar Informe",onClick:te})])]),N.value?(W(),G("div",{key:0,class:"p-1",style:ie([`width:${I.value}%`,{transition:"1s ease all",position:"fixed",top:"3rem",display:"flex","justify-content":"end","align-items":"center","z-index":"9999",height:"1rem","background-color":"var(--primary-color)"}])},[s("p",Ee,q(Math.round(I.value))+"%",1)],4)):re("",!0),s("div",$e,[a(v,{style:{"max-width":"1024px"},filters:S.value,"onUpdate:filters":e[12]||(e[12]=t=>S.value=t),class:"col-12 m-auto",value:U.value,tableStyle:"min-width: 50rem;",paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reportes"},{header:h(()=>[s("div",Pe,[Te,s("div",Ue,[a(m,{style:{width:"100%"},class:"",modelValue:S.value.global.value,"onUpdate:modelValue":e[11]||(e[11]=t=>S.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:h(()=>[a(f,{class:"py-1",field:"cdi_inventory_id",header:"ID"}),a(f,{class:"py-1",field:"employer_name",header:"Responsable"},{body:h(t=>[s("div",Fe,q(t.data.employer_name),1)]),_:1}),a(f,{class:"py-1",field:"site_name",header:"Sede"}),a(f,{class:"py-1",field:"date",header:"Fecha"},{body:h(t=>{var D;return[H(q((D=t.data.date)==null?void 0:D.split("-").reverse().join("-")),1)]}),_:1}),a(f,{style:{},class:"py-1 px-0",field:"date",header:"Action"},{body:h(t=>[s("div",Ve,[a(V,{to:`/cdi-inventory/cdi-inventory-view/${t.data.cdi_inventory_id}`},{default:h(()=>[a(o,{style:{height:"2rem"},severity:"help",class:"p-1",icon:"pi pi-eye"})]),_:2},1032,["to"]),a(o,{onClick:D=>ee(t.data.cdi_inventory_id,t.data.site_name,t.data.date),style:{height:"2rem",background:"var(--primary-color)",border:"none"},severity:"success",class:"p-1",icon:"pi pi-download"},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])])],64)}}},Ke=se(je,[["__scopeId","data-v-ee3847b8"]]);export{Ke as default};
