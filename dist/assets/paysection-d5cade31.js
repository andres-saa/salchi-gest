import{_ as Pe,j as o,I as ee,y as ae,k as te,m as O,U as M,l as ke,G as Se,z as Te,H as se,C as Ve,av as w,r as d,o as x,c as le,e as s,f as n,a as t,d as oe,n as ne,A as De,h as u,t as b,N,u as v,p as re,g as $,i as B,F as Re,b as Ie,q as Ue,x as $e}from"./index-f8593e29.js";import{D as qe}from"./DialogoPedido-2c353b7b.js";import{e as Ae}from"./formatDate-262296cf.js";import{f as Le}from"./formatoPesos-e824e30b.js";import"./formatoPesos-2293ab52.js";/* empty css                                                                      */const C=D=>(Ue("data-v-0bf7290c"),D=D(),$e(),D),ze={class:"container",style:{"margin-top":"4rem"}},Ee=C(()=>t("h3",null,[t("b",null,"Archivar pago")],-1)),Oe={style:{display:"flex",gap:".5rem"}},Me=C(()=>t("p",{class:"text-4xl text-center px-4",style:{"font-weight":"bold","margin-top":"4rem"}},[t("i",{class:"fa-solid fa-money-bill"}),u(" Pedidos de pasarela sin pagar o abandonados ")],-1)),Ne=C(()=>t("h3",null,[t("b",null,"Rechazar orden")],-1)),Be=C(()=>t("h3",null,[t("b",null,"Aprobar esta orden")],-1)),je={style:{"max-width":"1280px"},class:"mx-auto"},Fe={class:"taskbar",style:{padding:"0 .5rem"}},He={class:"slider mx-auto",style:{display:"flex",overflow:"hidden"}},Ge={class:"grid",style:{"align-items":"center","justify-content":"space-between"}},Xe={style:{display:"flex",gap:"2rem",padding:"0 2rem"}},We={class:"md:mt-0 p-input-icon-right m-3"},Je=C(()=>t("i",{class:"pi pi-search"},null,-1)),Ke={style:{display:"flex",gap:".5rem"}},Qe={class:"grid p-3 mt-4",style:{"align-items":"center","justify-content":"start",display:"flex",gap:"1rem"}},Ye={class:"px-2 m-0"},Ze=C(()=>t("i",{class:"fa-regular fa-bars-progress"},null,-1)),ea={style:{"text-transform":"uppercase"}},aa={class:"m-0"},ta={__name:"paysection",setup(D){const j=[33,35,36],F=[1,2,3,7,8,9,10,11,29,30],H=[32],i=o({usa:!0,colombia:!0,distri:!1}),y=o("pending"),f=o([]),R=o([]),ie=ee(()=>{const l=new Set([...i.value.usa?j:[],...i.value.colombia?F:[],...i.value.distri?H:[]]);return f.value.filter(e=>l.has(e.site_id))}),de=ee(()=>{const l=new Set([...i.value.usa?j:[],...i.value.colombia?F:[],...i.value.distri?H:[]]);return R.value.filter(e=>l.has(e.site_id))}),G=o([]);o([{columnName:"SEDE",columnValue:"sede",columnType:"other",size:"1rem",vif:!0},{columnName:"ASESOR",columnValue:"current_status",columnType:"status",size:"15rem",vif:!0}]);const _=o({start_date:new Date,end_date:new Date,sites:[]}),ue=o([]),q=ae(),ce=l=>{q.setVisible("currentOrder",!0),q.setOrder(l)},pe=async l=>{const e=L.rawUserData.id;await w.aproveOrder(l,e),I.value=!1,T()},me=o([]),P=o(!1);te(async()=>{G.value=await O.get(`${M}/sites/`)});const A=o(!1),I=o(!1),L=ke(),g=o({});o([{index:1,slide:0,name:"Basico"},{index:2,slide:-100,name:"reportes"}]);const X=o({index:1,slide:0,name:"Basico"});ae();const k=Se(),h=o(),W=()=>{h.value={global:{value:null,matchMode:De.CONTAINS}}};W(),Te(()=>{W()}),te(()=>{T()}),se(()=>q.numberOders,()=>{T()}),se(()=>k.params.request_status,async()=>{K.value=await J.revisar()},{deep:!0});const J={revisar:w.getPendientsCancellationRequest,aprobadas:w.getaceptedCancellationAcepted,rechazadas:w.getPendientsCancellationRejected},K=o([]),U=Ve();async function ve(l){const e=`https://salchimonster.com/pagar/${l.order_id}`;try{await navigator.clipboard.writeText(e),U.add({severity:"success",summary:"¡Copiado!",detail:"El enlace se copió al portapapeles",life:2500})}catch{const c=document.createElement("input");c.value=e,document.body.appendChild(c),c.select(),document.execCommand("copy"),c.remove(),U.add({severity:"info",summary:"Copiado con método alternativo",detail:"Tu navegador no soporta la API moderna de portapapeles",life:3e3})}}const S=o(!1),z=o({order_id:null}),ye=l=>{z.value.order_id=l.order_id,S.value=!0},T=async()=>{P.value=!0;try{f.value=await w.getOrdersPay()}finally{P.value=!1}},Q=async()=>{P.value=!0;try{R.value=await O.get(`${M}/order-to-pay-archived`)}finally{P.value=!1}},Y=async l=>{y.value!==l&&(y.value=l,l==="archived"&&R.value.length===0&&await Q(),l==="pending"&&f.value.length===0&&await T())},fe=async l=>{S.value=!1;const e=[...f.value];f.value=f.value.filter(r=>r.order_id!==l);try{await O.put(`${M}/reject_order_pay/${l}`,{responsible_id:L.rawUserData.id}),U.add({severity:"success",summary:"Archivado",detail:`Pago de la orden ${l} archivado`,life:2500}),(y.value==="archived"||R.value.length)&&await Q()}catch{f.value=e,U.add({severity:"error",summary:"Error",detail:"No se pudo archivar el pago. Intenta de nuevo.",life:3500})}finally{T()}},be=async(l,e,r)=>{const c={authorized:l,responsible_id:L.rawUserData.id,responsible_observation:g.value.reason||"sin observaciones"};await w.resolveCancellationRequest(e,c),I.value=!1,A.value=!1,K.value=await J.revisar()};return(l,e)=>{const r=d("Button"),c=d("Dialog"),_e=d("Textarea"),E=d("Checkbox"),ge=d("InputText"),he=d("ProgressSpinner"),m=d("Column"),Z=d("DataTable"),we=d("Calendar"),xe=d("calendar"),Ce=d("MultiSelect");return x(),le("div",ze,[s(c,{visible:S.value,"onUpdate:visible":e[2]||(e[2]=a=>S.value=a),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:n(()=>[Ee]),default:n(()=>[t("form",{onSubmit:e[1]||(e[1]=N(a=>fe(z.value.order_id),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column"}},[t("p",null,[u(" ¿Seguro que deseas archivar el pago de la orden "),t("b",null,b(z.value.order_id),1),u("? Esta acción no intentará cobrar al cliente. ")]),t("div",Oe,[s(r,{type:"button",label:"Cancelar",class:"w-full p-button-secondary",onClick:e[0]||(e[0]=a=>S.value=!1)}),s(r,{type:"submit",label:"Archivar",class:"w-full p-button-danger"})])],32)]),_:1},8,["visible"]),Me,s(c,{visible:A.value,"onUpdate:visible":e[5]||(e[5]=a=>A.value=a),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:n(()=>[Ne]),default:n(()=>[t("form",{onSubmit:e[4]||(e[4]=N(a=>be(!1,g.value.id,g.value.reason),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[s(_e,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:g.value.reason,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value.reason=a),rows:"5",placeholder:"Porque desea rechazar esta solicitud?"},null,8,["modelValue"]),s(r,{style:{width:"100%","border-radius":".5rem"},label:"Rechazar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),s(c,{visible:I.value,"onUpdate:visible":e[7]||(e[7]=a=>I.value=a),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:n(()=>[Be]),default:n(()=>[t("form",{onSubmit:e[6]||(e[6]=N(a=>pe(g.value.order_id),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[s(r,{style:{width:"100%","border-radius":".5rem"},label:"Aprobar (usuario contactado)",type:"submit",class:"p-button-success"})],32)]),_:1},8,["visible"]),t("div",je,[t("div",Fe,[s(r,{label:"Pendientes",class:oe(["task-btn",y.value==="pending"?"task-btn--active":"p-button-outlined"]),onClick:e[8]||(e[8]=a=>Y("pending"))},null,8,["class"]),s(r,{label:"Archivados",class:oe(["task-btn",y.value==="archived"?"task-btn--active":"p-button-outlined"]),onClick:e[9]||(e[9]=a=>Y("archived"))},null,8,["class"])]),t("div",He,[t("div",{style:ne(`transform:translateX(${X.value.slide}%)`),class:"slider-item"},[s(Z,{loading:P.value,paginator:!0,rows:15,filters:h.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Transferencias",rowsPerPageOptions:[5,10,25,100],scrollable:"",scrollHeight:"65vh",stripedRows:"","onUpdate:filters":e[14]||(e[14]=a=>h.value=a),class:"col-12 m-auto",value:y.value==="pending"?ie.value:de.value,tableStyle:"min-width: 50rem;"},{header:n(()=>[t("div",Ge,[t("div",Xe,[t("div",null,[s(E,{modelValue:i.value.colombia,"onUpdate:modelValue":e[10]||(e[10]=a=>i.value.colombia=a),binary:!0},null,8,["modelValue"]),u(" Tiendas Colombia")]),t("div",null,[s(E,{modelValue:i.value.usa,"onUpdate:modelValue":e[11]||(e[11]=a=>i.value.usa=a),binary:!0},null,8,["modelValue"]),u(" Tiendas Usa")]),t("div",null,[s(E,{modelValue:i.value.distri,"onUpdate:modelValue":e[12]||(e[12]=a=>i.value.distri=a),binary:!0},null,8,["modelValue"]),u(" Distrimonster")])]),t("span",We,[Je,s(ge,{modelValue:h.value.global.value,"onUpdate:modelValue":e[13]||(e[13]=a=>h.value.global.value=a),placeholder:"Buscar Solicitud..."},null,8,["modelValue"])])])]),loading:n(()=>[s(he,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".2s","aria-label":"Custom ProgressSpinner"})]),default:n(()=>[s(m,{style:{"min-width":"max-content"},class:"py-1",field:"order_id",header:"ID orden",frozen:""}),s(m,{class:"py-1",field:"total_order_price",header:"Monto de la orden"},{body:n(a=>[u(b(v(Le)(a.data.total_order_price)||"$ 0"),1)]),_:1}),s(m,{class:"py-1",field:"hora",header:"Hora"},{body:n(a=>[u(b(v(Ae)(a.data.latest_status_timestamp)),1)]),_:1}),s(m,{class:"py-1",field:"delivery_price",header:"Domicilio"},{body:n(a=>{var p,V;return[u(b(v(re)((V=(p=a.data.pe_json)==null?void 0:p.delivery)==null?void 0:V.delivery_costoenvio)),1)]}),_:1}),s(m,{class:"py-1",field:"Total",header:"Total"},{body:n(a=>{var p,V;return[u(b(v(re)((((V=(p=a.data.pe_json)==null?void 0:p.delivery)==null?void 0:V.delivery_costoenvio)||0)+(a.data.total_order_price||0))),1)]}),_:1}),s(m,{class:"py-1",field:"user_name",header:"Cliente"}),s(m,{class:"py-1",field:"user_phone",header:"Telefono cliente"}),s(m,{class:"py-1 px-0",field:"date",header:"Action",frozen:"",alignFrozen:"right"},{body:n(a=>[t("div",Ke,[v(k).params.request_status!="aprobadas"?(x(),$(r,{key:0,onClick:p=>ce(a.data),style:{height:"1.8rem",width:"2rem"},severity:"info",class:"p-1",icon:"pi pi-eye"},null,8,["onClick"])):B("",!0),v(k).params.request_status!="aprobadas"?(x(),$(r,{key:1,onClick:p=>ve(a.data),style:{height:"1.8rem","min-width":"max-content"},label:"Cop. Link",severity:"help",class:"py-1",icon:"pi pi-copy"},null,8,["onClick"])):B("",!0),v(k).params.request_status!="aprobadas"&&y.value==="pending"?(x(),$(r,{key:2,onClick:p=>ye(a.data),style:{height:"1.8rem",width:"2rem"},severity:"danger",class:"p-1",icon:"pi pi-trash"},null,8,["onClick"])):B("",!0)])]),_:1})]),_:1},8,["loading","filters","value"])],4),t("div",{style:ne(`transform:translateX(${X.value.slide}%)`),class:"slider-item"},[s(Z,{paginator:!0,rows:15,style:{width:"100%"},paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Transferencias",rowsPerPageOptions:[5,10,25,100],scrollable:"",showGridlines:"",stripedRows:"",class:"col-12 p-2",value:me.value,tableStyle:"min-width:50rem;",filters:h.value},{header:n(()=>[t("div",Qe,[t("h4",Ye,[Ze,t("b",ea,[u("Pedidos pendientes "),t("b",null,b(v(k).params.section),1)])]),s(we,{modelValue:_.value.start_date,"onUpdate:modelValue":e[15]||(e[15]=a=>_.value.start_date=a)},null,8,["modelValue"]),s(xe,{modelValue:_.value.end_date,"onUpdate:modelValue":e[16]||(e[16]=a=>_.value.end_date=a)},null,8,["modelValue"]),s(Ce,{style:{"max-width":"30rem"},modelValue:_.value.sites,"onUpdate:modelValue":e[17]||(e[17]=a=>_.value.sites=a),optionLabel:"site_name",options:G.value.filter(a=>a.show_on_web)},null,8,["modelValue","options"]),s(r,{severity:"help",onClick:l.update,label:"Buscar",icon:"pi pi-search"},null,8,["onClick"])])]),default:n(()=>[(x(!0),le(Re,null,Ie(ue.value,a=>(x(),$(m,{class:"py-1",style:{"text-transform":"uppercase"},key:a,header:a},{body:n(p=>[t("h6",aa,b(p.data[a]),1)]),_:2},1032,["header"]))),128))]),_:1},8,["value","filters"])],4)])]),s(qe)])}}},da=Pe(ta,[["__scopeId","data-v-0bf7290c"]]);export{da as default};
