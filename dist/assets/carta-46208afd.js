import{_ as re,G as oe,j as l,I as ne,k as se,H as ie,m as P,U as _,r as S,o as p,c as v,a as i,t as le,u as L,e as c,f as $,F as R,b as z,i as O,d as j,N as g,q as ce,x as ue,ab as B}from"./index-870d583b.js";import{p as de}from"./ProductService-081b45f3.js";import"./site-9b71f333.js";const M=h=>(ce("data-v-68e7c564"),h=h(),ue(),h),pe={style:{padding:"3rem"}},ve={style:{"text-transform":"capitalize"}},fe=M(()=>i("p",null," Arrastra y suelta tus imágenes aquí o haz clic para seleccionarlas. ",-1)),ge={key:0,class:"preview-container"},me=["src"],_e={key:1,style:{position:"absolute",left:"0",top:"0",width:"100%",display:"flex","justify-content":"center","align-items":"center",height:"100%","background-color":"#ffffff80"}},he={class:"col-12 p-0 m-0"},ye={class:"draggable-container"},De=["onDragstart","onDragenter","onDrop"],be=["src","alt"],we=M(()=>i("div",{class:"confirmation-content"},[i("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"2rem",color:"#ff9800"}}),i("span",{class:"message"}," ¿Estás seguro de que deseas eliminar esta imagen? ")],-1)),xe={class:"dialog-footer"},Ie={__name:"carta",setup(h){const y=oe(),s=l([]),D=l(-1),b=l(-1),w=l(!1),m=l(null),x=l(!1),k=l(!1),u=l([]),d=l([]),F=l(null),I=l(!1),E=ne(()=>s.value.slice().sort((e,a)=>e.index-a.index));se(async()=>{await U()}),ie(()=>y.params.carta_id,async()=>{await U()});async function U(){try{const e=y.params.carta_id,a=await P.get(`${_}/carta/${e}`);s.value=a.map((t,r)=>({...t,id:t.id??Date.now()+Math.random(),index:t.index??r,src:t.img_identifier,title:t.title??"Sin título"}))}catch(e){console.error("Error al obtener cartas:",e)}}async function N(e){return await P.post(`${_}/carta/`,e)}async function q(e){return(await B.post(`${_}/carta/reorder`,e)).data}async function T(e){return(await B.delete(`${_}/carta/${e}`)).data}function V(e){D.value=e}function G(e){b.value=e}function H(){b.value=-1}async function W(e){if(e===D.value)return;const a=E.value[D.value],t=s.value.findIndex(r=>r.id===a.id);s.value.splice(t,1),s.value.splice(e,0,a),s.value.forEach((r,o)=>{r.index=o}),D.value=-1,b.value=-1;try{const r=s.value.map(o=>({id:o.id,index:o.index,img_identifier:o.src}));await q(r)}catch(r){console.error("Error al reordenar cartas:",r)}}function J(e){m.value=e,w.value=!0}function A(){w.value=!1,m.value=null}async function K(){if(m.value){try{await T(m.value.id);const e=s.value.findIndex(a=>a.id===m.value.id);e!==-1&&(s.value.splice(e,1),s.value.forEach((a,t)=>{a.index=t}))}catch(e){console.error("Error al eliminar carta:",e)}A()}}function Q(){x.value=!0}function X(){F.value.click()}function Y(e){const a=e.target.files;if(!a||a.length===0)return;const t=Array.from(a);u.value=u.value.concat(t);const r=t.map(o=>URL.createObjectURL(o));d.value=d.value.concat(r),e.target.value=""}function Z(){I.value=!0}function ee(){I.value=!1}function ae(e){I.value=!1;const a=e.dataTransfer.files;if(!a||a.length===0)return;const t=Array.from(a);u.value=u.value.concat(t);const r=t.map(o=>URL.createObjectURL(o));d.value=d.value.concat(r)}async function te(){if(u.value.length===0){alert("Por favor selecciona al menos una imagen.");return}k.value=!0;try{for(const e of u.value){const a=new FormData;a.append("file",e);const t=await de.uploadPhoto(a),{image_identifier:r}=t,o={index:s.value.length,img_identifier:r,carta_id:y.params.carta_id},n=await N(o);s.value.push({id:n.id??Date.now()+Math.random(),index:n.index??s.value.length-1,src:n.img_identifier,title:e.name})}u.value=[],d.value=[],x.value=!1}catch(e){console.error("Error al subir las imágenes o crear cartas:",e),alert("Hubo un error al subir las imágenes.")}finally{k.value=!1,location.reload()}}return(e,a)=>{const t=S("Button"),r=S("ProgressSpinner"),o=S("Dialog");return p(),v("div",pe,[i("h2",ve,[i("b",null,le(L(y).params.carta_name),1)]),c(t,{style:{margin:"1rem 0","background-color":"var(--primary-color)",border:"none"},label:"Agregar Imágenes",icon:"pi pi-upload",severity:"help",onClick:Q}),c(o,{header:"Agregar Imágenes",visible:x.value,"onUpdate:visible":a[0]||(a[0]=n=>x.value=n),modal:"",style:{width:"40rem"}},{footer:$(()=>[i("div",he,[c(t,{onClick:te,severity:"help",label:"Guardar"})])]),default:$(()=>[i("div",{class:j(["drop-zone",{"drag-over-zone":I.value}]),onDragover:g(Z,["prevent"]),onDragleave:g(ee,["prevent"]),onDrop:g(ae,["prevent"]),onClick:X},[fe,d.value.length>0?(p(),v("div",ge,[(p(!0),v(R,null,z(d.value,(n,f)=>(p(),v("div",{key:f,class:"preview-item"},[i("img",{src:n,alt:"Preview",style:{width:"100%","object-fit":"contain","border-radius":"0.2rem"}},null,8,me)]))),128))])):O("",!0),i("input",{type:"file",ref_key:"fileInput",ref:F,onChange:Y,style:{display:"none"},multiple:"",accept:"image/*"},null,544),k.value?(p(),v("div",_e,[c(r,{strokeWidth:"8",style:{color:"white"}})])):O("",!0)],34)]),_:1},8,["visible"]),i("div",ye,[(p(!0),v(R,null,z(E.value,(n,f)=>(p(),v("div",{key:n.id,class:j(["draggable-item",{"drag-over":b.value===f}]),draggable:"true",onDragstart:C=>V(f),onDragenter:g(C=>G(f),["prevent"]),onDragover:a[1]||(a[1]=g(()=>{},["prevent"])),onDragleave:H,onDrop:C=>W(f)},[i("img",{src:`${L(_)}/read-photo-product/${n.src}/300`,alt:n.title},null,8,be),c(t,{style:{"border-radius":"50%",position:"absolute","background-color":"var(--primary-color)",border:"3px solid","aspect-ratio":"1 / 1",right:"-1.5rem",top:"-1.5rem"},icon:"pi pi-times",severity:"info",class:"delete-button",onClick:g(C=>J(n),["stop"])},null,8,["onClick"])],42,De))),128)),c(o,{header:"Confirmar Eliminación",visible:w.value,"onUpdate:visible":a[2]||(a[2]=n=>w.value=n),modal:"",closable:!1,style:{width:"350px"}},{default:$(()=>[we,i("div",xe,[c(t,{label:"Sí, eliminar",icon:"pi pi-check",class:"p-button-danger",onClick:K}),c(t,{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:A})])]),_:1},8,["visible"])])])}}},$e=re(Ie,[["__scopeId","data-v-68e7c564"]]);export{$e as default};
