import{_ as se,h as i,Z as oe,I as D,i as ne,j as x,U as ie,D as Y,o as h,c as b,a as o,f as t,u as s,e as y,$ as w,a0 as T,a1 as V,a2 as F,q as A,t as I,a3 as p,a4 as ue,a5 as de,F as P,r as G,k as re,a6 as ce,a7 as me,p as pe,m as ve,H as S}from"./index-ef292654.js";const f=U=>(pe("data-v-d5516bd3"),U=U(),ve(),U),ye={class:"p-4",style:{"max-width":"70rem",width:"100%",margin:"auto","background-color":"white","border-radius":"1rem",transition:"all .3s ease"}},fe={style:{height:"100%"}},_e={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",style:{"align-items":"center"}},ge=f(()=>o("h2",{class:"text-2xl font-bold whitespace-nowrap m-0 p-0",style:{"min-width":"max-content"}},"Plantillas de WhatsApp",-1)),he={class:"p-input-icon-left w-full md:w-80 my-3",style:{height:"100%"}},be=f(()=>o("i",{class:"pi pi-search"},null,-1)),xe={class:"flex gap-2"},we={style:{display:"flex",width:"100%","justify-content":"end","margin-top":"1rem"}},Ve={class:"space-y-4"},Ue={class:"md:grid-cols-2 gap-3"},Ce={class:"field"},Ee=f(()=>o("label",{class:"font-medium"},"Nombre",-1)),$e={class:"field"},Te=f(()=>o("label",{class:"font-medium"},"Categoría",-1)),Ie={class:"field"},Se=f(()=>o("label",{class:"font-medium"},"Idioma",-1)),Ne={class:"font-medium"},ke={class:"opacity-70"},Le={key:0,class:"",style:{display:"flex","flex-direction":"column",gap:"1rem","justify-content":"center"}},Re=f(()=>o("h5",{class:"font-medium m-0 p-0 py-3"},"Ejemplos de variables",-1)),Oe={class:"space-y-2"},je={class:"flex items-center my-4",style:{"align-items":"center",gap:"1rem"}},Ae=f(()=>o("h5",{class:"m-0"},"Botones",-1)),Be={style:{display:"flex","flex-direction":"column",gap:"1rem","max-width":"100%",overflow:"hidden"}},De={__name:"templates",setup(U){const N=i([]),k=i(!1),C=i(""),_=i(!1),L=i(!1),E=i(null),R=i([]),c=i({name:"",category:"UTILITY",language:"es_ES"}),g=i(""),v=i([]),u=i({}),K=i(null),m=i({}),M=oe(),H=[{label:"AUTHENTICATION",value:"AUTHENTICATION"},{label:"MARKETING",value:"MARKETING"},{label:"UTILITY",value:"UTILITY"}],q=[{label:"Español (CO)",value:"es_CO"},{label:"Español (ES)",value:"es_ES"},{label:"English (US)",value:"en_US"}],Q=[{label:"URL",value:"URL"},{label:"QUICK_REPLY",value:"QUICK_REPLY"}],z=D(()=>{if(!C.value)return N.value;const l=C.value.toLowerCase();return N.value.filter(a=>`${a.name} ${a.category}`.toLowerCase().includes(l))});ne(async()=>{var l;R.value=await x.get(`${ie}/restaurants`),m.value=((l=R.value[0])==null?void 0:l.waba_id)||null,m.value});const $=i([]);Y(g,l=>{const a=Array.from(new Set((l.match(/{{\s*([^{}\s]+)\s*}}/g)||[]).map(e=>e.replace(/{{|}}/g,"").trim())));$.value=a,u.value=Object.fromEntries(Object.entries(u.value).filter(([e])=>a.includes(e))),a.forEach(e=>{e in u.value||(u.value[e]="")})});async function O(){k.value=!0;try{N.value=await x.get(`${S}/wabas/${m.value}/templates/`)}finally{k.value=!1}}Y(m,async l=>{l&&O()});function J(l){return{APPROVED:"success",PENDING:"warning",REJECTED:"danger"}[l]||"info"}function W(){c.value={name:"",category:"UTILITY",language:"es_ES"},g.value="",v.value=[],u.value={},E.value=null}function Z(){W(),_.value=!0}const X=D(()=>K.value?"Editar plantilla":"Nueva plantilla");function ee(l){var n,d;E.value=l.id,c.value={name:l.name,category:l.category,language:l.language};const a=l.components.find(r=>r.type==="BODY")||{text:""};g.value=a.text,u.value={},(n=a.example)!=null&&n.body_text_named_params?a.example.body_text_named_params.forEach(({param_name:r,example:j})=>{u.value[r]=j}):(d=a.example)!=null&&d.body_text&&a.example.body_text[0].forEach((r,j)=>{u.value[String(j+1)]=r});const e=l.components.find(r=>r.type==="BUTTONS")||{buttons:[]};v.value=e.buttons.map(r=>({type:r.type,text:r.text,url:r.url||""})),_.value=!0}function ae(){v.value.push({type:"URL",text:"",url:""})}function le(){const l=$.value;return l.length?l.every(e=>/^\d+$/.test(e))?{body_text:[l.sort((n,d)=>+n-+d).map(n=>u.value[n]||"")]}:{body_text_named_params:l.map(e=>({param_name:e,example:u.value[e]||""}))}:void 0}async function te(){if(c.value.name.trim()){L.value=!0;try{const l=le(),a=[{type:"BODY",data:{text:g.value,...l?{example:l}:{}}},...v.value.length?[{type:"BUTTONS",data:{buttons:v.value}}]:[]],e={...c.value,components:a};E.value?await x.post(`${S}/wabas/${m.value}/templates/${E.value}`,e):await x.post(`${S}/wabas/${m.value}/templates`,e),await O(),_.value=!1}finally{L.value=!1}}}function B(l){M.require({message:`¿Eliminar la plantilla "${l.name}"?`,header:"Confirmar eliminación",icon:"pi pi-exclamation-triangle",acceptLabel:"Sí",rejectLabel:"No",accept:async()=>{await x.delete(`${S}/wabas/${m.value}/templates/${l.name}`),await O()}})}return(l,a)=>(h(),b("div",ye,[o("div",fe,[o("div",_e,[ge,o("span",he,[be,t(s(w),{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),modelModifiers:{trim:!0},placeholder:"Buscar…",class:"w-full"},null,8,["modelValue"])]),t(s(T),{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),options:R.value.filter(e=>e.exist),optionLabel:"name",optionValue:"waba_id",placeholder:"Selecciona un restaurante",class:"w-full md:w-80 my-3"},null,8,["modelValue","options"])]),t(s(ue),{value:z.value,dataKey:"id",paginator:"",rows:10,responsiveLayout:"scroll",loading:k.value,globalFilterFields:["name","category"],class:"shadow-md rounded-xl overflow-hidden"},{default:y(()=>[t(s(V),{class:"my-1 py-1",field:"name",header:"Nombre",bodyClass:"font-medium"}),t(s(V),{class:"my-1 py-1",field:"category",header:"Categoría"}),t(s(V),{class:"my-1 py-1",field:"language",header:"Idioma"}),t(s(V),{class:"my-1 py-1",header:"Estado"},{body:y(({data:e})=>[t(s(F),{severity:J(e.status)},{default:y(()=>[A(I(e.status),1)]),_:2},1032,["severity"])]),_:1}),t(s(V),{class:"my-1 py-1",headerStyle:"width:8rem",header:"Acciones"},{body:y(({data:e})=>[o("div",xe,[t(s(p),{icon:"pi pi-eye",rounded:"",text:"",severity:"secondary",onClick:n=>ee(e)},null,8,["onClick"]),t(s(p),{icon:"pi pi-trash",rounded:"",text:"",severity:"danger",onClick:n=>B(e)},null,8,["onClick"]),t(s(p),{icon:"pi pi-sync",label:"Difundir",severity:"danger",onClick:n=>B(e)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"]),o("div",we,[t(s(p),{label:"Nueva plantilla",icon:"pi pi-plus",severity:"help",class:"w-full md:w-auto",onClick:Z})]),t(s(ce),{visible:_.value,"onUpdate:visible":a[7]||(a[7]=e=>_.value=e),header:X.value,modal:"",class:"",style:{width:"90vw","max-width":"60rem","min-width":"50rem"}},{footer:y(()=>[t(s(p),{label:"Cancelar",text:"",severity:"secondary",onClick:a[6]||(a[6]=e=>_.value=!1)}),t(s(p),{label:"Guardar",severity:"help",icon:"pi pi-check",onClick:te,loading:L.value,autofocus:""},null,8,["loading"])]),default:y(()=>[o("div",Ve,[o("div",Ue,[o("div",Ce,[Ee,t(s(w),{modelValue:c.value.name,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value.name=e),class:"w-full"},null,8,["modelValue"])]),o("div",$e,[Te,t(s(T),{modelValue:c.value.category,"onUpdate:modelValue":a[3]||(a[3]=e=>c.value.category=e),options:H,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),o("div",Ie,[Se,t(s(T),{modelValue:c.value.language,"onUpdate:modelValue":a[4]||(a[4]=e=>c.value.language=e),options:q,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),o("div",null,[o("h6",Ne,[A("Cuerpo del mensaje "),o("small",ke,"(usa "+I(l.param)+" o "+I(1)+")",1)]),t(s(de),{"auto-resize":"",modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=e=>g.value=e),rows:"6",class:"w-full"},null,8,["modelValue"])]),$.value.length?(h(),b("div",Le,[Re,(h(!0),b(P,null,G($.value,e=>(h(),b("div",{key:e,style:{"align-items":"center",display:"flex",gap:"1rem"},class:""},[t(s(F),{severity:"info",style:{padding:"0 1rem",height:"2.8rem","min-width":"2.8rem"},class:"min-w-[5rem] text-center text-xl"},{default:y(()=>[A(I(e),1)]),_:2},1024),t(s(w),{modelValue:u.value[e],"onUpdate:modelValue":n=>u.value[e]=n,placeholder:`Ejemplo para ${e}`,class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])):re("",!0),o("div",Oe,[o("div",je,[Ae,t(s(p),{icon:"pi pi-plus",severity:"success",onClick:ae})]),o("div",Be,[(h(!0),b(P,null,G(v.value,(e,n)=>(h(),b("div",{key:n,class:"",style:{display:"grid","grid-template-columns":"10rem  1fr 1fr 3rem",gap:".5rem"}},[t(s(T),{modelValue:e.type,"onUpdate:modelValue":d=>e.type=d,options:Q,optionLabel:"label",optionValue:"value"},null,8,["modelValue","onUpdate:modelValue"]),t(s(w),{modelValue:e.text,"onUpdate:modelValue":d=>e.text=d,placeholder:"Texto"},null,8,["modelValue","onUpdate:modelValue"]),t(s(w),{modelValue:e.url,"onUpdate:modelValue":d=>e.url=d,placeholder:"URL"},null,8,["modelValue","onUpdate:modelValue"]),t(s(p),{icon:"pi pi-times",severity:"danger",onClick:d=>v.value.splice(n,1)},null,8,["onClick"])]))),128))])])])]),_:1},8,["visible","header"]),t(s(me))])]))}},Fe=se(De,[["__scopeId","data-v-d5516bd3"]]);export{Fe as default};
