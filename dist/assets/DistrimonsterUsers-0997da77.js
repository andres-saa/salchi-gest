import{_ as K,j as m,G as O,k as Q,o,c as p,e as n,f as d,u as s,a as i,g as u,i as b,F as W,m as U,U as V,h as j,t as _,$ as v,a3 as S,ae as F,a0 as c,a4 as y,cp as X,a1 as Y,a2 as Z,p as P,q as ee}from"./index-282fd2e4.js";const I=w=>(P("data-v-ae838ec4"),w=w(),ee(),w),ae={class:"p-3"},se={class:"flex justify-content-end gap-2 mt-4"},te={style:{display:"flex","justify-content":"center","align-items":"center","flex-direction":"column",width:"100%"}},le=I(()=>i("h3",null,[i("b",null,"Melo")],-1)),ne=I(()=>i("i",{class:"pi pi-check text-7xl",style:{"font-weight":"bold",color:"green"}},null,-1)),ie={class:"p-3"},oe={class:"field"},re=I(()=>i("label",{for:"descuentoMayor"},[i("b",null,"Descuento para Precio Mayor (%)")],-1)),de={class:"field mt-3"},ue=I(()=>i("label",{for:"descuentoDistribuidor"},[i("b",null,"Descuento para Precio Distribuidor (%)")],-1)),ce={class:"flex justify-content-end gap-2 mt-4"},me={style:{"margin-top":"3rem","max-width":"1920px",margin:"5rem auto"},class:"px-3"},_e=I(()=>i("h1",null,[i("strong",null,"Usuarios Distrimonster")],-1)),ve={key:1,class:"m-0 p-0"},pe={key:1,class:"m-0 p-0"},he={key:1,class:"m-0 p-0"},ye={key:1,class:"m-0 p-0"},fe={key:1,class:"m-0 p-0"},be={key:1,class:"m-0 p-0"},ge={class:"m-0 p-0"},ke={key:1,class:"m-0 p-0"},xe={style:{color:"white"},class:"m-0 p-0"},Ce={style:{display:"flex",gap:"1rem","justify-content":"end",margin:"1rem 0"}},De={__name:"DistrimonsterUsers",setup(w){const g=m(!1),k=m(!1),x=m(0),C=m(0),f=m([]),E=m([]),r=m(!1),N=m({unit_measures:[],presentation_measures:[]}),D=m(!1),M=m(null),$=async()=>{try{const t=await U.get(`${V}/users-distri`);f.value=t.map(a=>({...a,changed:!1})),E.value=t.map(a=>({...a}))}catch(t){console.error("Error al actualizar los datos:",t)}try{const t=await U.get(`${V}/distrimonster-measures/`);N.value=t}catch(t){console.error("Error al actualizar los datos (measures):",t)}},B=()=>{r.value=!0},T=()=>{r.value=!1,$()},h=(t,a,e)=>{a[e]=t.target.value,z(a)},z=t=>{const a=E.value.find(l=>l.user_id===t.user_id);if(!a){t.changed=!0;return}const e=t.cedula_nit!==a.cedula_nit||t.user_name!==a.user_name||t.second_name!==a.second_name||t.first_last_name!==a.first_last_name||t.second_last_name!==a.second_last_name||t.user_phone!==a.user_phone||t.email!==a.email||t.visible!==a.visible;t.changed=e},R=O(()=>f.value.some(t=>t.changed)),q=async()=>{const t=f.value.filter(e=>e.changed);if(!t.length)return;const a={users:t.map(e=>({user_id:e.user_id,user_name:e.user_name,user_phone:e.user_phone,cedula_nit:e.cedula_nit,email:e.email,first_last_name:e.first_last_name,second_last_name:e.second_last_name,second_name:e.second_name,visible:e.visible}))};try{await U.put(`${V}/update-users`,a),g.value=!0,r.value=!1,$()}catch(e){console.error("Error al actualizar usuarios:",e)}},A=t=>{M.value=t,D.value=!0},G=async()=>{try{await U.put(`${V}/delete-user-by-id/${M.value.user_id}`),D.value=!1,g.value=!0,$()}catch(t){console.error("Error al borrar el usuario:",t)}},H=()=>{const t=parseInt(x.value,10)||0,a=parseInt(C.value,10)||0;f.value=f.value.map(e=>{const l=e.minor*(1-t/100),J=e.minor*(1-a/100);return{...e,mayor:parseFloat(l.toFixed(0)),distribuidor:parseFloat(J.toFixed(0)),changed:!0}}),k.value=!1,x.value=0,C.value=0},L=()=>{k.value=!1,x.value=0,C.value=0};return Q(async()=>{await $()}),(t,a)=>(o(),p(W,null,[n(s(S),{visible:D.value,"onUpdate:visible":a[1]||(a[1]=e=>D.value=e),modal:"",closable:!1,header:"Eliminar usuario",style:{width:"30rem"}},{default:d(()=>{var e;return[i("div",ae,[i("h6",null,[j(" ¿Estás seguro de que deseas eliminar a "),i("b",null,_((e=M.value)==null?void 0:e.user_name),1),j("? ")]),i("div",se,[n(s(v),{label:"Cancelar",severity:"help",onClick:a[0]||(a[0]=l=>D.value=!1)}),n(s(v),{label:"Sí, eliminar",severity:"danger",onClick:G})])])]}),_:1},8,["visible"]),n(s(S),{visible:g.value,"onUpdate:visible":a[3]||(a[3]=e=>g.value=e),modal:"",closable:!1,style:{display:"flex","justify-content":"center",width:"10rem"}},{default:d(()=>[i("div",te,[le,ne,n(s(v),{onClick:a[2]||(a[2]=e=>g.value=!1),icon:"pi pi-times",style:{position:"absolute","aspect-ratio":"1/1","border-radius":"50%",right:"-1.5rem",top:"-1.5rem"},severity:"danger"})])]),_:1},8,["visible"]),n(s(S),{visible:k.value,"onUpdate:visible":a[6]||(a[6]=e=>k.value=e),modal:"",header:"Modificar precios masivamente",closable:!0,style:{width:"20rem"}},{default:d(()=>[i("div",ie,[i("div",oe,[re,n(s(F),{inputStyle:{width:"100%",height:"2rem",borderRadius:"0"},id:"descuentoMayor",modelValue:x.value,"onUpdate:modelValue":a[4]||(a[4]=e=>x.value=e),mode:"decimal",min:0,max:100,step:.1,class:"w-full"},null,8,["modelValue"])]),i("div",de,[ue,n(s(F),{inputStyle:{width:"100%",height:"2rem",borderRadius:"0"},id:"descuentoDistribuidor",modelValue:C.value,"onUpdate:modelValue":a[5]||(a[5]=e=>C.value=e),mode:"decimal",min:0,max:100,step:.1,class:"w-full"},null,8,["modelValue"])]),i("div",ce,[n(s(v),{label:"Cancelar",severity:"danger",onClick:L}),n(s(v),{label:"Aplicar",severity:"success",onClick:H})])])]),_:1},8,["visible"]),i("div",me,[_e,n(s(Z),{scrollable:"",scrollHeight:"70vh",value:f.value,class:"shadow-1 py-3 px-2"},{default:d(()=>[n(s(c),{frozen:"","align-frozen":"left",header:"Cedula / Nit",class:"m-0 py-2"},{body:d(e=>[r.value?(o(),u(s(y),{key:0,"model-value":e.data.cedula_nit,onInput:l=>h(l,e.data,"cedula_nit"),style:{height:"2rem",width:"8rem"}},null,8,["model-value","onInput"])):(o(),p("h6",ve,_(e.data.cedula_nit),1))]),_:1}),n(s(c),{header:"Primer nombre",class:"m-0 py-0"},{body:d(e=>[r.value?(o(),u(s(y),{key:0,"model-value":e.data.user_name,onInput:l=>h(l,e.data,"user_name"),style:{height:"2rem",width:"10rem"}},null,8,["model-value","onInput"])):(o(),p("h6",pe,_(e.data.user_name||"----"),1))]),_:1}),n(s(c),{header:"Segundo nombre",class:"m-0 py-0"},{body:d(e=>[r.value?(o(),u(s(y),{key:0,"model-value":e.data.second_name,onInput:l=>h(l,e.data,"second_name"),style:{height:"2rem",width:"10rem"}},null,8,["model-value","onInput"])):(o(),p("h6",he,_(e.data.second_name||"----"),1))]),_:1}),n(s(c),{header:"Primer apellido",class:"m-0 py-0"},{body:d(e=>[r.value?(o(),u(s(y),{key:0,"model-value":e.data.first_last_name,onInput:l=>h(l,e.data,"first_last_name"),style:{height:"2rem",width:"10rem"}},null,8,["model-value","onInput"])):(o(),p("h6",ye,_(e.data.first_last_name||"----"),1))]),_:1}),n(s(c),{header:"Segundo apellido",class:"m-0 py-0"},{body:d(e=>[r.value?(o(),u(s(y),{key:0,"model-value":e.data.second_last_name,onInput:l=>h(l,e.data,"second_last_name"),style:{height:"2rem",width:"10rem"}},null,8,["model-value","onInput"])):(o(),p("h6",fe,_(e.data.second_last_name||"----"),1))]),_:1}),n(s(c),{header:"Telefono",class:"m-0 py-0"},{body:d(e=>[r.value?(o(),u(s(y),{key:0,"model-value":e.data.user_phone,onInput:l=>h(l,e.data,"user_phone"),style:{height:"2rem",width:"10rem"}},null,8,["model-value","onInput"])):(o(),p("h6",be,_(e.data.user_phone||"----"),1))]),_:1}),n(s(c),{header:"Direccion",class:"m-0 py-0",style:{"min-width":"20rem","text-transform":"capitalize"}},{body:d(e=>{var l;return[i("h6",ge,_(((l=e.data.user_address)==null?void 0:l.toLowerCase())||"----"),1)]}),_:1}),n(s(c),{header:"Correo",class:"m-0 py-0"},{body:d(e=>[r.value?(o(),u(s(y),{key:0,type:"email","model-value":e.data.email,onInput:l=>h(l,e.data,"email"),style:{height:"2rem",width:"20rem"}},null,8,["model-value","onInput"])):(o(),p("h6",ke,_(e.data.email||"----"),1))]),_:1}),r.value?(o(),u(s(c),{key:0,header:"Visible?",class:"m-0 py-0"},{body:d(e=>[n(s(X),{modelValue:e.data.visible,"onUpdate:modelValue":l=>e.data.visible=l,onChange:l=>z(e.data)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):b("",!0),n(s(c),{header:"Tipo",class:"m-0 py-0"},{body:d(e=>[n(s(Y),{severity:e.data.old?"success":"warning",style:{color:"white","border-radius":"0.2rem"}},{default:d(()=>[i("h6",xe,_(e.data.old?"viejo":"Nuevo"),1)]),_:2},1032,["severity"])]),_:1}),r.value?b("",!0):(o(),u(s(c),{key:1,frozen:"",alignFrozen:"right",header:"Action",class:"m-0 py-0"},{body:d(e=>[n(s(v),{severity:"danger",style:{height:"2rem","border-radius":"0.2rem"},icon:"pi pi-trash",onClick:l=>A(e.data)},null,8,["onClick"])]),_:1}))]),_:1},8,["value"]),i("div",Ce,[r.value&&R.value?(o(),u(s(v),{key:0,onClick:q,severity:"success",label:"Guardar cambios"})):b("",!0),r.value?b("",!0):(o(),u(s(v),{key:1,onClick:B,severity:"info",label:"Editar"})),r.value?(o(),u(s(v),{key:2,onClick:T,severity:"danger",label:"Descartar"})):b("",!0),r.value?(o(),u(s(v),{key:3,onClick:a[7]||(a[7]=e=>k.value=!0),severity:"warning",label:"Modificar Masiva"})):b("",!0)])])],64))}},we=K(De,[["__scopeId","data-v-ae838ec4"]]);export{we as default};
