import{c as V}from"./contestService-5f8dbd8d.js";import{a9 as le,U as j,_ as ie,h as c,l as oe,D as se,G as ne,s as de,i as re,g as m,o as _,c as z,f as i,e as s,a as o,x as ce,u as R,F as ue,r as pe,t as p,d as b,q as w,k as C,b as I,p as ve,m as me}from"./index-c4d0673c.js";import{a as H}from"./formatDate-262296cf.js";const _e={async uploadImage(x,D,y){const h=`${j}/upload-product-image/${D}-${y}`,k=new FormData;k.append("file",x);try{const u=await le.post(h,k,{headers:{"Content-Type":"multipart/form-data"}});u.status===200?console.log("Archivo photo cargado con Ã©xito"):console.error("Error al cargar foto de perfil:",u.status,u.statusText)}catch(u){console.error("Error en la solicitud:",u)}}};const ye=x=>(ve("data-v-1e60bbcb"),x=x(),me(),x),fe={action:"",class:""},ge=["src"],he={class:"field col-12 mt-3 mb-6 p-0",style:{display:"flex","justify-content":"end"}},be={class:"form-container my-2"},we={style:{}},Ce={style:{display:"flex","justify-content":"space-between"}},xe=["for"],Ve={style:{width:"100%"}},De={style:{display:"flex","justify-content":"end"}},ke={class:"container px-0 md:px-3"},Se=ye(()=>o("h1",{class:"m-auto px-4 py-4"},[o("b",null,"Administrador de concursos")],-1)),Te={class:"grid p-2",style:{"align-items":"center",display:"flex",gap:"1rem","justify-content":"end"}},Ue=["src"],Fe={style:{"text-transform":"capitalize","min-width":"max-content"}},Ae={style:{display:"flex","align-items":"center",gap:"0"}},Ie={style:{display:"flex","align-items":"center",gap:"0"}},Pe={__name:"manageContest",setup(x){const D=c(null),y=c(!1);oe();const h=c(!1),k=c([]),u=c(),S=c({}),P=c(null),Q=l=>{const a=l.target.files[0];a&&(console.log("Archivo seleccionado:",a),D.value=a,P.value=URL.createObjectURL(a))},E=c(!1),t=c({}),v=c({dialogAddContestVisible:!1,deleteContestDialogVisible:!1}),J=l=>{h.value=!0;const a={...l};a.evidence_type_id=S.value.evidences.filter(n=>n.id==a.evidence_type_id)[0],a.contest_winner_type_id=S.value.winner_type.filter(n=>n.id==a.contest_winner_type_id)[0],a.is_site_participation=a.is_site_participation?{name:"Sedes",value:!0}:{name:"Colaboradores",value:!1},t.value=a,v.value.dialogAddContestVisible=!0},K=()=>{h.value=!1,t.value={},v.value.dialogAddContestVisible=!0},$=c([{type:"text",field:"name",name:"Nombre"},{type:"textArea",field:"description",name:"Descripcion"},{type:"textArea",field:"instructions",name:"Instrucciones"},{type:"date",field:"start_date",name:"Fecha de inicio"},{type:"date",field:"end_date",name:"Fecha de finalizacion"},{type:"Dropdown",field:"contest_winner_type_id",name:"Forma de ganar",options_name:"winner_type",delicated:!0,options:[],selected:{}},{type:"Dropdown",field:"evidence_type_id",name:"Tipo de evidencia",delicated:!0,options_name:"evidences",options:[],selected:{}},{type:"Dropdown",field:"is_site_participation",name:"Participantes",options_name:"name",options:[{name:"Sedes",value:!0},{name:"Colaboradores",value:!1}],selected:{}}]);se(t,(l,a)=>{var n,f;if(((n=l.contest_winner_type_id)==null?void 0:n.id)!==2){E.value=!1;return}t.value.evidence_type_id=(f=$.value.filter(g=>g.field=="evidence_type_id")[0].options)==null?void 0:f.filter(g=>g.id==4)[0],E.value=!0},{deep:!0});const W=()=>{u.value={global:{value:null,matchMode:ce.CONTAINS}}},X=ne(()=>k.value.map(l=>({...l,formattedStartDate:H(l.start_date),formattedEndDate:H(l.end_date)})));de(()=>{W()});const L=c({}),Y=l=>{L.value=l,v.value.deleteContestDialogVisible=!0,y.value=!1},T=c({}),N=async()=>{const l=await V.getAllContestAll();l.forEach(a=>{T.value[a.id]=a.visible}),k.value=l},Z=async()=>{var n,f,g,U,F,A;if(y.value=!0,!t.value.name||!t.value.start_date||!t.value.end_date||!t.value.description||!((f=(n=t.value)==null?void 0:n.evidence_type_id)!=null&&f.id)||!((g=t.value)!=null&&g.instructions)||!((F=(U=t.value)==null?void 0:U.contest_winner_type_id)!=null&&F.id)||!((A=t.value)!=null&&A.is_site_participation)){alert("debe llenar todos los campos");return}const l={name:t.value.name||"",start_date:t.value.start_date||"",end_date:t.value.end_date||"",description:t.value.description||"",evidence_type_id:t.value.evidence_type_id.id||"",instructions:t.value.instructions||"",contest_winner_type_id:t.value.contest_winner_type_id.id||"",is_site_participation:t.value.is_site_participation.value||!1},a=h.value?await V.updateContest({...l,id:t.value.id}):await V.createContest(l);v.value.dialogAddContestVisible=!1,D.value&&_e.uploadImage(D.value,"contest",a),N()},ee=async l=>{v.value.deleteContestDialogVisible=!1,await V.deleteContest(l),N()};return re(async()=>{S.value=await V.getContestEntryOption(),$.value.forEach(l=>{l.type=="Dropdown"&&l.field!="is_site_participation"?l.options=S.value[l.options_name]:l.options=l.options}),await N()}),(l,a)=>{const n=m("Button"),f=m("Tag"),g=m("InputText"),U=m("Textarea"),F=m("Calendar"),A=m("Dropdown"),B=m("Dialog"),r=m("column"),te=m("InputSwitch"),ae=m("DataTable");return _(),z("div",null,[i(B,{class:"mx-2",header:h.value?"Editar concurso":"Nuevo concurso",style:{width:"30rem"},modal:"",visible:v.value.dialogAddContestVisible,"onUpdate:visible":a[3]||(a[3]=e=>v.value.dialogAddContestVisible=e)},{footer:s(()=>[o("div",Ve,[i(n,{onClick:a[1]||(a[1]=e=>v.value.dialogAddContestVisible=!1),text:"",severity:"danger",label:"Cancelar"}),i(n,{onClick:a[2]||(a[2]=e=>Z()),label:"Guardar",severity:"help"})])]),default:s(()=>[o("form",fe,[o("img",{class:"img-profile-add",style:{width:"100%","object-fit":"contain","border-radius":"0.5rem"},src:P.value?P.value:`${R(j)}/read-product-image/600/contest-${t.value.id}`,alt:""},null,8,ge),o("div",he,[o("input",{ref:"fileInput",type:"file",accept:"image/*",onChange:Q,style:{display:"none"}},null,544),i(n,{icon:"pi pi-camera",severity:"help",class:"",onClick:a[0]||(a[0]=e=>{l.$refs.fileInput.click()})})]),o("div",be,[(_(!0),z(ue,null,pe($.value,e=>(_(),z("div",we,[o("div",Ce,[o("span",{class:"py-0 my-0",for:e.name},p(e.name),9,xe),(t.value[e.field]==null||t.value[e.field]=="")&&y.value?(_(),b(f,{key:0,severity:"danger",class:"pr-1 pl-3",style:{"border-radius":"3rem .7rem 0  0"}},{default:s(()=>[w("Este campo es obligatorio")]),_:1})):C("",!0)]),e.type=="text"?(_(),b(g,{key:0,class:I((t.value[e.field]==null||t.value[e.field]=="")&&y.value?"invalid":""),modelValue:t.value[e.field],"onUpdate:modelValue":d=>t.value[e.field]=d,style:{width:"100%"},id:e.name},null,8,["class","modelValue","onUpdate:modelValue","id"])):C("",!0),e.type=="textArea"?(_(),b(U,{key:1,class:I((t.value[e.field]==null||t.value[e.field]=="")&&y.value?"invalid":""),modelValue:t.value[e.field],"onUpdate:modelValue":d=>t.value[e.field]=d,rows:"4",style:{width:"100%",resize:"none","min-width":"100%","max-width":"100%"}},null,8,["class","modelValue","onUpdate:modelValue"])):C("",!0),e.type=="date"?(_(),b(F,{key:2,class:I((t.value[e.field]==null||t.value[e.field]=="")&&y.value?"invalid":""),showTime:"",dateFormat:"dd/mm/yy",modelValue:t.value[e.field],"onUpdate:modelValue":d=>t.value[e.field]=d,style:{width:"100%"}},null,8,["class","modelValue","onUpdate:modelValue"])):C("",!0),e.type=="Dropdown"?(_(),b(A,{key:3,class:I((t.value[e.field]==null||t.value[e.field]=="")&&y.value?"invalid":""),disabled:e.field==="evidence_type_id"&&E.value||e.delicated&&h.value,showTime:"",modelValue:t.value[e.field],"onUpdate:modelValue":d=>t.value[e.field]=d,optionLabel:"name",options:e.options,style:{width:"100%"}},null,8,["class","disabled","modelValue","onUpdate:modelValue","options"])):C("",!0)]))),256))])])]),_:1},8,["header","visible"]),i(B,{class:"mx-2",header:"Eliminar concurso",style:{width:"25rem"},modal:"",visible:v.value.deleteContestDialogVisible,"onUpdate:visible":a[5]||(a[5]=e=>v.value.deleteContestDialogVisible=e)},{footer:s(()=>[o("div",De,[i(n,{onClick:a[4]||(a[4]=e=>ee(L.value.id)),label:"Eliminar este concurso",severity:"danger"})])]),default:s(()=>[o("div",null,[o("p",null,[w("Esta seguro de eliminar el concurso "),o("b",null,p(L.value.name)+"?",1)])])]),_:1},8,["visible"]),o("div",ke,[Se,i(ae,{paginator:!0,rows:15,filters:u.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} concursos",rowsPerPageOptions:[5,10,25,100],scrollable:"",scrollHeight:"65vh",stripedRows:"",style:{},"onUpdate:filters":a[7]||(a[7]=e=>u.value=e),class:"col-12 m-auto",value:X.value,tableStyle:"min-width: 50rem;"},{header:s(()=>[o("div",Te,[i(g,{class:"",style:{width:"100%","max-width":"500px"},modelValue:u.value.global.value,"onUpdate:modelValue":a[6]||(a[6]=e=>u.value.global.value=e),placeholder:"Buscar Concurso..."},null,8,["modelValue"]),i(n,{onClick:K,style:{"min-width":"max-content"},icon:"pi pi-plus",label:"Nuevo concurso",class:"",severity:"help"})])]),default:s(()=>[i(r,{frozen:"",style:{"min-width":"1rem"},class:"py-1 pl-0",header:"Id",field:"id"}),i(r,{style:{"min-width":"1rem"},class:"py-1 pl-0",header:"imagen",field:"id"},{body:s(e=>[o("img",{class:"p-0",style:{width:"100%","aspect-ratio":"3 / 3","border-radius":".3rem","object-fit":"cover"},src:`${R(j)}/read-product-image/96/contest-${e.data.id}`,alt:""},null,8,Ue)]),_:1}),i(r,{style:{"min-width":"20rem"},class:"py-1",header:"Nombre",field:"name"}),i(r,{style:{"min-width":"20rem"},class:"py-1",header:"Participantes",field:"name"},{body:s(e=>[w(p(e.data.is_site_participation?"Sedes":"Colaboradores"),1)]),_:1}),i(r,{style:{"min-width":"13rem"},class:"py-1",header:"Fecha de inicio",field:"formattedStartDate"},{body:s(e=>[w(p(e.data.formattedStartDate),1)]),_:1}),i(r,{style:{"min-width":"13rem"},class:"py-1",header:"Fecha de finalizacion",field:"formattedStartDate"},{body:s(e=>[w(p(e.data.formattedEndDate),1)]),_:1}),i(r,{style:{"min-width":"13rem"},class:"py-1",header:"Forma de ganar",field:"formattedStartDate"},{body:s(e=>[o("span",null,p(e.data.contest_winner_type_name),1)]),_:1}),i(r,{style:{"min-width":"12rem"},class:"py-1",header:"Tipo de evidencia",field:"formattedStartDate"},{body:s(e=>[o("span",null,p(e.data.evidence_type_name),1)]),_:1}),i(r,{style:{"min-width":"12rem"},class:"py-1",header:"Quien va ganando?",field:"formattedStartDate"},{body:s(e=>{var d,M,O,q,G;return[o("p",Fe,p((G=(q=(O=(M=(d=e.data.rbq[0])==null?void 0:d.name)==null?void 0:M.split(" "))==null?void 0:O.slice(0,3))==null?void 0:q.join(" "))==null?void 0:G.toLowerCase()),1)]}),_:1}),i(r,{style:{"min-width":"20rem"},class:"py-1",header:"Instrucciones",field:"formattedStartDate"},{body:s(e=>[o("span",null,p(e.data.instructions),1)]),_:1}),i(r,{style:{"min-width":"5rem"},class:"py-1",header:"Estado",field:"formattedStartDate"},{body:s(e=>[e.data.started?(_(),b(f,{key:0,severity:e.data.vigent?"success":"danger",style:{"border-radius":".3rem","min-width":"max-content"}},{default:s(()=>[w(p(e.data.vigent?"En curso...":"Finalizado"),1)]),_:2},1032,["severity"])):C("",!0),e.data.started?C("",!0):(_(),b(f,{key:1,style:{"border-radius":".3rem","min-width":"max-content"}},{default:s(()=>[w(p(e.data.started?"":"Proximo"),1)]),_:2},1024))]),_:1}),i(r,{alignFrozen:"right",style:{"min-width":"4rem"},class:"py-1 pr-0",header:"Acciones",field:"Visible"},{body:s(e=>[o("div",Ae,[i(n,{onClick:d=>J(e.data),style:{pediting:"0",margin:"0"},severity:"warning",text:"",class:"p-0 m-0 text-2xl",icon:"fa-solid fa-pen-to-square p-0 m-0"},null,8,["onClick"]),i(n,{onClick:d=>Y(e.data),style:{pediting:"0",margin:"0"},severity:"danger",text:"",class:"p-0 m-0 text-2xl",icon:"fa-solid fa-trash  p-0 m-0"},null,8,["onClick"])])]),_:1}),i(r,{frozen:"",alignFrozen:"right",style:{"min-width":"4rem"},class:"py-1 pr-0",header:"Visible",field:"Visible"},{body:s(e=>[o("div",Ie,[i(te,{onChange:()=>R(V).contestToggleVisible(T.value[e.data.id],e.data.id),modelValue:T.value[e.data.id],"onUpdate:modelValue":d=>T.value[e.data.id]=d},null,8,["onChange","modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["filters","value"])])])}}},Ne=ie(Pe,[["__scopeId","data-v-1e60bbcb"]]);export{Ne as default};
