import{_ as oe,g as v,h as Y,i as D,U as P,Z as se,H as J,e as x,o as b,c as f,a as e,b as i,f as u,P as I,u as s,a2 as k,m as y,t as r,x as T,j as O,d as le,F as R,r as N,p as re,k as ne}from"./index-63e6722e.js";import{f as C}from"./formatoPesos-8aa989a0.js";const n=V=>(re("data-v-10687233"),V=V(),ne(),V),ae=n(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),ie=n(()=>e("span",{for:"responsible"},"Responsable",-1)),de=n(()=>e("span",{for:"reason"},"Razón",-1)),ce=n(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),ue=n(()=>e("span",{class:"advert",style:{"text-transform":"lowercase",color:"red","font-weight":"bold"}}," Desde el 16 de mayo de 2024, la cancelación de órdenes requerirá autorización.",-1)),pe=n(()=>e("span",{for:"responsible"},"Responsable",-1)),me=n(()=>e("span",{for:"reason"},"Razón",-1)),_e={style:{"text-transform":"capitalize"}},be={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},ve={class:""},ye={id:"factura",style:{width:"100%"}},he=n(()=>e("i",{class:"pi pi-whatsapp mr-2"},null,-1)),ge=n(()=>e("br",null,null,-1)),fe={class:"",style:{width:"auto"}},we={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},Oe={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},xe={style:{padding:"0",color:"black","text-align":"center",margin:"auto","margin-bottom":"1rem",width:"max-content","min-width":"max-content",display:"flex","justify-content":"center","flex-direction":"column"}},ke=n(()=>e("div",{class:"",style:{"font-weight":"bold",color:"white",margin:"0","background-color":"black","align-items":"center",display:"grid","grid-template-columns":"auto auto"}},[e("div",{style:{width:"100%"}},[e("b",null," productos")]),e("div",null,[e("p",{style:{"text-align":"end","font-weight":"bold"}},[e("b",null," total ")])])],-1)),Ce={style:{display:"grid","grid-template-columns":"auto auto"}},Ve={class:"p-0 m-0"},Me=n(()=>e("br",null,null,-1)),$e={style:{"text-align":"end",color:"black"}},Ee={key:0,class:"p-0 m-0"},ze=n(()=>e("b",null,"COMBO INCLUYE",-1)),De=[ze],Pe={class:"p-0 m-0 ml-5",style:{}},Te={style:{display:"flex",width:"","justify-content":"space-between"},class:"p-0 m-0"},Re={class:"p-0 m-0",style:{}},Se={class:"p-0 m-0",style:{"text-align":"end"}},Ie=n(()=>e("div",{style:{"background-color":"rgba(0, 0, 0, 0.286)",height:"1px"}},null,-1)),Ne={class:"",style:{display:"grid",color:"","margin-top":"0.5rem","grid-template-columns":"auto auto"}},je=n(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Subtotal")])],-1)),Ue={class:""},Le={style:{"text-align":"end","font-weight":"bold",color:"black"}},Be=n(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Domicilio")])],-1)),Ae={class:""},Fe={style:{"text-align":"end","font-weight":"bold",color:"black"}},He=n(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold",color:"black"}},[e("b",null,"Total")])],-1)),qe={class:""},Ze={style:{"text-align":"end",color:"black","font-weight":"bold"}},Ge=n(()=>e("div",{class:""},null,-1)),Ye=n(()=>e("p",{style:{"font-weight":"bold","background-color":"black",color:"white",padding:"0",margin:"0","margin-top":"0.5rem"}},[e("b",null,"Notas")],-1)),Je={class:"notas",style:{border:"1px solid",margin:"0",color:"black",padding:"0.5rem"}},Ke=n(()=>e("p",{style:{"background-color":"black","font-weight":"bold","margin-top":"1rem",color:"white"}},[e("b",null,"cliente")],-1)),Qe={style:{display:"grid","grid-template-columns":"auto auto"}},We=n(()=>e("div",{class:"",style:{}},[e("span",null,[e("b",null,"NOMBRE")])],-1)),Xe={class:""},et={style:{"text-align":"end",color:"black"}},tt=n(()=>e("div",{style:{}},[e("span",null,[e("b",null,"telefono")])],-1)),ot={style:{"text-align":"end",color:"black"}},st=n(()=>e("div",{style:{}},[e("span",null,[e("b",null,"direccion ")])],-1)),lt={style:{"text-align":"end",color:"black"}},rt=n(()=>e("div",null,[e("span",null,[e("b",null,"metodo de pago")])],-1)),nt={style:{"text-align":"end",color:"black"}},at={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},it={class:"mt-3"},dt=n(()=>e("h3",null,[e("b",null,"Cambiar Método de Pago")],-1)),ct=n(()=>e("span",{for:"paymentMethod"},"Método de Pago actual",-1)),ut={for:"paymentMethod"},pt=n(()=>e("span",{for:"paymentMethod"},"Nuevo método de Pago",-1)),mt={__name:"DialogoPedido",setup(V){const M=v(!1),$=v(null),j=v([]);Y(async()=>{try{const a=await D.get(`${P}/payment_methods`);j.value=a}catch(a){console.error("Error al obtener métodos de pago:",a)}o.currentOrder.value=o.currentOrder,U.value=await D.get(`${P}/sites`)});const K=async()=>{if($.value)try{await D.put(`${P}/change-method/${o.currentOrder.order_id}/${$.value}`,`Cambiando método de pago para la orden ${o.currentOrder.order_id}`),M.value=!1,o.visibles.currentOrder=!1,console.log("Método de pago cambiado exitosamente")}catch(a){console.error("Error al cambiar el método de pago:",a)}},Q=a=>{var p,m,d,h;const t=(h=(d=(m=(p=a.latest_status_timestamp)==null?void 0:p.split("T")[1])==null?void 0:m.split(":"))==null?void 0:d.slice(0,2))==null?void 0:h.join(":");switch(a.current_status){case"enviada":return`El pedido fue enviado a su domicilio a las ${t}`;case"cancelada":return`El pedido fue cancelado a las ${t}
Responsable: ${a.responsible}
Razón: ${a.reason}`;case"en preparacion":return`El pedido está en preparación desde las ${t} y será enviado en breve.`;case"generada":return`Hemos recibido su pedido a las ${t} y empezaremos a prepararlo en breve. Gracias por su espera.`;default:return""}};v(0);const E=v(!1),o=se(),W=J(()=>o.currentOrder.pe_json.listaPedidos.reduce((a,t)=>{var m;let p=t.pedido_cantidad*t.pedido_precio;if(t.modificadorseleccionList&&t.modificadorseleccionList.length>0){const h=((m=t.modificadorseleccionList)==null?void 0:m.filter(w=>w.pedido_productoid==t.pedido_productoid)).reduce((w,l)=>w+l.modificadorseleccion_cantidad*l.pedido_precio,0);p+=h}return a+p},0));J(()=>W.value+o.currentOrder.delivery_price);const X=async()=>{var t;const a={order_id:o.currentOrder.order_id,responsible:(t=c.value.responsible)==null?void 0:t.name,reason:c.value.reason};await k.create_cancellling_request(a),E.value=!1,o.Notification.pause(),o.Notification.currentTime=0},z=v(!1),ee=()=>{const a=document.getElementById("factura").innerHTML,t=window.open("","_blank");t.document.write("<html><head><title>Factura</title>");const p=document.getElementsByTagName("style");for(let m=0;m<p.length;m++)t.document.write(p[m].outerHTML);t.document.write("<style>  @media print { html{height: min-content;}  *{text-transform:uppercase;align-items:center; width:100%; font-family: sans-serif;padding:0;margin:0; font-size:o.9rem !IMPORTANT} body { padding:0; -webkit-print-color-adjust: exact; /* Chrome, Safari */ color-adjust: exact; /* Firefox */ } }  </style>"),t.document.write("</head><body>"),t.document.write(a),t.document.write("</body></html>"),t.document.close(),t.print(),setTimeout(()=>{t.close()},.01)},U=v([]);Y(async()=>{o.currentOrder.value=o.currentOrder,U.value=await D.get(`${P}/sites`)});const S=v(!1);v(!1);const c=v({responsible:null,reason:"Sin razon"}),L=v([{name:"Restaurante",value:"restaurant"},{name:"Cliente",value:"client"}]),te=()=>{c.value.responsible&&k.cancelOrder(o.currentOrder.order_id,c.value.reason,c.value.responsible.name).then(a=>{a&&(S.value=!1,console.log("Order canceled successfully"))}).catch(a=>{console.error("Failed to cancel order:",a)})};return(a,t)=>{const p=x("Dropdown"),m=x("Textarea"),d=x("Button"),h=x("Dialog"),w=x("Tag");return b(),f(R,null,[e("div",null,[i(h,{visible:S.value,"onUpdate:visible":t[2]||(t[2]=l=>S.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:u(()=>[ae]),default:u(()=>[e("form",{onSubmit:I(te,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[ie,i(p,{style:{width:"100%"},id:"responsible",modelValue:c.value.responsible,"onUpdate:modelValue":t[0]||(t[0]=l=>c.value.responsible=l),options:L.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),de,i(m,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:c.value.reason,"onUpdate:modelValue":t[1]||(t[1]=l=>c.value.reason=l),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),i(d,{style:{width:"100%","border-radius":"0.5rem"},label:"cancelar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),i(h,{visible:E.value,"onUpdate:visible":t[5]||(t[5]=l=>E.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:u(()=>[ce]),default:u(()=>[e("form",{onSubmit:I(X,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[ue,pe,i(p,{style:{width:"100%"},id:"responsible",modelValue:c.value.responsible,"onUpdate:modelValue":t[3]||(t[3]=l=>c.value.responsible=l),options:L.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),me,i(m,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:c.value.reason,"onUpdate:modelValue":t[4]||(t[4]=l=>c.value.reason=l),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),i(d,{style:{width:"100%","border-radius":"0.5rem"},label:"solicitar cancelacion",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),i(h,{closable:!1,style:{width:"30rem"},modal:"",visible:z.value,"onUpdate:visible":t[8]||(t[8]=l=>z.value=l)},{footer:u(()=>[e("div",be,[i(d,{text:"",size:"small",onClick:t[6]||(t[6]=()=>{s(k).deliveryZero(s(o).currentOrder.order_id),z.value=!1}),style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"si"}),i(d,{onClick:t[7]||(t[7]=l=>z.value=!1),size:"small",style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"no"})])]),default:u(()=>[e("span",_e,[y(" Esta seguro de llevar a $0.00 el valor del domicilio para la orden "),e("b",null,r(s(o).currentOrder.order_id),1),y(" del cliente "),e("b",null,r(s(o).currentOrder.user_name),1),y("? ")])]),_:1},8,["visible"]),i(h,{class:"mx-3",closeOnEscape:"",closable:!1,visible:s(o).visibles.currentOrder,"onUpdate:visible":t[14]||(t[14]=l=>s(o).visibles.currentOrder=l),modal:"",style:{"max-height":"95vh",width:"35rem",position:"relative"}},{footer:u(()=>[e("div",at,[s(o).currentOrder.current_status=="generada"?(b(),T(d,{key:0,size:"small",onClick:t[9]||(t[9]=l=>s(k).prepareOrder(s(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"Preparar"})):O("",!0),s(o).currentOrder.current_status=="en preparacion"?(b(),T(d,{key:1,size:"small",onClick:t[10]||(t[10]=l=>s(k).sendOrder(s(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"enviar"})):O("",!0),i(d,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:ee,severity:"warning",label:"imprimir"}),i(d,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:t[11]||(t[11]=l=>E.value=!0),severity:"danger",label:"CANCELAR "})]),e("div",it,[i(d,{onClick:t[12]||(t[12]=l=>M.value=!0),label:"Cambiar metodo de pago",severity:"success"})])]),default:u(()=>{var l,B,A,F,H,q,Z;return[e("div",ve,[e("div",null,[e("p",{class:le(`estado ${(B=(l=s(o).currentOrder)==null?void 0:l.current_status)==null?void 0:B.split(" ")[0]}`)},r(Q(s(o).currentOrder)),3)])]),e("div",ye,[s(o).currentOrder.responsible_id?(b(),T(w,{key:0,style:{},class:"tag mb-2",severity:"success"},{default:u(()=>[he,y(" TRANSFERENCIA APROBADA")]),_:1})):O("",!0),y(),ge,s(o).currentOrder.responsible_id?(b(),T(w,{key:1,class:"tag",severity:"success"},{default:u(()=>[y(r(s(o).currentOrder.name),1)]),_:1})):O("",!0),e("div",fe,[e("p",we," ID:"+r(s(o).currentOrder.order_id),1),e("p",Oe,r(s(o).currentOrder.user_name),1),e("p",xe,[e("b",null," fecha: "+r((A=s(o).currentOrder.latest_status_timestamp)==null?void 0:A.split("T")[0]),1),e("b",null," Hora: "+r((Z=(q=(H=(F=s(o).currentOrder.latest_status_timestamp)==null?void 0:F.split("T")[1])==null?void 0:H.split(":"))==null?void 0:q.slice(0,2))==null?void 0:Z.join(":")),1)]),ke,(b(!0),f(R,null,N(s(o).currentOrder.pe_json.listaPedidos,_=>{var G;return b(),f("div",null,[e("div",Ce,[e("p",Ve,[y(" ( "+r(_.pedido_cantidad)+" ) "+r(_.pedido_nombre_producto)+" ",1),Me]),e("div",null,[e("p",$e,r(s(C)(_.pedido_base_price*_.pedido_cantidad)),1)])]),_.lista_productocombo.length>0?(b(),f("p",Ee,De)):O("",!0),_.lista_productocombo?(b(!0),f(R,{key:1},N(_.lista_productocombo,g=>(b(),f("p",Pe,[y(" -- "),e("b",null,r(g.pedido_cantidad),1),y(" "+r(g.pedido_nombre),1)]))),256)):O("",!0),(b(!0),f(R,null,N((G=_.modificadorseleccionList)==null?void 0:G.filter(g=>g.pedido_productoid==_.pedido_productoid),g=>(b(),f("div",Te,[e("p",Re,[y(" - ( "+r(_.pedido_cantidad)+" ) ",1),e("b",null,r(g.modificadorseleccion_cantidad/_.pedido_cantidad),1),y(" "+r(g.modificador_nombre),1)]),e("p",Se,r(s(C)(g.pedido_precio*g.modificadorseleccion_cantidad)),1)]))),256)),Ie])}),256)),e("div",Ne,[je,e("div",Ue,[e("p",Le,[e("b",null,r(s(C)(s(o).currentOrder.pe_json.delivery.delivery_pagocon-s(o).currentOrder.delivery_price)),1)])]),Be,e("div",Ae,[e("p",Fe,[e("b",null,r(s(C)(s(o).currentOrder.delivery_price)),1)])]),He,e("div",qe,[e("p",Ze,[e("b",null,r(s(C)(s(o).currentOrder.pe_json.delivery.delivery_pagocon)),1)])]),Ge]),Ye,e("p",Je,r(s(o).currentOrder.order_notes),1),Ke,e("div",Qe,[We,e("div",Xe,[e("p",et,r(s(o).currentOrder.user_name),1)]),tt,e("div",null,[e("p",ot,r(s(o).currentOrder.user_phone),1)]),st,e("div",null,[e("p",lt,r(s(o).currentOrder.user_address),1)]),rt,e("div",null,[e("p",nt,r(s(o).currentOrder.payment_method),1)])])])]),i(d,{class:"shadow-4",onClick:t[13]||(t[13]=_=>s(o).setVisible("currentOrder",!1)),icon:"pi pi-times",rounded:"",severity:"danger",style:{position:"absolute",top:"-1rem","border-radius":"50%",right:"-1rem"}})]}),_:1},8,["visible"])]),i(h,{visible:M.value,"onUpdate:visible":t[16]||(t[16]=l=>M.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:u(()=>[dt]),default:u(()=>[e("form",{onSubmit:I(K,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[ct,i(w,{class:"px-4",severity:"warning"},{default:u(()=>[e("span",ut,[e("b",null,r(s(o).currentOrder.payment_method),1)])]),_:1}),pt,i(p,{style:{width:"100%"},id:"paymentMethod",modelValue:$.value,"onUpdate:modelValue":t[15]||(t[15]=l=>$.value=l),options:j.value,optionLabel:"name",optionValue:"id",placeholder:"Selecciona un método de pago",required:""},null,8,["modelValue","options"]),i(d,{style:{width:"100%","border-radius":"0.5rem"},label:"Cambiar",type:"submit",class:"p-button-help"})],32)]),_:1},8,["visible"])],64)}}},vt=oe(mt,[["__scopeId","data-v-10687233"]]);export{vt as D};
