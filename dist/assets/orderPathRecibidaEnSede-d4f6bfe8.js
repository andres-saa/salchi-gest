import{_ as xe,G as De,r as p,l as ke,q as Ce,a as _,o as G,b as Q,i as s,h as r,d as o,F as ee,B as je,j as D,t as m,k as Se,e as Te,n as N,w as Fe,v as Re,p as Ee,m as Ae}from"./index-e0d1eab6.js";import{s as Pe}from"./siteService-77184632.js";import"./sass.default-a5b7a582.js";import{p as g}from"./purchaseOrderService-85db5e5d.js";import{u as T,a as te}from"./xlsx-4cca7150.js";import{E as Ue}from"./exceljs.min-4b158bf5.js";import{F as ae}from"./FileSaver.min-cc8488c4.js";import{f as se}from"./format-8cf56335.js";import{e as oe}from"./es-f6133d36.js";import"./_commonjsHelpers-23102255.js";const b=O=>(Ee("data-v-d9b2de61"),O=O(),Ae(),O),$e={class:"grid"},Me={class:"col-12 px-0 mx-0"},Oe={class:"col-12",style:{display:"flex","flex-direction":"column"}},qe=b(()=>o("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),Ie={class:"col-12",style:{display:"flex","flex-direction":"column"}},Le=b(()=>o("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),Ve={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},Ne={class:"col-12",style:{display:"flex","justify-content":"center"}},Be=b(()=>o("p",null,"Desea ageregar notas?",-1)),He={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},ze={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},Ge=b(()=>o("br",null,null,-1)),Qe={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},We={class:"m-0"},Ke={class:"m-0"},Je={key:0},Ye=b(()=>o("b",null,"Notas",-1)),Xe={style:{display:"flex",gap:"1rem"}},Ze={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},et={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},tt={class:"m-0 p-0"},at=b(()=>o("b",null,"Transportado por:",-1)),st={class:"m-0 p-0"},ot=b(()=>o("b",null,"Sede:",-1)),lt={class:"mt-0 p-0"},nt=b(()=>o("b",null,"Fecha",-1)),it={style:{display:"flex","flex-direction":"column","align-items":"start",gap:"0.5rem"}},rt={style:{display:"flex","align-items":"center",gap:"1rem"}},dt={class:"text-right"},ct=["max","onUpdate:modelValue"],ut={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},pt={class:"m-auto",style:{"max-width":"1024px"}},mt={class:"col-12 px-3 mt-4 pack-butons",style:{display:"flex","justify-content":"end",gap:"1rem"}},ht={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},yt={class:"grid",style:{"align-items":"center"}},vt={class:"col-12 md:col-6 p-3"},_t={style:{"min-width":"max-content"}},ft={style:{"min-width":"max-content"}},gt={class:"m-0 p-0",style:{display:"flex",width:"100%","justify-content":"center","align-items":"center",gap:"0.5rem"}},le=4,bt={__name:"orderPathRecibidaEnSede",setup(O){const k=De(),q=p(!1),F=p([]),R=p(!1),B=p(""),ne=p(!1),ie=l=>{if(l.some(t=>!t.ajustment&&t.ajustment!==0)){alert("por favor complete todos los campos");return}if(l.some(t=>t.ajustment>t.quantity)){alert("No puedes enviar mas de lo solicitado");return}R.value=!0},y=p({}),H=p(!1),W=p([]),re=async l=>{H.value=!0,W.value=await g.getPurchaseOrderHistory(l)},de=()=>{F.value.forEach(l=>{l.ajustment=l.quantity_adjusted})},I=p(!1),ce=l=>{q.value=!0,y.value=l},ue=async l=>{I.value=!0,F.value=await g.getpurchaseOrderEntriesBypurchaseOrderID(l)},pe={Generada:"#FF0000",Lista:"#FFA500","Entregada al transportista":"#FFFF00",Completada:"#00FF00"},me=[{color:"#7fffd4",description:"Esta todo bien"},{color:"rgb(251 53 146)",description:"El transportista reporto menos de lo que habia"},{color:" rgb(255, 175, 51)",description:"Recibiste menos de lo reportado por el transportista"}],K=ke(),J=p([]),Y=p([{}]),E=p(!1),C=p(new Date(new Date().setDate(new Date().getDate()-7))),w=p(new Date),A=p(new Date(new Date().setDate(new Date().getDate()-7))),P=p(new Date),j=p(),x=p(),he=(l,t)=>{A.value=l,P.value=t},U=l=>{const t=new Date,a=new Date(t);a.setDate(a.getDate()+1);const c=new Date(t);c.setDate(t.getDate()-l),C.value=c,l==1?(w.value=t,P.value=w.value,A.value=C.value,E.value=!1):(w.value=a,A.value=C.value,P.value=w.value,E.value=!1),ye()};Ce(async()=>{J.value=await Pe.getSites(),Y.value=J.value,j.value=await g.getPurchaseOrderByLap_id(le)}),(()=>{x.value={global:{value:null,matchMode:je.CONTAINS}}})();function X(l){const t=new Date(l),a=t.getFullYear(),c=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0");return`${a}-${c}-${i}`}const ye=async()=>{const l=Y.value.map(c=>c.site_id);K.rawUserData.id;const t=X(A.value),a=X(P.value);j.value=await g.getAllpurchaseOrderReportsFiltered(l,t,a)},$=p([]),ve=async(l,t,a)=>{$.value=await g.getpurchaseOrderEntriesBypurchaseOrderID(l);const c=$.value.map(v=>({Producto:v.item_name,Cantidad:v.quantity,"Unidad de medida":v.unit_measure})),i=T.json_to_sheet(c);i["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const h=T.book_new();T.book_append_sheet(h,i,"Usuarios"),te(h,`Orden_de_compra_${t}_${a} .xlsx`)},_e=l=>l.map(a=>{if(a.quantity!=a.ajustment)return{order_purchase_entry_id:a.entry_id,quantity_adjusted:a.ajustment}}).filter(a=>a),fe=async l=>{if(l.some(a=>!a.ajustment&&a.ajustment!==0)){alert("por favor complete todos los campos");return}k.setLoading(!0,"Recibiendo orden");const t={purchase_order_id:y.value.purchase_order_id,lap_id:y.value.lap_id,responsible_id:K.rawUserData.id,ajusts:_e(l),order_purchase_notes:B.value};await g.PreparePurchaserOrder(t),j.value=await g.getPurchaseOrderByLap_id(le),q.value=!1,I.value=!1,k.setLoading(!1,"Recibiendo orden"),R.value=!1,ne.value=!1},ge=async()=>{k.setLoading(!0,"generando descargas");const l=j.value,t=[];for(const e of l){const n=await g.getpurchaseOrderEntriesBypurchaseOrderID(e.purchase_order_id);t.push(...n)}const a={};t.forEach(e=>{const n=e.site_name,u=e.item_name,f=e.quantity,S=e.unit_measure;a[u]||(a[u]={unit_measure:S}),a[u][n]||(a[u][n]=0),a[u][n]+=f});const c=[...new Set(t.map(e=>e.site_name))],i=[],h=se(A.value,"dd-MMMM-yyyy",{locale:oe}),v=se(P.value,"dd-MMMM-yyyy",{locale:oe});h==v?i.push([`ORDENES DE COMPRA DEL ${h.toUpperCase()}`,...Array(c.length+2).fill("")]):i.push([`ORDENES DE COMPRA DEL${h.toUpperCase()} AL ${v.toUpperCase()}`,...Array(c.length+2).fill("")]);const z=["PRODUCTO","UNIDAD DE MEDIDA",...c,"TOTAL"];i.push(z);for(const[e,n]of Object.entries(a)){const u=[e,n.unit_measure];let f=0;for(const S of c){const Z=n[S]||0;u.push(Z),f+=Z}u.push(f),i.push(u)}const M=new Ue.Workbook,d=M.addWorksheet("Inventario por Sede");i.forEach((e,n)=>{const u=d.addRow(e);n===0?(u.height=40,u.font={name:"Arial",bold:!0,size:14},u.alignment={horizontal:"center",vertical:"middle",wrapText:!0},d.mergeCells(`A1:${d.getColumn(c.length+3).letter}1`),d.getRow(1).eachCell(f=>{f.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF00"}}})):n===1&&(u.font={name:"Arial",bold:!0})}),d.columns.forEach((e,n)=>{e.width=n===0?30:n===1?25:15,e.eachCell(u=>{u.font={name:"Arial"},u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),d.getRow(2).eachCell(e=>{e.font={name:"Arial",bold:!0}}),d.getRow(1).eachCell(e=>{e.font={name:"Arial",bold:!0,size:16}}),d.views=[{showGridLines:!1}];const L=await M.xlsx.writeBuffer(),V=new Blob([L],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});h==v?ae.saveAs(V,`Reporte de inventario del ${h}.xlsx`):ae.saveAs(V,`Reporte de inventario del ${h} al ${v} .xlsx`),k.setLoading(!1,"generando descargas")},be=async()=>{k.setLoading(!0,"generando descargas");const l=j.value;for(const i of l){const h=await g.getpurchaseOrderEntriesBypurchaseOrderID(i.purchase_order_id);$.value.push(...h)}console.log($.value);const t=$.value.map(i=>({Fecha:i.date.split("T")[0],Hora:i.date.split("T")[1],Sede:i.site_name,Producto:i.item_name,Cantidad:i.quantity,"Unidad de medida":i.unit_measure})),a=T.json_to_sheet(t);a["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const c=T.book_new();T.book_append_sheet(c,a,"Usuarios"),te(c,"Compras de todas las sedes.xlsx"),k.setLoading(!1,"generando descargas")};function we(l){l.key===","&&(alert("Por favor usa punto ( . ) para los decimales, gracias"),l.preventDefault())}return(l,t)=>{const a=_("Button"),c=_("Calendar"),i=_("Dialog"),h=_("Textarea"),v=_("Timeline"),z=_("router-link"),M=_("Tag"),d=_("Column"),L=_("DataTable"),V=_("InputText");return G(),Q(ee,null,[s(i,{class:"mx-2",visible:E.value,"onUpdate:visible":t[8]||(t[8]=e=>E.value=e),modal:"",header:"Periodo",style:{width:"25rem"}},{default:r(()=>[o("div",$e,[o("div",Me,[s(a,{text:"",label:"Hoy",onClick:t[0]||(t[0]=e=>U(0)),class:"p-button-text col-12 p-1 m-0"}),s(a,{text:"",label:"Ayer",onClick:t[1]||(t[1]=e=>U(1)),class:"p-button-text col-12 p-1 m-0"}),s(a,{text:"",label:"Últimos 7 días",onClick:t[2]||(t[2]=e=>U(7)),class:"p-button-text col-12 p-1 m-0"}),s(a,{text:"",label:"Últimos 14 días",onClick:t[3]||(t[3]=e=>U(14)),class:"p-button-text col-12 p-1"}),s(a,{text:"",label:"Últimos 28 días",onClick:t[4]||(t[4]=e=>U(28)),class:"p-button-text col-12 p-0"})]),o("div",Oe,[qe,s(c,{style:{"min-width":"max-content"},modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=e=>C.value=e)},null,8,["modelValue"])]),o("div",Ie,[Le,s(c,{style:{"min-width":"max-content"},modelValue:w.value,"onUpdate:modelValue":t[6]||(t[6]=e=>w.value=e),showWeek:""},null,8,["modelValue"])]),o("div",Ve,[o("div",Ne,[s(a,{onClick:t[7]||(t[7]=()=>{he(C.value,w.value),E.value=!1})},{default:r(()=>[D("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),s(i,{class:"mx-2",visible:R.value,"onUpdate:visible":t[12]||(t[12]=e=>R.value=e),modal:"",header:"Notas de alistamientos",style:{width:"25rem"}},{footer:r(()=>[o("div",He,[s(a,{text:"",onClick:t[10]||(t[10]=e=>R.value=!1),severity:"danger",label:"cancelar"}),s(a,{onClick:t[11]||(t[11]=e=>fe(F.value.filter(n=>n.quantity!=0))),severity:"help",label:"Alistar orden"})])]),default:r(()=>[Be,o("div",null,[s(h,{modelValue:B.value,"onUpdate:modelValue":t[9]||(t[9]=e=>B.value=e),style:{width:"100%",resize:"none",height:"10rem"}},null,8,["modelValue"])])]),_:1},8,["visible"]),s(i,{class:"mx-2",visible:H.value,"onUpdate:visible":t[13]||(t[13]=e=>H.value=e),modal:"",header:"Historial de la orden",style:{width:"min-content"}},{default:r(()=>[s(v,{value:W.value},{opposite:r(e=>{var n;return[o("p",ze,m(e.item.status_timestamp.split("T")[0]),1),D(),Ge,o("p",Qe,m((n=e.item.status_timestamp.split("T")[1])==null?void 0:n.split(":").slice(0,2).join(":")),1)]}),content:r(e=>[o("p",We,[o("b",null,m(e.item.lap_name),1)]),o("p",Ke,m(e.item.name),1),e.item.notes?(G(),Q("p",Je,[Ye,D(" "+m(e.item.notes),1)])):Se("",!0),o("div",Xe,[s(a,{disabled:!e.item.notes,style:{height:"2rem",opacity:"0","border-radius":"0.3rem"},cla:"",severity:"help",class:"",label:"Notas"},null,8,["disabled"]),s(a,{disabled:!e.item.conflict,style:{height:"2rem","border-radius":"0.3rem"},severity:"danger",class:"mb-4",label:"Conflictos"},null,8,["disabled"])])]),_:1},8,["value"])]),_:1},8,["visible"]),s(i,{class:"mx-2",visible:q.value,"onUpdate:visible":t[17]||(t[17]=e=>q.value=e),modal:"",header:"Interactuar con la orden",style:{width:"25rem"}},{default:r(()=>[o("div",Ze,[s(z,{to:`/purchase-order/recorrido/purchase-order-view/${y.value.purchase_order_id}`},{default:r(()=>[s(a,{text:"",style:{width:"100%"},severity:"help",class:"",label:"Ver detalles",icon:"pi pi-eye"})]),_:1},8,["to"]),s(a,{text:"",label:"Descargar en excel",style:{},onClick:t[14]||(t[14]=e=>{var n;return ve(y.value.purchase_order_id,y.value.site_name,(n=y.value.expedition_date)==null?void 0:n.split("T")[0])}),severity:"success",class:"",icon:"pi pi-download"}),s(a,{onClick:t[15]||(t[15]=e=>re(y.value.purchase_order_id)),text:"",label:"Ver Historial",style:{},severity:"warning",class:"",icon:"pi pi-history p-0 m-0"}),s(a,{onClick:t[16]||(t[16]=e=>ue(y.value.purchase_order_id)),label:"Recibir orden",style:{},severity:"help",class:"",icon:"pi  p-0 m-0"})])]),_:1},8,["visible"]),s(i,{class:"px-2",visible:I.value,"onUpdate:visible":t[20]||(t[20]=e=>I.value=e),modal:"",header:"Recibir orden",style:{width:"max-content","max-width":"100vw"}},{footer:r(()=>[o("div",ut,[s(a,{outlined:"",onClick:de,severity:"help",label:"Todo esta completo"}),s(a,{onClick:t[19]||(t[19]=e=>ie(F.value.filter(n=>n.quantity!=0))),severity:"help",label:"Recibir orden"})])]),default:r(()=>[o("div",et,[o("p",tt,[at,D(" "+m(y.value.responsible_lap),1)]),o("p",st,[ot,D(" "+m(y.value.site_name),1)]),o("p",lt,[nt,D(" "+m(y.value.status_timestamp.split("T")[0]),1)]),o("div",it,[(G(),Q(ee,null,Te(me,e=>o("div",rt,[s(M,{style:N([`background-color:${e.color}`,{height:"2rem","aspect-ratio":"4 / 3"}])},null,8,["style"]),o("span",null,m(e.description),1)])),64))]),s(L,{showGridlines:"",style:{"max-width":"1024px"},stripedRows:"",filters:x.value,"onUpdate:filters":t[18]||(t[18]=e=>x.value=e),class:"col-12 m-auto p-0 m-0",value:F.value.filter(e=>e.quantity!=0),tableStyle:"min-width: 50rem;"},{default:r(()=>[s(d,{class:"py-0",field:"item_id",header:"id"}),s(d,{class:"py-0",field:"item_name",header:"Item"},{body:r(e=>[o("p",{style:N(e.data.ajustment===0?"text-decoration: line-through;background-color:#ffc9d1":"")},m(e.data.item_name),5)]),_:1}),s(d,{class:"py-0",field:"quantity_adjusted",header:"cant. Reportada por transportista"},{body:r(e=>[o("p",dt,m(e.data.quantity_adjusted),1)]),_:1}),s(d,{class:"py-0 px-0",field:"quantity",header:"cant. realmente recibida"},{body:r(e=>[Fe(o("input",{onKeydown:we,class:"text-right",max:e.data.quantity,min:0,"onUpdate:modelValue":n=>e.data.ajustment=n,style:N([{"background-color":"transparent",height:"2rem",width:"100%",border:"none"},e.data.quantity_adjusted===e.data.ajustment?"background-color: aquamarine;":e.data.ajustment===0?"background-color:#ffc9d1":e.data.ajustment<e.data.quantity?"background-color:#FFAF33;border:2px solid #FF7A33":e.data.ajustment>e.data.quantity?"background-color:#FF3393;border:2px solid #FF3342":""]),type:"number"},null,44,ct),[[Re,e.data.ajustment]])]),_:1}),s(d,{class:"py-0",field:"unit_measure",header:"Und. de medida"}),s(d,{class:"py-0",field:"quantity",header:"interactuar"},{body:r(e=>[s(a,{onClick:n=>e.data.ajustment=e.data.quantity_adjusted,style:{"min-width":"max-content"},text:"",class:"px-0 py-1",label:"Esta completo"},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value"])])]),_:1},8,["visible"]),o("div",pt,[o("div",mt,[s(a,{severity:"help",icon:"pi pi-download",label:"Descargar Todo",onClick:be}),s(a,{severity:"help",icon:"pi pi-download",label:"Descargar Informe",onClick:ge})])]),o("div",ht,[s(L,{stripedRows:"",showGridlines:"",style:{"max-width":"1024px"},filters:x.value,"onUpdate:filters":t[22]||(t[22]=e=>x.value=e),class:"col-12 m-auto",value:j.value,tableStyle:"min-width: 50rem;",paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reportes"},{header:r(()=>[o("div",yt,[o("div",vt,[s(V,{style:{width:"100%"},class:"",modelValue:x.value.global.value,"onUpdate:modelValue":t[21]||(t[21]=e=>x.value.global.value=e),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:r(()=>[s(d,{class:"py-1",field:"purchase_order_id",header:"ID"}),s(d,{class:"py-1",field:"employer_name",header:"Solicitante"}),s(d,{class:"py-1",field:"site_name",header:"Sede"}),s(d,{class:"py-1",field:"date",header:"Fecha"},{body:r(e=>{var n;return[o("p",_t,m((n=e.data.expedition_date)==null?void 0:n.split("T")[0]),1)]}),_:1}),s(d,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:r(e=>{var n,u,f,S;return[o("span",ft,m((S=(f=(u=(n=e.data.expedition_date)==null?void 0:n.split("T")[1])==null?void 0:u.split(":"))==null?void 0:f.slice(0,2))==null?void 0:S.join(" : ")),1)]}),_:1}),s(d,{class:"py-1",field:"date",header:"Estado actual"},{body:r(e=>[s(M,{style:N([{width:"100%",color:"black"},`background-color:${pe[e.data.current_status]}`])},{default:r(()=>[D(m(e.data.current_status),1)]),_:2},1032,["style"])]),_:1}),s(d,{style:{"justify-content":"center"},class:"py-0 mx-0 px-0",field:"date",header:"Actuar"},{body:r(e=>[o("div",gt,[s(a,{label:"",style:{width:"min-content"},text:"",onClick:n=>ce(e.data),severity:"",class:"text-center p-1",icon:"fa-solid fa-hand"},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])])],64)}}},At=xe(bt,[["__scopeId","data-v-d9b2de61"]]);export{At as default};
