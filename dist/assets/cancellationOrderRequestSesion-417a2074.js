import{_ as W,r as m,l as X,z as Y,k as Z,B as ee,i as te,m as ae,a as v,o as S,c as se,d as a,w as i,b as s,L as A,s as oe,t as w,u as P,f as L,D as $,p as ne,g as le}from"./index-ecc0c64b.js";import{o as u}from"./orderService-98afcc87.js";import{u as ie}from"./order-3509a344.js";import"./index-558f534d.js";import"./_commonjsHelpers-23102255.js";const k=_=>(ne("data-v-771baa1a"),_=_(),le(),_),re={class:"container"},de=k(()=>s("h3",null,[s("b",null,"Rechazar esta solicitud")],-1)),ce=k(()=>s("h3",null,[s("b",null,"Aprobar esta solicitud")],-1)),ue={class:"grid",style:{"align-items":"center","justify-content":"space-between"}},pe={class:"col-12 md:col-6 p-3"},me={class:"text-xl",style:{width:"100%"}},ve={style:{"text-transform":"capitalize"}},he={class:"md:mt-0 p-input-icon-right m-3"},_e=k(()=>s("i",{class:"pi pi-search"},null,-1)),ye={style:{"min-width":"max-content"}},be={style:{"min-width":"max-content"}},fe={style:{"min-width":"max-content"}},ge={style:{display:"flex",gap:"0.5rem"}},we={__name:"cancellationOrderRequestSesion",setup(_){const y=m(!1),p=m([]),b=m(!1),T=X(),n=m({}),B=new Audio("/sound/pip1.wav"),O=new Audio("/sound/pip2.wav"),U=new Audio("/sound/pip3.wav"),M=ie(),F=m(null),x={revisar:u.getPendientsCancellationRequest,aprobadas:u.getaceptedCancellationAcepted,rechazadas:u.getPendientsCancellationRejected},j={revisar:u.getPendientsCancellationRequestNoLoading,aprobadas:u.getaceptedCancellationAceptedNoLoading,rechazadas:u.getPendientsCancellationRejectedNoLoading};Y(()=>{D()});const N=(r,e)=>{n.value.id=e,r?b.value=!0:y.value=!0},z=async(r,e,d)=>{const l={authorized:r,responsible_id:T.rawUserData.id,responsible_observation:n.value.reason||"sin observaciones"};await u.resolveCancellationRequest(e,l),b.value=!1,y.value=!1,p.value=await x[c.params.request_status]()},V=r=>{const e=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],d=r.split("T"),l=d[0].split("-"),f=l[2],C=parseInt(l[1],10)-1,o=l[0],q=e[C],t=d[1].split(":"),g=parseInt(t[0],10),J=t[1],Q=g>=12,R=g%12||12,G=R<10?`0${R}`:`${R}`,K=Q?"PM":"AM";return{date:`${f}-${q}-${o}`,time:`${G}:${J} ${K}`}},c=Z(),h=m(),D=()=>{h.value={global:{value:null,matchMode:ee.CONTAINS}}};D(),te(()=>{E(),F.value=setInterval(()=>{H()},1e4)});const E=async()=>{p.value=await x[c.params.request_status]()},I=[B,O,U],H=async()=>{p.value=await j.revisar();const r=M.numberCancellationRequests,e=p.value.length;if(r<e){const d=Math.floor(Math.random()*I.length);I[d].play(),M.numberCancellationRequests=e}};return ae(()=>c.params.request_status,async()=>{p.value=await x[c.params.request_status]()},{deep:!0}),(r,e)=>{const d=v("Textarea"),l=v("Button"),f=v("Dialog"),C=v("InputText"),o=v("Column"),q=v("DataTable");return S(),se("div",re,[a(f,{visible:y.value,"onUpdate:visible":e[2]||(e[2]=t=>y.value=t),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:i(()=>[de]),default:i(()=>[s("form",{onSubmit:e[1]||(e[1]=A(t=>z(!1,n.value.id,n.value.reason),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[a(d,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:n.value.reason,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.reason=t),rows:"5",placeholder:"Porque desea rechazar esta solicitud?"},null,8,["modelValue"]),a(l,{style:{width:"100%","border-radius":"0.5rem"},label:"Rechazar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),a(f,{visible:b.value,"onUpdate:visible":e[5]||(e[5]=t=>b.value=t),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:i(()=>[ce]),default:i(()=>[s("form",{onSubmit:e[4]||(e[4]=A(t=>z(!0,n.value.id,n.value.reason),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[a(d,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:n.value.reason,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.reason=t),rows:"5",placeholder:"Notas para el solicitante"},null,8,["modelValue"]),a(l,{style:{width:"100%","border-radius":"0.5rem"},label:"Aprobar",type:"submit",class:"p-button-success"})],32)]),_:1},8,["visible"]),a(q,{paginator:!0,rows:15,filters:h.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} solicitudes",rowsPerPageOptions:[5,10,25,100],scrollable:"",scrollHeight:"65vh",stripedRows:"",style:{},"onUpdate:filters":e[7]||(e[7]=t=>h.value=t),class:"col-12 m-auto",value:p.value,tableStyle:"min-width: 50rem;"},{header:i(()=>[s("div",ue,[s("div",pe,[s("span",me,[oe(" Solicitudes de cancelacion - "),s("span",ve,w(P(c).params.request_status.split("-").join(" ")),1)])]),s("span",he,[_e,a(C,{class:"",modelValue:h.value.global.value,"onUpdate:modelValue":e[6]||(e[6]=t=>h.value.global.value=t),placeholder:"Buscar Solicitud..."},null,8,["modelValue"])])])]),default:i(()=>[a(o,{style:{},class:"py-1 pl-0",field:"order_id",header:"ID orden",frozen:""},{body:i(t=>[s("p",ye,w(t.data.order_id),1)]),_:1}),a(o,{class:"py-1",field:"site_name",header:"Sede"}),a(o,{class:"py-1",field:"site_name",header:"Fecha"},{body:i(t=>[s("p",be,w(V(t.data.timestamp).date),1)]),_:1}),a(o,{class:"py-1",field:"site_name",header:"Hora"},{body:i(t=>[s("p",fe,w(V(t.data.timestamp).time),1)]),_:1}),a(o,{style:{"min-width":"30rem"},class:"py-1",field:"reason",header:"Motivo"}),a(o,{style:{"min-width":"10rem"},class:"py-1",field:"responsible",header:"Quien solicita?"}),a(o,{style:{"min-width":"20em"},class:"py-1",field:"user_name",header:"Nombre del cliente"}),a(o,{style:{"min-width":"10rem"},class:"py-1",field:"user_phone",header:"Cel. cliente"}),a(o,{style:{},class:"py-1 px-0",field:"date",header:"Action",frozen:"",alignFrozen:"right"},{body:i(t=>[s("div",ge,[P(c).params.request_status!="aprobadas"?(S(),L(l,{key:0,size:"",onClick:g=>N(!0,t.data.id),style:{height:"1.8rem",width:"2rem"},severity:"success",class:"p-1",icon:"pi pi-check"},null,8,["onClick"])):$("",!0),P(c).params.request_status!="rechazadas"?(S(),L(l,{key:1,onClick:g=>N(!1,t.data.id),style:{height:"1.8rem",width:"2rem",background:"var(--primary-color)",border:"none"},severity:"danger",class:"p-1",icon:"pi pi-times"},null,8,["onClick"])):$("",!0)])]),_:1})]),_:1},8,["filters","value"])])}}},Pe=W(we,[["__scopeId","data-v-771baa1a"]]);export{Pe as default};
