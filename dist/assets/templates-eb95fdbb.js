import{_ as xe,l as Ce,h as n,J as K,Z as Ee,i as Te,j as C,U as Ve,D as q,o as h,c as E,f as o,e as g,u as s,a as l,F as R,$ as v,q as T,t as y,r as H,d as Ue,n as ke,a0 as W,a1 as b,a2 as Z,a3 as L,a4 as D,a5 as X,a6 as $e,k as Se,a7 as Le,p as Ne,m as Ie,H as S}from"./index-90cf6a8a.js";const d=N=>(Ne("data-v-0d4f36ea"),N=N(),Ie(),N),Oe={style:{height:"100%"}},Pe={style:{display:"grid","grid-template-columns":"repeat(2, 1fr)","max-width":"max-content",gap:".5rem","align-items":"center"}},Re=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Id plantilla :")],-1)),De={class:"m-0 p-0"},Ae=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Nombre plantilla :")],-1)),Be={class:"m-0 p-0"},je=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Estado :")],-1)),Fe={class:"m-0 p-0"},Ye=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Categoria :")],-1)),Me={class:"m-0 p-0"},Ge=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Mensaje :")],-1)),Ke={class:"m-0",style:{"background-color":"#0a3744",padding:"1rem","border-radius":".5rem",color:"white"}},qe=d(()=>l("h5",null,[l("strong",null,"Usuarios")],-1)),He={class:"statuses",style:{display:"flex",gap:"1rem"}},Je={style:{width:"100%",height:"50vh","margin-top":"1rem"}},ze={class:"p-4 templates-container",style:{"max-width":"70rem",width:"100%",margin:"auto","background-color":"white","border-radius":"1rem",transition:"all .3s ease"}},Qe={style:{height:"100%"}},We={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",style:{"align-items":"center"}},Ze=d(()=>l("h2",{class:"text-2xl font-bold whitespace-nowrap m-0 p-0",style:{"min-width":"max-content"}},"Plantillas de WhatsApp",-1)),Xe={class:"p-input-icon-left w-full md:w-80 my-3",style:{height:"100%"}},ea=d(()=>l("i",{class:"pi pi-search"},null,-1)),aa={class:"flex gap-2"},la={style:{display:"flex",width:"100%","justify-content":"end","margin-top":"1rem"}},ta={class:"space-y-4"},sa={class:"md:grid-cols-2 gap-3"},oa={class:"field"},na=d(()=>l("label",{class:"font-medium"},"Nombre",-1)),ia={class:"field"},ra=d(()=>l("label",{class:"font-medium"},"Categoría",-1)),ua={class:"field"},da=d(()=>l("label",{class:"font-medium"},"Idioma",-1)),ca={class:"font-medium"},pa={class:"opacity-70"},ma={key:0,class:"",style:{display:"flex","flex-direction":"column",gap:"1rem","justify-content":"center"}},va=d(()=>l("h5",{class:"font-medium m-0 p-0 py-3"},"Ejemplos de variables",-1)),fa={class:"space-y-2"},ga={class:"flex items-center my-4",style:{"align-items":"center",gap:"1rem"}},ya=d(()=>l("h5",{class:"m-0"},"Botones",-1)),_a={style:{display:"flex","flex-direction":"column",gap:"1rem","max-width":"100%",overflow:"hidden"}},ha={__name:"templates",setup(N){const ee=Ce(),A=n([]),_=n({}),B=n(!1),I=n(""),V=n(!1),j=n(!1),O=n(null),F=n([]),f=n({name:"",category:"UTILITY",language:"es_ES"}),U=n(""),w=n([]),c=n({}),ae=n(null),p=n({}),Y=n([{}]);n({label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-triangle-exclamation"});const m=n([]),le=n([{label:"SIN DATOS",bg:"#7f8c8d",icon:"fa-circle-question"},{label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-triangle-exclamation"},{label:"CASUAL",bg:"#e67e22",icon:"fa-person-walking"},{label:"FRECUENTE",bg:"#27ae60",icon:"fa-repeat"},{label:"TOP",bg:"#2980b9",icon:"fa-ranking-star"},{label:"ESTRELLA",bg:"#8e44ad",icon:"fa-star"}]);function te(t){const a=t.label;if(a==="TODO"){m.value=[];return}const e=m.value.indexOf("TODO");e>-1&&m.value.splice(e,1);const i=m.value.indexOf(a);i===-1?m.value.push(a):m.value.splice(i,1)}const J=K(()=>m.value.length===0?Y.value:Y.value.filter(t=>m.value.includes(t.clasification))),se=Ee(),k=n(!1),oe=[{label:"AUTHENTICATION",value:"AUTHENTICATION"},{label:"MARKETING",value:"MARKETING"},{label:"UTILITY",value:"UTILITY"}],ne=[{label:"Español (CO)",value:"es_CO"},{label:"Español (ES)",value:"es_ES"},{label:"English (US)",value:"en_US"}],ie=[{label:"URL",value:"URL"},{label:"QUICK_REPLY",value:"QUICK_REPLY"}],re=K(()=>{if(!I.value)return A.value;const t=I.value.toLowerCase();return A.value.filter(a=>`${a.name} ${a.category}`.toLowerCase().includes(t))});Te(async()=>{F.value=await C.get(`${Ve}/restaurants`),p.value=F.value[0]||null,p.value});const ue=t=>{_.value=t,k.value=!0};q(k,()=>{m.value=[]});const P=n([]);q(U,t=>{const a=Array.from(new Set((t.match(/{{\s*([^{}\s]+)\s*}}/g)||[]).map(e=>e.replace(/{{|}}/g,"").trim())));P.value=a,c.value=Object.fromEntries(Object.entries(c.value).filter(([e])=>a.includes(e))),a.forEach(e=>{e in c.value||(c.value[e]="")})});async function M(){B.value=!0;try{A.value=await C.get(`${S}/wabas/${p.value.waba_id}/templates/`)}finally{B.value=!1}}const de=async()=>{Y.value=await C.get(`${S}/wabas/${p.value.waba_id}/templates/users/${p.value.id}`)};q(p,async t=>{t&&(M(),m.value=[],await de())},{deep:!0});function ce(t){return{APPROVED:"success",PENDING:"warning",REJECTED:"danger"}[t]||"info"}function pe(){f.value={name:"",category:"UTILITY",language:"es_ES"},U.value="",w.value=[],c.value={},O.value=null}function me(){pe(),V.value=!0}const ve=K(()=>ae.value?"Editar plantilla":"Nueva plantilla");function fe(t){var i,r;O.value=t.id,f.value={name:t.name,category:t.category,language:t.language};const a=t.components.find(u=>u.type==="BODY")||{text:""};U.value=a.text,c.value={},(i=a.example)!=null&&i.body_text_named_params?a.example.body_text_named_params.forEach(({param_name:u,example:$})=>{c.value[u]=$}):(r=a.example)!=null&&r.body_text&&a.example.body_text[0].forEach((u,$)=>{c.value[String($+1)]=u});const e=t.components.find(u=>u.type==="BUTTONS")||{buttons:[]};w.value=e.buttons.map(u=>({type:u.type,text:u.text,url:u.url||""})),V.value=!0}function ge(){w.value.push({type:"URL",text:"",url:""})}function ye(){const t=P.value;return t.length?t.every(e=>/^\d+$/.test(e))?{body_text:[t.sort((i,r)=>+i-+r).map(i=>c.value[i]||"")]}:{body_text_named_params:t.map(e=>({param_name:e,example:c.value[e]||""}))}:void 0}async function _e(){if(f.value.name.trim()){j.value=!0;try{const t=ye(),a=[{type:"BODY",data:{text:U.value,...t?{example:t}:{}}},...w.value.length?[{type:"BUTTONS",data:{buttons:w.value}}]:[]],e={...f.value,components:a};O.value?await C.post(`${S}/wabas/${p.value.waba_id}/templates/${O.value}`,e):await C.post(`${S}/wabas/${p.value.waba_id}/templates`,e),await M(),V.value=!1}finally{j.value=!1}}}function he(t){se.require({message:`¿Eliminar la plantilla "${t.name}"?`,header:"Confirmar eliminación",icon:"pi pi-exclamation-triangle",acceptLabel:"Sí",rejectLabel:"No",accept:async()=>{await C.delete(`${S}/wabas/${p.value.waba_id}/templates/${t.name}`),await M()}})}const G=n(!1);async function be(){if(!_.value)return;const t=J.value.map(e=>e.wa_id),a=new FormData;a.append("messaging_product","whatsapp"),a.append("employer_id",ee.rawUserData.id.toString()),a.append("context_message_id",""),a.append("restaurant_id",p.value.id),a.append("template",JSON.stringify(_.value)),t.forEach(e=>a.append("recipients",e)),G.value=!0;try{await C.post(`${S}/webhook/send/template/bulk/`,a,!1),console.log(`✅ Difusión iniciada para ${t.length} usuarios`),k.value=!1}catch(e){console.error("✗ Error en difusión masiva:",e)}finally{G.value=!1}}return(t,a)=>(h(),E(R,null,[o(s(Z),{visible:k.value,"onUpdate:visible":a[1]||(a[1]=e=>k.value=e),modal:"",header:"Difundir Plantilla",style:{width:"100vw","max-width":"80rem","background-color":"white"}},{footer:g(()=>[o(s(v),{label:"Cancelar",text:"",severity:"secondary",onClick:a[0]||(a[0]=e=>k.value=!1)}),o(s(v),{label:"Enviar a todos",severity:"help",icon:"pi pi-broadcast",loading:G.value,onClick:be,autofocus:""},null,8,["loading"])]),default:g(()=>{var e,i,r,u,$,z,Q;return[l("div",Oe,[l("div",Pe,[Re,T(),l("h6",De,y((e=_.value)==null?void 0:e.id),1),Ae,T(),l("h6",Be,y((i=_.value)==null?void 0:i.name),1),je,T(),l("h6",Fe,y((r=_.value)==null?void 0:r.status),1),Ye,T(),l("h6",Me,y((u=_.value)==null?void 0:u.category),1),Ge,l("h6",Ke,y((Q=(z=($=_.value)==null?void 0:$.components)==null?void 0:z.find(x=>x.type=="BODY"))==null?void 0:Q.text),1)]),qe,l("div",He,[(h(!0),E(R,null,H(le.value,(x,we)=>(h(),Ue(s(v),{key:we,style:ke([{height:"2.3rem","border-radius":".3rem",padding:".5rem"},m.value.includes(x.label)?{backgroundColor:x.bg,color:"#fff"}:{backgroundColor:"#ffffff20",color:x.bg}]),text:"",onClick:ba=>te(x),class:"status",label:x.label},null,8,["onClick","label","style"]))),128))]),l("div",Je,[o(s(W),{rows:10,paginator:"",stripedRows:"",showGridlines:"",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,15,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} clientes",responsiveLayout:"scroll",scrollable:"",value:J.value,header:"clientes"},{default:g(()=>[o(s(b),{class:"py-1",header:"Nombre",field:"nombre"}),o(s(b),{class:"py-1",header:"Número",field:"wa_id"}),o(s(b),{class:"py-1",header:"Clasificación",field:"clasification"})]),_:1},8,["value"])])])]}),_:1},8,["visible"]),l("div",ze,[l("div",Qe,[l("div",We,[Ze,l("span",Xe,[ea,o(s(L),{modelValue:I.value,"onUpdate:modelValue":a[2]||(a[2]=e=>I.value=e),modelModifiers:{trim:!0},placeholder:"Buscar…",class:"w-full"},null,8,["modelValue"])]),o(s(D),{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=e=>p.value=e),options:F.value.filter(e=>e.exist),optionLabel:"name",placeholder:"Selecciona un restaurante",class:"w-full md:w-80 my-3"},null,8,["modelValue","options"])]),o(s(W),{value:re.value,dataKey:"id",paginator:"",rows:10,responsiveLayout:"scroll",loading:B.value,globalFilterFields:["name","category"],class:"shadow-md rounded-xl overflow-hidden"},{default:g(()=>[o(s(b),{class:"my-1 py-1",field:"name",header:"Nombre",bodyClass:"font-medium"}),o(s(b),{class:"my-1 py-1",field:"category",header:"Categoría"}),o(s(b),{class:"my-1 py-1",field:"language",header:"Idioma"}),o(s(b),{class:"my-1 py-1",header:"Estado"},{body:g(({data:e})=>[o(s(X),{severity:ce(e.status)},{default:g(()=>[T(y(e.status),1)]),_:2},1032,["severity"])]),_:1}),o(s(b),{class:"my-1 py-1",headerStyle:"width:8rem",header:"Acciones"},{body:g(({data:e})=>[l("div",aa,[o(s(v),{icon:"pi pi-eye",severity:"warning",onClick:i=>fe(e)},null,8,["onClick"]),o(s(v),{icon:"pi pi-trash",severity:"danger",onClick:i=>he(e)},null,8,["onClick"]),o(s(v),{icon:"pi pi-sync",label:"Difundir",severity:"help",onClick:i=>ue(e)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"]),l("div",la,[o(s(v),{label:"Nueva plantilla",icon:"pi pi-plus",severity:"help",class:"w-full md:w-auto",onClick:me})]),o(s(Z),{visible:V.value,"onUpdate:visible":a[9]||(a[9]=e=>V.value=e),header:ve.value,modal:"",class:"",style:{width:"90vw","max-width":"60rem","min-width":"50rem"}},{footer:g(()=>[o(s(v),{label:"Cancelar",text:"",severity:"secondary",onClick:a[8]||(a[8]=e=>V.value=!1)}),o(s(v),{label:"Guardar",severity:"help",icon:"pi pi-check",onClick:_e,loading:j.value,autofocus:""},null,8,["loading"])]),default:g(()=>[l("div",ta,[l("div",sa,[l("div",oa,[na,o(s(L),{modelValue:f.value.name,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value.name=e),class:"w-full"},null,8,["modelValue"])]),l("div",ia,[ra,o(s(D),{modelValue:f.value.category,"onUpdate:modelValue":a[5]||(a[5]=e=>f.value.category=e),options:oe,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),l("div",ua,[da,o(s(D),{modelValue:f.value.language,"onUpdate:modelValue":a[6]||(a[6]=e=>f.value.language=e),options:ne,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),l("div",null,[l("h6",ca,[T("Cuerpo del mensaje "),l("small",pa,"(usa "+y(t.param)+" o "+y(1)+")",1)]),o(s($e),{"auto-resize":"",modelValue:U.value,"onUpdate:modelValue":a[7]||(a[7]=e=>U.value=e),rows:"6",class:"w-full"},null,8,["modelValue"])]),P.value.length?(h(),E("div",ma,[va,(h(!0),E(R,null,H(P.value,e=>(h(),E("div",{key:e,style:{"align-items":"center",display:"flex",gap:"1rem"},class:""},[o(s(X),{severity:"info",style:{padding:"0 1rem",height:"2.8rem","min-width":"2.8rem"},class:"min-w-[5rem] text-center text-xl"},{default:g(()=>[T(y(e),1)]),_:2},1024),o(s(L),{modelValue:c.value[e],"onUpdate:modelValue":i=>c.value[e]=i,placeholder:`Ejemplo para ${e}`,class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])):Se("",!0),l("div",fa,[l("div",ga,[ya,o(s(v),{icon:"pi pi-plus",severity:"success",onClick:ge})]),l("div",_a,[(h(!0),E(R,null,H(w.value,(e,i)=>(h(),E("div",{key:i,class:"",style:{display:"grid","grid-template-columns":"10rem  1fr 1fr 3rem",gap:".5rem"}},[o(s(D),{modelValue:e.type,"onUpdate:modelValue":r=>e.type=r,options:ie,optionLabel:"label",optionValue:"value"},null,8,["modelValue","onUpdate:modelValue"]),o(s(L),{modelValue:e.text,"onUpdate:modelValue":r=>e.text=r,placeholder:"Texto"},null,8,["modelValue","onUpdate:modelValue"]),o(s(L),{modelValue:e.url,"onUpdate:modelValue":r=>e.url=r,placeholder:"URL"},null,8,["modelValue","onUpdate:modelValue"]),o(s(v),{icon:"pi pi-times",severity:"danger",onClick:r=>w.value.splice(i,1)},null,8,["onClick"])]))),128))])])])]),_:1},8,["visible","header"]),o(s(Le))])])],64))}},xa=xe(ha,[["__scopeId","data-v-0d4f36ea"]]);export{xa as default};
