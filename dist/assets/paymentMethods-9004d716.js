import{_ as q,j as h,T as G,I as R,k as H,m as g,U as b,r as J,o as d,c as r,a as t,F as M,b as V,e as c,f as w,au as E,d as x,t as k,h as K,N as p,i as $,u as Q,aw as W,q as X,x as Y}from"./index-bc571c19.js";const N=m=>(X("data-v-576f63b6"),m=m(),Y(),m),Z={class:"site-payments"},ee=N(()=>t("div",{class:"header-row"},[t("h1",{class:"title"},[t("b",null,"MÃ©todos de pago tiendas")])],-1)),se={class:"sites-grid"},te=["onClick"],ae={class:"site-card__title"},oe=N(()=>t("i",{class:"pi pi-map-marker"},null,-1)),ne={class:"site-card__stats"},ie={key:0,class:"site-card__content"},le={class:"toolbar"},ce={class:"toolbar__buttons"},de={class:"methods-grid"},re=["onClick"],_e={class:"method-tile__left"},ue={class:"method-texts"},pe={class:"method-name"},ve={key:0,class:"method-sub"},he={class:"method-tile__right"},me={key:0,class:"sticky-footer"},fe=N(()=>t("div",{class:"sticky-footer__info"},[t("i",{class:"pi pi-info-circle"}),t("span",null,"Tienes cambios sin guardar")],-1)),ye={class:"sticky-footer__actions"},ge={__name:"paymentMethods",setup(m){const v=h([]),f=h([]),o=G({}),y=h({}),_=h(null),C=h(!1),O=e=>{_.value=_.value===e?null:e},j=R(()=>JSON.stringify(o)!==JSON.stringify(y.value)),S=e=>(Array.isArray(o[e])||(o[e]=[]),o[e]),T=(e,a)=>S(e).includes(a),B=(e,a)=>{const i=S(e),l=i.indexOf(a);l>=0?i.splice(l,1):i.push(a)},D=e=>{o[e]=v.value.map(a=>a.id)},z=e=>{o[e]=[]},A=e=>{const a=new Set(v.value.map(s=>s.id)),i=new Set(S(e)),l=[];a.forEach(s=>{i.has(s)||l.push(s)}),o[e]=l},L=e=>e.icon||e.icon_class||"pi pi-money-bill",I=e=>e.english_name||e.code||e.slug||"",U=()=>Object.fromEntries(Object.entries(o).map(([e,a])=>[e,v.value.filter(i=>a.includes(i.id))])),F=async()=>{try{C.value=!0,await g.put(`${b}/site-payments`,{data:U()}),y.value=JSON.parse(JSON.stringify(o))}catch(e){console.error("Error guardando site-payments",e)}finally{C.value=!1}},P=()=>{const e=JSON.parse(JSON.stringify(y.value||{}));Object.keys(o).forEach(a=>delete o[a]),Object.entries(e).forEach(([a,i])=>o[a]=i)};return H(async()=>{const[e,a,i]=await Promise.all([g.get(`${b}/payment_methods`),g.get(`${b}/sites`),g.get(`${b}/site-payments`)]);v.value=e,f.value=a,f.value.filter(s=>s.show_on_web).forEach(({site_id:s})=>{const n=((i==null?void 0:i[s])||[]).map(u=>typeof u=="object"?u.id:u);o[s]=n.length?n:[]}),y.value=JSON.parse(JSON.stringify(o));const l=f.value.find(s=>s.show_on_web);l&&(_.value=l.site_id)}),(e,a)=>{const i=J("Tag"),l=J("Button");return d(),r("div",null,[t("div",Z,[ee,t("div",se,[(d(!0),r(M,null,V(f.value.filter(s=>s.show_on_web),s=>(d(),r("div",{key:s.site_id,class:x(["site-card",{open:_.value===s.site_id}])},[t("div",{class:"site-card__header",onClick:n=>O(s.site_id)},[t("div",ae,[oe,t("b",null,k(s.site_name),1)]),t("div",ne,[c(i,{class:"tag soft mr-2",style:{"background-color":"black",color:"white"}},{default:w(()=>[K(k((o[s.site_id]||[]).length)+" seleccionados ",1)]),_:2},1024),c(l,{icon:_.value===s.site_id?"pi pi-chevron-up":"pi pi-chevron-down",rounded:"",text:"","aria-label":"toggle",onClick:p(n=>O(s.site_id),["stop"])},null,8,["icon","onClick"])])],8,te),c(E,{name:"fade"},{default:w(()=>[_.value===s.site_id?(d(),r("div",ie,[t("div",le,[t("div",ce,[c(l,{label:"Seleccionar todos",size:"small",text:"",onClick:p(n=>D(s.site_id),["stop"])},null,8,["onClick"]),c(l,{label:"Invertir",size:"small",text:"",onClick:p(n=>A(s.site_id),["stop"])},null,8,["onClick"]),c(l,{label:"Limpiar",size:"small",text:"",class:"danger",onClick:p(n=>z(s.site_id),["stop"])},null,8,["onClick"])])]),t("div",de,[(d(!0),r(M,null,V(v.value,n=>(d(),r("div",{key:`m-${s.site_id}-${n.id}`,class:x(["method-tile",{active:T(s.site_id,n.id)}]),onClick:p(u=>B(s.site_id,n.id),["prevent"])},[t("div",_e,[t("i",{class:x([L(n),"method-icon"])},null,2),t("div",ue,[t("span",pe,k(n.name),1),I(n)?(d(),r("small",ve,k(I(n)),1)):$("",!0)])]),t("div",he,[c(Q(W),{inputId:`m-${s.site_id}-${n.id}`,modelValue:o[s.site_id],"onUpdate:modelValue":u=>o[s.site_id]=u,binary:!1,value:n.id,onClick:a[0]||(a[0]=p(()=>{},["stop"]))},null,8,["inputId","modelValue","onUpdate:modelValue","value"])])],10,re))),128))])])):$("",!0)]),_:2},1024)],2))),128))]),c(E,{name:"slide-up"},{default:w(()=>[j.value?(d(),r("div",me,[fe,t("div",ye,[c(l,{label:"Deshacer",text:"",onClick:P}),c(l,{label:"Guardar",class:"primary",loading:C.value,onClick:F},null,8,["loading"])])])):$("",!0)]),_:1})])])}}},ke=q(ge,[["__scopeId","data-v-576f63b6"]]);export{ke as default};
