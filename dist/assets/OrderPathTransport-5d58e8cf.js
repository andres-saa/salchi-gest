import{_ as De,E as ke,j as u,l as Ce,k as Te,r as b,o as W,c as K,e as o,f as r,a as s,F as ae,A as je,h as f,t as p,b as Fe,n as V,w as Se,Z as Ae,i as Pe,q as Ue,x as Ee}from"./index-30f9c1fa.js";import{s as Oe}from"./siteService-51a9b11b.js";import"./sass.default-a5b7a582.js";import{p as x}from"./purchaseOrderService-2f90e02c.js";import{u as S,a as se}from"./xlsx-4cca7150.js";import{E as $e}from"./exceljs.min-4b158bf5.js";import{F as oe}from"./FileSaver.min-cc8488c4.js";import{f as le}from"./format-8cf56335.js";import{e as ne}from"./es-f6133d36.js";import"./_commonjsHelpers-23102255.js";const _=q=>(Ue("data-v-84b721bb"),q=q(),Ee(),q),Me={class:"grid"},qe={class:"col-12 px-0 mx-0"},Re={class:"col-12",style:{display:"flex","flex-direction":"column"}},Ie=_(()=>s("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),Le={class:"col-12",style:{display:"flex","flex-direction":"column"}},Ne=_(()=>s("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),Ve={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},Be={class:"col-12",style:{display:"flex","justify-content":"center"}},He=_(()=>s("p",null,"Desea ageregar notas?",-1)),ze={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},Ge=_(()=>s("b",null,"Autor de la nota: ",-1)),Qe=_(()=>s("b",null,"Fecha: ",-1)),We={style:{border:"1px solid","border-radius":"0.3rem"},class:"p-2"},Ke=_(()=>s("b",null,"Contenido de la Observacion: ",-1)),Je=_(()=>s("br",null,null,-1)),Ye={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},Ze={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},Xe={class:"m-0 p-0"},et=_(()=>s("b",null,"Autorizada por:",-1)),tt={class:"m-0 p-0"},at=_(()=>s("b",null,"Sede:",-1)),st={class:"mt-0 p-0"},ot=_(()=>s("b",null,"Fecha de autorizacion:",-1)),lt={style:{display:"flex","flex-direction":"column","align-items":"start",gap:"0.5rem"}},nt={style:{display:"flex","align-items":"center",gap:"1rem"}},it={class:"text-right"},rt=["max","onUpdate:modelValue"],dt={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},ct={class:"m-auto",style:{"max-width":"1024px"}},ut={class:"col-12 px-3 mt-4 pack-butons",style:{display:"flex","justify-content":"end",gap:"1rem"}},pt={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},mt={class:"grid",style:{"align-items":"center"}},ht={class:"col-12 md:col-6 p-3"},vt={style:{"min-width":"max-content"}},_t={style:{"min-width":"max-content"}},yt={class:"m-0 p-0",style:{display:"flex",width:"100%","justify-content":"center","align-items":"center",gap:"0.5rem"}},ft={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},gt=_(()=>s("br",null,null,-1)),bt={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},wt={class:"m-0"},xt={class:"m-0"},Dt={key:0},kt=_(()=>s("b",null,"Notas",-1)),Ct={style:{display:"flex",gap:"1rem"}},ie=3,Tt={__name:"OrderPathTransport",setup(q){const C=ke(),R=u(!1),A=u([]),P=u(!1),B=u({}),re=l=>{if(l.some(t=>!t.ajustment&&t.ajustment!==0)){alert("por favor complete todos los campos");return}if(l.some(t=>t.ajustment>t.quantity_adjusted)){alert("No puedes enviar mas de lo solicitado");return}P.value=!0},H=u(""),v=u({}),z=u(!1),G=u(!1),J=u([]),de=async l=>{G.value=!0,J.value=await x.getPurchaseOrderHistory(l)},ce=()=>{A.value.forEach(l=>{l.ajustment=l.quantity_adjusted})},I=u(!1),ue=l=>{R.value=!0,v.value=l},pe=async l=>{I.value=!0,A.value=await x.getpurchaseOrderEntriesBypurchaseOrderID(l)},me={Generada:"#FF0000",Lista:"#FFA500","Entregada al transportista":"#FFFF00",Completada:"#00FF00"},he=[{color:"#7fffd4",description:"Esta todo bien"},{color:"rgb(251 53 146)",description:"Cuidado estan enviando mas de lo que reportan"},{color:" rgb(255, 175, 51)",description:"Recibiste menos de lo reportado"}],Y=Ce(),Z=u([]),X=u([{}]),U=u(!1),T=u(new Date(new Date().setDate(new Date().getDate()-7))),D=u(new Date),E=u(new Date(new Date().setDate(new Date().getDate()-7))),O=u(new Date),j=u(),k=u(),ve=(l,t)=>{E.value=l,O.value=t},$=l=>{const t=new Date,a=new Date(t);a.setDate(a.getDate()+1);const d=new Date(t);d.setDate(t.getDate()-l),T.value=d,l==1?(D.value=t,O.value=D.value,E.value=T.value,U.value=!1):(D.value=a,E.value=T.value,O.value=D.value,U.value=!1),_e()};Te(async()=>{Z.value=await Oe.getSites(),X.value=Z.value,j.value=await x.getPurchaseOrderByLap_id(ie)}),(()=>{k.value={global:{value:null,matchMode:je.CONTAINS}}})();function ee(l){const t=new Date(l),a=t.getFullYear(),d=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0");return`${a}-${d}-${i}`}const _e=async()=>{const l=X.value.map(d=>d.site_id);Y.rawUserData.id;const t=ee(E.value),a=ee(O.value);j.value=await x.getAllpurchaseOrderReportsFiltered(l,t,a)},M=u([]),ye=async(l,t,a)=>{M.value=await x.getpurchaseOrderEntriesBypurchaseOrderID(l);const d=M.value.map(g=>({Producto:g.item_name,Cantidad:g.quantity,"Unidad de medida":g.unit_measure})),i=S.json_to_sheet(d);i["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const h=S.book_new();S.book_append_sheet(h,i,"Usuarios"),se(h,`Orden_de_compra_${t}_${a} .xlsx`)},fe=l=>l.map(a=>{if(a.quantity!=a.ajustment)return{order_purchase_entry_id:a.entry_id,quantity_adjusted:a.ajustment}}).filter(a=>a),ge=async l=>{if(l.some(a=>!a.ajustment&&a.ajustment!==0)){alert("por favor complete todos los campos");return}C.setLoading(!0,"Transportando orden");const t={purchase_order_id:v.value.purchase_order_id,lap_id:v.value.lap_id,responsible_id:Y.rawUserData.id,ajusts:fe(l),order_purchase_notes:H.value};await x.PreparePurchaserOrder(t),j.value=await x.getPurchaseOrderByLap_id(ie),R.value=!1,I.value=!1,C.setLoading(!1,"Transportando orden"),z.value=!1,P.value=!1},be=async()=>{C.setLoading(!0,"generando descargas");const l=j.value,t=[];for(const e of l){const n=await x.getpurchaseOrderEntriesBypurchaseOrderID(e.purchase_order_id);t.push(...n)}const a={};t.forEach(e=>{const n=e.site_name,c=e.item_name,w=e.quantity,F=e.unit_measure;a[c]||(a[c]={unit_measure:F}),a[c][n]||(a[c][n]=0),a[c][n]+=w});const d=[...new Set(t.map(e=>e.site_name))],i=[],h=le(E.value,"dd-MMMM-yyyy",{locale:ne}),g=le(O.value,"dd-MMMM-yyyy",{locale:ne});h==g?i.push([`ORDENES DE COMPRA DEL ${h.toUpperCase()}`,...Array(d.length+2).fill("")]):i.push([`ORDENES DE COMPRA DEL${h.toUpperCase()} AL ${g.toUpperCase()}`,...Array(d.length+2).fill("")]);const L=["PRODUCTO","UNIDAD DE MEDIDA",...d,"TOTAL"];i.push(L);for(const[e,n]of Object.entries(a)){const c=[e,n.unit_measure];let w=0;for(const F of d){const te=n[F]||0;c.push(te),w+=te}c.push(w),i.push(c)}const m=new $e.Workbook,y=m.addWorksheet("Inventario por Sede");i.forEach((e,n)=>{const c=y.addRow(e);n===0?(c.height=40,c.font={name:"Arial",bold:!0,size:14},c.alignment={horizontal:"center",vertical:"middle",wrapText:!0},y.mergeCells(`A1:${y.getColumn(d.length+3).letter}1`),y.getRow(1).eachCell(w=>{w.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF00"}}})):n===1&&(c.font={name:"Arial",bold:!0})}),y.columns.forEach((e,n)=>{e.width=n===0?30:n===1?25:15,e.eachCell(c=>{c.font={name:"Arial"},c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),y.getRow(2).eachCell(e=>{e.font={name:"Arial",bold:!0}}),y.getRow(1).eachCell(e=>{e.font={name:"Arial",bold:!0,size:16}}),y.views=[{showGridLines:!1}];const Q=await m.xlsx.writeBuffer(),N=new Blob([Q],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});h==g?oe.saveAs(N,`Reporte de inventario del ${h}.xlsx`):oe.saveAs(N,`Reporte de inventario del ${h} al ${g} .xlsx`),C.setLoading(!1,"generando descargas")},we=async()=>{C.setLoading(!0,"generando descargas");const l=j.value;for(const i of l){const h=await x.getpurchaseOrderEntriesBypurchaseOrderID(i.purchase_order_id);M.value.push(...h)}console.log(M.value);const t=M.value.map(i=>({Fecha:i.date.split("T")[0],Hora:i.date.split("T")[1],Sede:i.site_name,Producto:i.item_name,Cantidad:i.quantity,"Unidad de medida":i.unit_measure})),a=S.json_to_sheet(t);a["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const d=S.book_new();S.book_append_sheet(d,a,"Usuarios"),se(d,"Compras de todas las sedes.xlsx"),C.setLoading(!1,"generando descargas")};function xe(l){l.key===","&&(alert("Por favor usa punto ( . ) para los decimales, gracias"),l.preventDefault())}return(l,t)=>{const a=b("Button"),d=b("Calendar"),i=b("Dialog"),h=b("Textarea"),g=b("router-link"),L=b("Tag"),m=b("Column"),y=b("DataTable"),Q=b("InputText"),N=b("Timeline");return W(),K(ae,null,[o(i,{class:"mx-2",visible:U.value,"onUpdate:visible":t[8]||(t[8]=e=>U.value=e),modal:"",header:"Periodo",style:{width:"25rem"}},{default:r(()=>[s("div",Me,[s("div",qe,[o(a,{text:"",label:"Hoy",onClick:t[0]||(t[0]=e=>$(0)),class:"p-button-text col-12 p-1 m-0"}),o(a,{text:"",label:"Ayer",onClick:t[1]||(t[1]=e=>$(1)),class:"p-button-text col-12 p-1 m-0"}),o(a,{text:"",label:"Últimos 7 días",onClick:t[2]||(t[2]=e=>$(7)),class:"p-button-text col-12 p-1 m-0"}),o(a,{text:"",label:"Últimos 14 días",onClick:t[3]||(t[3]=e=>$(14)),class:"p-button-text col-12 p-1"}),o(a,{text:"",label:"Últimos 28 días",onClick:t[4]||(t[4]=e=>$(28)),class:"p-button-text col-12 p-0"})]),s("div",Re,[Ie,o(d,{style:{"min-width":"max-content"},modelValue:T.value,"onUpdate:modelValue":t[5]||(t[5]=e=>T.value=e)},null,8,["modelValue"])]),s("div",Le,[Ne,o(d,{style:{"min-width":"max-content"},modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=e=>D.value=e),showWeek:""},null,8,["modelValue"])]),s("div",Ve,[s("div",Be,[o(a,{onClick:t[7]||(t[7]=()=>{ve(T.value,D.value),U.value=!1})},{default:r(()=>[f("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),o(i,{class:"mx-2",visible:P.value,"onUpdate:visible":t[12]||(t[12]=e=>P.value=e),modal:"",header:"Notas de Transporte de orden",style:{width:"25rem"}},{footer:r(()=>[s("div",ze,[o(a,{text:"",onClick:t[10]||(t[10]=e=>P.value=!1),severity:"danger",label:"cancelar"}),o(a,{onClick:t[11]||(t[11]=e=>ge(A.value.filter(n=>n.quantity!=0))),severity:"help",label:"Alistar orden"})])]),default:r(()=>[He,s("div",null,[o(h,{modelValue:H.value,"onUpdate:modelValue":t[9]||(t[9]=e=>H.value=e),style:{width:"100%",resize:"none",height:"10rem"}},null,8,["modelValue"])])]),_:1},8,["visible"]),o(i,{class:"mx-2",visible:z.value,"onUpdate:visible":t[13]||(t[13]=e=>z.value=e),modal:"",header:"Notas de la orden",style:{width:"28rem"}},{default:r(()=>[s("div",null,[s("p",null,[Ge,f(p(B.value.item.name),1)]),s("p",null,[Qe,f(p(B.value.item.status_timestamp.split("T")[0]),1)]),s("p",We,[Ke,f(),Je,f(p(B.value.item.notes),1)])])]),_:1},8,["visible"]),o(i,{class:"mx-2",visible:R.value,"onUpdate:visible":t[17]||(t[17]=e=>R.value=e),modal:"",header:"Interactuar con la orden",style:{width:"25rem"}},{default:r(()=>[s("div",Ye,[o(g,{to:`/purchase-order/recorrido/purchase-order-view/${v.value.purchase_order_id}`},{default:r(()=>[o(a,{text:"",style:{width:"100%"},severity:"help",class:"",label:"Ver detalles",icon:"pi pi-eye"})]),_:1},8,["to"]),o(a,{text:"",label:"Descargar en excel",style:{},onClick:t[14]||(t[14]=e=>{var n;return ye(v.value.purchase_order_id,v.value.site_name,(n=v.value.expedition_date)==null?void 0:n.split("T")[0])}),severity:"success",class:"",icon:"pi pi-download"}),o(a,{onClick:t[15]||(t[15]=e=>de(v.value.purchase_order_id)),text:"",label:"Ver Historial",style:{},severity:"warning",class:"",icon:"pi pi-history p-0 m-0"}),o(a,{onClick:t[16]||(t[16]=e=>pe(v.value.purchase_order_id)),label:"Transportar orden",style:{},severity:"help",class:"",icon:"pi  p-0 m-0"})])]),_:1},8,["visible"]),o(i,{class:"px-2",visible:I.value,"onUpdate:visible":t[20]||(t[20]=e=>I.value=e),modal:"",header:"Transportar orden",style:{width:"max-content","max-width":"100vw"}},{footer:r(()=>[s("div",dt,[o(a,{outlined:"",onClick:ce,severity:"help",label:"Todo esta completo"}),o(a,{onClick:t[19]||(t[19]=e=>re(A.value.filter(n=>n.quantity!=0))),severity:"help",label:"Transportar orden"})])]),default:r(()=>[s("div",Ze,[s("p",Xe,[et,f(" "+p(v.value.responsible_lap),1)]),s("p",tt,[at,f(" "+p(v.value.site_name),1)]),s("p",st,[ot,f(" "+p(v.value.status_timestamp.split("T")[0]),1)]),s("div",lt,[(W(),K(ae,null,Fe(he,e=>s("div",nt,[o(L,{style:V([`background-color:${e.color}`,{height:"2rem","aspect-ratio":"4 / 3"}])},null,8,["style"]),s("span",null,p(e.description),1)])),64))]),o(y,{showGridlines:"",style:{"max-width":"1024px"},stripedRows:"",filters:k.value,"onUpdate:filters":t[18]||(t[18]=e=>k.value=e),class:"col-12 m-auto p-0 m-0",value:A.value.filter(e=>e.quantity!=0),tableStyle:"min-width: 50rem;"},{default:r(()=>[o(m,{class:"py-0",field:"item_id",header:"id"}),o(m,{class:"py-0",field:"item_name",header:"Item"},{body:r(e=>[s("p",{style:V(e.data.ajustment===0?"text-decoration: line-through;background-color:#ffc9d1":"")},p(e.data.item_name),5)]),_:1}),o(m,{class:"py-0",field:"quantity_adjusted",header:"cant. Aprobada en despacho"},{body:r(e=>[s("p",it,p(e.data.quantity_adjusted),1)]),_:1}),o(m,{class:"py-0 px-0",field:"quantity",header:"cant. realmente recibida"},{body:r(e=>[Se(s("input",{onKeydown:xe,class:"text-right",max:e.data.quantity,min:0,"onUpdate:modelValue":n=>e.data.ajustment=n,style:V([{"background-color":"transparent",height:"2rem",width:"100%",border:"none"},e.data.quantity_adjusted===e.data.ajustment?"background-color: aquamarine;":e.data.ajustment===0?"background-color:#ffc9d1":e.data.ajustment<e.data.quantity?"background-color:#FFAF33;border:2px solid #FF7A33":e.data.ajustment>e.data.quantity?"background-color:#FF3393;border:2px solid #FF3342":""]),type:"number"},null,44,rt),[[Ae,e.data.ajustment]])]),_:1}),o(m,{class:"py-0",field:"unit_measure",header:"Und. de medida"}),o(m,{class:"py-0",field:"quantity",header:"interactuar"},{body:r(e=>[o(a,{onClick:n=>e.data.ajustment=e.data.quantity_adjusted,style:{"min-width":"max-content"},text:"",class:"px-0 py-1",label:"Esta completo"},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value"])])]),_:1},8,["visible"]),s("div",ct,[s("div",ut,[o(a,{severity:"help",icon:"pi pi-download",label:"Descargar Todo",onClick:we}),o(a,{severity:"help",icon:"pi pi-download",label:"Descargar Informe",onClick:be})])]),s("div",pt,[o(y,{stripedRows:"",showGridlines:"",style:{"max-width":"1024px"},filters:k.value,"onUpdate:filters":t[22]||(t[22]=e=>k.value=e),class:"col-12 m-auto",value:j.value,tableStyle:"min-width: 50rem;",paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reportes"},{header:r(()=>[s("div",mt,[s("div",ht,[o(Q,{style:{width:"100%"},class:"",modelValue:k.value.global.value,"onUpdate:modelValue":t[21]||(t[21]=e=>k.value.global.value=e),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:r(()=>[o(m,{class:"py-1",field:"purchase_order_id",header:"ID"}),o(m,{class:"py-1",field:"employer_name",header:"Solicitante"}),o(m,{class:"py-1",field:"site_name",header:"Sede"}),o(m,{class:"py-1",field:"date",header:"Fecha"},{body:r(e=>{var n;return[s("p",vt,p((n=e.data.expedition_date)==null?void 0:n.split("T")[0]),1)]}),_:1}),o(m,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:r(e=>{var n,c,w,F;return[s("span",_t,p((F=(w=(c=(n=e.data.expedition_date)==null?void 0:n.split("T")[1])==null?void 0:c.split(":"))==null?void 0:w.slice(0,2))==null?void 0:F.join(" : ")),1)]}),_:1}),o(m,{class:"py-1",field:"date",header:"Estado actual"},{body:r(e=>[o(L,{style:V([{width:"100%"},`background-color:${me[e.data.current_status]}`])},{default:r(()=>[f(p(e.data.current_status),1)]),_:2},1032,["style"])]),_:1}),o(m,{style:{"justify-content":"center"},class:"py-0 mx-0 px-0",field:"date",header:"Actuar"},{body:r(e=>[s("div",yt,[o(a,{label:"",style:{width:"min-content"},text:"",onClick:n=>ue(e.data),severity:"",class:"text-center p-1",icon:"fa-solid fa-hand"},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])]),o(i,{class:"mx-2",visible:G.value,"onUpdate:visible":t[23]||(t[23]=e=>G.value=e),modal:"",header:"Historial de la orden",style:{width:"min-content"}},{default:r(()=>[o(N,{value:J.value},{opposite:r(e=>{var n;return[s("p",ft,p(e.item.status_timestamp.split("T")[0]),1),f(),gt,s("p",bt,p((n=e.item.status_timestamp.split("T")[1])==null?void 0:n.split(":").slice(0,2).join(":")),1)]}),content:r(e=>[s("p",wt,[s("b",null,p(e.item.lap_name),1)]),s("p",xt,p(e.item.name),1),e.item.notes?(W(),K("p",Dt,[kt,f(" "+p(e.item.notes),1)])):Pe("",!0),s("div",Ct,[o(a,{disabled:!e.item.notes,style:{height:"2rem",opacity:"0","border-radius":"0.3rem"},cla:"",severity:"help",class:"",label:"Notas"},null,8,["disabled"]),o(a,{disabled:!e.item.conflict,style:{height:"2rem","border-radius":"0.3rem"},severity:"danger",class:"mb-4",label:"Conflictos"},null,8,["disabled"])])]),_:1},8,["value"])]),_:1},8,["visible"])],64)}}},Rt=De(Tt,[["__scopeId","data-v-84b721bb"]]);export{Rt as default};
