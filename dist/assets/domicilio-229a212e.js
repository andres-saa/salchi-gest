import{_ as re,f as s,g as $,h as B,O,A as de,u as ce,r as h,o as y,c as N,I as D,n as L,d as l,w as i,a as n,F as z,U as c,Q as ue,b as pe,q,l as G,P as H,k as J,t as me,p as he,e as ve}from"./index-31829377.js";import{_ as K}from"./Loading-5d821892.js";import{g as ye}from"./dropDownAux-54571327.js";const C=k=>(he("data-v-2b39e564"),k=k(),ve(),k),fe=C(()=>n("p",null,"¿Estás seguro de que quieres eliminar este barrio?",-1)),_e={class:"grid",style:{}},ge={class:"col-6 pr-2 pl-3"},be={class:"col-6 pl-2 pr-3"},we={class:"my-2",style:{width:"100%",display:"flex",gap:"1rem"}},Ce={class:"col-12 pl-0"},ke={class:"col-12 m-auto p-0",style:{"max-width":"900px"}},Ve={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Pe={class:"m-0 text-2xl my-4 my-0 py-0"},xe={class:"block mt-2 md:mt-0 p-input-icon-left"},Se=C(()=>n("i",{class:"pi pi-search"},null,-1)),Ue=C(()=>n("span",{class:"p-column-title"},"Code",-1)),Ee=C(()=>n("span",{class:"p-column-title"},"Code",-1)),Te=C(()=>n("span",{class:"p-column-title"},"Code",-1)),$e={__name:"domicilio",setup(k){const V=s(!1),r=s([{}]),Q=e=>{r.value.length>1&&r.value.splice(e,1)},v=s(!1);s({neighborhood_id:0,name:"",delivery_price:0,site_id:0,city_id:0});const P=s(0),u=s(0);$(u,(e,o)=>{e!=o&&ee().then(a=>{E.value=a,P.value=E.value[0]})}),$(v,(e,o)=>{e==!0&&(u.value={},r.value=[{}])});const W=async()=>{V.value=!0;try{await Promise.all(r.value.map(async e=>{if(e.site_id=P.value.site_id,e.city_id=u.value.city_id,!(await fetch(`${c}/neighborhood`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error(`Error creating neighborhood: ${e.name}`)})),U.add({severity:"success",summary:"Created",detail:"All neighborhoods created successfully",life:3e3}),r.value=[{}],v.value=!1,await x().then(e=>f.value=e),V.value=!1}catch(e){console.error("Request error:",e),U.add({severity:"error",summary:"Error",detail:"Failed to create some neighborhoods",life:3e3}),V.value=!1}},I=s([]),X=async()=>{try{const e=await fetch(`${c}/cities`);if(e.ok)return await e.json()}catch{}},Y=async()=>{const e={method:"DELETE"};try{if(!(await fetch(`${c}/neighborhood/${j.value.neighborhood_id}`,e)).ok)throw new Error("Error al eliminar el barrio");await x().then(a=>f.value=a),g.value=!1,U.add({severity:"success",summary:"Eliminado",detail:"Barrio eliminado con éxito",life:3e3})}catch(o){console.error("Error en la petición:",o),U.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el barrio",life:3e3})}};B(async()=>{X().then(e=>I.value=e)});const f=s([]),_=s(!1),g=s(!1),j=s({}),Z=e=>{j.value=e,g.value=!0},x=async()=>{const e=M.params.site_id;try{_.value=!0;const o=await fetch(`${c}/neighborhoods/by-site/${e}`);if(o.ok||(_.value=!1),o.ok){const a=await o.json();return _.value=!1,a}}catch{_.value=!1}},ee=async()=>{var o;if(!((o=u.value)!=null&&o.city_id))return;const e=u.value.city_id;try{const a=await fetch(`${c}/sites/city/${e}`);if(a.ok,a.ok)return await a.json()}catch{}};B(async()=>{x().then(e=>{f.value=e})});const R=s(),S=s(null),oe=()=>{S.value={global:{value:null,matchMode:ue.CONTAINS}}};O(()=>{oe()}),s(!1),s(!1);const U=de(),M=ce();s(!1);const te=s([]),ae=s([]);s({}),s({});const se=s(!0);s(!1),s([]);const A=async e=>{const o={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};fetch(`${c}/neighborhood/${e.neighborhood_id}`,o).then(a=>{if(!a.ok)throw new Error("La petición ha fallado");return a.json()}).then(a=>{console.log("Respuesta del servidor:",a)}).catch(a=>{console.error("Error en la petición:",a)})};async function le(){try{const e=await fetch(`${c}/employers/grouped-by-site`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let o=await e.json();o=o.map(a=>{const b=a.employers.reduce((p,d)=>(p[d.position]=p[d.position]||[],p[d.position].push(d),p),{});return{...a,positions:b}}),te.value=o,se.value=!1}catch(e){console.error("Error al obtener usuarios agrupados por sede:",e)}}async function ne(){try{const e=await fetch(`${c}/employers/grouped-by-position`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);ae.value=await e.json()}catch(e){console.error("Error al obtener usuarios agrupados por posición:",e)}}const E=s([]);return O(()=>{ye().then(e=>E.value=e)}),B(async()=>{await le(),await ne()}),$(()=>M.path,()=>{x().then(e=>{f.value=e})}),(e,o)=>{const a=h("Button"),b=h("Dialog"),p=h("Dropdown"),d=h("InputText"),F=h("InputNumber"),w=h("Column"),ie=h("DataTable");return y(),N(z,null,[_.value?(y(),D(K,{key:0,tittle:"Cargando barrios"})):L("",!0),V.value?(y(),D(K,{key:1,tittle:"Guardando barrios"})):L("",!0),l(b,{visible:g.value,"onUpdate:visible":o[1]||(o[1]=t=>g.value=t),style:{width:"auto"},header:"Confirmar eliminación",modal:!0,closable:!1},{default:i(()=>[fe,l(a,{label:"Cancelar",onClick:o[0]||(o[0]=t=>g.value=!1),class:"p-button-text"}),l(a,{label:"Eliminar",onClick:Y,class:"p-button-danger"})]),_:1},8,["visible"]),l(b,{visible:v.value,"onUpdate:visible":o[6]||(o[6]=t=>v.value=t),header:"Crear Nuevo Barrio",modal:!0,closable:!1},{footer:i(()=>[l(a,{label:"Cancelar",onClick:o[5]||(o[5]=t=>v.value=!1),class:"p-button-text"}),l(a,{label:"Crear",onClick:W,class:"p-button-text"})]),default:i(()=>[n("div",_e,[n("div",ge,[l(p,{style:{width:"100%"},modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=t=>u.value=t),options:I.value,optionLabel:"city_name",placeholder:"Ciudad"},null,8,["modelValue","options"])]),n("div",be,[l(p,{style:{width:"100%"},modelValue:P.value,"onUpdate:modelValue":o[3]||(o[3]=t=>P.value=t),options:E.value,optionLabel:"site_name",placeholder:"Sede"},null,8,["modelValue","options"])])]),(y(!0),N(z,null,pe(r.value,(t,m)=>(y(),N("div",{key:m},[n("div",we,[l(d,{modelValue:t.name,"onUpdate:modelValue":T=>t.name=T,placeholder:"Nombre del Barrio"},null,8,["modelValue","onUpdate:modelValue"]),l(F,{modelValue:t.delivery_price,"onUpdate:modelValue":T=>t.delivery_price=T,placeholder:"Precio del Domicilio"},null,8,["modelValue","onUpdate:modelValue"]),r.value.length>1?(y(),D(a,{key:0,text:"",class:"p-0",size:"small",severity:"danger",onClick:T=>Q(m)},{default:i(()=>[n("i",{class:q(["text-xl",G(H).TRASH])},null,2)]),_:2},1032,["onClick"])):L("",!0)])]))),128)),n("div",Ce,[l(a,{text:"",class:"p-0",onClick:o[4]||(o[4]=()=>{r.value.push({})})},{default:i(()=>[n("i",{class:q(["text-4xl",G(H).PLUS_CIRCLE])},null,2)]),_:1})])]),_:1},8,["visible"]),n("div",ke,[l(ie,{ref:"dt",value:f.value,selection:R.value,"onUpdate:selection":o[9]||(o[9]=t=>R.value=t),dataKey:"id",paginator:!0,rows:10,filters:S.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} neighborhoods",responsiveLayout:"scroll",scrollable:"","scroll-height":"62vh",frozenValue:e.lockedCustomers},{header:i(()=>[n("div",Ve,[n("p",Pe,[J("Precios Domicilios "),l(a,{class:"p-2 ml-4",label:"Nuevo Barrio",onClick:o[7]||(o[7]=t=>v.value=!0)})]),n("span",xe,[Se,l(d,{class:"",modelValue:S.value.global.value,"onUpdate:modelValue":o[8]||(o[8]=t=>S.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:i(()=>[l(w,{class:"p-2",selectionMode:"multiple",headerStyle:"width: 3rem; ",frozen:""}),l(w,{class:"p-2",field:"id",header:"Id",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[Ue,J(" "+me(t.data.neighborhood_id),1)]),_:1}),l(w,{class:"p-2",field:"name",header:"Barrio",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[Ee,l(d,{onchange:()=>A(t.data),style:{width:"100%"},modelValue:t.data.name,"onUpdate:modelValue":m=>t.data.name=m},null,8,["onchange","modelValue","onUpdate:modelValue"])]),_:1}),l(w,{class:"p-2",field:"delivery_price",header:"Precio del domicilio",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[Te,l(F,{style:{width:"100%"},modelValue:t.data.delivery_price,"onUpdate:modelValue":[m=>t.data.delivery_price=m,()=>A(t.data)]},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(w,{field:"actions",header:"Acciones"},{body:i(t=>[l(a,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:m=>Z(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters","frozenValue"])])],64)}}},Le=re($e,[["__scopeId","data-v-2b39e564"]]);export{Le as default};
