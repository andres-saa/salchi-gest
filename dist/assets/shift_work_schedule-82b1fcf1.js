import{_ as We,f as n,x as je,C as Fe,h as Ne,U as k,g as Me,a2 as le,r as j,o as p,c as m,d as l,w as c,a as t,l as F,F as Y,b as ne,k as I,t as v,n as ie,a4 as Be,y as pe,a5 as Re,p as Ae,e as He}from"./index-9a9a1d69.js";import{u as me,f as ve,s as ee,e as te,a as qe,b as ye,c as _e,d as fe}from"./subMonths-9cc250dc.js";import{s as ze}from"./siteService-dbe3b9ff.js";import{l as Je}from"./user-6f6d8f50.js";const y=q=>(Ae("data-v-ebe55bf8"),q=q(),He(),q),Pe={key:0,class:"user-info",style:{display:"flex","flex-direction":"column","align-items":"center"}},Ke=["src"],Ze={class:"col-12 p-0 mt-4"},Ge={key:0},Qe={key:0,class:"p-0 my-1"},Xe=y(()=>t("b",null," Desde: ",-1)),Ye={key:1,class:"p-0 my-1"},et=y(()=>t("b",null," Hasta: ",-1)),tt={key:2,class:"p-0 my-1 text-xl",style:{color:"green"}},at=y(()=>t("b",null," Descansa ",-1)),st=[at],ot={class:"p-0 my-1"},lt=y(()=>t("b",null,"Cargo:",-1)),nt={class:"p-0 my-1"},it=y(()=>t("b",null,"Telefono:",-1)),rt={class:"p-0 my-1"},dt=y(()=>t("b",null,"Contrato",-1)),ct={class:""},ut={class:"col-12 p-0 m-0 my-2"},pt={class:"col-12 p-0 m-0 my-2"},mt={class:"col-12 p-0 m-0 my-2"},vt={class:"col-12 p-0 m-0 my-2"},yt={class:"col-12 p-0 my-2"},_t={class:"col-12 p-0 my-2"},ft=y(()=>t("p",{class:"col-12 m-0 p-0 py-2"},"Desde:",-1)),ht=y(()=>t("p",{class:"col-12 m-0 p-0 py-2"},"Hasta:",-1)),gt=y(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este día de trabajo y todos sus registros?")],-1)),wt=y(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este registro?")],-1)),bt=y(()=>t("h3",null,"Nueva semana",-1)),Dt={style:{},class:"p-0 m-0 col-12"},kt={class:"col-12 p-0 m-0 mb-8"},St={class:"grid p-0 mx-auto"},xt={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},Ct={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},Tt={class:"col-12 md:col-2 py-2",style:{display:"flex",height:"4rem","justify-content":"end"}},Lt={class:"grid"},Ut={class:"col-2 p-0",style:{height:"80vh","overflow-y":"auto"}},$t={class:"p-0 text-sm",style:{display:"flex","justify-content":"center"}},It={style:{display:"flex",gap:"1rem","flex-direction":"column"},class:"pb-3 m-auto"},Ot=["onDragstart"],Et=["onClick","src","onError"],Vt={class:"my-0 py-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},Wt={class:"my-0 py-0",style:{"min-width":"min-content","text-transform":"uppercase","text-align":"center"}},jt={class:"col-10",style:{height:"80vh","overflow-y":"auto"}},Ft={class:"col-12 pb-6",style:{}},Nt={style:{display:"flex",gap:"0rem","flex-direction":"column"}},Mt={class:"py-0 px-4 text-center col-12 m-0 p-0 text",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},Bt={style:{"overflow-x":"auto"}},Rt={style:{"min-width":"max-content"}},At=["onDrop"],Ht={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},qt=["onClick","src","onError"],zt={key:0,class:"text-sm"},Jt={class:"py-0 my-0 text-sm text-center"},Pt={key:1,class:"text-sm"},Kt={class:"py-0 my-0"},Zt=y(()=>t("p",{class:"py-0 my-0"},[t("b",{style:{color:"green"}},"DESCANSA")],-1)),Gt={class:"",style:{"text-transform":"uppercase"}},Qt=y(()=>t("p",null,"Hora de llegada:",-1)),Xt=y(()=>t("p",null,"Hora de salida:",-1)),Yt={class:"col-12 p-0",style:{display:"flex","justify-content":"space-between"}},ea={__name:"shift_work_schedule",setup(q){const z=n(!1),u=n(null),re=s=>{u.value=s,z.value=!0},N=n(!1),h=n(new Date),w=n(new Date),J=Je(),d=je(),M=n(!1),P=n(null),g=n(),B=n(),U=n(),O=n(),L=n(!1),_=n(null),S=n(null),x=n(new Date),C=n(new Date),de=Fe(()=>!U.value||!O.value?"":`${ve(U.value,"dd/MM/yyyy")} - ${ve(O.value,"dd/MM/yyyy")}`),he=()=>{h.value=U.value||new Date,w.value=O.value||new Date,N.value=!0},ge=()=>{N.value=!1},$=async()=>{U.value=h.value,O.value=w.value,N.value=!1,await X(U.value),V()},ce=()=>{const s=new Date;h.value=ee(s,{weekStartsOn:1}),w.value=te(s,{weekStartsOn:1}),$()},we=()=>{const s=ee(new Date,{weekStartsOn:1});h.value=qe(s,7),w.value=te(h.value,{weekStartsOn:1}),$()},be=()=>{const s=new Date;h.value=ye(s),w.value=_e(s),$()},De=()=>{const s=new Date;h.value=ye(fe(s,1)),w.value=_e(fe(s,1)),$()},ke=s=>{P.value=s,M.value=!0},Se=async()=>{if(M.value=!1,d.setLoading(!0,"borrando"),!P.value)return;const s=await fetch(`${k}/shift_work_records/${P.value}`,{method:"DELETE"});s.ok?(V(),d.setLoading(!1,"borrando")):(console.error("Error al eliminar el registro:",await s.text()),alert("Hubo un error al eliminar el registro."),d.setLoading(!1,"borrando")),P.value=null},R=n(!1),K=n(null),xe=s=>{K.value=s,R.value=!0},Ce=async()=>{if(R.value=!1,!K.value)return;d.setLoading(!0,"borrando"),(await fetch(`${k}/shift_work_days/${K.value}`,{method:"DELETE"})).ok?(G.value=G.value.filter(e=>e.id!==K.value),d.setLoading(!1,"borrando")):(alert("Hubo un error al eliminar el día de trabajo."),d.setLoading(!1,"borrando"))},Te={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},Le=s=>{if(!(s instanceof Date))return console.error("getDayColor: date is not a Date object",s),"#FFFFFF";const e=s.toLocaleDateString("en-US",{weekday:"long"});return Te[e]},Z=n([]),G=n([]),ae=(s,e)=>{const o={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},i=s==null?void 0:s.trim().toLowerCase();e.target.src=o[i]||o.default},E=n(null),Q=n(!1),se=n(new Date);Ne(async()=>{B.value=await ze.getSites(),g.value=B.value.filter(o=>o.site_id==J.rawUserData.site_id)[0],E.value=B.value.filter(o=>o.site_id==J.rawUserData.site_id)[0];const s=await me.getUsersBySiteId(J.rawUserData.site_id);Z.value=s.filter(o=>o.status=="activo"),await fetch(`${k}/shift_work_days_with_records`),await X(new Date),await V()});const Ue=async()=>{const s=new Date,e=new Date(s.setDate(s.getDate()+(7-s.getDay())+1));h.value=ee(e,{weekStartsOn:1}),w.value=te(e,{weekStartsOn:1}),$()},$e=async()=>{const s=new Date,e=new Date(s.setDate(s.getDate()+(7-s.getDay())+8));h.value=ee(e,{weekStartsOn:1}),w.value=te(e,{weekStartsOn:1}),$()};Me(g,async(s,e)=>{var o,i;if(le()==1104&&((o=g.value.site_name)==null?void 0:o.toLowerCase())!="kennedy"&&((i=g.value.site_name)==null?void 0:i.toLowerCase())!="montes"){alert("No tienes permiso para administrar esta sede"),g.value=e;return}else{const b=await me.getUsersBySiteId(s.site_id);Z.value=b.filter(f=>f.status=="activo"),E.value=s,ce(),V(),await X(W);const W=new Date}});const V=async()=>{var i,b;if(le()==1104&&((i=g.value.site_name)==null?void 0:i.toLowerCase())!="kennedy"&&((b=g.value.site_name)==null?void 0:b.toLowerCase())!="montes")return;if(d.setLoading(!0,"cargando horario"),!g.value||!U.value||!O.value){alert("No olvide seleccionar una sede y un rango de fechas");return}const s=U.value.toISOString().split("T")[0],e=O.value.toISOString().split("T")[0],o=await fetch(`${k}/shift_filtered_work_days?site_id=${g.value.site_id}&start_date=${s}&end_date=${e}`);if(o.ok){d.setLoading(!1,"cargando horario");const W=await o.json();G.value=W.map(f=>(f.date=new Date(f.date),f.date.setDate(f.date.getDate()+1),f.users=f.records.map(T=>{let A=Z.value.find(D=>D.id===T.employer_id);if(A){let D={...A};const H=new Date(`${f.date.toISOString().split("T")[0]}T${T.start_time}`),a=new Date(`${f.date.toISOString().split("T")[0]}T${T.end_time}`);return D.arrivalTime=H,D.departureTime=a,D.hoursWorked=(a-H)/36e5,D.rest=T.rest,D}return null}).filter(T=>T!=null),d.setLoading(!1,"cargando horario"),f))}else d.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")};async function X(s){if(!E.value)return;let e=new Date(s.getTime()-s.getTimezoneOffset()*6e4).toISOString().split("T")[0];const o=await fetch(`${k}/shift_work_days`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:e,site_id:E.value.site_id})});o.ok?V():console.error("Error al agregar un nuevo día laboral",await o.text())}const Ie=s=>{_.value=s},Oe=s=>{S.value=s,L.value=!0},Ee=async()=>{if(L.value=!1,d.setLoading(!0,"cargando"),!_.value||!S.value)return;if(x.value.getTime()>=C.value.getTime()){alert("La hora de llegada no puede ser mayor o igual a la hora de salida."),d.setLoading(!1,"cargando"),L.value=!0;return}let s=x.value.toISOString().split("T")[1].slice(0,8),e=C.value.toISOString().split("T")[1].slice(0,8);const o={employer_id:_.value.id,work_day_id:S.value.id,start_time:s,end_time:e};await fetch(`${k}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),_.value.arrivalTime=x.value,_.value.departureTime=C.value,_.value.hoursWorked=(C.value-x.value)/36e5,S.value.users.push(_.value),L.value=!1,_.value=null,S.value=null,d.setLoading(!1,"cargando")},Ve=async()=>{if(L.value=!1,d.setLoading(!0,"cargando"),!_.value||!S.value)return;let s=x.value.toISOString().split("T")[1].slice(0,8),e=C.value.toISOString().split("T")[1].slice(0,8);const o={employer_id:_.value.id,work_day_id:S.value.id,start_time:s,end_time:e,rest:!0};await fetch(`${k}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});const i={..._.value};i.arrivalTime=x.value,i.departureTime=C.value,i.hoursWorked=(C.value-x.value)/36e5,i.rest=!0,S.value.users.push(i),L.value=!1,_.value=null,S.value=null,d.setLoading(!1,"cargando")};return(s,e)=>{var A,D,H;const o=j("Button"),i=j("Dialog"),b=j("Calendar"),W=j("Dropdown"),f=j("InputText"),T=j("InputIcon");return p(),m(Y,null,[l(i,{visible:z.value,"onUpdate:visible":e[2]||(e[2]=a=>z.value=a),modal:"",style:{width:"30rem"}},{footer:c(()=>[l(o,{label:"Cerrar",onClick:e[1]||(e[1]=a=>z.value=!1)})]),default:c(()=>{var a;return[t("h4",null,v(u.value.name),1),u.value?(p(),m("div",Pe,[t("img",{class:"shadow-3",src:`${F(k)}/read-product-image/300/employer-${u.value.dni}`,onError:e[0]||(e[0]=r=>ae(u.value.gender,r)),alt:"Foto del empleado",style:{width:"100%","aspect-ratio":"1 / 1","border-radius":"0.5rem","object-fit":"cover"}},null,40,Ke),t("div",Ze,[u.value.arrivalTime&&u.value.departureTime?(p(),m("div",Ge,[u.value.rest?ie("",!0):(p(),m("p",Qe,[Xe,I(v(new Date(u.value.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)])),u.value.rest?(p(),m("p",tt,st)):(p(),m("p",Ye,[et,I(" "+v(new Date(u.value.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)]))])):ie("",!0),t("p",ot,[lt,I(" "+v(u.value.position),1)]),t("p",nt,[it,I(" "+v(u.value.phone),1)]),t("p",rt,[dt,I(" "+v((a=u.value.contract_type)==null?void 0:a.toLowerCase()),1)])])])):ie("",!0)]}),_:1},8,["visible"]),l(i,{visible:N.value,"onUpdate:visible":e[5]||(e[5]=a=>N.value=a),modal:"",closable:""},{footer:c(()=>[l(o,{severity:"danger",label:"Cancelar",onClick:ge,class:"p-button-text"}),l(o,{severity:"success",label:"Aceptar",onClick:$})]),default:c(()=>[t("div",ct,[t("div",ut,[l(o,{class:"col-12 p-1",severity:"success",label:"Semana entrante",onClick:Ue})]),t("div",pt,[l(o,{class:"col-12 p-1",severity:"secondary",label:"Dentro de 2 semanas",onClick:$e})]),t("div",mt,[l(o,{class:"col-12 p-1",severity:"danger",label:"Esta semana",onClick:ce})]),t("div",vt,[l(o,{class:"col-12 p-1",severity:"help",label:"Semana pasada",onClick:we})]),t("div",yt,[l(o,{class:"col-12 p-1",severity:"warning",label:"Este mes",onClick:be})]),t("div",_t,[l(o,{class:"col-12 p-1",severity:"primary",label:"Mes pasado",onClick:De})])]),ft,l(b,{class:"col-12 m-0 p-0",modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),showIcon:""},null,8,["modelValue"]),ht,l(b,{class:"col-12 m-0 p-0",modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=a=>w.value=a),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),l(i,{visible:R.value,"onUpdate:visible":e[7]||(e[7]=a=>R.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:c(()=>[l(o,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[6]||(e[6]=a=>R.value=!1)}),l(o,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:Ce})]),default:c(()=>[gt]),_:1},8,["visible"]),l(i,{visible:M.value,"onUpdate:visible":e[9]||(e[9]=a=>M.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:c(()=>[l(o,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[8]||(e[8]=()=>M.value=!1)}),l(o,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:Se})]),default:c(()=>[wt]),_:1},8,["visible"]),l(i,{visible:Q.value,"onUpdate:visible":e[14]||(e[14]=a=>Q.value=a),style:{width:"22rem"},modal:"",closeOnEscape:"",onClose:e[15]||(e[15]=a=>Q.value=!1)},{footer:c(()=>[l(o,{label:"cancelar",onClick:e[12]||(e[12]=a=>Q.value=!1),class:"p-button-danger"}),l(o,{label:"Agregar",onClick:e[13]||(e[13]=a=>X(se.value)),class:"p-button-success"})]),default:c(()=>[bt,l(b,{class:"my-4",modelValue:se.value,"onUpdate:modelValue":e[10]||(e[10]=a=>se.value=a),showIcon:""},null,8,["modelValue"]),l(W,{class:"col-12 p-0",disabled:"",modelValue:E.value,"onUpdate:modelValue":e[11]||(e[11]=a=>E.value=a),options:B.value,optionLabel:"site_name",placeholder:"Select a site"},null,8,["modelValue","options"])]),_:1},8,["visible"]),t("div",Dt,[t("div",kt,[t("div",St,[t("div",xt,[l(W,{disabled:!((H=F(Be)["Horarios de trabajo admin"])!=null&&H.includes((D=(A=F(J))==null?void 0:A.rawUserData)==null?void 0:D.rol))&&F(le)()!=1104,style:{height:"100%"},class:"col-12 p-0 m-0",modelValue:g.value,"onUpdate:modelValue":e[16]||(e[16]=a=>g.value=a),options:B.value,optionLabel:"site_name"},null,8,["disabled","modelValue","options"])]),t("div",Ct,[l(f,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:de.value,"onUpdate:modelValue":e[17]||(e[17]=a=>de.value=a),onClick:he},null,8,["modelValue"])]),t("div",Tt,[l(o,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:V})])])]),t("div",Lt,[t("div",Ut,[t("div",$t,[t("div",It,[(p(!0),m(Y,null,ne(Z.value,a=>(p(),m("div",{key:a.id,draggable:"true",style:{display:"flex","flex-direction":"column","align-items":"center"},onDragstart:r=>Ie(a)},[t("img",{onClick:r=>re(a),class:"shadow-2 p-1",src:`${F(k)}/read-product-image/96/employer-${a.dni}`,alt:"user.name",onError:r=>ae(a.gender,r),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,Et),t("p",Vt,v(a.name.split(" ").slice(0,2).join(" ")),1),t("span",Wt,v(a.position),1)],40,Ot))),128))])])]),t("div",jt,[t("div",Ft,[t("div",Nt,[(p(!0),m(Y,null,ne(G.value,a=>(p(),m("div",{class:"p-0 m-0",key:a.id,style:{position:"relative"}},[t("div",{class:"shadow-2",style:pe({"background-color":Le(a.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[t("p",Mt,v(a.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"}))+" ",1)],4),t("div",Bt,[l(o,{style:{position:"absolute",right:"-1rem",top:"-1rem"},icon:"pi pi-trash text-2xl ",class:"p-button-rounded p-button-danger shadow-5",onClick:r=>xe(a.id)},null,8,["onClick"]),t("div",Rt,[t("div",{class:"shadow-5 p-3 m-0 p-4",style:{"border-radius":"0 0 0.5rem 0.5rem",display:"flex","overflow-x":"auto","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"},onDragover:e[18]||(e[18]=Re(()=>{},["prevent"])),onDrop:r=>Oe(a)},[(p(!0),m(Y,null,ne(a.users,r=>{var ue;return p(),m("div",{class:"shadow-2 p-2",key:r.id,style:pe([{"text-align":"center",width:"7rem","aspect-ratio":"1 / 1","background-color":"white",color:"black",position:"relative","border-radius":"0.5rem"},r.rest?"outline:2px solid green;  ":"background-color: white;"])},[t("p",Ht,v(r.name.split(" ").slice(0,1).join(" ")),1),t("img",{class:"shadow-2 p-1",onClick:oe=>re(r),src:`${F(k)}/read-product-image/96/employer-${r.dni}`,alt:"user.name",onError:oe=>ae(r.gender,oe),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,qt),r.rest?(p(),m("div",Pt,[t("p",Kt,[t("b",null,v((ue=r.contract_type)==null?void 0:ue.toLowerCase().slice(0,13)),1)]),Zt])):(p(),m("div",zt,[t("p",Jt," De: "+v(new Date(r.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}))+" A: "+v(new Date(r.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)])),l(o,{style:{position:"absolute",width:"1.5rem",height:"1.5rem",top:"-0.5rem",right:"-0.5rem","font-weight":"bold"},icon:"pi pi-times fw-bold",class:"p-button-rounded p-button-danger p-0",onClick:oe=>ke(r.id)},null,8,["onClick"])],4)}),128))],40,At)])])]))),128)),I(" ` ")])])])]),l(i,{visible:L.value,"onUpdate:visible":e[21]||(e[21]=a=>L.value=a),style:{width:"20rem"},modal:!0},{header:c(()=>[I(" . ")]),footer:c(()=>[t("div",Yt,[l(o,{severity:"help",label:"Descansa",onClick:Ve}),l(o,{severity:"success",label:"Aceptar",onClick:Ee})])]),default:c(()=>[t("h5",Gt,"Cuantas horas trabajo "+v(_.value.name)+"?",1),Qt,l(b,{modelValue:x.value,"onUpdate:modelValue":e[19]||(e[19]=a=>x.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:c(({clickCallback:a})=>[l(T,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"]),Xt,l(b,{modelValue:C.value,"onUpdate:modelValue":e[20]||(e[20]=a=>C.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:c(({clickCallback:a})=>[l(T,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])],64)}}},la=We(ea,[["__scopeId","data-v-ebe55bf8"]]);export{la as default};
