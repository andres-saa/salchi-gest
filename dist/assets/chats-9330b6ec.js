import{H as Ee,h as y,i as re,I as le,j as L,J as I,D as ye,g as $,o as p,c as k,a as t,n as c,u as i,F as pe,r as me,d as T,e as h,t as _,f,b as ce,k as D,p as Te,m as Le,_ as be,C as Ue,l as je,G as Ie,U as Re,q as ve,K as Oe,L as ze}from"./index-23e26b6d.js";import{c as xe,u as De,P as Ae}from"./Messages.vue_vue_type_style_index_0_scoped_09e7a26a_lang-eb42a6ec.js";/* empty css                                                             */import Ve from"./Messages-f36c8f95.js";const fe=R=>(Te("data-v-763db2f1"),R=R(),Le(),R),Me={class:"sidebar-container",style:{position:"relative"}},Pe={class:"header"},Be=fe(()=>t("strong",null," Notificaciones ",-1)),Fe=[Be],We=["onClick"],Je={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},Ke={style:{display:"flex","flex-direction":"column",width:"100%"}},qe=fe(()=>t("h3",null,[t("b",null," Buscar un usuario")],-1)),Ge=["onClick"],He={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},Xe={style:{"grid-area":"check",display:"flex","justify-content":"end",gap:".5rem"}},Ye={key:0,style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold"}},Ze={style:{color:"white"}},Qe=fe(()=>t("i",{style:{color:"greenyellow"},class:"fa-solid fa-check-double"},null,-1)),et={key:0,style:{bottom:"0","padding-bottom":"1rem",background:"linear-gradient(to bottom , transparent 3%, black)",display:"flex",position:"absolute","z-index":"100",width:"100%",color:"white"}},tt={key:1,style:{"text-align":"center",padding:".5rem",color:"#ffffff80"}},at={class:"flex align-items-center"},st=["src"],ot={class:"flex align-items-center"},it=["src"],nt={style:{display:"flex",gap:"1rem"}},rt={style:{color:"white"}},lt={class:"statuses"},ct=["onClick"],dt={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},ut={style:{"grid-area":"check",display:"flex","justify-content":"end",gap:".5rem"}},pt={key:0,style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold"}},mt={style:{color:"white"}},ft=fe(()=>t("i",{style:{color:"greenyellow"},class:"fa-solid fa-check-double"},null,-1)),_t={key:0,style:{bottom:"0","padding-bottom":"1rem",background:"linear-gradient(to bottom , transparent 3%, black)",display:"flex",position:"absolute","z-index":"100",width:"100%",color:"white"}},ht={key:1,style:{"text-align":"center",padding:".5rem",color:"#ffffff80"}},Se=1e3,gt=Ee({__name:"Sidebar",props:{restaurant:Object},setup(R){const b=y(!1),P=y(!1),Q=y(""),ee=y(!1),te=n=>{n.target.closest(".notifications")||(b.value=!1)};re(()=>{document.addEventListener("click",te)}),le(()=>{document.removeEventListener("click",te)});const g=xe(),q=R,l=De(),G=[{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}],d=y(q.restaurant||G[0]);y([{label:"Todos",textColor:"#4CAF50"},{label:"Sin leer",textColor:"#2196F3"},{label:"Favoritos",textColor:"#FFC107"},{label:"Preocupantes",textColor:"#F44336"},{label:"Top",textColor:"#9C27B0"}]);const N=async n=>{l.current_user=n,P.value=!1,b.value=!1;try{await L.post(`${I}/read-message/${n.user_id}/${d.value.id}`,!1)}catch(r){console.error("No se pudo marcar como leído",r)}n.unreaded=0},B=async n=>{var r;l.current_user=n.user_info,b.value=!1;try{await L.post(`${I}/read-message/${n.user_info.user_id}/${d.value.id}`,!1),await L.post(`${I}/view_notification/${n.id}`,!1),l.notifications[d.value.id]=await L.get(`${I}/notifications/${d.value.id}`);const e=(r=l.sidebars[d.value.id])==null?void 0:r.findIndex(a=>a.user_id==n.user_info.user_id);console.log(e),e!==-1&&(l.sidebars[d.value.id][e].unreaded=0)}catch(e){console.error("No se pudo marcar como leído",e)}},S=[{label:"SIN LEER",bg:"#f39c12",icon:"fa-solid fa-envelope-open"},{label:"LEIDOS",bg:"#16a085",icon:"fa-solid fa-envelope-circle-check"},{label:"TODO",bg:"#34495e",icon:"fa-solid fa-inbox"},{label:"SIN DATOS",bg:"#95a5a6",icon:"fa-solid fa-circle-question"},{label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-solid fa-triangle-exclamation"},{label:"CASUAL",bg:"#e67e22",icon:"fa-solid fa-person-walking"},{label:"FRECUENTE",bg:"#27ae60",icon:"fa-solid fa-repeat"},{label:"TOP",bg:"#2980b9",icon:"fa-solid fa-ranking-star"},{label:"ESTRELLA",bg:"#8e44ad",icon:"fa-solid fa-star"}],O=y({label:"SIN LEER",bg:"#f39c12",icon:"fa-solid fa-envelope-open"}),ae=y(0);let A=0;const F=y(!1),V=y(!1),w=y(null),se=(n="")=>{const r=n.trim().split(" ");return(Array.from(r[0]||"")[0]||"")+(r[1]?Array.from(r[1])[0]:"")};re(async()=>{l.notifications[d.value.id]=await L.get(`${I}/notifications/${d.value.id}`)});const _e=n=>n==="9+"?10:Number(n??0),z=(n,r)=>{const e=l.sidebars[n]||[];r.forEach(a=>{const o=e.findIndex(u=>u.wa_id===a.wa_id);if(o===-1)e.push(a);else{const u=e[o],C=u.ultimo_mensaje_id!==a.ultimo_mensaje_id,x=u.color!==a.color,E=u.nombre!==a.nombre,J=a.unreaded!=u.unreaded;(C||J||x||E)&&(e[o]=a)}}),l.sidebars[n]=e,ae.value=e.reduce((a,o)=>a+_e(o.unreaded),0)},H=async()=>{if(F.value||V.value)return;F.value=!0;const n=`${I}/last-contact-messages/${d.value.id}?limit=${Se}&offset=${A}`,r=await L.get(n,!1);r.length<Se&&(V.value=!0),A+=r.length,z(d.value.id,r),F.value=!1},U=()=>{const n=w.value;if(!n||F.value||V.value)return;n.scrollTop+n.clientHeight>=n.scrollHeight-120&&H()},he=n=>{const r=d.value.id,e=l.sidebars[r]||[],a=e.findIndex(o=>o.wa_id===n.wa_id);a!==-1?(e.splice(a,1),l.sidebars[r]=[n,...e]):l.sidebars[r]=[n,...e],ae.value=l.sidebars[r].reduce((o,u)=>o+Number(u.unreaded||0),0)};let j=null;const oe=()=>{const n=`wss://sockets-service.salchimonster.com/ws/salchimonster-${d.value.id}`;j=new WebSocket(n),j.onopen=()=>console.log("WebSocket conectado a",n),j.onerror=r=>console.error("WebSocket error",r),j.onclose=()=>setTimeout(oe,5e3),j.onmessage=async r=>{const e=JSON.parse(r.data);e!=null&&e.user_id&&he(e)}};let M=null;const X=()=>{const n=`wss://sockets-service.salchimonster.com/ws/salchimonster-notifications-${d.value.id}`;M=new WebSocket(n),M.onopen=()=>console.log("WebSocket conectado a",n),M.onerror=r=>console.error("WebSocket error",r),M.onclose=()=>setTimeout(X,5e3),M.onmessage=async r=>{l.notifications[d.value.id]=await L.get(`${I}/notifications/${d.value.id}`),ee.value=!0,setTimeout(()=>{ee.value=!1},1e3),JSON.parse(r.data)}};ye(d,async n=>{A=0,V.value=!1,l.sidebars[n.id]=[],j&&j.close(),oe(),X(),await H(),W.value=!1,setTimeout(()=>{W.value=!0},0)}),re(async()=>{var n;await H(),(n=w.value)==null||n.addEventListener("scroll",U),oe(),X()}),le(()=>{var n;(n=w.value)==null||n.removeEventListener("scroll",U),j&&j.close()});const W=y(!0),ge=n=>{O.value=n,W.value=!1,setTimeout(()=>{W.value=!0},0)};return(n,r)=>{var E,J,Y,Z,ie,ne;const e=$("RouterLink"),a=$("InputText"),o=$("ProgressSpinner"),u=$("Button"),C=$("Dialog"),x=$("Dropdown");return p(),k("div",Me,[t("div",Pe,[t("div",{class:"notifications",style:c([b.value?{height:"calc(100vh - 8rem)",top:"4rem",boxShadow:"0 1rem 1rem #00000040"}:{height:0,overflow:"hidden",top:"-2rem"},{width:"100%","max-width":"90%","background-color":"#ffffff90","max-height":"90vh",overflow:"auto",position:"absolute","z-index":"9",transition:"all linear .2s","border-radius":".5rem",right:"0","backdrop-filter":"blur(5px)",display:"flex","flex-direction":"column"}])},[t("h4",{class:"my-3 px-3",style:c(i(g).current_chat_theme.text)},Fe,4),(p(!0),k(pe,null,me((J=(E=i(l))==null?void 0:E.notifications)==null?void 0:J[d.value.id],(s,m)=>(p(),T(e,{"active-class":i(g).current_chat_theme.name==="dark"?"active":"active-light",key:m,to:`/chat/chats/messages/${d.value.id}/${s.user_info.wa_id}/${(s.user_info.nombre||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^A-Za-z0-9_-]/g,"")||"n"}/${s.user_info.color}?expirado=${s.user_info.expirado}&expira-en=${s.user_info.tiempo_para_expirar}`},{default:h(()=>[t("div",{class:"chat2",onClick:()=>B(s),style:c(s.resolved?"background-color: #fff":"background-color: #b6f8ff59")},[t("div",Je,[t("div",{style:c([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${s.user_info.color||"black"}`])},_(se(s.user_info.nombre)),5)]),t("div",{style:c([{"grid-area":"nombre"},`${i(g).current_chat_theme.text} ; ${s.resolved?"":"font-weight: bold;"}`])},_(s.description),5),t("span",{style:c([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},i(g).current_chat_theme.text])},_(s.user_info.nombre.slice(0,20))+"... ",5),t("p",{class:"p-0 m-0",style:c([{"grid-area":"fecha","text-align":"end","min-width":"max-content"},i(g).current_chat_theme.text])},_(s.user_info.hora_ultimo_mensaje),5)],12,We)]),_:2},1032,["active-class","to"]))),128))],4),f(C,{closable:!1,header:"Buscar un usuario",visible:P.value,"onUpdate:visible":r[2]||(r[2]=s=>P.value=s),style:{width:"50rem"},modal:""},{header:h(()=>[t("div",Ke,[qe,f(a,{modelValue:Q.value,"onUpdate:modelValue":r[0]||(r[0]=s=>Q.value=s),style:{width:"100%"},placeholder:"Escriba el nombre o numero del usuario"},null,8,["modelValue"])])]),default:h(()=>{var s;return[t("div",{class:ce(["",W.value?"chats active-new":"chats"]),style:{height:"67vh"},ref_key:"chatsContainer",ref:w,onScroll:U},[(p(!0),k(pe,null,me(((s=i(l).sidebars[d.value.id])==null?void 0:s.filter(m=>{var ue,we,ke,$e;const v=((we=(ue=Q.value)==null?void 0:ue.toLowerCase())==null?void 0:we.trim())||"";if(v==="")return!1;const K=((ke=m.nombre)==null?void 0:ke.toLowerCase())||"",de=(($e=m.wa_id)==null?void 0:$e.toLowerCase())||"";return K.includes(v)||de.includes(v)}))||[],(m,v)=>(p(),T(e,{"active-class":i(g).current_chat_theme.name=="dark"?"active":"active-light",key:v,to:`/chat/chats/messages/${d.value.id}/${m.wa_id}/${m.nombre}/${m.color}?expirado=${m.expirado}&?expira-en?=${m.tiempo_para_expirar}`},{default:h(()=>[t("div",{class:"chat",onClick:()=>N(m)},[t("div",He,[t("div",{style:c([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${m.color||"black"}`])},_(se(m.nombre)),5)]),t("div",{style:c([{"grid-area":"nombre","text-transform":"capitalize","font-weight":"500"},i(g).current_chat_theme.text])},_(m.nombre),5),t("div",{style:c([{"grid-area":"numero","text-transform":"capitalize",opacity:".7"},i(g).current_chat_theme.text])},"+"+_(m.wa_id),5),t("span",{style:c([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},i(g).current_chat_theme.text])},_(m.mensaje_truncado),5),t("span",{style:c([{"grid-area":"fecha","text-align":"end"},i(g).current_chat_theme.text])},_(m.abreviatura||m.fecha_ultimo_mensaje),5),t("div",Xe,[m.unreaded>0?(p(),k("div",Ye,[t("span",Ze,_(m.unreaded),1)])):D("",!0),Qe])],8,Ge)]),_:2},1032,["active-class","to"]))),128)),F.value?(p(),k("div",et,[(p(),T(o,{key:0,style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".3s","aria-label":"Custom ProgressSpinner"}))])):D("",!0),V.value?(p(),k("div",tt,"No hay más chats.")):D("",!0)],34),f(u,{rounded:"",onClick:r[1]||(r[1]=m=>P.value=!1),icon:"pi pi-times  text-xl",style:{position:"absolute",top:"-1rem",right:"-1rem"},severity:"danger"})]}),_:1},8,["visible"]),f(x,{modelValue:d.value,"onUpdate:modelValue":r[3]||(r[3]=s=>d.value=s),options:G,optionLabel:"name",style:c([{"background-color":"#ffffff20",outline:"none","box-shadow":"none"},i(g).current_chat_theme.border])},{option:h(s=>[t("div",at,[t("img",{src:s.option.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,st),t("span",null,[t("b",null,_(s.option.name),1)])])]),value:h(s=>[t("div",ot,[s.value?(p(),k("img",{key:0,src:s.value.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,it)):D("",!0),t("span",{style:c(i(g).current_chat_theme.text)},_(s.value?s.value.name:"Selecciona"),5)])]),_:1},8,["modelValue","style"]),t("div",nt,[f(u,{class:"options",text:""},{default:h(()=>[t("i",{class:"pi pi-search text-2xl",onClick:r[4]||(r[4]=s=>P.value=!0),style:c(i(g).current_chat_theme.text)},null,4)]),_:1}),t("div",{class:"notifications",style:{position:"relative",cursor:"pointer"},onClick:r[5]||(r[5]=s=>b.value=!b.value)},[f(u,{class:"options",text:"",style:{opacity:".5"}},{default:h(()=>[t("i",{class:"pi pi-bell text-2xl notifications",style:c(i(g).current_chat_theme.text)},null,4)]),_:1}),t("div",{class:ce(ee.value?"load":""),style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",position:"absolute",top:"-1rem",right:"-.7rem",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold",padding:".8rem"}},[t("span",rt,_(((ie=(Z=(Y=i(l))==null?void 0:Y.notifications)==null?void 0:Z[d.value.id])==null?void 0:ie.length)||0),1)],2)]),f(u,{class:"options",text:""},{default:h(()=>[t("i",{class:"pi pi-bars text-2xl",style:c(i(g).current_chat_theme.text)},null,4)]),_:1})])]),t("div",lt,[(p(),k(pe,null,me(S,(s,m)=>f(u,{style:c([{"border-radius":".3rem",padding:"0.3rem","text-transform":"capitalize"},s.label===O.value.label?{backgroundColor:s.bg,color:"#fff"}:{backgroundColor:"#ffffff20",color:s.bg}]),text:"",icon:s.icon,key:m,onClick:()=>ge(s),class:"status",label:s.label.toLowerCase()},null,8,["icon","onClick","label","style"])),64))]),t("div",{class:ce(["",W.value?"chats active-new":"chats"]),ref_key:"chatsContainer",ref:w,onScroll:U},[(p(!0),k(pe,null,me(((ne=i(l).sidebars[d.value.id])==null?void 0:ne.filter(s=>O.value.label==="TODO"?!0:O.value.label==="SIN LEER"?s.unreaded>0:O.value.label==="LEIDOS"?s.unreaded==0:s.clasification===O.value.label))||[],(s,m)=>(p(),T(e,{"active-class":i(g).current_chat_theme.name=="dark"?"active":"active-light",key:m,to:`/chat/chats/messages/${d.value.id}/${s.wa_id}/${s.nombre}/${s.color}?expirado=${s.expirado}&?expira-en?=${s.tiempo_para_expirar}`},{default:h(()=>[t("div",{class:"chat",onClick:()=>N(s)},[t("div",dt,[t("div",{style:c([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${s.color||"black"}`])},_(se(s.nombre)),5)]),t("div",{style:c([{"grid-area":"nombre","text-transform":"capitalize","font-weight":"500"},i(g).current_chat_theme.text])},_(s.nombre),5),t("div",{style:c([{"grid-area":"numero","text-transform":"capitalize",opacity:".7"},i(g).current_chat_theme.text])},"+"+_(s.wa_id),5),t("span",{style:c([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},i(g).current_chat_theme.text])},_(s.mensaje_truncado),5),t("span",{style:c([{"grid-area":"fecha","text-align":"end"},i(g).current_chat_theme.text])},_(s.abreviatura||s.fecha_ultimo_mensaje),5),t("div",ut,[s.unreaded>0?(p(),k("div",pt,[t("span",mt,_(s.unreaded),1)])):D("",!0),ft])],8,ct)]),_:2},1032,["active-class","to"]))),128)),F.value?(p(),k("div",_t,[(p(),T(o,{key:0,style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".3s","aria-label":"Custom ProgressSpinner"}))])):D("",!0),V.value?(p(),k("div",ht,"No hay más chats.")):D("",!0)],34)])}}}),Ce=be(gt,[["__scopeId","data-v-763db2f1"]]),Ne=R=>(Te("data-v-07d567be"),R=R(),Le(),R),vt={class:"top-bar-left"},yt={style:{height:"3rem",width:"3rem",display:"flex","align-items":"center"}},bt={class:"top-bar-info"},xt={style:{display:"flex","flex-direction":"column"}},wt={style:{display:"flex","align-items":"center",gap:"1rem"}},kt={style:{height:"100%",overflow:"auto"}},$t={class:"message-area"},St=Ne(()=>t("i",{class:"fas fa-laugh-wink emoji-picker"},null,-1)),Ct=["onKeydown"],Et=["src"],Tt={style:{position:"relative",transition:".2s"}},Lt=Ne(()=>t("i",{class:"pi pi-send text-2xl"},null,-1)),Dt={style:{display:"flex",gap:"1rem"}},Nt={class:"flex gap-2"},Ut={style:{width:"100%",display:"flex","justify-content":"end"}},jt=Ee({__name:"Main",setup(R){const b=xe();function P(e){return{APPROVED:"success",PENDING:"warning",REJECTED:"danger"}[e]||"info"}const Q=e=>{ee(e),q.value=!1};async function ee(e){const a=e,o=new FormData;o.append("messaging_product","whatsapp"),o.append("employer_id",G.rawUserData.id.toString()),o.append("context_message_id",""),o.append("restaurant_id",l.params.restaurant_id),o.append("to",l.params.user_id),o.append("type","template"),o.append("template",JSON.stringify(a));try{w.sending=!0,await L.post(`${I}/webhook/send/template/`,o,!1),console.log(`✅ Template enviado a ${to}`)}catch(u){console.error(`✗ Error al enviar template a ${to}`,u)}finally{w.sending=!1}}const te=y([{}]),g=e=>{e.target.closest(".emoji-picker")||(d.value=!1)};re(()=>{document.addEventListener("click",g),r()}),le(()=>{document.removeEventListener("click",g)});const q=y(!1);y([]);const l=Ue(),G=je(),d=y(!1),N=y(""),B=y(!1),S=y(null),O=y(!1),ae=y(!0),A=Ie(()=>{var e,a;return ae.value&&(((e=l.query)==null?void 0:e.expirado)==="true"||((a=l.query)==null?void 0:a.expirado)===!0)}),F=e=>{ae.value=e};ye(()=>{var e;return(e=l.params)==null?void 0:e.restaurant_id},()=>{r()}),ye(A,e=>{N.value=e?"Conversación expirada":""},{immediate:!0});const V={"SIN DATOS":{bg:"#7f8c8d",icon:"fa-circle-question"},PREOCUPANTE:{bg:"#e74c3c",icon:"fa-triangle-exclamation"},CASUAL:{bg:"#e67e22",icon:"fa-person-walking"},FRECUENTE:{bg:"#27ae60",icon:"fa-repeat"},TOP:{bg:"#2980b9",icon:"fa-ranking-star"},ESTRELLA:{bg:"#8e44ad",icon:"fa-star"}},w=De();y([{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}]);const se=(e="")=>{const a=e.trim().split(" ");return(Array.from(a[0]||"")[0]||"")+(a[1]?Array.from(a[1])[0]:"")},_e=e=>{N.value+=e.i,d.value=!1};let z=null,H=[],U=null;const he=async()=>{if(B.value&&z){z.stop();return}try{U=await navigator.mediaDevices.getUserMedia({audio:!0});const e=MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")?"audio/ogg;codecs=opus":"audio/webm;codecs=opus";z=new MediaRecorder(U,{mimeType:e}),z.ondataavailable=a=>a.data.size&&H.push(a.data),z.onstop=()=>{const a=new Blob(H,{type:e.split(";")[0]});H=[],U.getTracks().forEach(u=>u.stop());const o=e.startsWith("audio/ogg")?"ogg":"webm";S.value={file:new File([a],`audio_${Date.now()}.${o}`,{type:a.type}),url:URL.createObjectURL(a)},B.value=!1},z.start(),B.value=!0}catch(e){console.error("No se pudo abrir el micrófono:",e.name,e.message),B.value=!1,U&&U.getTracks().forEach(a=>a.stop())}},j=()=>{S.value&&URL.revokeObjectURL(S.value.url),S.value=null};le(()=>{z&&B.value&&z.stop(),U&&U.getTracks().forEach(e=>e.stop())});const oe={messaging_product:"whatsapp",employer_id:G.rawUserData.id,context_message_id:null},M=async(e,a=null)=>{var u,C;if(A.value||!e.trim())return;const o=new FormData;o.append("messaging_product","whatsapp"),o.append("employer_id",G.rawUserData.id),o.append("context_message_id",((u=a==null?void 0:a.message_data)==null?void 0:u.wa_id)||null),o.append("restaurant_id",(C=l.params.restaurant_id)==null?void 0:C.toString()),o.append("to",l.params.user_id),o.append("type","text"),o.append("text",JSON.stringify({body:e})),N.value="";try{w.sending=!0,await L.post(`${I}/webhook/send/text/`,o,!1)}catch(x){console.error("Error al enviar texto",x)}w.sending=!1},X=async()=>{var u;if(A.value||!S.value||O.value)return;const e=S.value;j(),O.value=!0;const a=new FormData;a.append("files",e.file);const o={...oe,restaurant_id:(u=l.params.restaurant_id)==null?void 0:u.toString(),to:l.params.user_id,type:"audio",text:{body:""},file_index:0};a.append("payloads",JSON.stringify(o));try{await L.post(`${I}/webhook/send`,a,!1)}catch(C){console.error("Error al enviar audio",C)}O.value=!1},W=async e=>{var C;if(A.value||!(e!=null&&e.length))return;const a=new FormData,o={restaurant_id:(C=l.params.restaurant_id)==null?void 0:C.toString(),to:l.params.user_id,messaging_product:"whatsapp",employer_id:G.rawUserData.id,context_message_id:null},u=x=>{var Z;const{type:E,name:J}=x;if(E.startsWith("image/"))return"image";if(E.startsWith("audio/"))return"audio";if(E.startsWith("video/"))return"video";if(E==="application/pdf")return"document";const Y=(Z=J.split(".").pop())==null?void 0:Z.toLowerCase();return["jpg","jpeg","png","webp"].includes(Y)?"image":["mp3","wav","ogg","opus"].includes(Y)?"audio":"document"};e.forEach((x,E)=>{a.append("files",x.file),a.append("payloads",JSON.stringify({...o,type:u(x.file),text:{body:x.caption||""},file_index:E}))}),w.sending=!0;try{await L.post(`${I}/webhook/send`,a,!1)}catch(x){console.error("Error al enviar archivos",x)}w.sending=!1},ge=e=>{e.key==="Enter"&&(e.preventDefault(),N.value.trim()&&M(N.value))},n=e=>{e.key==="Enter"&&S.value&&(e.preventDefault(),X())};re(()=>window.addEventListener("keydown",n)),le(()=>window.removeEventListener("keydown",n));async function r(){if(l.params.restaurant_id){const a=(await L.get(`${Re}/restaurants`)||[]).find(o=>{var u;return o.id==((u=l.params)==null?void 0:u.restaurant_id)})||null;a&&(te.value=await L.get(`${I}/wabas/${a.waba_id}/templates/`))}}return(e,a)=>{var ie,ne,s,m;const o=$("Button"),u=$("RouterView"),C=$("Textarea"),x=$("Column"),E=$("Tag"),J=$("DataTable"),Y=$("RouterLink"),Z=$("Dialog");return p(),k("div",{class:"main-container",style:c([i(b).current_chat_theme.bg_image,{}])},[(ie=i(l).params)!=null&&ie.user_id?(p(),k("div",{key:0,tabindex:"0",class:"top-bar",style:c([{"border-radius":".5rem",gap:"1rem"},i(b).current_chat_theme.bg_bars])},[t("div",vt,[t("div",yt,[t("div",{class:"cliente-img",style:c([`background-color:${i(l).params.color}`,{height:"100%",color:"white",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"}])},_(se(i(l).params.user_name)),5)]),t("div",bt,[t("div",xt,[t("strong",null,[t("h5",{style:c([{"text-transform":"capitalize",margin:"0"},i(b).current_chat_theme.text])},_((ne=i(l).params.user_name)==null?void 0:ne.substring(0,20)),5)]),t("span",null,"+"+_(i(l).params.user_id),1)]),t("div",null,[i(w).current_user.clasification?(p(),T(o,{key:0,style:c({height:"2.3rem",display:"flex",alignItems:"center",textTransform:"capitalize",gap:"0.35rem",backgroundColor:((s=V[i(w).current_user.clasification])==null?void 0:s.bg)||"#7f8c8d",color:"#fff"})},{default:h(()=>{var v,K;return[t("i",{class:ce(["fa-solid",(v=V[i(w).current_user.clasification])==null?void 0:v.icon]),"aria-hidden":"true",style:{"font-size":"0.9rem"}},null,2),ve(" "+_((K=i(w).current_user.clasification)==null?void 0:K.toLowerCase())+" "+_(i(w).current_user.times_purchased)+" compras ",1)]}),_:1},8,["style"])):D("",!0)])])]),t("div",wt,[f(o,{icon:"pi pi-shopping-cart",class:"p-2",style:{color:"white","min-width":"max-content"},severity:"warning",label:"Ing. Ped"}),f(o,{text:"",class:"p-2"},{default:h(()=>[t("i",{style:c(i(b).current_chat_theme.text),class:"pi pi-search text-2xl"},null,4)]),_:1}),f(o,{text:"",class:"p-2"},{default:h(()=>[t("i",{style:c(i(b).current_chat_theme.text),class:"pi pi-bars text-2xl"},null,4)]),_:1})])],4)):D("",!0),t("div",kt,[f(u,null,{default:h(()=>[i(l).params.user_id?(p(),T(Ve,{key:0,send_function:W,send_text:M,change_expiration:F,ref:"Messages_element"},null,512)):D("",!0)]),_:1})]),(m=i(l).params)!=null&&m.user_id?(p(),k("div",{key:1,class:"chat-bar",tabindex:"0",style:c(i(b).current_chat_theme.bg_bars)},[d.value?(p(),T(i(Ae),{key:0,native:!0,style:{position:"absolute",bottom:"4rem","z-index":"1000"},onSelect:_e,class:"emoji-picker"})):D("",!0),t("div",$t,[f(o,{text:"",style:{"font-size":"2rem"},onClick:a[0]||(a[0]=v=>d.value=!d.value)},{default:h(()=>[St]),_:1}),S.value?(p(),k("div",{key:1,class:"audio-chip",onKeydown:Oe(ze(X,["prevent"]),["enter"])},[t("audio",{style:{width:"100%","min-width":"28rem","max-width":"42rem"},src:S.value.url,controls:""},null,8,Et),f(o,{text:"",class:"btn-audio-trash p-2",onClick:j},{default:h(()=>[t("i",{style:c(i(b).current_chat_theme.text),class:"pi pi-trash text-2xl p-0"},null,4)]),_:1})],40,Ct)):(p(),T(C,{key:0,modelValue:N.value,"onUpdate:modelValue":a[1]||(a[1]=v=>N.value=v),autoResize:"",class:"message",disabled:A.value,onKeydown:ge,style:c(`${i(b).current_chat_theme.text} ; ${i(b).current_chat_theme.border} `)},null,8,["modelValue","disabled","style"]))]),t("div",Tt,[!S.value&&N.value.trim()===""?(p(),T(o,{key:0,text:"",style:{height:"100%"},onClick:he},{default:h(()=>[t("i",{style:c(i(b).current_chat_theme.text),class:ce(B.value?"pi pi-stop text-2xl text-red-500":"pi pi-microphone text-2xl ")},null,6)]),_:1})):S.value?(p(),T(o,{key:1,disabled:O.value,text:"",onClick:X},{default:h(()=>[t("i",{style:c(i(b).current_chat_theme.text),class:"pi pi-send text-2xl"},null,4)]),_:1},8,["disabled"])):(p(),T(o,{key:2,style:c(i(b).current_chat_theme.text),text:"",onClick:a[2]||(a[2]=v=>M(N.value))},{default:h(()=>[Lt]),_:1},8,["style"]))]),t("div",Dt,[f(o,{severity:"danger",style:{},icon:"pi pi-clock",class:"p-2",onClick:a[3]||(a[3]=()=>q.value=!0)}),i(l).query.expirado?(p(),T(o,{key:0,icon:"pi pi-bolt",severity:"warning",style:{},class:"p-2",onClick:a[4]||(a[4]=()=>q.value=!0)})):D("",!0)])],4)):D("",!0),f(Z,{visible:q.value,"onUpdate:visible":a[5]||(a[5]=v=>q.value=v),header:"Envio de plantilla",style:{width:"50rem"}},{default:h(()=>[f(J,{value:te.value,dataKey:"id",paginator:"",rows:10,responsiveLayout:"scroll",class:"shadow-md rounded-xl overflow-hidden"},{default:h(()=>[f(x,{class:"my-1 py-1",field:"name",header:"Nombre",bodyClass:"font-medium"}),f(x,{class:"my-1 py-1",header:"Estado"},{body:h(({data:v})=>[f(E,{severity:P(v.status)},{default:h(()=>[ve(_(v.status),1)]),_:2},1032,["severity"])]),_:1}),f(x,{class:"my-1 py-1",header:"Estado"},{body:h(({data:v})=>{var K,de;return[ve(_((de=(K=v==null?void 0:v.components)==null?void 0:K.find(ue=>ue.type=="BODY"))==null?void 0:de.text),1)]}),_:1}),f(x,{class:"my-1 py-1",headerStyle:"width:8rem",header:"Acciones"},{body:h(({data:v})=>[t("div",Nt,[f(o,{icon:"pi pi-send",label:"Enviar",severity:"help",onClick:K=>Q(v)},null,8,["onClick"])])]),_:1})]),_:1},8,["value"]),t("div",Ut,[f(Y,{to:"/chat/templates"},{default:h(()=>[f(o,{severity:"help",icon:"pi pi-plus",label:"Agregar otro"})]),_:1})])]),_:1},8,["visible"])],4)}}}),It=be(jt,[["__scopeId","data-v-07d567be"]]);const Rt={__name:"chats",setup(R){const b=xe();return(P,Q)=>(p(),k("div",{class:"chat-container",style:c(i(b).current_chat_theme.bg)},[f(Ce,{style:{"box-shadow":".5rem 0 1rem #00000010"},class:"sidebar-left",restaurant:{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}}),f(It),f(Ce,{style:{"box-shadow":"-.5rem 0 1rem #00000010"},class:"sidebar-right",restaurant:{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}})],4))}},Mt=be(Rt,[["__scopeId","data-v-5877f5bf"]]);export{Mt as default};
