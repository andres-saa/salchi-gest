import{r as i,H as ue,y as pe,k as ce,h as me,E as ve,a as v,o as s,c as m,d as o,w as u,b as n,F as z,K as b,U as x,I as ye,f as y,e as G,t as g,m as f,q as U,u as I,s as k}from"./index-b5f7dc11.js";import{f as $,a as Y}from"./formatoPesos-8aa989a0.js";import{r as ge,u as A,w as he}from"./xlsx-4f9172c7.js";const fe={class:"m-0 my-3"},we={style:{display:"flex","justify-content":"end"}},_e={class:"grid p-3",style:{"align-items":"center","justify-content":"space-between",display:"flex",gap:"1rem"}},be=n("h3",{class:"px-2"},[n("i",{class:"fa fa-upload"}),U(),n("b",null,"Carga de precios")],-1),xe=n("div",{style:{display:"flex",width:"100%","justify-content":"end","flex-wrap":"wrap",gap:"1rem","align-items":"center"}},null,-1),ke={style:{"margin-top":"3rem"}},Ie={class:"grid p-3",style:{"align-items":"center","justify-content":"space-between",display:"flex",gap:"1rem"}},Pe=n("h3",{class:"px-2"},[n("i",{class:"fa fa-carrot"}),U(),n("b",null,"Ingredientes")],-1),Ce={style:{display:"flex",width:"100%","justify-content":"end","flex-wrap":"wrap",gap:"1rem","align-items":"center"}},Ve=n("h6",{class:"m-0"},[n("b",null," Porcentajes visible")],-1),Ee=n("div",null,null,-1),Te={__name:"pricesCdiTable",setup(Ue){const D=i([]),H=i(null),R=i(!1),Z=()=>{H.value.click()},ee=async a=>{const t=a.target.files[0];if(t)try{const r=await te(t);D.value=r,R.value=!0,console.log(D.value)}catch(r){console.error("Error al leer el archivo:",r)}},te=a=>new Promise((t,r)=>{const c=new FileReader;c.onload=_=>{try{const p=ge(_.target.result,{type:"binary"}),P=p.SheetNames[0],S=p.Sheets[P],h=A.sheet_to_json(S);t(h)}catch(p){r(p)}},c.onerror=_=>{r(_)},c.readAsBinaryString(a)}),q=ue(),N=i([]),J=i({}),T=i(!1),d=i({}),B=i([{}]),K=i([]),L=i(!1),M=i(!1),ae=()=>{L.value=!1,d.value={},T.value=!0},le=async()=>{const a=J.value.id;await b.delete(`${x}/delete-ingredient/${a}`,"Borrando ingrediente"),M.value=!1,O()},F=i([{percent:"cargando..."}]),Q=[{header:"Id",value:"id",width:"1",frozen:!0},{header:"Nombre ingrediente",value:"name",type:"max-content",width:"",frozen:!0},{header:"UM de compra",value:"unit_measure",width:"10",frozen:!1},{header:"Ultimo precio de compra",value:"last_price_purchase",width:"10",type:"money",frozen:!1},{header:"iva",value:"iva",width:"5",type:"percent",frozen:!1}],ne=i([...Q]);pe(()=>{var a;return(a=ne.value)==null?void 0:a.map(t=>t.value)});const se=i([{name:"Nombre del ingrediente",fiel:"name",type:"text"},{name:"Unidad de medida de compra",fiel:"purchasing_unit_measure",type:"drop",Options:i(K),optionLable:"name"},{name:"precio de compra",fiel:"purchasing_price",type:"money"},{name:"Presentacion convertir a gramos",fiel:"net_gross_weight",type:"number"}]);ce(d,async(a,t)=>{var r;d.value.purchasing_unit_measure_id=((r=a.purchasing_unit_measure)==null?void 0:r.id)||null},{deep:!0});const oe=async()=>{q.setLoading(!0,"generando descargas");const a=B.value.map(c=>({ID:c.id,INGREDIENTE:c.name,"IVA (%)":c.iva,"ULTIMO PRECIO DE COMPRA":c.last_price_purchase})),t=A.json_to_sheet(a);t["!cols"]=[{wch:3},{wch:50},{wch:8},{wch:25}];const r=A.book_new();A.book_append_sheet(r,t,"Usuarios"),he(r,"Ultimos precios de compra.xlsx"),q.setLoading(!1,"generando descargas")},W=async()=>{const a=d.value;if(!a.name||!a.purchasing_unit_measure_id||!a.purchasing_price||!a.net_gross_weight){alert("Por favor llene todos los campos");return}L.value?await b.post(`${x}/update-ingredient/${d.value.id}`,a,"Editando ingrediente"):await b.post(`${x}/create-ingredient`,a,"creando un nuevo ingrediente"),O(),T.value=!1},re=async()=>{var t;const a=(t=D.value)==null?void 0:t.map(r=>({ingredient_id:r.ID,last_price_purchase:r["ULTIMO PRECIO DE COMPRA"]||0}));console.log(a),await b.put(`${x}/update-bulk-last-purchase-price`,a,"cargando precios"),O(),R.value=!1},O=async()=>{B.value=await b.get(`${x}/get-cdi-prices-table`,"cargando ingredientes"),K.value=await b.get(`${x}/daily_inventory_unit_measures`),F.value=await b.get(`${x}/get-prices-cdi-percents`)};me(async()=>{O()});const w=i(null),ie=()=>{w.value={global:{value:null,matchMode:ye.CONTAINS}}};return ve(()=>{ie()}),(a,t)=>{const r=v("inputText"),c=v("Dropdown"),_=v("InputNumber"),p=v("Button"),P=v("Dialog"),S=v("InputText"),h=v("column"),X=v("DataTable"),de=v("MultiSelect");return s(),m(z,null,[o(P,{style:{width:"30rem"},header:L.value?"Actualizar Ingrediente":"Nuevo Ingrediente",class:"mx-2",visible:T.value,"onUpdate:visible":t[0]||(t[0]=e=>T.value=e),modal:""},{footer:u(()=>[L.value?(s(),y(p,{key:1,onClick:W,severity:"help",label:"Modificar ingrediente"})):(s(),y(p,{key:0,onClick:W,severity:"help",label:"Guardar ingrediente"}))]),default:u(()=>[(s(!0),m(z,null,G(se.value,e=>(s(),m("div",null,[n("h6",fe,g(e.name),1),e.type=="text"?(s(),y(r,{key:0,modelValue:d.value[e.fiel],"onUpdate:modelValue":l=>d.value[e.fiel]=l,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])):f("",!0),e.type=="drop"?(s(),y(c,{key:1,options:e.Options,optionLabel:"name",modelValue:d.value[e.fiel],"onUpdate:modelValue":l=>d.value[e.fiel]=l,style:{width:"100%"}},null,8,["options","modelValue","onUpdate:modelValue"])):f("",!0),e.type=="money"?(s(),y(_,{key:2,modelValue:d.value[e.fiel],"onUpdate:modelValue":l=>d.value[e.fiel]=l,style:{width:"100%"},locale:"es-ES","max-fraction-digits":"3",prefix:"$"},null,8,["modelValue","onUpdate:modelValue"])):f("",!0),e.type=="number"?(s(),y(_,{key:3,modelValue:d.value[e.fiel],"onUpdate:modelValue":l=>d.value[e.fiel]=l,style:{width:"100%"},locale:"es-ES","max-fraction-digits":"3"},null,8,["modelValue","onUpdate:modelValue"])):f("",!0),e.type=="persent"?(s(),y(_,{key:4,modelValue:d.value[e.fiel],"onUpdate:modelValue":l=>d.value[e.fiel]=l,style:{width:"100%"},locale:"es-ES","max-fraction-digits":"3",suffix:"%"},null,8,["modelValue","onUpdate:modelValue"])):f("",!0)]))),256))]),_:1},8,["header","visible"]),o(P,{class:"mx-2",header:"Eliminar ingrediente",visible:M.value,"onUpdate:visible":t[3]||(t[3]=e=>M.value=e),modal:""},{footer:u(()=>[n("div",we,[o(p,{size:"small",label:"cancelar",onClick:t[1]||(t[1]=e=>M.value=!1),severity:"help"}),o(p,{size:"small",onClick:t[2]||(t[2]=e=>le()),label:"Eliminar ingrediente",severity:"danger",text:""})])]),default:u(()=>[n("h6",null,[U("seguro que desea eliminar el Ingrediente "),n("b",null,g(J.value.ingredient_name),1),U(" ?")])]),_:1},8,["visible"]),o(P,{visible:R.value,"onUpdate:visible":t[6]||(t[6]=e=>R.value=e),modal:"",header:"Actualizar ultimos precios de compra"},{footer:u(()=>[n("div",null,[o(p,{onClick:t[5]||(t[5]=e=>re()),label:"Actualizar",severity:"help"})])]),default:u(()=>[o(X,{paginator:!0,rows:15,style:{width:"100%"},paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} recetas",rowsPerPageOptions:[5,10,25,100],scrollable:"",showGridlines:"",scrollHeight:"65vh",stripedRows:"",class:"col-12 m-auto",value:D.value,tableStyle:"min-width: 50rem;",filters:w.value},{header:u(()=>[n("div",_e,[be,o(S,{class:"",modelValue:w.value.global.value,"onUpdate:modelValue":t[4]||(t[4]=e=>w.value.global.value=e),placeholder:"Buscar ingrediente ..."},null,8,["modelValue"])]),xe]),default:u(()=>[o(h,{header:"ID",field:"ID",class:"py-1"}),o(h,{header:"INGREDIENTE",field:"INGREDIENTE",class:"py-1"}),o(h,{header:"ULTIMO PRECIO DE COMPRA",field:"ULTIMO PRECIO DE COMPRA",class:"py-1"},{body:u(e=>[U(g(I($)(e.data["ULTIMO PRECIO DE COMPRA"])),1)]),_:1})]),_:1},8,["value","filters"])]),_:1},8,["visible"]),n("div",ke,[o(X,{paginator:!0,rows:15,style:{width:"100%"},paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} recetas",rowsPerPageOptions:[5,10,25,100],scrollable:"",showGridlines:"",scrollHeight:"65vh",stripedRows:"",class:"col-12 m-auto",value:B.value,tableStyle:"min-width: 50rem;",filters:w.value},{header:u(()=>[n("div",Ie,[Pe,o(S,{class:"",modelValue:w.value.global.value,"onUpdate:modelValue":t[7]||(t[7]=e=>w.value.global.value=e),placeholder:"Buscar ingrediente ..."},null,8,["modelValue"])]),n("div",Ce,[Ve,o(de,{optionLabel:"percent",modelValue:N.value,"onUpdate:modelValue":t[8]||(t[8]=e=>N.value=e),placeholder:"Columnas visibles",options:F.value},null,8,["modelValue","options"]),o(p,{size:"small",icon:"pi pi-plus",severity:"help",onClick:ae,label:"Nuevo ingredinte"}),o(p,{size:"small",icon:"pi pi-download",severity:"help",onClick:oe,label:"descargar plantilla"}),o(p,{size:"small",icon:"pi pi-upload",severity:"help",onClick:Z,label:"Cargar precios"}),n("input",{type:"file",ref_key:"fileInput",ref:H,style:{display:"none"},onChange:ee},null,544)])]),default:u(()=>[(s(),m(z,null,G(Q,e=>o(h,{frozen:e.frozen,header:e.header,style:k(`min-width:${e.width}rem`),field:e.value,class:"py-2"},{body:u(l=>[e.type=="money"?(s(),m("h6",{key:0,style:k([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},g(I($)(l.data[e.value])||"-----------"),5)):e.type=="percent"?(s(),m("h6",{key:1,style:k([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},g(`${I(Y)(l.data[e.value])}%`||"-----------"),5)):e.type=="number"?(s(),m("h6",{key:2,style:k([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},g(I(Y)(l.data[e.value])||"-----------"),5)):e.type!="money"&&e.type!="number"?(s(),m("h6",{key:3,style:k([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},g(l.data[e.value]||"-----------"),5)):f("",!0)]),_:2},1032,["frozen","header","style","field"])),64)),Ee,(s(!0),m(z,null,G(F.value,e=>(s(),m("div",null,[N.value.some(l=>l.percent==e.percent)?(s(),y(h,{key:0,header:`Al ${e.percent}%`,style:"min-width:6rem",field:e.value,class:"py-2"},{body:u(l=>{var C,V,E;return[n("h6",{style:k([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},g(I($)((E=(V=(C=l.data)==null?void 0:C.percent_prices)==null?void 0:V.find(j=>j.hasOwnProperty(e.percent.toString())))==null?void 0:E[e.percent])||"-----------"),5)]}),_:2},1032,["header","field"])):f("",!0),N.value.some(l=>l.percent==e.percent)?(s(),y(h,{key:1,header:`Al ${e.percent}% + IVA`,style:"min-width:10rem",field:e.value,class:"py-2"},{body:u(l=>{var C,V,E;return[n("h6",{style:k([{"text-transform":"lowercase"},e.type=="max-content"?"min-width:max-content":""]),class:"my-0 p-0"},g(I($)((E=(V=(C=l.data)==null?void 0:C.percent_prices_iva)==null?void 0:V.find(j=>j.hasOwnProperty(e.percent)))==null?void 0:E[e.percent])||"-----------"),5)]}),_:2},1032,["header","field"])):f("",!0)]))),256))]),_:1},8,["value","filters"])])],64)}}};export{Te as default};
