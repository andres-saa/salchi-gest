import{_ as we,l as xe,h as n,G,Z as Ee,i as Ve,j as k,U as Ce,D as Y,o as f,c as _,f as s,e as p,u as t,a,F as N,$ as g,q as E,t as h,r as H,d as Ue,n as ke,a0 as Z,a1 as b,a2 as X,a3 as T,a4 as P,a5 as ee,k as ae,a6 as Te,a7 as $e,p as Ie,m as Se,J as R}from"./index-34463bb2.js";const d=$=>(Ie("data-v-723c93dd"),$=$(),Se(),$),Le={style:{height:"100%"}},Ne={style:{display:"grid","grid-template-columns":"repeat(2, 1fr)","max-width":"max-content",gap:".5rem","align-items":"center"}},Pe=d(()=>a("h6",{class:"m-0 p-0"},[a("strong",null,"Id plantilla :")],-1)),Re={class:"m-0 p-0"},Oe=d(()=>a("h6",{class:"m-0 p-0"},[a("strong",null,"Nombre plantilla :")],-1)),Ae={class:"m-0 p-0"},De=d(()=>a("h6",{class:"m-0 p-0"},[a("strong",null,"Estado :")],-1)),je={class:"m-0 p-0"},Be=d(()=>a("h6",{class:"m-0 p-0"},[a("strong",null,"Categoria :")],-1)),Fe={class:"m-0 p-0"},Me=d(()=>a("h6",{class:"m-0 p-0"},[a("strong",null,"Mensaje :")],-1)),Ge={class:"m-0",style:{"background-color":"#0a3744",padding:"1rem","border-radius":".5rem",color:"white"}},Ye=d(()=>a("h5",null,[a("strong",null,"Usuarios")],-1)),He={class:"statuses",style:{display:"flex",gap:"1rem"}},Ke={style:{width:"100%",height:"50vh","margin-top":"1rem"}},qe={class:"p-4 templates-container",style:{"max-width":"70rem",width:"100%",margin:"auto","background-color":"white","border-radius":"1rem",transition:"all .3s ease"}},ze={style:{height:"100%"}},Je={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",style:{"align-items":"center"}},Qe=d(()=>a("h2",{class:"text-2xl font-bold whitespace-nowrap m-0 p-0",style:{"min-width":"max-content"}},"Plantillas de WhatsApp",-1)),We={class:"p-input-icon-left w-full md:w-80 my-3",style:{height:"100%"}},Ze=d(()=>a("i",{class:"pi pi-search"},null,-1)),Xe={class:"flex gap-2"},ea={class:"space-y-4"},aa={class:"md:grid-cols-2 gap-3"},la={class:"field"},ta={key:0,style:{position:"relative",width:"300px","margin-top":".5rem"}},sa=["src"],oa={style:{display:"flex","justify-content":"center"}},na=["src"],ia={class:"field"},ra=d(()=>a("label",{class:"font-medium"},"Nombre",-1)),da={class:"field"},ua=d(()=>a("label",{class:"font-medium"},"Categoría",-1)),ca={class:"field"},ma=d(()=>a("label",{class:"font-medium"},"Idioma",-1)),pa={class:"font-medium"},va={class:"opacity-70"},fa={key:0,class:"",style:{display:"flex","flex-direction":"column",gap:"1rem","justify-content":"center"}},ga=d(()=>a("h5",{class:"font-medium m-0 p-0 py-3"},"Ejemplos de variables",-1)),ha={class:"space-y-2"},ya=d(()=>a("div",{class:"flex items-center my-4",style:{"align-items":"center",gap:"1rem"}},[a("h5",{class:"m-0"},"Botones")],-1)),_a={style:{display:"flex","flex-direction":"column",gap:"1rem","max-width":"100%",overflow:"hidden"}},ba={__name:"templates",setup($){const le=xe();function te(){K.value=null,q.value=""}n(""),n(!1);const O=n([]),y=n({}),A=n(!1),I=n(""),S=n(!1);n(!1);const se=n(null),D=n([]),w=n({name:"",category:"UTILITY",language:"es_ES"}),L=n(""),j=n([]),v=n({}),oe=n(null),m=n({}),B=n([{}]);n({label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-triangle-exclamation"});const K=n(null),q=n(""),c=n([]),ne=n([{label:"SIN DATOS",bg:"#7f8c8d",icon:"fa-circle-question"},{label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-triangle-exclamation"},{label:"CASUAL",bg:"#e67e22",icon:"fa-person-walking"},{label:"FRECUENTE",bg:"#27ae60",icon:"fa-repeat"},{label:"TOP",bg:"#2980b9",icon:"fa-ranking-star"},{label:"ESTRELLA",bg:"#8e44ad",icon:"fa-star"}]);function ie(o){const l=o.label;if(l==="TODO"){c.value=[];return}const e=c.value.indexOf("TODO");e>-1&&c.value.splice(e,1);const i=c.value.indexOf(l);i===-1?c.value.push(l):c.value.splice(i,1)}const z=G(()=>c.value.length===0?B.value:B.value.filter(o=>c.value.includes(o.clasification))),re=Ee(),V=n(!1),de=[{label:"AUTHENTICATION",value:"AUTHENTICATION"},{label:"MARKETING",value:"MARKETING"},{label:"UTILITY",value:"UTILITY"}],ue=[{label:"Español (CO)",value:"es_CO"},{label:"Español (ES)",value:"es_ES"},{label:"English (US)",value:"en_US"}],ce=[{label:"URL",value:"URL"},{label:"QUICK_REPLY",value:"QUICK_REPLY"}],me=G(()=>{if(!I.value)return O.value;const o=I.value.toLowerCase();return O.value.filter(l=>`${l.name} ${l.category}`.toLowerCase().includes(o))});Ve(async()=>{D.value=await k.get(`${Ce}/restaurants`),m.value=D.value[0]||null,m.value});const pe=o=>{y.value=o,V.value=!0};Y(V,()=>{c.value=[]});const F=n([]);Y(L,o=>{const l=Array.from(new Set((o.match(/{{\s*([^{}\s]+)\s*}}/g)||[]).map(e=>e.replace(/{{|}}/g,"").trim())));F.value=l,v.value=Object.fromEntries(Object.entries(v.value).filter(([e])=>l.includes(e))),l.forEach(e=>{e in v.value||(v.value[e]="")})});async function J(){A.value=!0;try{O.value=await k.get(`${R}/wabas/${m.value.waba_id}/templates/`)}finally{A.value=!1}}const ve=async()=>{B.value=await k.get(`${R}/wabas/${m.value.waba_id}/templates/users/${m.value.id}`)};Y(m,async o=>{o&&(J(),c.value=[],await ve())},{deep:!0});function fe(o){return{APPROVED:"success",PENDING:"warning",REJECTED:"danger"}[o]||"info"}const Q=n({}),ge=G(()=>oe.value?"Editar plantilla":"Nueva plantilla");function he(o){var u,U;se.value=o.id,w.value={name:o.name,category:o.category,language:o.language};const l=o.components.find(r=>r.type==="BODY")||{text:""};L.value=l.text,v.value={},(u=l.example)!=null&&u.body_text_named_params?l.example.body_text_named_params.forEach(({param_name:r,example:C})=>{v.value[r]=C}):(U=l.example)!=null&&U.body_text&&l.example.body_text[0].forEach((r,C)=>{v.value[String(C+1)]=r});const e=o.components.find(r=>r.type==="BUTTONS")||{buttons:[]};j.value=e.buttons.map(r=>({type:r.type,text:r.text,url:r.url||""}));const i=o.components.find(r=>r.type==="HEADER")||{type:"HEADER",format:"IMAGE",example:{header_handle:[]}};Q.value=i==null?void 0:i.example.header_handle[0],S.value=!0}function ye(o){re.require({message:`¿Eliminar la plantilla "${o.name}"?`,header:"Confirmar eliminación",icon:"pi pi-exclamation-triangle",acceptLabel:"Sí",rejectLabel:"No",accept:async()=>{await k.delete(`${R}/wabas/${m.value.waba_id}/templates/${o.name}`),await J()}})}const M=n(!1);async function _e(){if(!y.value)return;const o=z.value.map(e=>e.wa_id),l=new FormData;l.append("messaging_product","whatsapp"),l.append("employer_id",le.rawUserData.id.toString()),l.append("context_message_id",""),l.append("restaurant_id",m.value.id),l.append("template",JSON.stringify(y.value)),o.forEach(e=>l.append("recipients",e)),M.value=!0;try{await k.post(`${R}/webhook/send/template/bulk/`,l,!1),console.log(`✅ Difusión iniciada para ${o.length} usuarios`),V.value=!1}catch(e){console.error("✗ Error en difusión masiva:",e)}finally{M.value=!1}}return(o,l)=>(f(),_(N,null,[s(t(X),{visible:V.value,"onUpdate:visible":l[1]||(l[1]=e=>V.value=e),modal:"",header:"Difundir Plantilla",style:{width:"100vw","max-width":"80rem","background-color":"white"}},{footer:p(()=>[s(t(g),{label:"Cancelar",text:"",severity:"secondary",onClick:l[0]||(l[0]=e=>V.value=!1)}),s(t(g),{label:"Enviar a todos",severity:"help",icon:"pi pi-broadcast",loading:M.value,onClick:_e,autofocus:""},null,8,["loading"])]),default:p(()=>{var e,i,u,U,r,C,W;return[a("div",Le,[a("div",Ne,[Pe,E(),a("h6",Re,h((e=y.value)==null?void 0:e.id),1),Oe,E(),a("h6",Ae,h((i=y.value)==null?void 0:i.name),1),De,E(),a("h6",je,h((u=y.value)==null?void 0:u.status),1),Be,E(),a("h6",Fe,h((U=y.value)==null?void 0:U.category),1),Me,a("h6",Ge,h((W=(C=(r=y.value)==null?void 0:r.components)==null?void 0:C.find(x=>x.type=="BODY"))==null?void 0:W.text),1)]),Ye,a("div",He,[(f(!0),_(N,null,H(ne.value,(x,be)=>(f(),Ue(t(g),{key:be,style:ke([{height:"2.3rem","border-radius":".3rem",padding:".5rem"},c.value.includes(x.label)?{backgroundColor:x.bg,color:"#fff"}:{backgroundColor:"#ffffff20",color:x.bg}]),text:"",onClick:wa=>ie(x),class:"status",label:x.label},null,8,["onClick","label","style"]))),128))]),a("div",Ke,[s(t(Z),{rows:10,paginator:"",stripedRows:"",showGridlines:"",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,15,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} clientes",responsiveLayout:"scroll",scrollable:"",value:z.value,header:"clientes"},{default:p(()=>[s(t(b),{class:"py-1",header:"Nombre",field:"nombre"}),s(t(b),{class:"py-1",header:"Número",field:"wa_id"}),s(t(b),{class:"py-1",header:"Clasificación",field:"clasification"})]),_:1},8,["value"])])])]}),_:1},8,["visible"]),a("div",qe,[a("div",ze,[a("div",Je,[Qe,a("span",We,[Ze,s(t(T),{modelValue:I.value,"onUpdate:modelValue":l[2]||(l[2]=e=>I.value=e),modelModifiers:{trim:!0},placeholder:"Buscar…",class:"w-full"},null,8,["modelValue"])]),s(t(P),{modelValue:m.value,"onUpdate:modelValue":l[3]||(l[3]=e=>m.value=e),options:D.value.filter(e=>e.exist),optionLabel:"name",placeholder:"Selecciona un restaurante",class:"w-full md:w-80 my-3"},null,8,["modelValue","options"])]),s(t(Z),{value:me.value,dataKey:"id",paginator:"",rows:10,responsiveLayout:"scroll",loading:A.value,globalFilterFields:["name","category"],class:"shadow-md rounded-xl overflow-hidden"},{default:p(()=>[s(t(b),{class:"my-1 py-1",field:"name",header:"Nombre",bodyClass:"font-medium"}),s(t(b),{class:"my-1 py-1",field:"category",header:"Categoría"}),s(t(b),{class:"my-1 py-1",field:"language",header:"Idioma"}),s(t(b),{class:"my-1 py-1",header:"Estado"},{body:p(({data:e})=>[s(t(ee),{severity:fe(e.status)},{default:p(()=>[E(h(e.status),1)]),_:2},1032,["severity"])]),_:1}),s(t(b),{class:"my-1 py-1",headerStyle:"width:8rem",header:"Acciones"},{body:p(({data:e})=>[a("div",Xe,[s(t(g),{icon:"pi pi-eye",severity:"warning",onClick:i=>he(e)},null,8,["onClick"]),s(t(g),{icon:"pi pi-trash",severity:"danger",onClick:i=>ye(e)},null,8,["onClick"]),s(t(g),{icon:"pi pi-sync",label:"Difundir",severity:"help",onClick:i=>pe(e)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"]),s(t(X),{visible:S.value,"onUpdate:visible":l[9]||(l[9]=e=>S.value=e),header:ge.value,modal:"",class:"",style:{width:"90vw","max-width":"20rem","min-width":"40rem"}},{footer:p(()=>[s(t(g),{label:"cerrar",text:"",severity:"secondary",onClick:l[8]||(l[8]=e=>S.value=!1)})]),default:p(()=>[a("div",ea,[a("div",aa,[a("div",la,[K.value?(f(),_("div",ta,[a("img",{src:q.value,style:{width:"100%",height:"100%","object-fit":"cover","border-radius":".5rem"}},null,8,sa),s(t(g),{icon:"pi pi-times",severity:"danger",size:"small",style:{position:"absolute",top:".1rem",right:".1rem"},onClick:te})])):ae("",!0)]),a("div",oa,[a("img",{src:Q.value,style:{"max-width":"20rem",margin:"","aspect-ratio":"1 / 1","object-fit":"contain"},alt:""},null,8,na)]),a("div",ia,[ra,s(t(T),{modelValue:w.value.name,"onUpdate:modelValue":l[4]||(l[4]=e=>w.value.name=e),class:"w-full"},null,8,["modelValue"])]),a("div",da,[ua,s(t(P),{modelValue:w.value.category,"onUpdate:modelValue":l[5]||(l[5]=e=>w.value.category=e),options:de,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),a("div",ca,[ma,s(t(P),{modelValue:w.value.language,"onUpdate:modelValue":l[6]||(l[6]=e=>w.value.language=e),options:ue,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),a("div",null,[a("h6",pa,[E("Cuerpo del mensaje "),a("small",va,"(usa "+h(o.param)+" o "+h(1)+")",1)]),s(t(Te),{"auto-resize":"",modelValue:L.value,"onUpdate:modelValue":l[7]||(l[7]=e=>L.value=e),rows:"6",class:"w-full"},null,8,["modelValue"])]),F.value.length?(f(),_("div",fa,[ga,(f(!0),_(N,null,H(F.value,e=>(f(),_("div",{key:e,style:{"align-items":"center",display:"flex",gap:"1rem"},class:""},[s(t(ee),{severity:"info",style:{padding:"0 1rem",height:"2.8rem","min-width":"2.8rem"},class:"min-w-[5rem] text-center text-xl"},{default:p(()=>[E(h(e),1)]),_:2},1024),s(t(T),{modelValue:v.value[e],"onUpdate:modelValue":i=>v.value[e]=i,placeholder:`Ejemplo para ${e}`,class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])):ae("",!0),a("div",ha,[ya,a("div",_a,[(f(!0),_(N,null,H(j.value,(e,i)=>(f(),_("div",{key:i,class:"",style:{display:"grid","grid-template-columns":"10rem  1fr 1fr 3rem",gap:".5rem"}},[s(t(P),{modelValue:e.type,"onUpdate:modelValue":u=>e.type=u,options:ce,optionLabel:"label",optionValue:"value"},null,8,["modelValue","onUpdate:modelValue"]),s(t(T),{modelValue:e.text,"onUpdate:modelValue":u=>e.text=u,placeholder:"Texto"},null,8,["modelValue","onUpdate:modelValue"]),s(t(T),{modelValue:e.url,"onUpdate:modelValue":u=>e.url=u,placeholder:"URL"},null,8,["modelValue","onUpdate:modelValue"]),s(t(g),{icon:"pi pi-times",severity:"danger",onClick:u=>j.value.splice(i,1)},null,8,["onClick"])]))),128))])])])]),_:1},8,["visible","header"]),s(t($e))])])],64))}},Ea=we(ba,[["__scopeId","data-v-723c93dd"]]);export{Ea as default};
