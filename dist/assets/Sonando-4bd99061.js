import{_ as ue,g as r,h as de,D as ve,e as P,o as d,x as L,f as w,a,b as i,c as _,F as Y,r as M,d as J,u as E,U as re,t as S,n as pe,p as _e,k as me,G as ke,H as T,I as $e,J as Pe,m as ce,j as xe,w as Ce,K as A}from"./index-a97ea6dc.js";import{u as ye}from"./site-dbc6c3f8.js";const fe=m=>(_e("data-v-fb10a3e2"),m=m(),me(),m),Te={class:"dialog-content"},Ie=fe(()=>a("b",{class:"dialog-title"},null,-1)),De={class:"form-container"},Be={key:0,class:"loading-container"},Ne=fe(()=>a("p",{class:"loading-text"},"Cargando sedes...",-1)),Ee={key:1,class:"sites-grid"},Ve=["onClick"],Re=["src","alt"],qe={class:"site-info"},Ae={class:"site-name"},We={class:"button-container"},Ye={__name:"siteDialogSonando",setup(m){const y=ye(),h=r([]),f=r(!1),p=r(null),O=async()=>{f.value=!0;try{const n=await fetch(`${re}/sites`);if(n.ok){const x=await n.json();h.value=x}else console.error("Error al obtener las sedes:",n.statusText)}catch(n){console.error("Error al obtener las sedes:",n)}finally{f.value=!1}},U=n=>{p.value=n},v=()=>{p.value&&(y.sonando=p.value,y.visibles.sonandoCurrentSite=!1)};return de(()=>{O()}),ve(()=>y.visibles.currentSite,n=>{n&&(p.value=null)}),(n,x)=>{const z=P("ProgressSpinner"),I=P("Button"),c=P("Dialog");return d(),L(c,{class:"dialog-content",style:pe([{"background-color":"#000000ba !important",color:"white","max-width":"94%",padding:"0"},"width: 60rem ; border: 3px solid  red"]),visible:E(y).visibles.sonandoCurrentSite,"onUpdate:visible":x[0]||(x[0]=s=>E(y).visibles.sonandoCurrentSite=s),header:"Selección de sede",modal:!0},{footer:w(()=>[a("div",We,[i(I,{label:"Aplicar",severity:"help",onClick:v,disabled:!p.value,class:"apply-"},null,8,["disabled"])])]),default:w(()=>[a("div",Te,[Ie,a("div",De,[f.value?(d(),_("div",Be,[i(z,{class:"spinner",strokeWidth:"8",fill:"var(--white)",animationDuration:".5s","aria-label":"Cargando sedes"}),Ne])):(d(),_("div",Ee,[(d(!0),_(Y,null,M(h.value.filter(s=>s.show_on_web==!0),s=>{var C;return d(),_("div",{key:s.id,class:J(["site-card",{selected:((C=p.value)==null?void 0:C.site_id)===s.site_id}]),onClick:j=>U(s)},[a("img",{src:`${E(re)}/read-product-image/300/site-${s.site_id}`,alt:s.name,class:"site-image"},null,8,Re),a("div",qe,[a("p",Ae,S(s.site_name),1)])],10,Ve)}),128))]))])])]),_:1},8,["visible"])}}},Oe=ue(Ye,[["__scopeId","data-v-fb10a3e2"]]);const V=m=>(_e("data-v-f1251221"),m=m(),me(),m),Ue=["src"],ze={class:"main-container"},je={class:"salchimonster-container",style:{overflow:"hidden"}},Le={style:{margin:"0 2rem 0 1rem"}},Me=V(()=>a("i",{class:"fa-solid fa-play",style:{"margin-right":"1rem"}},null,-1)),Je={style:{"min-width":"max-content","max-width":"max-content"}},Fe={style:{display:"flex",gap:"1rem","justify-content":"center"}},Ge={class:"player-wrapper",style:{"pointer-events":"none"}},Qe={key:0,class:"current-song-info"},He=V(()=>a("strong",null,"Solicitada por:",-1)),Ke={class:"progress-bar-container"},Xe={class:"controls-container"},Ze={class:"queue-container"},et=V(()=>a("h3",null,"Cola de Reproducción",-1)),tt={class:"queue-list"},at=["src"],ot={class:"song-info"},st={class:"song-title"},lt={class:"requested-by"},nt=V(()=>a("h2",{style:{color:"black"}},"Solicitar una Canción",-1)),it={class:"queue-list"},rt=["onClick"],ct=["src"],ut={class:"song-info"},dt={style:{color:"black !important"}},vt={class:"dialog-footer"},pt=V(()=>a("h2",{style:{color:"black"}},"Proporciona tu Nombre",-1)),_t={class:"solicitar-nombre-container"},mt={style:{color:"black !important"}},yt=["src"],ft={class:"dialog-footer"},W="https://backend-musica.salchimonster.com",ht="wss://backend-musica.salchimonster.com/ws",bt={__name:"Sonando",setup(m){const y=ye(),h=r(!1),f=r(!1),p=r(!0);function O(){c&&B.isPlayerReady&&(c.pauseVideo(),p.value=!0)}function U(){c&&B.isPlayerReady&&(c.seekTo(s.value.currentTime,!0),c.playVideo(),p.value=!1)}const v=r(null),n=r("");function x(){v.value?f.value=!0:alert("Por favor, selecciona una canción primero.")}async function z(){if(!v.value||!n.value.trim()){alert("Por favor, selecciona una canción y proporciona tu nombre.");return}try{const t={type:"add_song",song_id:v.value.id,requestedBy:n.value.trim()};u&&u.readyState===WebSocket.OPEN?(u.send(JSON.stringify(t)),v.value=null,n.value="",f.value=!1,h.value=!1):alert("No estás conectado al servidor. Intenta recargar la página.")}catch(t){console.error("Error al agregar la canción a la cola:",t)}}const I=r(null);let c=null;const s=r(null),C=r([]),j=r([]),k=r(0),D=r(0),B=ke({isPlayerReady:!1,showPlayButton:!1});function F(t){const e=Math.floor(t/60),o=Math.floor(t%60);return`${e}:${o<10?"0":""}${o}`}T(()=>F(k.value)),T(()=>F(D.value));const he=T(()=>D.value>0?k.value/D.value*100:0),G=T(()=>!s.value||s.value.currentIndex===void 0?0:Math.max(s.value.currentIndex-4,0)),Q=T(()=>C.value.slice(G.value)),$=T(()=>{var t;return((t=y.sonando)==null?void 0:t.site_id)||"default"});let u=null,R=r(null);function H(){u&&(u.close(),u=null);const t=`${ht}/${$.value}`;u=new WebSocket(t),u.onopen=()=>{console.log(`Conectado al WebSocket de la sede: ${$.value}`)},u.onmessage=e=>{try{const o=JSON.parse(e.data);if(o.type==="queue_update"){C.value=o.queue,s.value=o.status,k.value=o.status.currentTime,D.value=o.status.totalDuration;const b=o.status.currentSong?o.status.currentSong.id:null;b!==R.value&&(ee(b),R.value=b),B.showPlayButton=!o.status.isPlaying}}catch(o){console.error("Error al parsear mensaje del WebSocket:",o)}},u.onerror=e=>{console.error("Error en el WebSocket:",e)},u.onclose=()=>{console.warn(`WebSocket cerrado para sede: ${$.value}. Reintentando en 3 segundos...`),setTimeout(()=>{H()},3e3)}}function be(t){if(window.YT&&window.YT.Player){t();return}window.onYouTubeIframeAPIReady=()=>{t()};const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e)}function K(t,e,o,b){return new window.YT.Player(t,{videoId:e,playerVars:{autoplay:1,controls:1,disablekb:0,fs:1,playsinline:1,iv_load_policy:3,modestbranding:1,rel:0},events:{onReady:o,onStateChange:b}})}function X(t){var e;B.isPlayerReady=!0,(e=s.value)!=null&&e.isPlaying?(t.target.playVideo(),k.value>0&&t.target.seekTo(k.value,!0)):(t.target.pauseVideo(),B.showPlayButton=!0)}function Z(t){const e=window.YT.PlayerState;switch(t.data){case e.PLAYING:break;case e.PAUSED:break;case e.ENDED:te();break}}function ee(t){window.YT&&window.YT.Player&&t&&(c?(c.loadVideoById({videoId:t,startSeconds:k.value}),s.value.isPlaying?c.playVideo():c.pauseVideo()):c=K(I.value,t,X,Z))}async function te(){try{await A.post(`${W}/next/${$.value}`)}catch(t){console.error("Error al avanzar a la siguiente canción:",t)}}async function ge(){try{const[t,e,o]=await Promise.all([A.get(`${W}/available`),A.get(`${W}/queue/${$.value}`),A.get(`${W}/current/${$.value}`)]);j.value=t.data,C.value=e.data,s.value=o.data,k.value=s.value.currentTime,D.value=s.value.totalDuration,R.value=s.value.currentSong?s.value.currentSong.id:null,ee(R.value)}catch(t){console.error("Error al cargar datos iniciales:",t)}}function Se(t){const e=Q.value.length;if(e===1)return 1;const o=.2,q=1-o;return o+t/(e-1)*q}return de(()=>{be(()=>{var e,o;const t=((o=(e=s.value)==null?void 0:e.currentSong)==null?void 0:o.id)||"";t&&(c=K(I.value,t,X,Z))}),ve($,async(t,e)=>{console.log(`Cambio de sede: ${e} -> ${t}`),await ge(),H()},{immediate:!0})}),$e(()=>{u&&u.close()}),(t,e)=>{var oe,se,le,ne,ie;const o=P("Button"),b=P("ProgressBar"),q=P("Dialog"),ae=P("InputText"),we=Pe("random-hover-color");return d(),_(Y,null,[a("img",{style:{width:"120vw",position:"fixed",left:"-10%",top:"0",height:"100vh","object-fit":"cover","z-index":"-1",filter:"blur(10px)"},src:(se=(oe=s.value)==null?void 0:oe.currentSong)==null?void 0:se.thumbnail,alt:""},null,8,Ue),a("div",ze,[a("div",je,[a("h2",Le,[Me,ce(" SONANDO EN "),a("span",Je,"SM "+S((ne=(le=E(y))==null?void 0:le.sonando)==null?void 0:ne.site_name),1)]),a("div",Fe,[i(o,{size:"small",onClick:e[0]||(e[0]=l=>h.value=!0),style:{margin:"1rem 0"},label:"Pedir tema",icon:"fa-solid fa-forward"}),i(o,{size:"small",icon:"fa-solid fa-sync",onClick:e[1]||(e[1]=l=>E(y).visibles.sonandoCurrentSite=!0),style:{margin:"1rem 0"},label:"Cambiar sede"})]),a("div",Ge,[a("div",{ref_key:"playerElement",ref:I,style:{width:"100% !important","max-width":"100% !important"},id:"youtube-player"},null,512)]),(ie=s.value)!=null&&ie.currentSong?(d(),_("div",Qe,[a("h2",null,S(s.value.currentSong.title),1),a("p",null,[He,ce(" "+S(s.value.currentSong.requestedBy),1)])])):xe("",!0),a("div",Ke,[i(b,{value:he.value,"show-value":!1,style:{width:"100%"}},null,8,["value"])]),a("div",Xe,[i(o,{disabled:"",rounded:"",icon:"fa-solid fa-backward",class:"previous-button"}),p.value?(d(),L(o,{key:1,rounded:"",icon:"fa-solid fa-play",onClick:U,label:"Reanudar"})):(d(),L(o,{key:0,rounded:"",icon:"fa-solid fa-pause",onClick:O,label:"Pausa"})),i(o,{disabled:"",rounded:"",icon:"fa-solid fa-forward",onClick:te,class:"next-button"})]),a("div",Ze,[et,a("ul",tt,[(d(!0),_(Y,null,M(Q.value,(l,g)=>{var N;return d(),_("li",{key:`${l.id}-${g}`,class:J({"current-song":G.value+g===((N=s.value)==null?void 0:N.currentIndex)}),style:pe({opacity:Se(g),transition:"opacity 0.5s ease"})},[a("img",{src:l.thumbnail,alt:"Thumbnail",class:"thumbnail"},null,8,at),a("div",ot,[a("span",st,S(l.title),1),a("span",lt,"Solicitada por: "+S(l.requestedBy),1)])],6)}),128))])])])]),i(q,{visible:h.value,"onUpdate:visible":e[3]||(e[3]=l=>h.value=l),modal:"",style:{"max-width":"94%",width:"40rem",border:"none"}},{header:w(()=>[nt]),footer:w(()=>[a("div",vt,[i(o,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:e[2]||(e[2]=l=>h.value=!1)}),i(o,{label:"Solicitar",severity:"help",icon:"pi pi-check",disabled:!v.value,onClick:x,class:"p-button"},null,8,["disabled"])])]),default:w(()=>[a("ul",it,[(d(!0),_(Y,null,M(j.value,(l,g)=>Ce((d(),_("li",{class:J(["song",{"selected-song":v.value===l}]),style:{transition:"all none"},key:`${l.id}-${g}`,onClick:N=>v.value=l},[a("img",{src:l.thumbnail,alt:"Thumbnail",class:"thumbnail"},null,8,ct),a("div",ut,[a("span",dt,S(l.title),1)])],10,rt)),[[we,{opacity:.239}]])),128))])]),_:1},8,["visible"]),i(q,{visible:f.value,"onUpdate:visible":e[6]||(e[6]=l=>f.value=l),modal:"",style:{"max-width":"94%",width:"30rem"}},{header:w(()=>[pt]),footer:w(()=>[a("div",ft,[i(o,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:e[5]||(e[5]=l=>f.value=!1)}),i(o,{label:"Solicitar",icon:"pi pi-check",severity:"help",disabled:!n.value.trim(),onClick:z},null,8,["disabled"])])]),default:w(()=>{var l,g;return[a("div",_t,[a("h3",mt,S((l=v.value)==null?void 0:l.title),1),a("img",{src:(g=v.value)==null?void 0:g.thumbnail,alt:"Thumbnail",class:"thumbnail-large"},null,8,yt),i(ae,{style:{width:"100%",color:"black"},modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=N=>n.value=N),placeholder:"Tu nombre",class:"input-text"},null,8,["modelValue"])])]}),_:1},8,["visible"]),i(Oe)],64)}}},wt=ue(bt,[["__scopeId","data-v-f1251221"]]);export{wt as default};
