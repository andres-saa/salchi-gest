import{_ as W,r as m,l as X,z as Y,k as Z,B as ee,i as te,m as se,a as v,o as S,c as ae,d as s,w as i,b as a,L as A,s as oe,t as w,u as P,f as L,D as $,p as ne,g as le}from"./index-9cbe9f48.js";import{o as u}from"./orderService-2b70c646.js";import{u as ie}from"./order-b588bdfe.js";import"./index-558f534d.js";import"./_commonjsHelpers-23102255.js";const k=_=>(ne("data-v-40892623"),_=_(),le(),_),re={class:"container"},de=k(()=>a("h3",null,[a("b",null,"Rechazar esta solicitud")],-1)),ce=k(()=>a("h3",null,[a("b",null,"Aprobar esta solicitud")],-1)),ue={class:"grid",style:{"align-items":"center","justify-content":"space-between"}},pe={class:"col-12 md:col-6 p-3"},me={class:"text-xl",style:{width:"100%"}},ve={style:{"text-transform":"capitalize"}},he={class:"md:mt-0 p-input-icon-right m-3"},_e=k(()=>a("i",{class:"pi pi-search"},null,-1)),ye={style:{"min-width":"max-content"}},be={style:{"min-width":"max-content"}},fe={style:{"min-width":"max-content"}},ge={style:{display:"flex",gap:"0.5rem"}},we={__name:"cancellationOrderRequestSesion",setup(_){const y=m(!1),p=m([]),b=m(!1),T=X(),l=m({}),B=new Audio("/sound/pip1.wav"),O=new Audio("/sound/pip2.wav"),U=new Audio("/sound/pip3.wav"),M=ie(),F=m(null),x={revisar:u.getPendientsCancellationRequest,aprobadas:u.getaceptedCancellationAcepted,rechazadas:u.getPendientsCancellationRejected},j={revisar:u.getPendientsCancellationRequestNoLoading,aprobadas:u.getaceptedCancellationAceptedNoLoading,rechazadas:u.getPendientsCancellationRejectedNoLoading};Y(()=>{D()});const N=(c,t)=>{l.value.id=t,c?b.value=!0:y.value=!0},z=async(c,t,r)=>{const o={authorized:c,responsible_id:T.rawUserData.id,responsible_observation:l.value.reason||"sin observaciones"};await u.resolveCancellationRequest(t,o),b.value=!1,y.value=!1,p.value=await x[d.params.request_status]()},V=c=>{const t=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],r=c.split("T"),o=r[0].split("-"),f=o[2],C=parseInt(o[1],10)-1,n=o[0],q=t[C],e=r[1].split(":"),g=parseInt(e[0],10),J=e[1],Q=g>=12,R=g%12||12,G=R<10?`0${R}`:`${R}`,K=Q?"PM":"AM";return{date:`${f}-${q}-${n}`,time:`${G}:${J} ${K}`}},d=Z(),h=m(),D=()=>{h.value={global:{value:null,matchMode:ee.CONTAINS}}};D(),te(()=>{E(),F.value=setInterval(()=>{H()},1e4)});const E=async()=>{p.value=await x[d.params.request_status]()},I=[B,O,U],H=async()=>{const c=d.params.request_status||"revisar";p.value=await j[c]();const t=M.numberCancellationRequests,r=p.value.length;if(t<r){const o=Math.floor(Math.random()*I.length);I[o].play(),M.numberCancellationRequests=r}};return se(()=>d.params.request_status,async()=>{p.value=await x[d.params.request_status]()},{deep:!0}),(c,t)=>{const r=v("Textarea"),o=v("Button"),f=v("Dialog"),C=v("InputText"),n=v("Column"),q=v("DataTable");return S(),ae("div",re,[s(f,{visible:y.value,"onUpdate:visible":t[2]||(t[2]=e=>y.value=e),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:i(()=>[de]),default:i(()=>[a("form",{onSubmit:t[1]||(t[1]=A(e=>z(!1,l.value.id,l.value.reason),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[s(r,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:l.value.reason,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.reason=e),rows:"5",placeholder:"Porque desea rechazar esta solicitud?"},null,8,["modelValue"]),s(o,{style:{width:"100%","border-radius":"0.5rem"},label:"Rechazar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),s(f,{visible:b.value,"onUpdate:visible":t[5]||(t[5]=e=>b.value=e),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:i(()=>[ce]),default:i(()=>[a("form",{onSubmit:t[4]||(t[4]=A(e=>z(!0,l.value.id,l.value.reason),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[s(r,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:l.value.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.reason=e),rows:"5",placeholder:"Notas para el solicitante"},null,8,["modelValue"]),s(o,{style:{width:"100%","border-radius":"0.5rem"},label:"Aprobar",type:"submit",class:"p-button-success"})],32)]),_:1},8,["visible"]),s(q,{paginator:!0,rows:15,filters:h.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} solicitudes",rowsPerPageOptions:[5,10,25,100],scrollable:"",scrollHeight:"65vh",stripedRows:"",style:{},"onUpdate:filters":t[7]||(t[7]=e=>h.value=e),class:"col-12 m-auto",value:p.value,tableStyle:"min-width: 50rem;"},{header:i(()=>[a("div",ue,[a("div",pe,[a("span",me,[oe(" Solicitudes de cancelacion - "),a("span",ve,w(P(d).params.request_status.split("-").join(" ")),1)])]),a("span",he,[_e,s(C,{class:"",modelValue:h.value.global.value,"onUpdate:modelValue":t[6]||(t[6]=e=>h.value.global.value=e),placeholder:"Buscar Solicitud..."},null,8,["modelValue"])])])]),default:i(()=>[s(n,{style:{},class:"py-1 pl-0",field:"order_id",header:"ID orden",frozen:""},{body:i(e=>[a("p",ye,w(e.data.order_id),1)]),_:1}),s(n,{class:"py-1",field:"site_name",header:"Sede"}),s(n,{class:"py-1",field:"site_name",header:"Fecha"},{body:i(e=>[a("p",be,w(V(e.data.timestamp).date),1)]),_:1}),s(n,{class:"py-1",field:"site_name",header:"Hora"},{body:i(e=>[a("p",fe,w(V(e.data.timestamp).time),1)]),_:1}),s(n,{style:{"min-width":"30rem"},class:"py-1",field:"reason",header:"Motivo"}),s(n,{style:{"min-width":"10rem"},class:"py-1",field:"responsible",header:"Quien solicita?"}),s(n,{style:{"min-width":"20em"},class:"py-1",field:"user_name",header:"Nombre del cliente"}),s(n,{style:{"min-width":"10rem"},class:"py-1",field:"user_phone",header:"Cel. cliente"}),s(n,{style:{},class:"py-1 px-0",field:"date",header:"Action",frozen:"",alignFrozen:"right"},{body:i(e=>[a("div",ge,[P(d).params.request_status!="aprobadas"?(S(),L(o,{key:0,size:"",onClick:g=>N(!0,e.data.id),style:{height:"1.8rem",width:"2rem"},severity:"success",class:"p-1",icon:"pi pi-check"},null,8,["onClick"])):$("",!0),P(d).params.request_status!="rechazadas"?(S(),L(o,{key:1,onClick:g=>N(!1,e.data.id),style:{height:"1.8rem",width:"2rem",background:"var(--primary-color)",border:"none"},severity:"danger",class:"p-1",icon:"pi pi-times"},null,8,["onClick"])):$("",!0)])]),_:1})]),_:1},8,["filters","value"])])}}},Pe=W(we,[["__scopeId","data-v-40892623"]]);export{Pe as default};
