import{_ as ue,H as pe,l as ve,z as _e,r as i,A as me,I as W,q as fe,s as z,U as B,a as c,o as h,b as X,d as a,i as s,h as l,B as be,j as g,t as u,u as f,x as N,g as D,k as M,F as he,e as ge,N as we,p as ye,m as Ce,av as P}from"./index-e0d1eab6.js";import{D as Te}from"./DialogoPedido-fb8603ca.js";import"./formatoPesos-2bac1853.js";import"./formatoPesos-2293ab52.js";const r=V=>(ye("data-v-2c9ca175"),V=V(),Ce(),V),ke={class:"page"},Pe=r(()=>a("header",{class:"page-header"},[a("div",{class:"title-wrap"},[a("i",{class:"pi pi-wallet"}),a("h2",null,"Transferencias cliente no confirma")])],-1)),Ve={class:"card"},xe=r(()=>a("div",{class:"toolbar-left"},[a("i",{class:"pi pi-list"}),a("span",null,[a("b",null,"Solicitudes")])],-1)),Se={class:"p-input-icon-left",style:{width:"18rem","max-width":"100%"}},Re=r(()=>a("i",{class:"pi pi-search"},null,-1)),De=r(()=>a("div",{class:"empty"},[a("i",{class:"pi pi-inbox"}),a("p",null,"Sin transferencias pendientes por ahora.")],-1)),Ie={class:"action-row"},Ue={class:"filters"},qe={class:"filters-row"},Le={class:"filters-item"},$e=r(()=>a("label",{class:"filters-label"},"Fecha inicio",-1)),ze={class:"filters-item"},Be=r(()=>a("label",{class:"filters-label"},"Fecha fin",-1)),Ne={class:"filters-item grow"},Me=r(()=>a("label",{class:"filters-label"},"Sedes",-1)),je={class:"filters-item"},Fe={class:"table-header-compact"},Oe=r(()=>a("i",{class:"pi pi-chart-bar"},null,-1)),Ae=r(()=>a("div",{class:"empty"},[a("i",{class:"pi pi-folder-open"}),a("p",null,"Sin resultados para los filtros seleccionados.")],-1)),Ee={class:"m-0"},He=r(()=>a("h3",null,[a("b",null,"Rechazar orden")],-1)),Ge={class:"dialog-footer"},Je=r(()=>a("h3",null,[a("b",null,"Aprobar esta orden")],-1)),Ke=r(()=>a("div",{class:"dialog-content"},[a("p",null,"Confirma que la transferencia fue recibida.")],-1)),Qe={class:"dialog-footer"},We=r(()=>a("h3",null,[a("b",null,"El cliente no realizó la transferencia")],-1)),Xe=r(()=>a("div",{class:"dialog-content"},[a("p",null,"Se archivará la solicitud como no confirmada.")],-1)),Ye={class:"dialog-footer"},Ze={__name:"TransferSessionNoConfirmed",setup(V){const w=pe(),I=ve(),U=_e(),x=i([]),j=i([]),F=i([]),O=i([]),Y=i(!1),q=i(!1),A=i(0),y=i(),Z=()=>{y.value={global:{value:null,matchMode:be.CONTAINS}}};me(()=>Z());const _=i({start_date:new Date,end_date:new Date,sites:[]}),S=i(!1),b=i(!1),C=i(!1),m=i({}),E=i({}),ee=i(0),ae=i(0),te=o=>{U.setVisible("currentOrder",!0),U.setOrder(o)},se=async o=>{const t=I.rawUserData.id;await P.authorizeOrder(o,t),b.value=!1,ee.value++,R()},le=async o=>{const t=I.rawUserData.id;await P.rejectOrder(o,t),C.value=!1,ae.value++,R()},oe=o=>{b.value=!0,m.value.order_id=o},ne=o=>{C.value=!0,E.value.order_id=o},ie=async(o,t,G)=>{const L={authorized:o,responsible_id:I.rawUserData.id,responsible_observation:m.value.reason||"sin observaciones"};await P.resolveCancellationRequest(t,L),b.value=!1,S.value=!1,x.value=await P.getPendientsCancellationRequest()},H=async()=>{q.value=!0;try{const o=await z.post(`${B}/transaction_report/`,{start_date:_.value.start_date,end_date:_.value.end_date,sites:_.value.sites.map(t=>t.site_id)});j.value=o||[],F.value=o!=null&&o[0]?Object.keys(o[0]):[]}finally{q.value=!1}},R=async()=>{x.value=await z.get(`${B}/order-to-transfer-no-confirmed`)};return W(()=>U.numberTransferRequests,()=>{R()}),W(()=>w.params.request_status,async()=>{x.value=await P.getPendientsCancellationRequest()},{deep:!0}),fe(async()=>{O.value=await z.get(`${B}/sites/`),await Promise.all([R(),H()])}),(o,t)=>{const G=c("InputText"),L=c("Toolbar"),p=c("Column"),v=c("Button"),J=c("DataTable"),K=c("TabPanel"),Q=c("Calendar"),re=c("MultiSelect"),de=c("TabView"),ce=c("Textarea"),$=c("Dialog");return h(),X("div",ke,[Pe,a("div",Ve,[s(de,{activeIndex:A.value,"onUpdate:activeIndex":t[5]||(t[5]=e=>A.value=e)},{default:l(()=>[s(K,{header:"Básico"},{default:l(()=>[s(L,{class:"toolbar"},{start:l(()=>[xe]),end:l(()=>[a("span",Se,[Re,s(G,{modelValue:y.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value.global.value=e),placeholder:"Buscar solicitud...",class:"w-full"},null,8,["modelValue"])])]),_:1}),s(J,{value:x.value,class:"datatable",loading:Y.value,paginator:!0,rows:15,rowsPerPageOptions:[5,10,25,100],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} transferencias",scrollable:"",scrollHeight:"65vh",stripedRows:"",showGridlines:"",filters:y.value,"onUpdate:filters":t[1]||(t[1]=e=>y.value=e)},{empty:l(()=>[De]),default:l(()=>[s(p,{field:"order_id",header:"ID orden",style:{"min-width":"max-content"},frozen:""}),s(p,{header:"Monto de la orden"},{body:l(e=>[g(u(f(N)(e.data.total_order_price)),1)]),_:1}),s(p,{header:"Fecha"},{body:l(e=>{var n,d,T,k;return[g(u((k=(T=(d=(n=e.data.latest_status_timestamp)==null?void 0:n.split("T")[0])==null?void 0:d.split("-"))==null?void 0:T.reverse())==null?void 0:k.join("-")),1)]}),_:1}),s(p,{header:"Hora"},{body:l(e=>{var n,d,T,k;return[g(u((k=(T=(d=(n=e.data.latest_status_timestamp)==null?void 0:n.split("T")[1])==null?void 0:d.split(":"))==null?void 0:T.slice(0,2))==null?void 0:k.join(":")),1)]}),_:1}),s(p,{header:"Domicilio"},{body:l(e=>{var n,d;return[g(u(f(N)(((d=(n=e.data.pe_json)==null?void 0:n.delivery)==null?void 0:d.delivery_costoenvio)||0)),1)]}),_:1}),s(p,{header:"Total"},{body:l(e=>{var n,d;return[g(u(f(N)((((d=(n=e.data.pe_json)==null?void 0:n.delivery)==null?void 0:d.delivery_costoenvio)||0)+(e.data.total_order_price||0))),1)]}),_:1}),s(p,{header:"Cliente",style:{"min-width":"16rem"}},{body:l(e=>[g(u(e.data.user_name)+" "+u(e.data.second_name)+" "+u(e.data.first_last_name)+" "+u(e.data.second_last_name),1)]),_:1}),s(p,{field:"user_phone",header:"Teléfono cliente"}),s(p,{header:"Acciones",frozen:"",alignFrozen:"right",class:"px-0",style:{"min-width":"10rem"}},{body:l(e=>[a("div",Ie,[f(w).params.request_status!="aprobadas"?(h(),D(v,{key:0,onClick:n=>te(e.data),icon:"pi pi-eye",style:{width:"2rem",height:"2rem"},severity:"info","aria-label":"Ver"},null,8,["onClick"])):M("",!0),f(w).params.request_status!="aprobadas"?(h(),D(v,{key:1,onClick:n=>oe(e.data.order_id),icon:"pi pi-check",severity:"success","aria-label":"Aprobar",style:{width:"2rem",height:"2rem"}},null,8,["onClick"])):M("",!0),f(w).params.request_status!="aprobadas"?(h(),D(v,{key:2,onClick:n=>ne(e.data.order_id),icon:"pi pi-trash",severity:"danger","aria-label":"Archivar",style:{width:"2rem",height:"2rem"}},null,8,["onClick"])):M("",!0)])]),_:1})]),_:1},8,["value","loading","filters"])]),_:1}),s(K,{header:"Reportes"},{default:l(()=>[a("div",Ue,[a("div",qe,[a("div",Le,[$e,s(Q,{modelValue:_.value.start_date,"onUpdate:modelValue":t[2]||(t[2]=e=>_.value.start_date=e),showIcon:""},null,8,["modelValue"])]),a("div",ze,[Be,s(Q,{modelValue:_.value.end_date,"onUpdate:modelValue":t[3]||(t[3]=e=>_.value.end_date=e),showIcon:""},null,8,["modelValue"])]),a("div",Ne,[Me,s(re,{modelValue:_.value.sites,"onUpdate:modelValue":t[4]||(t[4]=e=>_.value.sites=e),options:O.value.filter(e=>e.show_on_web),optionLabel:"site_name",display:"chip",placeholder:"Selecciona sedes",class:"w-full"},null,8,["modelValue","options"])]),a("div",je,[s(v,{severity:"help",onClick:H,label:"Buscar",icon:"pi pi-search"})])])]),s(J,{value:j.value,class:"datatable",loading:q.value,paginator:!0,rows:15,rowsPerPageOptions:[5,10,25,100],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} transferencias",scrollable:"",showGridlines:"",stripedRows:""},{header:l(()=>[a("div",Fe,[Oe,a("span",null,[a("b",null,"Transferencias "+u(f(w).params.section),1)])])]),empty:l(()=>[Ae]),default:l(()=>[(h(!0),X(he,null,ge(F.value,e=>(h(),D(p,{key:e,header:e,class:"py-1",style:{"text-transform":"uppercase"}},{body:l(n=>[a("h6",Ee,u(n.data[e]),1)]),_:2},1032,["header"]))),128))]),_:1},8,["value","loading"])]),_:1})]),_:1},8,["activeIndex"])]),s($,{visible:S.value,"onUpdate:visible":t[10]||(t[10]=e=>S.value=e),modal:"",closable:!0,draggable:!1,class:"dialog-md"},{header:l(()=>[He]),footer:l(()=>[a("div",Ge,[s(v,{label:"Cancelar",class:"p-button-text",onClick:t[8]||(t[8]=e=>S.value=!1)}),s(v,{label:"Rechazar",type:"submit",class:"p-button-danger",onClick:t[9]||(t[9]=e=>{var n;return(n=o.$el.querySelector("form"))==null?void 0:n.dispatchEvent(new o.Event("submit",{cancelable:!0,bubbles:!0}))})})])]),default:l(()=>[a("form",{onSubmit:t[7]||(t[7]=we(e=>ie(!1,m.value.id,m.value.reason),["prevent"])),class:"dialog-form"},[s(ce,{id:"reason",modelValue:m.value.reason,"onUpdate:modelValue":t[6]||(t[6]=e=>m.value.reason=e),rows:"5",placeholder:"¿Por qué deseas rechazar esta solicitud?",class:"w-full",style:{resize:"none","text-transform":"lowercase"}},null,8,["modelValue"])],32)]),_:1},8,["visible"]),s($,{visible:b.value,"onUpdate:visible":t[13]||(t[13]=e=>b.value=e),modal:"",closable:!0,draggable:!1,class:"dialog-sm"},{header:l(()=>[Je]),footer:l(()=>[a("div",Qe,[s(v,{label:"Cancelar",class:"p-button-text",onClick:t[11]||(t[11]=e=>b.value=!1)}),s(v,{label:"Aprobar (Transferencia confirmada)",class:"p-button-success",onClick:t[12]||(t[12]=e=>se(m.value.order_id))})])]),default:l(()=>[Ke]),_:1},8,["visible"]),s($,{visible:C.value,"onUpdate:visible":t[16]||(t[16]=e=>C.value=e),modal:"",closable:!0,draggable:!1,class:"dialog-sm"},{header:l(()=>[We]),footer:l(()=>[a("div",Ye,[s(v,{label:"Cancelar",class:"p-button-text",onClick:t[14]||(t[14]=e=>C.value=!1)}),s(v,{label:"Archivar (Transferencia no confirmada)",class:"p-button-danger",onClick:t[15]||(t[15]=e=>le(E.value.order_id))})])]),default:l(()=>[Xe]),_:1},8,["visible"]),s(Te)])}}},la=ue(Ze,[["__scopeId","data-v-2c9ca175"]]);export{la as default};
