import{_ as Ee,f as i,x as Oe,C as Ve,h as je,U as y,g as Fe,r as E,o as g,c as h,d as l,w as c,a as t,l as A,F as X,b as te,k as O,t as p,n as We,a4 as Ne,y as re,a5 as Me,p as Be,e as Re}from"./index-46a67493.js";import{u as de,f as ue,s as ce,e as pe,a as Ae,b as me,c as ve,d as fe}from"./subMonths-2b0c8d2c.js";import{s as He}from"./siteService-24a2257b.js";import{l as Pe}from"./user-644c17c7.js";const v=H=>(Be("data-v-d6b4bd51"),H=H(),Re(),H),qe={key:0,class:"user-info",style:{display:"flex","flex-direction":"column","align-items":"center"}},ze=["src"],Je={class:"col-12"},Ke=v(()=>t("b",null,"Nombre:",-1)),Ze=v(()=>t("b",null,"Cargo:",-1)),Ge=v(()=>t("b",null,"Telefono:",-1)),Qe=v(()=>t("b",null,"Contrato",-1)),Xe={class:""},Ye={class:"col-12 p-0 m-0"},et={class:"col-12 p-0 m-0"},tt={class:"col-12 p-0"},at={class:"col-12 p-0"},st=v(()=>t("p",null,"Desde:",-1)),ot=v(()=>t("p",null,"Hasta:",-1)),lt=v(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este día de trabajo y todos sus registros?")],-1)),nt=v(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este registro?")],-1)),it=v(()=>t("h3",null,"Nueva semana",-1)),rt={style:{},class:"p-0 m-0 col-12"},dt={class:"col-12 p-0 m-0 mb-8"},ut={class:"grid p-0 mx-auto"},ct={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},pt={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},mt={class:"col-12 md:col-2 py-2",style:{display:"flex",height:"4rem","justify-content":"end"}},vt={class:"grid"},ft={class:"col-2 p-0",style:{height:"80vh","overflow-y":"auto"}},yt={class:"p-0 text-sm",style:{display:"flex","justify-content":"center"}},gt={style:{display:"flex",gap:"1rem","flex-direction":"column"},class:"pb-3 m-auto"},ht=["onDragstart"],_t=["onClick","src","onError"],wt={class:"my-0 py-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},bt={class:"my-0 py-0",style:{"min-width":"min-content","text-transform":"uppercase","text-align":"center"}},kt={class:"col-10",style:{height:"80vh","overflow-y":"auto"}},Dt={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},xt={class:"col-12 pb-6",style:{}},St={style:{display:"flex",gap:"0rem","flex-direction":"column"}},Ct={class:"py-0 px-4 text-center col-12 m-0 p-0 text",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},Tt={style:{"overflow-x":"auto"}},$t={style:{"min-width":"max-content"}},Lt=["onDrop"],Ut={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},It=["onClick","src","onError"],Et={key:0,class:"text-sm"},Ot={class:"py-0 my-0"},Vt={class:"py-0 my-0"},jt={key:1,class:"text-sm"},Ft={class:"py-0 my-0"},Wt=v(()=>t("p",{class:"py-0 my-0"},[t("b",{style:{color:"green"}},"DESCANSA")],-1)),Nt={class:"",style:{"text-transform":"uppercase"}},Mt=v(()=>t("p",null,"Hora de llegada:",-1)),Bt=v(()=>t("p",null,"Hora de salida:",-1)),Rt={class:"col-12 p-0",style:{display:"flex","justify-content":"space-between"}},At={__name:"shift_work_schedule",setup(H){const P=i(!1),_=i(null),ae=s=>{_.value=s,P.value=!0},V=i(!1),w=i(new Date),S=i(new Date),q=Pe(),d=Oe(),j=i(!1),z=i(null),T=i(),F=i(),$=i(),L=i(),C=i(!1),m=i(null),b=i(null),k=i(new Date),D=i(new Date),se=Ve(()=>!$.value||!L.value?"":`${ue($.value,"dd/MM/yyyy")} - ${ue(L.value,"dd/MM/yyyy")}`),ye=()=>{w.value=$.value||new Date,S.value=L.value||new Date,V.value=!0},ge=()=>{V.value=!1},W=()=>{$.value=w.value,L.value=S.value,V.value=!1,M()},oe=()=>{const s=new Date;w.value=ce(s,{weekStartsOn:1}),S.value=pe(s,{weekStartsOn:1}),W()},he=()=>{const s=ce(new Date,{weekStartsOn:1});w.value=Ae(s,7),S.value=pe(w.value,{weekStartsOn:1}),W()},_e=()=>{const s=new Date;w.value=me(s),S.value=ve(s),W()},we=()=>{const s=new Date;w.value=me(fe(s,1)),S.value=ve(fe(s,1)),W()},be=s=>{z.value=s,j.value=!0},ke=async()=>{if(j.value=!1,d.setLoading(!0,"borrando"),!z.value)return;const s=await fetch(`${y}/shift_work_records/${z.value}`,{method:"DELETE"});s.ok?(M(),d.setLoading(!1,"borrando")):(console.error("Error al eliminar el registro:",await s.text()),alert("Hubo un error al eliminar el registro."),d.setLoading(!1,"borrando")),z.value=null},N=i(!1),J=i(null),De=s=>{J.value=s,N.value=!0},xe=async()=>{if(N.value=!1,!J.value)return;d.setLoading(!0,"borrando"),(await fetch(`${y}/shift_work_days/${J.value}`,{method:"DELETE"})).ok?(Z.value=Z.value.filter(e=>e.id!==J.value),d.setLoading(!1,"borrando")):(alert("Hubo un error al eliminar el día de trabajo."),d.setLoading(!1,"borrando"))},Se={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},Ce=s=>{if(!(s instanceof Date))return console.error("getDayColor: date is not a Date object",s),"#FFFFFF";const e=s.toLocaleDateString("en-US",{weekday:"long"});return Se[e]},K=i([]),Z=i([]),Y=(s,e)=>{const o={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},n=s==null?void 0:s.trim().toLowerCase();e.target.src=o[n]||o.default},U=i(null),I=i(!1),G=i(new Date);je(async()=>{F.value=await He.getSites(),T.value=F.value.filter(e=>e.site_id==q.rawUserData.site_id)[0],U.value=F.value.filter(e=>e.site_id==q.rawUserData.site_id)[0];const s=await de.getUsersBySiteId(q.rawUserData.site_id);K.value=s.filter(e=>e.status=="activo"),await fetch(`${y}/shift_work_days_with_records`)}),Fe(T,async s=>{const e=await de.getUsersBySiteId(s.site_id);K.value=e.filter(o=>o.status=="activo"),U.value=s,oe(),M()});const M=async()=>{if(d.setLoading(!0,"cargando horario"),!T.value||!$.value||!L.value){alert("Please select a site and date range.");return}const s=$.value.toISOString().split("T")[0],e=L.value.toISOString().split("T")[0],o=await fetch(`${y}/shift_filtered_work_days?site_id=${T.value.site_id}&start_date=${s}&end_date=${e}`);if(o.ok){d.setLoading(!1,"cargando horario");const n=await o.json();Z.value=n.map(u=>(u.date=new Date(u.date),u.date.setDate(u.date.getDate()+1),u.users=u.records.map(x=>{let Q=K.value.find(f=>f.id===x.employer_id);if(Q){let f={...Q};const B=new Date(`${u.date.toISOString().split("T")[0]}T${x.start_time}`),R=new Date(`${u.date.toISOString().split("T")[0]}T${x.end_time}`);return f.arrivalTime=B,f.departureTime=R,f.hoursWorked=(R-B)/36e5,f.rest=x.rest,f}return null}).filter(x=>x!=null),d.setLoading(!1,"cargando horario"),u))}else d.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")},Te=async()=>{if(I.value=!1,d.setLoading(!0,"guardando"),!U.value||!G.value){alert("Please select a site and date.");return}let s=new Date(G.value.getTime());const e=new Date(s.getTime()-s.getTimezoneOffset()*6e4).toISOString().split("T")[0],o=await fetch(`${y}/shift_work_days`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:e,site_id:U.value.site_id})});if(o.ok){const n=await o.json();n.date=new Date(n.date),n.date.setDate(n.date.getDate()+1),d.setLoading(!1,"guardando"),M()}else{const n=await o.json();n.detail&&n.detail==="El día con el mismo site_id ya está registrado."?alert("Este dia ya esta registrado para esta sede"):alert("Failed to add new workday"),d.setLoading(!1,"guardando")}},$e=s=>{m.value=s},Le=s=>{b.value=s,C.value=!0},Ue=async()=>{if(C.value=!1,d.setLoading(!0,"cargando"),!m.value||!b.value)return;if(k.value.getTime()>=D.value.getTime()){alert("La hora de llegada no puede ser mayor o igual a la hora de salida."),d.setLoading(!1,"cargando"),C.value=!0;return}let s=k.value.toISOString().split("T")[1].slice(0,8),e=D.value.toISOString().split("T")[1].slice(0,8);const o={employer_id:m.value.id,work_day_id:b.value.id,start_time:s,end_time:e};await fetch(`${y}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),m.value.arrivalTime=k.value,m.value.departureTime=D.value,m.value.hoursWorked=(D.value-k.value)/36e5,b.value.users.push(m.value),C.value=!1,m.value=null,b.value=null,d.setLoading(!1,"cargando")},Ie=async()=>{if(C.value=!1,d.setLoading(!0,"cargando"),!m.value||!b.value)return;let s=k.value.toISOString().split("T")[1].slice(0,8),e=D.value.toISOString().split("T")[1].slice(0,8);const o={employer_id:m.value.id,work_day_id:b.value.id,start_time:s,end_time:e,rest:!0};await fetch(`${y}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});const n={...m.value};n.arrivalTime=k.value,n.departureTime=D.value,n.hoursWorked=(D.value-k.value)/36e5,n.rest=!0,b.value.users.push(n),C.value=!1,m.value=null,b.value=null,d.setLoading(!1,"cargando")};return(s,e)=>{var B,R,le;const o=E("Button"),n=E("Dialog"),u=E("Calendar"),x=E("Dropdown"),Q=E("InputText"),f=E("InputIcon");return g(),h(X,null,[l(n,{visible:P.value,"onUpdate:visible":e[2]||(e[2]=a=>P.value=a),modal:"",style:{width:"20rem"}},{footer:c(()=>[l(o,{label:"Cerrar",onClick:e[1]||(e[1]=a=>P.value=!1)})]),default:c(()=>{var a;return[t("h3",null,p(_.value.name),1),_.value?(g(),h("div",qe,[t("img",{class:"shadow-3 p-1",src:`${A(y)}/read-product-image/300/employer-${_.value.dni}`,onError:e[0]||(e[0]=r=>Y(_.value.gender,r)),alt:"Foto del empleado",style:{width:"100px",height:"100px","border-radius":"50%","object-fit":"cover"}},null,40,ze),t("div",Je,[t("p",null,[Ke,O(" "+p(_.value.name),1)]),t("p",null,[Ze,O(" "+p(_.value.position),1)]),t("p",null,[Ge,O(" "+p(_.value.phone),1)]),t("p",null,[Qe,O(" "+p((a=_.value.contract_type)==null?void 0:a.toLowerCase()),1)])])])):We("",!0)]}),_:1},8,["visible"]),l(n,{visible:V.value,"onUpdate:visible":e[5]||(e[5]=a=>V.value=a),modal:"",closable:""},{footer:c(()=>[l(o,{severity:"danger",label:"Cancelar",onClick:ge,class:"p-button-text"}),l(o,{severity:"success",label:"Aceptar",onClick:W})]),default:c(()=>[t("div",Xe,[t("div",Ye,[l(o,{class:"col-12",severity:"danger",text:"",label:"Esta semana",onClick:oe})]),t("div",et,[l(o,{class:"col-12",severity:"help",text:"",label:"Semana pasada",onClick:he})]),t("div",tt,[l(o,{class:"col-12",severity:"warning",text:"",label:"Este mes",onClick:_e})]),t("div",at,[l(o,{class:"col-12",severity:"primary",text:"",label:"Mes pasado",onClick:we})])]),st,l(u,{class:"col-12",modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=a=>w.value=a),showIcon:""},null,8,["modelValue"]),ot,l(u,{class:"col-12",modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=a=>S.value=a),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),l(n,{visible:N.value,"onUpdate:visible":e[7]||(e[7]=a=>N.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:c(()=>[l(o,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[6]||(e[6]=a=>N.value=!1)}),l(o,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:xe})]),default:c(()=>[lt]),_:1},8,["visible"]),l(n,{visible:j.value,"onUpdate:visible":e[9]||(e[9]=a=>j.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:c(()=>[l(o,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[8]||(e[8]=()=>j.value=!1)}),l(o,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:ke})]),default:c(()=>[nt]),_:1},8,["visible"]),l(n,{visible:I.value,"onUpdate:visible":e[13]||(e[13]=a=>I.value=a),style:{width:"22rem"},modal:"",closeOnEscape:"",onClose:e[14]||(e[14]=a=>I.value=!1)},{footer:c(()=>[l(o,{label:"cancelar",onClick:e[12]||(e[12]=a=>I.value=!1),class:"p-button-danger"}),l(o,{label:"Agregar",onClick:Te,class:"p-button-success"})]),default:c(()=>[it,l(u,{class:"my-4",modelValue:G.value,"onUpdate:modelValue":e[10]||(e[10]=a=>G.value=a),showIcon:""},null,8,["modelValue"]),l(x,{class:"col-12 p-0",disabled:"",modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=a=>U.value=a),options:F.value,optionLabel:"site_name",placeholder:"Select a site"},null,8,["modelValue","options"])]),_:1},8,["visible"]),t("div",rt,[t("div",dt,[t("div",ut,[t("div",ct,[l(x,{disabled:!((le=A(Ne)["Horarios de trabajo admin"])!=null&&le.includes((R=(B=A(q))==null?void 0:B.rawUserData)==null?void 0:R.rol)),style:{height:"100%"},class:"col-12 p-0 m-0",modelValue:T.value,"onUpdate:modelValue":e[15]||(e[15]=a=>T.value=a),options:F.value,optionLabel:"site_name"},null,8,["disabled","modelValue","options"])]),t("div",pt,[l(Q,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:se.value,"onUpdate:modelValue":e[16]||(e[16]=a=>se.value=a),onClick:ye},null,8,["modelValue"])]),t("div",mt,[l(o,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:M})])])]),t("div",vt,[t("div",ft,[t("div",yt,[t("div",gt,[(g(!0),h(X,null,te(K.value,a=>(g(),h("div",{key:a.id,draggable:"true",style:{display:"flex","flex-direction":"column","align-items":"center"},onDragstart:r=>$e(a)},[t("img",{onClick:r=>ae(a),class:"shadow-2 p-1",src:`${A(y)}/read-product-image/96/employer-${a.dni}`,alt:"user.name",onError:r=>Y(a.gender,r),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,_t),t("p",wt,p(a.name.split(" ").slice(0,2).join(" ")),1),t("span",bt,p(a.position),1)],40,ht))),128))])])]),t("div",kt,[t("div",Dt,[l(o,{class:"mb-3",icon:"pi pi-plus",severity:"info",label:"Nueva semana",onClick:e[17]||(e[17]=a=>I.value=!0)})]),t("div",xt,[t("div",St,[(g(!0),h(X,null,te(Z.value,a=>(g(),h("div",{class:"p-0 m-0",key:a.id,style:{position:"relative"}},[t("div",{class:"shadow-2",style:re({"background-color":Ce(a.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[t("p",Ct,p(a.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"}))+" ",1)],4),t("div",Tt,[l(o,{style:{position:"absolute",right:"-1rem",top:"-1rem"},icon:"pi pi-trash text-2xl ",class:"p-button-rounded p-button-danger shadow-5",onClick:r=>De(a.id)},null,8,["onClick"]),t("div",$t,[t("div",{class:"shadow-5 p-3 m-0 p-4",style:{"border-radius":"0 0 0.5rem 0.5rem",display:"flex","overflow-x":"auto","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"},onDragover:e[18]||(e[18]=Me(()=>{},["prevent"])),onDrop:r=>Le(a)},[(g(!0),h(X,null,te(a.users,r=>{var ne,ie;return g(),h("div",{class:"shadow-2 p-3",key:r.id,style:re([{"text-align":"center",width:"7rem","aspect-ratio":"1 / 1","background-color":"white",color:"black",position:"relative","border-radius":"0.5rem"},r.rest?"outline:2px solid green;  ":"background-color: white;"])},[t("p",Ut,p(r.name.split(" ").slice(0,1).join(" ")),1),t("img",{class:"shadow-2 p-1",onClick:ee=>ae(r),src:`${A(y)}/read-product-image/96/employer-${r.dni}`,alt:"user.name",onError:ee=>Y(r.gender,ee),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,It),r.rest?(g(),h("div",jt,[t("p",Ft,[t("b",null,p((ie=r.contract_type)==null?void 0:ie.toLowerCase().slice(0,13)),1)]),Wt])):(g(),h("div",Et,[t("p",Ot,[t("b",null,p((ne=r.contract_type)==null?void 0:ne.toLowerCase().slice(0,13)),1)]),t("p",Vt,p(new Date(r.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).split(":")[0])+" - "+p(new Date(r.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).split(":")[0]),1)])),l(o,{style:{position:"absolute",width:"1.5rem",height:"1.5rem",top:"-1rem",right:"-1rem","font-weight":"bold"},icon:"pi pi-times fw-bold",class:"p-button-rounded p-button-danger p-0",onClick:ee=>be(r.id)},null,8,["onClick"])],4)}),128))],40,Lt)])])]))),128)),O(" ` ")])])])]),l(n,{visible:C.value,"onUpdate:visible":e[21]||(e[21]=a=>C.value=a),style:{width:"20rem"},modal:!0},{header:c(()=>[O(" . ")]),footer:c(()=>[t("div",Rt,[l(o,{severity:"help",label:"Descansa",onClick:Ie}),l(o,{severity:"success",label:"Aceptar",onClick:Ue})])]),default:c(()=>[t("h5",Nt,"Cuantas horas trabajo "+p(m.value.name)+"?",1),Mt,l(u,{modelValue:k.value,"onUpdate:modelValue":e[19]||(e[19]=a=>k.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:c(({clickCallback:a})=>[l(f,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"]),Bt,l(u,{modelValue:D.value,"onUpdate:modelValue":e[20]||(e[20]=a=>D.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:c(({clickCallback:a})=>[l(f,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])],64)}}},Jt=Ee(At,[["__scopeId","data-v-d6b4bd51"]]);export{Jt as default};
