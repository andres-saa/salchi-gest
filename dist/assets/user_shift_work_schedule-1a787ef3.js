import{_ as we,f as o,x as be,C as Se,h as ke,U as L,g as De,r as V,o as w,c as b,d as n,w as k,a,k as W,t as S,F as B,b as K,y as Z,a5 as xe,l as q,a2 as Te,n as Ce,p as Ie,e as Ue}from"./index-46a67493.js";import{u as G,f as Q,s as X,e as Y,a as Oe,b as ee,c as te,d as ae}from"./subMonths-2b0c8d2c.js";import{s as Le}from"./siteService-24a2257b.js";import{l as Ve}from"./user-644c17c7.js";const T=F=>(Ie("data-v-7490564a"),F=F(),Ue(),F),Fe={class:""},$e={class:"col-12 p-0 m-0"},Ee={class:"col-12 p-0 m-0"},je={class:"col-12 p-0"},Me={class:"col-12 p-0"},We=T(()=>a("p",null,"Desde:",-1)),Be=T(()=>a("p",null,"Hasta:",-1)),Re={style:{},class:"p-0 m-0"},Ne={class:"col-12 p-0 m-0"},Ae={class:"grid p-0 mx-auto",style:{"max-width":"700px"}},He={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},Pe={class:"col-12 md:col-2 py-2 md:mb-8",style:{display:"flex",height:"4rem","justify-content":"end"}},Je={class:"p-3 text-2xl text-center my-2",style:{"font-weight":"bold",color:"black","text-transform":"uppercase"}},ze=T(()=>a("i",{class:"fa-solid fa-folder-open"},null,-1)),Ke={class:"col-12 pb-6",style:{}},Ze={style:{display:"flex",gap:"0rem","flex-direction":"column"}},qe={class:"py-0 px-4 text-center col-12 m-0 p-0 text",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},Ge={style:{"overflow-x":"auto"}},Qe={style:{"min-width":"max-content"}},Xe=["onDrop"],Ye={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},et=["onClick","src","onError"],tt={key:0,class:"text-sm"},at={class:"py-0 my-0"},st={class:"py-0 my-0"},ot={key:1,class:"text-sm"},lt={class:"py-0 my-0"},nt=T(()=>a("p",{class:"py-0 my-0"},[a("b",{style:{color:"green"}},"DESCANSA")],-1)),it={key:2,style:{position:"absolute","background-color":"green","border-radius":"50%",width:"1.5rem",height:"1.5rem",top:"-0.5rem",right:"-0.5rem","font-weight":"bold"},icon:"pi pi-times fw-bold",class:"p-button-rounded p-button-danger p-0 texto-parpadeante"},rt={class:"",style:{"text-transform":"uppercase"}},dt=T(()=>a("p",null,"Hora de llegada:",-1)),ct=T(()=>a("p",null,"Hora de salida:",-1)),ut={class:"col-12 p-0",style:{display:"flex","justify-content":"space-between"}},pt={__name:"user_shift_work_schedule",setup(F){const se=o(!1),oe=o(null),le=e=>{oe.value=e,se.value=!0},C=o(!1),u=o(new Date),h=o(new Date),$=Ve(),p=be();o(!1),o(null);const I=o(),E=o(),D=o(),x=o(),y=o(!1),r=o(null),m=o(null),v=o(new Date),_=o(new Date),R=Se(()=>!D.value||!x.value?"":`${Q(D.value,"dd/MM/yyyy")} - ${Q(x.value,"dd/MM/yyyy")}`),ne=()=>{u.value=D.value||new Date,h.value=x.value||new Date,C.value=!0},ie=()=>{C.value=!1},U=()=>{D.value=u.value,x.value=h.value,C.value=!1,M()},N=()=>{const e=new Date;u.value=X(e,{weekStartsOn:1}),h.value=Y(e,{weekStartsOn:1}),U()},re=()=>{const e=X(new Date,{weekStartsOn:1});u.value=Oe(e,7),h.value=Y(u.value,{weekStartsOn:1}),U()},de=()=>{const e=new Date;u.value=ee(e),h.value=te(e),U()},ce=()=>{const e=new Date;u.value=ee(ae(e,1)),h.value=te(ae(e,1)),U()},ue=o(!1),pe=o(null),me=e=>{pe.value=e,ue.value=!0},ve={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},_e=e=>{if(!(e instanceof Date))return console.error("getDayColor: date is not a Date object",e),"#FFFFFF";const t=e.toLocaleDateString("en-US",{weekday:"long"});return ve[t]},j=o([]),A=o([]),he=(e,t)=>{const l={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},g=e==null?void 0:e.trim().toLowerCase();t.target.src=l[g]||l.default},H=o(null);o(!1),o(new Date),ke(async()=>{E.value=await Le.getSites(),I.value=E.value.filter(t=>t.site_id==$.rawUserData.site_id)[0],H.value=E.value.filter(t=>t.site_id==$.rawUserData.site_id)[0];const e=await G.getUsersBySiteId($.rawUserData.site_id);j.value=e.filter(t=>t.status=="activo"),await fetch(`${L}/shift_work_days_with_records`)}),De(I,async e=>{const t=await G.getUsersBySiteId(e.site_id);j.value=t.filter(l=>l.status=="activo"),H.value=e,N(),M()});const M=async()=>{if(p.setLoading(!0,"cargando horario"),!I.value||!D.value||!x.value){alert("Please select a site and date range.");return}const e=D.value.toISOString().split("T")[0],t=x.value.toISOString().split("T")[0],l=await fetch(`${L}/shift_filtered_work_days?site_id=${I.value.site_id}&start_date=${e}&end_date=${t}`);if(l.ok){p.setLoading(!1,"cargando horario");const g=await l.json();A.value=g.map(d=>(d.date=new Date(d.date),d.date.setDate(d.date.getDate()+1),d.users=d.records.map(f=>{let O=j.value.find(c=>c.id===f.employer_id);if(O){let c={...O};const s=new Date(`${d.date.toISOString().split("T")[0]}T${f.start_time}`),i=new Date(`${d.date.toISOString().split("T")[0]}T${f.end_time}`);return c.arrivalTime=s,c.departureTime=i,c.hoursWorked=(i-s)/36e5,c.rest=f.rest,c}return null}).filter(f=>f!=null),p.setLoading(!1,"cargando horario"),d))}else p.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")},ye=e=>{m.value=e,y.value=!0},ge=async()=>{if(y.value=!1,p.setLoading(!0,"cargando"),!r.value||!m.value)return;if(v.value.getTime()>=_.value.getTime()){alert("La hora de llegada no puede ser mayor o igual a la hora de salida."),p.setLoading(!1,"cargando"),y.value=!0;return}let e=v.value.toISOString().split("T")[1].slice(0,8),t=_.value.toISOString().split("T")[1].slice(0,8);const l={employer_id:r.value.id,work_day_id:m.value.id,start_time:e,end_time:t};await fetch(`${L}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),r.value.arrivalTime=v.value,r.value.departureTime=_.value,r.value.hoursWorked=(_.value-v.value)/36e5,m.value.users.push(r.value),y.value=!1,r.value=null,m.value=null,p.setLoading(!1,"cargando")},fe=async()=>{if(y.value=!1,p.setLoading(!0,"cargando"),!r.value||!m.value)return;let e=v.value.toISOString().split("T")[1].slice(0,8),t=_.value.toISOString().split("T")[1].slice(0,8);const l={employer_id:r.value.id,work_day_id:m.value.id,start_time:e,end_time:t,rest:!0};await fetch(`${L}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),r.value.arrivalTime=v.value,r.value.departureTime=_.value,r.value.hoursWorked=(_.value-v.value)/36e5,r.value.rest=!0,m.value.users.push(r.value),y.value=!1,r.value=null,m.value=null,p.setLoading(!1,"cargando")};return(e,t)=>{var c;const l=V("Button"),g=V("Calendar"),d=V("Dialog"),f=V("InputText"),O=V("InputIcon");return w(),b(B,null,[n(d,{visible:C.value,"onUpdate:visible":t[2]||(t[2]=s=>C.value=s),modal:"",closable:""},{footer:k(()=>[n(l,{severity:"danger",label:"Cancelar",onClick:ie,class:"p-button-text"}),n(l,{severity:"success",label:"Aceptar",onClick:U})]),default:k(()=>[a("div",Fe,[a("div",$e,[n(l,{class:"col-12",severity:"danger",text:"",label:"Esta semana",onClick:N})]),a("div",Ee,[n(l,{class:"col-12",severity:"help",text:"",label:"Semana pasada",onClick:re})]),a("div",je,[n(l,{class:"col-12",severity:"warning",text:"",label:"Este mes",onClick:de})]),a("div",Me,[n(l,{class:"col-12",severity:"primary",text:"",label:"Mes pasado",onClick:ce})])]),We,n(g,{class:"col-12",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),showIcon:""},null,8,["modelValue"]),Be,n(g,{class:"col-12",modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=s=>h.value=s),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),a("div",Re,[a("div",Ne,[a("div",Ae,[a("div",He,[n(f,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:R.value,"onUpdate:modelValue":t[3]||(t[3]=s=>R.value=s),onClick:ne},null,8,["modelValue"])]),a("div",Pe,[n(l,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:M})])])]),a("p",Je,[ze,W(" Calendario de trabajo "+S((c=I.value)==null?void 0:c.site_name),1)]),a("div",Ke,[a("div",Ze,[(w(!0),b(B,null,K(A.value,s=>(w(),b("div",{class:"p-0 m-0",key:s.id,style:{position:"relative"}},[a("div",{class:"shadow-2",style:Z({"background-color":_e(s.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[a("p",qe,S(s.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"}))+" ",1)],4),a("div",Ge,[n(l,{style:{position:"absolute",right:"-1rem",top:"-1rem"},icon:"pi pi-trash text-2xl ",class:"p-button-rounded p-button-danger shadow-5",onClick:i=>me(s.id)},null,8,["onClick"]),a("div",Qe,[a("div",{class:"shadow-5 p-3 m-0 p-4",style:{"border-radius":"0 0 0.5rem 0.5rem",display:"flex","overflow-x":"auto","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"},onDragover:t[4]||(t[4]=xe(()=>{},["prevent"])),onDrop:i=>ye(s)},[(w(!0),b(B,null,K(s.users,i=>{var P,J;return w(),b("div",{class:"shadow-2 p-3",key:i.id,style:Z([{"text-align":"center",width:"7rem","aspect-ratio":"1 / 1","background-color":"white",color:"black",position:"relative","border-radius":"0.5rem"},i.rest?"box-shadow:0 0 10px green !important ":"background-color: white;"])},[a("p",Ye,S(i.name.split(" ").slice(0,1).join(" ")),1),a("img",{class:"shadow-2 p-1",onClick:z=>le(i),src:`${q(L)}/read-product-image/96/employer-${i.dni}`,alt:"user.name",onError:z=>he(i.gender,z),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,et),i.rest?(w(),b("div",ot,[a("p",lt,[a("b",null,S((J=i.contract_type)==null?void 0:J.toLowerCase().slice(0,13)),1)]),nt])):(w(),b("div",tt,[a("p",at,[a("b",null,S((P=i.contract_type)==null?void 0:P.toLowerCase().split(" ").slice(0,2).join(" ")),1)]),a("p",st,S(new Date(i.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).split(":")[0])+" - "+S(new Date(i.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).split(":")[0]),1)])),q(Te)()==i.id?(w(),b("div",it)):Ce("",!0)],4)}),128))],40,Xe)])])]))),128)),W(" ` ")])]),n(d,{visible:y.value,"onUpdate:visible":t[7]||(t[7]=s=>y.value=s),style:{width:"20rem"},modal:!0},{header:k(()=>[W(" . ")]),footer:k(()=>[a("div",ut,[n(l,{severity:"help",label:"Descansa",onClick:fe}),n(l,{severity:"success",label:"Aceptar",onClick:ge})])]),default:k(()=>[a("h5",rt,"Cuantas horas trabajo "+S(r.value.name)+"?",1),dt,n(g,{modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=s=>v.value=s),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:k(({clickCallback:s})=>[n(O,{class:"pi pi-clock cursor-pointer",onClick:s},null,8,["onClick"])]),_:1},8,["modelValue"]),ct,n(g,{modelValue:_.value,"onUpdate:modelValue":t[6]||(t[6]=s=>_.value=s),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:k(({clickCallback:s})=>[n(O,{class:"pi pi-clock cursor-pointer",onClick:s},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])],64)}}},yt=we(pt,[["__scopeId","data-v-7490564a"]]);export{yt as default};
