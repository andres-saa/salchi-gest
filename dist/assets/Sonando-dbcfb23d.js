import{_ as de,h as c,i as ve,D as pe,g as $,o as d,d as M,e as h,a as t,f as r,c as _,F as U,r as L,b as Q,u as N,U as F,t as g,n as me,p as _e,m as ye,Q as $e,G as C,I as xe,a8 as Pe,q as ue,k as Ce,w as Te,j as Ie,a9 as R}from"./index-5a52dadb.js";import{u as fe}from"./site-4975bcae.js";/* empty css                                                                */const he=y=>(_e("data-v-e757aa3b"),y=y(),ye(),y),De={class:"dialog-content"},Be=he(()=>t("b",{class:"dialog-title"},null,-1)),Ee={class:"form-container"},Ne={key:0,class:"loading-container"},Ve=he(()=>t("p",{class:"loading-text"},"Cargando sedes...",-1)),qe={key:1,class:"sites-grid"},Re=["onClick"],Ae=["src","alt"],Ue={class:"site-info"},We={class:"site-name"},Ye={class:"button-container"},Oe={__name:"siteDialogSonando",setup(y){const S=fe(),P=c([]),f=c(!1),v=c(null),T=async()=>{f.value=!0;try{const i=await fetch(`${F}/sites`);if(i.ok){const p=await i.json();P.value=p}else console.error("Error al obtener las sedes:",i.statusText)}catch(i){console.error("Error al obtener las sedes:",i)}finally{f.value=!1}},W=i=>{v.value=i},Y=()=>{v.value&&(S.sonando=v.value,S.visibles.sonandoCurrentSite=!1)};return ve(()=>{T()}),pe(()=>S.visibles.currentSite,i=>{i&&(v.value=null)}),(i,p)=>{const O=$("ProgressSpinner"),j=$("Button"),I=$("Dialog");return d(),M(I,{class:"dialog-content",style:me([{"background-color":"#000000ba !important",color:"white","max-width":"94%",padding:"0"},"width: 60rem ; border: 3px solid  red"]),visible:N(S).visibles.sonandoCurrentSite,"onUpdate:visible":p[0]||(p[0]=l=>N(S).visibles.sonandoCurrentSite=l),header:"Selección de sede",modal:!0},{footer:h(()=>[t("div",Ye,[r(j,{label:"Aplicar",severity:"help",onClick:Y,disabled:!v.value,class:"apply-"},null,8,["disabled"])])]),default:h(()=>[t("div",De,[Be,t("div",Ee,[f.value?(d(),_("div",Ne,[r(O,{class:"spinner",strokeWidth:"8",fill:"var(--white)",animationDuration:".5s","aria-label":"Cargando sedes"}),Ve])):(d(),_("div",qe,[(d(!0),_(U,null,L(P.value.filter(l=>l.show_on_web==!0),l=>{var n;return d(),_("div",{key:l.id,class:Q(["site-card",{selected:((n=v.value)==null?void 0:n.site_id)===l.site_id}]),onClick:V=>W(l)},[t("img",{src:`${N(F)}/read-product-image/300/site-${l.site_id}`,alt:l.name,class:"site-image"},null,8,Ae),t("div",Ue,[t("p",We,g(l.site_name),1)])],10,Re)}),128))]))])])]),_:1},8,["visible"])}}},je=de(Oe,[["__scopeId","data-v-e757aa3b"]]),x=y=>(_e("data-v-8a1c0434"),y=y(),ye(),y),ze={style:{display:"flex","justify-content":"center","align-items":"center","flex-direction":"column",width:"100%"}},Me=x(()=>t("h3",null,[t("b",null,"Melo")],-1)),Le=x(()=>t("i",{class:"pi pi-check text-7xl",style:{"font-weight":"bold",color:"green"}},null,-1)),Qe=["src"],Fe={class:"main-container"},Ge={class:"salchimonster-container",style:{overflow:"hidden"}},Je={style:{display:"flex","justify-content":"end",width:"100%"}},He={class:"text-xl",style:{margin:"0 2rem 0 1rem"}},Ke=x(()=>t("i",{class:"fa-solid fa-play",style:{"margin-right":"1rem"}},null,-1)),Xe={style:{"min-width":"max-content","max-width":"max-content"}},Ze={style:{display:"flex",gap:"1rem","justify-content":"center"}},et={class:"player-wrapper",style:{"pointer-events":"none"}},tt={key:0,class:"current-song-info"},at={class:"text-xl"},ot=x(()=>t("strong",null,"Solicitada por:",-1)),st={class:"progress-bar-container"},lt={class:"controls-container"},nt={class:"queue-container"},it=x(()=>t("h3",null,"Cola de Reproducción",-1)),rt={class:"queue-list"},ct=["src"],ut={class:"song-info"},dt={class:"song-title"},vt={class:"requested-by"},pt=x(()=>t("h2",{style:{color:"black"}},"Solicitar una Canción",-1)),mt={class:"queue-list"},_t=["onClick"],yt=["src"],ft={class:"song-info"},ht={style:{color:"black !important"}},bt={class:"dialog-footer"},gt=x(()=>t("h2",{style:{color:"black"}},"Proporciona tu Nombre",-1)),St={class:"solicitar-nombre-container"},wt={style:{color:"black !important"}},kt=["src"],$t={class:"dialog-footer"},A="https://backend-musica.salchimonster.com",xt="wss://backend-musica.salchimonster.com/ws",Pt={__name:"Sonando",setup(y){const S=async()=>{try{await Ie.post(`${F}/refresh-cache/6149/?quipupos=0`),update(),melo.value=!0}catch(a){console.error("Error al refrescar la caché:",a)}},P=fe(),f=c(!1),v=c(!1),T=c(!0);function W(){l&&B.isPlayerReady&&(l.pauseVideo(),T.value=!0)}function Y(){l&&B.isPlayerReady&&(l.seekTo(n.value.currentTime,!0),l.playVideo(),T.value=!1)}const i=c(null),p=c("");function O(){i.value?v.value=!0:alert("Por favor, selecciona una canción primero.")}async function j(){if(!i.value||!p.value.trim()){alert("Por favor, selecciona una canción y proporciona tu nombre.");return}try{const a={type:"add_song",song_id:i.value.id,requestedBy:p.value.trim()};u&&u.readyState===WebSocket.OPEN?(u.send(JSON.stringify(a)),i.value=null,p.value="",v.value=!1,f.value=!1):alert("No estás conectado al servidor. Intenta recargar la página.")}catch(a){console.error("Error al agregar la canción a la cola:",a)}}const I=c(null);let l=null;const n=c(null),V=c([]),G=c([]),w=c(0),D=c(0),B=$e({isPlayerReady:!1,showPlayButton:!1});function J(a){const e=Math.floor(a/60),o=Math.floor(a%60);return`${e}:${o<10?"0":""}${o}`}C(()=>J(w.value)),C(()=>J(D.value));const be=C(()=>D.value>0?w.value/D.value*100:0),H=C(()=>!n.value||n.value.currentIndex===void 0?0:Math.max(n.value.currentIndex-4,0)),K=C(()=>V.value.slice(H.value)),k=C(()=>{var a;return((a=P.sonando)==null?void 0:a.site_id)||"default"});let u=null,q=c(null);function X(){u&&(u.close(),u=null);const a=`${xt}/${k.value}`;u=new WebSocket(a),u.onopen=()=>{console.log(`Conectado al WebSocket de la sede: ${k.value}`)},u.onmessage=e=>{try{const o=JSON.parse(e.data);if(o.type==="queue_update"){V.value=o.queue,n.value=o.status,w.value=o.status.currentTime,D.value=o.status.totalDuration;const m=o.status.currentSong?o.status.currentSong.id:null;m!==q.value&&(ae(m),q.value=m),B.showPlayButton=!o.status.isPlaying}}catch(o){console.error("Error al parsear mensaje del WebSocket:",o)}},u.onerror=e=>{console.error("Error en el WebSocket:",e)},u.onclose=()=>{console.warn(`WebSocket cerrado para sede: ${k.value}. Reintentando en 3 segundos...`),setTimeout(()=>{X()},3e3)}}function ge(a){if(window.YT&&window.YT.Player){a();return}window.onYouTubeIframeAPIReady=()=>{a()};const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e)}function Z(a,e,o,m){return new window.YT.Player(a,{videoId:e,playerVars:{autoplay:1,controls:1,disablekb:0,fs:1,playsinline:1,iv_load_policy:3,modestbranding:1,rel:0},events:{onReady:o,onStateChange:m}})}function ee(a){var e;B.isPlayerReady=!0,(e=n.value)!=null&&e.isPlaying?(a.target.playVideo(),w.value>0&&a.target.seekTo(w.value,!0)):(a.target.pauseVideo(),B.showPlayButton=!0)}function te(a){const e=window.YT.PlayerState;switch(a.data){case e.PLAYING:break;case e.PAUSED:break;case e.ENDED:oe();break}}function ae(a){window.YT&&window.YT.Player&&a&&(l?(l.loadVideoById({videoId:a,startSeconds:w.value}),n.value.isPlaying?l.playVideo():l.pauseVideo()):l=Z(I.value,a,ee,te))}async function oe(){try{await R.post(`${A}/next/${k.value}`)}catch(a){console.error("Error al avanzar a la siguiente canción:",a)}}async function Se(){try{const[a,e,o]=await Promise.all([R.get(`${A}/available`),R.get(`${A}/queue/${k.value}`),R.get(`${A}/current/${k.value}`)]);G.value=a.data,V.value=e.data,n.value=o.data,w.value=n.value.currentTime,D.value=n.value.totalDuration,q.value=n.value.currentSong?n.value.currentSong.id:null,ae(q.value)}catch(a){console.error("Error al cargar datos iniciales:",a)}}function we(a){const e=K.value.length;if(e===1)return 1;const o=.2,z=1-o;return o+a/(e-1)*z}return ve(()=>{ge(()=>{var e,o;const a=((o=(e=n.value)==null?void 0:e.currentSong)==null?void 0:o.id)||"";a&&(l=Z(I.value,a,ee,te))}),pe(k,async(a,e)=>{console.log(`Cambio de sede: ${e} -> ${a}`),await Se(),X()},{immediate:!0})}),xe(()=>{u&&u.close()}),(a,e)=>{var le,ne,ie,re,ce;const o=$("Button"),m=$("Dialog"),z=$("ProgressBar"),se=$("InputText"),ke=Pe("random-hover-color");return d(),_(U,null,[r(m,{visible:a.melo,"onUpdate:visible":e[1]||(e[1]=s=>a.melo=s),modal:"",closable:!1,style:{display:"flex","justify-content":"center",width:"10rem"}},{default:h(()=>[t("div",ze,[Me,Le,r(o,{onClick:e[0]||(e[0]=s=>a.melo=!1),icon:"pi pi-times",style:{position:"absolute","aspect-ratio":"1/1","border-radius":"50%",right:"-1.5rem",top:"-1.5rem"},severity:"danger"})])]),_:1},8,["visible"]),t("img",{style:{width:"120vw",position:"fixed",left:"-10%",top:"0",height:"100vh","object-fit":"cover","z-index":"-1",filter:"blur(10px)"},src:(ne=(le=n.value)==null?void 0:le.currentSong)==null?void 0:ne.thumbnail,alt:""},null,8,Qe),t("div",Fe,[t("div",Ge,[t("div",Je,[r(o,{onClick:S,severity:"help",label:"Sincronizar lista",class:"my-4"})]),t("h2",He,[t("b",null,[Ke,ue(" SONANDO EN "),t("span",Xe,"SM "+g((re=(ie=N(P))==null?void 0:ie.sonando)==null?void 0:re.site_name),1)])]),t("div",Ze,[r(o,{size:"small",onClick:e[2]||(e[2]=s=>f.value=!0),style:{margin:"1rem 0"},label:"Pedir tema",icon:"fa-solid fa-forward"}),r(o,{size:"small",icon:"fa-solid fa-sync",onClick:e[3]||(e[3]=s=>N(P).visibles.sonandoCurrentSite=!0),style:{margin:"1rem 0"},label:"Cambiar sede"})]),t("div",et,[t("div",{ref_key:"playerElement",ref:I,style:{width:"100% !important","max-width":"100% !important"},id:"youtube-player"},null,512)]),(ce=n.value)!=null&&ce.currentSong?(d(),_("div",tt,[t("h2",at,g(n.value.currentSong.title),1),t("p",null,[ot,ue(" "+g(n.value.currentSong.requestedBy),1)])])):Ce("",!0),t("div",st,[r(z,{value:be.value,"show-value":!1,style:{width:"100%"}},null,8,["value"])]),t("div",lt,[r(o,{disabled:"",rounded:"",icon:"fa-solid fa-backward",class:"previous-button"}),T.value?(d(),M(o,{key:1,rounded:"",icon:"fa-solid fa-play",onClick:Y,label:"Reanudar"})):(d(),M(o,{key:0,rounded:"",icon:"fa-solid fa-pause",onClick:W,label:"Pausa"})),r(o,{disabled:"",rounded:"",icon:"fa-solid fa-forward",onClick:oe,class:"next-button"})]),t("div",nt,[it,t("ul",rt,[(d(!0),_(U,null,L(K.value,(s,b)=>{var E;return d(),_("li",{key:`${s.id}-${b}`,class:Q({"current-song":H.value+b===((E=n.value)==null?void 0:E.currentIndex)}),style:me({opacity:we(b),transition:"opacity 0.5s ease"})},[t("img",{src:s.thumbnail,alt:"Thumbnail",class:"thumbnail"},null,8,ct),t("div",ut,[t("span",dt,g(s.title),1),t("span",vt,"Solicitada por: "+g(s.requestedBy),1)])],6)}),128))])])])]),r(m,{visible:f.value,"onUpdate:visible":e[5]||(e[5]=s=>f.value=s),modal:"",style:{"max-width":"94%",width:"40rem",border:"none"}},{header:h(()=>[pt]),footer:h(()=>[t("div",bt,[r(o,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:e[4]||(e[4]=s=>f.value=!1)}),r(o,{label:"Solicitar",severity:"help",icon:"pi pi-check",disabled:!i.value,onClick:O,class:"p-button"},null,8,["disabled"])])]),default:h(()=>[t("ul",mt,[(d(!0),_(U,null,L(G.value,(s,b)=>Te((d(),_("li",{class:Q(["song",{"selected-song":i.value===s}]),style:{transition:"all none"},key:`${s.id}-${b}`,onClick:E=>i.value=s},[t("img",{src:s.thumbnail,alt:"Thumbnail",class:"thumbnail"},null,8,yt),t("div",ft,[t("span",ht,g(s.title),1)])],10,_t)),[[ke,{opacity:.239}]])),128))])]),_:1},8,["visible"]),r(m,{visible:v.value,"onUpdate:visible":e[8]||(e[8]=s=>v.value=s),modal:"",style:{"max-width":"94%",width:"30rem"}},{header:h(()=>[gt]),footer:h(()=>[t("div",$t,[r(o,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:e[7]||(e[7]=s=>v.value=!1)}),r(o,{label:"Solicitar",icon:"pi pi-check",severity:"help",disabled:!p.value.trim(),onClick:j},null,8,["disabled"])])]),default:h(()=>{var s,b;return[t("div",St,[t("h3",wt,g((s=i.value)==null?void 0:s.title),1),t("img",{src:(b=i.value)==null?void 0:b.thumbnail,alt:"Thumbnail",class:"thumbnail-large"},null,8,kt),r(se,{style:{width:"100%",color:"black"},modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=E=>p.value=E),placeholder:"Tu nombre",class:"input-text"},null,8,["modelValue"])])]}),_:1},8,["visible"]),r(je)],64)}}},Dt=de(Pt,[["__scopeId","data-v-8a1c0434"]]);export{Dt as default};
