import{_ as ie,H as re,r as c,l as de,h as ce,a as v,o as W,c as J,d as a,w as p,b as o,F as pe,I as ue,q as L,t as y,s as me,m as he,p as _e,g as ve}from"./index-b10cff69.js";import{s as ye}from"./siteService-9ed1be51.js";import"./sass.default-a5b7a582.js";import{p as S}from"./purchaseOrderService-4c6300e8.js";import{u as F,w as Q}from"./xlsx-4f9172c7.js";import{E as fe,F as Y}from"./FileSaver.min-192d3dee.js";import{f as K}from"./format-8cf56335.js";import{e as X}from"./es-f6133d36.js";import"./_commonjsHelpers-de833af9.js";const g=E=>(_e("data-v-f4c4d746"),E=E(),ve(),E),ge={class:"grid"},we={class:"col-12 px-0 mx-0"},xe={class:"col-12",style:{display:"flex","flex-direction":"column"}},be=g(()=>o("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),De={class:"col-12",style:{display:"flex","flex-direction":"column"}},Ce=g(()=>o("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),ke={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},Se={class:"col-12",style:{display:"flex","justify-content":"center"}},Fe={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},Me={class:"m-auto",style:{"max-width":"1024px"}},Te={class:"m-0 col-12",style:{"align-items":"center"}},Ae={class:"p-0 mb-3",style:{display:"flex","align-items":"center",gap:"1rem"}},$e=g(()=>o("span",{class:"text-xl"},[o("b",null,"Sedes")],-1)),Ee={class:"col p-0",style:{display:"flex",gap:"1rem","align-items":"center"}},Oe=g(()=>o("span",{class:"text-xl"},[o("b",null,"Periodo")],-1)),Pe={class:"col-12 px-3 mt-4 pack-butons",style:{display:"flex","justify-content":"end",gap:"1rem"}},Re={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},Ue={class:"grid",style:{"align-items":"center"}},Ie=g(()=>o("div",{class:"col-12 md:col-6 p-3"},[o("span",{class:"text-xl",style:{width:"100%"}}," Gestionar ordenes de compra")],-1)),Le={class:"col-12 md:col-6 p-3"},Ve={style:{"min-width":"max-content"}},Ne={style:{"min-width":"max-content"}},Be={class:"m-0 p-0",style:{display:"flex",width:"min-content","justify-content":"start","align-items":"center",gap:"0.5rem"}},je={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},He=g(()=>o("br",null,null,-1)),qe={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},ze={class:"m-0"},Ge={class:"m-0"},We={key:0},Je=g(()=>o("b",null,"Notas",-1)),Qe={style:{display:"flex",gap:"1rem"}},Ye=5,Ke={__name:"OrderPathComplete",setup(E){const O=re(),V=c(!1),w=c({}),Z=r=>{V.value=!0,w.value=r},ee={Generada:"#FF0000",Lista:"#FFA500","Entregada al transportista":"#FFFF00",Completada:"#00FF00"},N=c(!1),q=c([]),te=async r=>{N.value=!0,q.value=await S.getPurchaseOrderHistory(r)},se=de(),B=c([]),P=c([{}]),x=c(!1),b=c(new Date(new Date().setDate(new Date().getDate()-7))),f=c(new Date),D=c(new Date(new Date().setDate(new Date().getDate()-7))),C=c(new Date),M=c(),T=c(),ae=(r,t)=>{D.value=r,C.value=t},A=r=>{const t=new Date,s=new Date(t);s.setDate(s.getDate()+1);const i=new Date(t);i.setDate(t.getDate()-r),b.value=i,r==1?(f.value=t,C.value=f.value,D.value=b.value,x.value=!1):(f.value=s,D.value=b.value,C.value=f.value,x.value=!1),z()};ce(async()=>{B.value=await ye.getSites(),P.value=B.value,M.value=await S.getPurchaseOrderByLap_id(Ye)}),(()=>{T.value={global:{value:null,matchMode:ue.CONTAINS}}})();function R(r){const t=new Date(r),s=t.getFullYear(),i=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return`${s}-${i}-${n}`}const z=async()=>{const r=P.value.map(i=>i.site_id);se.rawUserData.id;const t=R(D.value),s=R(C.value);M.value=await S.getAllpurchaseOrderReportsFiltered(r,t,s)},$=c([]),oe=async(r,t,s)=>{$.value=await S.getpurchaseOrderEntriesBypurchaseOrderID(r);const i=$.value.map(m=>({Producto:m.item_name,Cantidad:m.quantity,"Unidad de medida":m.unit_measure})),n=F.json_to_sheet(i);n["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const u=F.book_new();F.book_append_sheet(u,n,"Usuarios"),Q(u,`Orden_de_compra_${t}_${s} .xlsx`)},le=async()=>{O.setLoading(!0,"generando descargas");const r=M.value,t=[];for(const e of r){const l=await S.getpurchaseOrderEntriesBypurchaseOrderID(e.purchase_order_id);t.push(...l)}const s={};t.forEach(e=>{const l=e.site_name,d=e.item_name,k=e.quantity,H=e.unit_measure;s[d]||(s[d]={unit_measure:H}),s[d][l]||(s[d][l]=0),s[d][l]+=k});const i=[...new Set(t.map(e=>e.site_name))],n=[],u=K(D.value,"dd-MMMM-yyyy",{locale:X}),m=K(C.value,"dd-MMMM-yyyy",{locale:X});u==m?n.push([`ORDENES DE COMPRA DEL ${u.toUpperCase()}`,...Array(i.length+2).fill("")]):n.push([`ORDENES DE COMPRA DEL${u.toUpperCase()} AL ${m.toUpperCase()}`,...Array(i.length+2).fill("")]);const U=["PRODUCTO","UNIDAD DE MEDIDA",...i,"TOTAL"];n.push(U);for(const[e,l]of Object.entries(s)){const d=[e,l.unit_measure];let k=0;for(const H of i){const G=l[H]||0;d.push(G),k+=G}d.push(k),n.push(d)}const h=new fe.Workbook,_=h.addWorksheet("Inventario por Sede");n.forEach((e,l)=>{const d=_.addRow(e);l===0?(d.height=40,d.font={name:"Arial",bold:!0,size:14},d.alignment={horizontal:"center",vertical:"middle",wrapText:!0},_.mergeCells(`A1:${_.getColumn(i.length+3).letter}1`),_.getRow(1).eachCell(k=>{k.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF00"}}})):l===1&&(d.font={name:"Arial",bold:!0})}),_.columns.forEach((e,l)=>{e.width=l===0?30:l===1?25:15,e.eachCell(d=>{d.font={name:"Arial"},d.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),_.getRow(2).eachCell(e=>{e.font={name:"Arial",bold:!0}}),_.getRow(1).eachCell(e=>{e.font={name:"Arial",bold:!0,size:16}}),_.views=[{showGridLines:!1}];const j=await h.xlsx.writeBuffer(),I=new Blob([j],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});u==m?Y.saveAs(I,`Reporte de inventario del ${u}.xlsx`):Y.saveAs(I,`Reporte de inventario del ${u} al ${m} .xlsx`),O.setLoading(!1,"generando descargas")},ne=async()=>{O.setLoading(!0,"generando descargas");const r=M.value;for(const n of r){const u=await S.getpurchaseOrderEntriesBypurchaseOrderID(n.purchase_order_id);$.value.push(...u)}console.log($.value);const t=$.value.map(n=>({Fecha:n.date.split("T")[0],Hora:n.date.split("T")[1],Sede:n.site_name,Producto:n.item_name,Cantidad:n.quantity,"Unidad de medida":n.unit_measure})),s=F.json_to_sheet(t);s["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const i=F.book_new();F.book_append_sheet(i,s,"Usuarios"),Q(i,"Compras de todas las sedes.xlsx"),O.setLoading(!1,"generando descargas")};return(r,t)=>{const s=v("Button"),i=v("Calendar"),n=v("Dialog"),u=v("router-link"),m=v("MultiSelect"),U=v("InputText"),h=v("Column"),_=v("Tag"),j=v("DataTable"),I=v("Timeline");return W(),J(pe,null,[a(n,{class:"mx-2",visible:x.value,"onUpdate:visible":t[8]||(t[8]=e=>x.value=e),modal:"",header:"Periodo",style:{width:"25rem"}},{default:p(()=>[o("div",ge,[o("div",we,[a(s,{text:"",label:"Hoy",onClick:t[0]||(t[0]=e=>A(0)),class:"p-button-text col-12 p-1 m-0"}),a(s,{text:"",label:"Ayer",onClick:t[1]||(t[1]=e=>A(1)),class:"p-button-text col-12 p-1 m-0"}),a(s,{text:"",label:"Últimos 7 días",onClick:t[2]||(t[2]=e=>A(7)),class:"p-button-text col-12 p-1 m-0"}),a(s,{text:"",label:"Últimos 14 días",onClick:t[3]||(t[3]=e=>A(14)),class:"p-button-text col-12 p-1"}),a(s,{text:"",label:"Últimos 28 días",onClick:t[4]||(t[4]=e=>A(28)),class:"p-button-text col-12 p-0"})]),o("div",xe,[be,a(i,{style:{"min-width":"max-content"},modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=e=>b.value=e)},null,8,["modelValue"])]),o("div",De,[Ce,a(i,{style:{"min-width":"max-content"},modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=e=>f.value=e),showWeek:""},null,8,["modelValue"])]),o("div",ke,[o("div",Se,[a(s,{onClick:t[7]||(t[7]=()=>{ae(b.value,f.value),x.value=!1})},{default:p(()=>[L("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),a(n,{class:"mx-2",visible:V.value,"onUpdate:visible":t[11]||(t[11]=e=>V.value=e),modal:"",header:"Interactuar con la orden",style:{width:"25rem"}},{default:p(()=>[o("div",Fe,[a(u,{to:`/purchase-order/recorrido/purchase-order-view/${w.value.purchase_order_id}`},{default:p(()=>[a(s,{text:"",style:{width:"100%"},severity:"help",class:"",label:"Ver detalles",icon:"pi pi-eye"})]),_:1},8,["to"]),a(s,{text:"",label:"Descargar en excel",style:{},onClick:t[9]||(t[9]=e=>{var l;return oe(w.value.purchase_order_id,w.value.site_name,(l=w.value.expedition_date)==null?void 0:l.split("T")[0])}),severity:"success",class:"",icon:"pi pi-download"}),a(s,{onClick:t[10]||(t[10]=e=>te(w.value.purchase_order_id)),text:"",label:"Ver Historial",style:{},severity:"warning",class:"",icon:"pi pi-history p-0 m-0"})])]),_:1},8,["visible"]),o("div",Me,[o("div",Te,[o("div",Ae,[$e,a(m,{style:{},display:"chip",multiple:"",modelValue:P.value,"onUpdate:modelValue":t[12]||(t[12]=e=>P.value=e),optionLabel:"site_name",options:B.value.filter(e=>e.site_id!=12&e.site_id!=13),class:"text-sm multi p-0"},null,8,["modelValue","options"])]),o("div",Ee,[Oe,a(U,{class:"",onClick:t[13]||(t[13]=e=>x.value=!0),style:{height:"2.7rem"},value:`${R(D.value)}  |  ${R(C.value)}`,placeholder:"periodo"},null,8,["value"]),a(s,{onClick:z,icon:"pi pi-search",severity:"help",class:"text-center p-0 col-12 md:p-0",style:{height:"2.5rem",width:"min-content","aspect-ratio":"1 / 1","font-weight":"bold","border-radius":"50%",display:"flex","justify-content":"center"}})])]),o("div",Pe,[a(s,{severity:"help",icon:"pi pi-download",label:"Descargar Todo",onClick:ne}),a(s,{severity:"help",icon:"pi pi-download",label:"Descargar Informe",onClick:le})])]),o("div",Re,[a(j,{style:{"max-width":"1024px"},filters:T.value,"onUpdate:filters":t[15]||(t[15]=e=>T.value=e),class:"col-12 m-auto",value:M.value,tableStyle:"min-width: 50rem;",paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reportes"},{header:p(()=>[o("div",Ue,[Ie,o("div",Le,[a(U,{style:{width:"100%"},class:"",modelValue:T.value.global.value,"onUpdate:modelValue":t[14]||(t[14]=e=>T.value.global.value=e),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:p(()=>[a(h,{class:"py-1",field:"purchase_order_id",header:"ID"}),a(h,{class:"py-1",field:"responsible_lap",header:"Recibido por"}),a(h,{class:"py-1",field:"site_name",header:"Sede"}),a(h,{class:"py-1",field:"date",header:"Fecha"},{body:p(e=>{var l;return[o("p",Ve,y((l=e.data.status_timestamp)==null?void 0:l.split("T")[0]),1)]}),_:1}),a(h,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:p(e=>{var l;return[o("span",Ne,y((l=e.data.status_timestamp)==null?void 0:l.split("T")[1]),1)]}),_:1}),a(h,{class:"py-1",field:"date",header:"Estado actual"},{body:p(e=>[a(_,{style:me([{width:"100%",height:"2.7rem"},`background-color:${ee[e.data.current_status]}`])},{default:p(()=>[L(y(e.data.current_status),1)]),_:2},1032,["style"])]),_:1}),a(h,{style:{width:"20px"},class:"py-1 mx-0 px-0",field:"date",header:"Acciones"},{body:p(e=>[o("div",Be,[a(s,{label:"Interactuar",onClick:l=>Z(e.data),severity:"help",class:"",icon:"pi "},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])]),a(n,{class:"mx-2",visible:N.value,"onUpdate:visible":t[16]||(t[16]=e=>N.value=e),modal:"",header:"Historial de la orden",style:{width:"min-content"}},{default:p(()=>[a(I,{value:q.value},{opposite:p(e=>{var l;return[o("p",je,y(e.item.status_timestamp.split("T")[0]),1),L(),He,o("p",qe,y((l=e.item.status_timestamp.split("T")[1])==null?void 0:l.split(":").slice(0,2).join(":")),1)]}),content:p(e=>[o("p",ze,[o("b",null,y(e.item.lap_name),1)]),o("p",Ge,y(e.item.name),1),e.item.notes?(W(),J("p",We,[Je,L(" "+y(e.item.notes),1)])):he("",!0),o("div",Qe,[a(s,{disabled:!e.item.notes,style:{height:"2rem",opacity:"0","border-radius":"0.3rem"},cla:"",severity:"help",class:"",label:"Notas"},null,8,["disabled"]),a(s,{disabled:!e.item.conflict,style:{height:"2rem","border-radius":"0.3rem"},severity:"danger",class:"mb-4",label:"Conflictos"},null,8,["disabled"])])]),_:1},8,["value"])]),_:1},8,["visible"])],64)}}},rt=ie(Ke,[["__scopeId","data-v-f4c4d746"]]);export{rt as default};
