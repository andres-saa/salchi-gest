import{H as Te,h as y,i as pe,I as fe,j as D,J as I,D as we,g as j,o as u,c as k,a as e,n,u as a,F as ge,r as ve,d as L,e as g,t as f,f as h,b as _e,k as C,p as Le,m as De,_ as ke,C as Ne,l as Ue,G as Ie,U as Re,q as xe,K as Oe,L as Ae}from"./index-6bbd0804.js";import{u as je}from"./chat-0bd17500.js";import{c as $e,P as ze}from"./Messages.vue_vue_type_style_index_0_scoped_09e7a26a_lang-24ffb2b2.js";/* empty css                                                             */import Ve from"./Messages-d02652e6.js";const ye=R=>(Le("data-v-ca8379a5"),R=R(),De(),R),Me={class:"sidebar-container",style:{position:"relative"}},Pe={class:"header"},Be=ye(()=>e("strong",null," Notificaciones ",-1)),Fe=[Be],We=["onClick"],Je={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},Ke={style:{display:"flex","flex-direction":"column",width:"100%"}},qe=ye(()=>e("h3",null,[e("b",null," Buscar un usuario")],-1)),He=["onClick"],Ge={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},Xe={style:{"grid-area":"check",display:"flex","justify-content":"end",gap:".5rem"}},Ye={key:0,style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold"}},Ze={style:{color:"white"}},Qe=ye(()=>e("i",{style:{color:"greenyellow"},class:"fa-solid fa-check-double"},null,-1)),et={key:1,style:{"text-align":"center",padding:".5rem",color:"#ffffff80"}},tt={class:"flex align-items-center"},at=["src"],st={class:"flex align-items-center"},ot=["src"],it={style:{display:"flex",gap:"1rem"}},rt={style:{color:"white"}},nt={class:"statuses"},lt=["onClick"],ct={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},dt={style:{"grid-area":"check",display:"flex","justify-content":"end",gap:".5rem"}},ut={key:0,style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold"}},mt={style:{color:"white"}},pt=ye(()=>e("i",{style:{color:"greenyellow"},class:"fa-solid fa-check-double"},null,-1)),ft={key:1,style:{"text-align":"center",padding:".5rem",color:"#ffffff80"}},Ce=100,_t=Te({__name:"Sidebar",props:{restaurant:Object},setup(R){const b=y(!1),F=y(!1),Q=y(""),te=y(!1),ae=i=>{i.target.closest(".notifications")||(b.value=!1)};pe(()=>{document.addEventListener("click",ae)}),fe(()=>{document.removeEventListener("click",ae)});const _=$e(),H=R,l=je(),G=[{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}],d=y(H.restaurant||G[0]);y([{label:"Todos",textColor:"#4CAF50"},{label:"Sin leer",textColor:"#2196F3"},{label:"Favoritos",textColor:"#FFC107"},{label:"Preocupantes",textColor:"#F44336"},{label:"Top",textColor:"#9C27B0"}]);const N=async i=>{l.current_user=i,F.value=!1,b.value=!1;try{await D.post(`${I}/read-message/${i.user_id}/${d.value.id}`,!1)}catch(r){console.error("No se pudo marcar como leído",r)}i.unreaded=0},W=async i=>{var r;l.current_user=i.user_info,b.value=!1;try{await D.post(`${I}/read-message/${i.user_info.user_id}/${d.value.id}`,!1),await D.post(`${I}/view_notification/${i.id}`,!1),l.notifications[d.value.id]=await D.get(`${I}/notifications/${d.value.id}`);const v=(r=l.sidebars[d.value.id])==null?void 0:r.findIndex(B=>B.user_id==i.user_info.user_id);console.log(v),v!==-1&&(l.sidebars[d.value.id][v].unreaded=0)}catch(v){console.error("No se pudo marcar como leído",v)}},E=[{label:"SIN LEER",bg:"#f39c12",icon:"fa-solid fa-envelope-open"},{label:"LEIDOS",bg:"#16a085",icon:"fa-solid fa-envelope-circle-check"},{label:"TODO",bg:"#34495e",icon:"fa-solid fa-inbox"},{label:"SIN DATOS",bg:"#95a5a6",icon:"fa-solid fa-circle-question"},{label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-solid fa-triangle-exclamation"},{label:"CASUAL",bg:"#e67e22",icon:"fa-solid fa-person-walking"},{label:"FRECUENTE",bg:"#27ae60",icon:"fa-solid fa-repeat"},{label:"TOP",bg:"#2980b9",icon:"fa-solid fa-ranking-star"},{label:"ESTRELLA",bg:"#8e44ad",icon:"fa-solid fa-star"}],O=y({label:"SIN LEER",bg:"#f39c12",icon:"fa-solid fa-envelope-open"}),he=y(0);let M=0;const J=y(!1),P=y(!1),$=y(null),se=(i="")=>{const r=i.trim().split(" ");return(Array.from(r[0]||"")[0]||"")+(r[1]?Array.from(r[1])[0]:"")};pe(async()=>{l.notifications[d.value.id]=await D.get(`${I}/notifications/${d.value.id}`)});const oe=async()=>{if(J.value||P.value)return;J.value=!0;const i=`${I}/last-contact-messages/${d.value.id}?limit=${Ce}&offset=${M}`,r=await D.get(i,!1);r.length<Ce&&(P.value=!0),M+=r.length,l.sidebars[d.value.id]=r,J.value=!1},T=()=>{const i=$.value;if(!i||J.value||P.value)return;i.scrollTop+i.clientHeight>=i.scrollHeight-120&&oe()},ie=i=>{const r=d.value.id,v=l.sidebars[r]||[],B=v.findIndex(s=>s.wa_id===i.wa_id);B!==-1?(v.splice(B,1),l.sidebars[r]=[i,...v]):l.sidebars[r]=[i,...v],he.value=l.sidebars[r].reduce((s,o)=>s+Number(o.unreaded||0),0)};let S=null;const re=()=>{const i=`wss://sockets-service.salchimonster.com/ws/salchimonster-${d.value.id}`;S=new WebSocket(i),S.onopen=()=>console.log("WebSocket conectado a",i),S.onerror=r=>console.error("WebSocket error",r),S.onclose=()=>setTimeout(re,5e3),S.onmessage=async r=>{const v=JSON.parse(r.data);v!=null&&v.user_id&&ie(v)}};let K=null;const ne=()=>{const i=`wss://sockets-service.salchimonster.com/ws/salchimonster-notifications-${d.value.id}`;K=new WebSocket(i),K.onopen=()=>console.log("WebSocket conectado a",i),K.onerror=r=>console.error("WebSocket error",r),K.onclose=()=>setTimeout(ne,5e3),K.onmessage=async r=>{l.notifications[d.value.id]=await D.get(`${I}/notifications/${d.value.id}`),te.value=!0,setTimeout(()=>{te.value=!1},1e3),JSON.parse(r.data)}};we(d,async i=>{M=0,P.value=!1,l.sidebars[i.id]=[],S&&S.close(),re(),ne(),await oe(),V.value=!1,setTimeout(()=>{V.value=!0},0)}),pe(async()=>{var i;await oe(),(i=$.value)==null||i.addEventListener("scroll",T),re(),ne()}),fe(()=>{var i;(i=$.value)==null||i.removeEventListener("scroll",T),S&&S.close()});const V=y(!0),le=i=>{O.value=i,V.value=!1,setTimeout(()=>{V.value=!0},0)};return(i,r)=>{var U,w,A,ee,X,q,ce;const v=j("RouterLink"),B=j("InputText"),s=j("ProgressSpinner"),o=j("Button"),c=j("Dialog"),x=j("Dropdown");return u(),k("div",Me,[e("div",Pe,[e("div",{class:"notifications",style:n([b.value?{height:"calc(100vh - 8rem)",top:"4rem",boxShadow:"0 1rem 1rem #00000040"}:{height:0,overflow:"hidden",top:"-2rem"},{width:"100%","max-width":"90%","background-color":"#ffffff90","max-height":"90vh",overflow:"auto",position:"absolute","z-index":"9",transition:"all linear .2s","border-radius":".5rem",right:"0","backdrop-filter":"blur(5px)",display:"flex","flex-direction":"column"}])},[e("h4",{class:"my-3 px-3",style:n(a(_).current_chat_theme.text)},Fe,4),(u(!0),k(ge,null,ve((w=(U=a(l))==null?void 0:U.notifications)==null?void 0:w[d.value.id],(t,p)=>(u(),L(v,{"active-class":a(_).current_chat_theme.name==="dark"?"active":"active-light",key:p,to:`/chat/chats/messages/${d.value.id}/${t.user_info.wa_id}/${(t.user_info.nombre||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^A-Za-z0-9_-]/g,"")||"n"}/${t.user_info.color}?expirado=${t.user_info.expirado}&expira-en=${t.user_info.tiempo_para_expirar}`},{default:g(()=>[e("div",{class:"chat2",onClick:()=>W(t),style:n(t.resolved?"background-color: #fff":"background-color: #b6f8ff59")},[e("div",Je,[e("div",{style:n([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${t.user_info.color||"black"}`])},f(se(t.user_info.nombre)),5)]),e("div",{style:n([{"grid-area":"nombre"},`${a(_).current_chat_theme.text} ; ${t.resolved?"":"font-weight: bold;"}`])},f(t.description),5),e("span",{style:n([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},a(_).current_chat_theme.text])},f(t.user_info.nombre.slice(0,20))+"... ",5),e("p",{class:"p-0 m-0",style:n([{"grid-area":"fecha","text-align":"end","min-width":"max-content"},a(_).current_chat_theme.text])},f(t.user_info.hora_ultimo_mensaje),5)],12,We)]),_:2},1032,["active-class","to"]))),128))],4),h(c,{closable:!1,header:"Buscar un usuario",visible:F.value,"onUpdate:visible":r[2]||(r[2]=t=>F.value=t),style:{width:"50rem"},modal:""},{header:g(()=>[e("div",Ke,[qe,h(B,{modelValue:Q.value,"onUpdate:modelValue":r[0]||(r[0]=t=>Q.value=t),style:{width:"100%"},placeholder:"Escriba el nombre o numero del usuario"},null,8,["modelValue"])])]),default:g(()=>{var t;return[e("div",{class:_e(["",V.value?"chats active-new":"chats"]),style:{height:"67vh"},ref_key:"chatsContainer",ref:$,onScroll:T},[(u(!0),k(ge,null,ve(((t=a(l).sidebars[d.value.id])==null?void 0:t.filter(p=>{var Z,de,ue,me;const m=((de=(Z=Q.value)==null?void 0:Z.toLowerCase())==null?void 0:de.trim())||"";if(m==="")return!1;const z=((ue=p.nombre)==null?void 0:ue.toLowerCase())||"",Y=((me=p.wa_id)==null?void 0:me.toLowerCase())||"";return z.includes(m)||Y.includes(m)}))||[],(p,m)=>(u(),L(v,{"active-class":a(_).current_chat_theme.name=="dark"?"active":"active-light",key:m,to:`/chat/chats/messages/${d.value.id}/${p.wa_id}/${p.nombre}/${p.color}?expirado=${p.expirado}&?expira-en?=${p.tiempo_para_expirar}`},{default:g(()=>[e("div",{class:"chat",onClick:()=>N(p)},[e("div",Ge,[e("div",{style:n([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${p.color||"black"}`])},f(se(p.nombre)),5)]),e("div",{style:n([{"grid-area":"nombre","text-transform":"capitalize","font-weight":"500"},a(_).current_chat_theme.text])},f(p.nombre),5),e("div",{style:n([{"grid-area":"numero","text-transform":"capitalize",opacity:".7"},a(_).current_chat_theme.text])},"+"+f(p.wa_id),5),e("span",{style:n([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},a(_).current_chat_theme.text])},f(p.mensaje_truncado),5),e("span",{style:n([{"grid-area":"fecha","text-align":"end"},a(_).current_chat_theme.text])},f(p.abreviatura||p.fecha_ultimo_mensaje),5),e("span",{style:n([{"grid-area":"hora",color:"#ffffff80",opacity:".5","text-align":"end"},a(_).current_chat_theme.text])},f(p.hora_ultimo_mensaje),5),e("div",Xe,[p.unreaded>0?(u(),k("div",Ye,[e("span",Ze,f(p.unreaded),1)])):C("",!0),Qe])],8,He)]),_:2},1032,["active-class","to"]))),128)),J.value?(u(),k("div",{key:0,style:n(`bottom:0;padding-bottom:1rem; background:linear-gradient(to bottom , transparent 3%, ${a(_).current_chat_theme.gradient});display:flex; position: absolute; z-index: 100;width:100%; color: white`)},[(u(),L(s,{key:0,style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".3s","aria-label":"Custom ProgressSpinner"}))],4)):C("",!0),P.value?(u(),k("div",et,"No hay más chats.")):C("",!0)],34),h(o,{rounded:"",onClick:r[1]||(r[1]=p=>F.value=!1),icon:"pi pi-times  text-xl",style:{position:"absolute",top:"-1rem",right:"-1rem"},severity:"danger"})]}),_:1},8,["visible"]),h(x,{modelValue:d.value,"onUpdate:modelValue":r[3]||(r[3]=t=>d.value=t),options:G,optionLabel:"name",style:n([{"background-color":"#ffffff20",outline:"none","box-shadow":"none"},a(_).current_chat_theme.border])},{option:g(t=>[e("div",tt,[e("img",{src:t.option.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,at),e("span",null,[e("b",null,f(t.option.name),1)])])]),value:g(t=>[e("div",st,[t.value?(u(),k("img",{key:0,src:t.value.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,ot)):C("",!0),e("span",{style:n(a(_).current_chat_theme.text)},f(t.value?t.value.name:"Selecciona"),5)])]),_:1},8,["modelValue","style"]),e("div",it,[h(o,{class:"options",text:""},{default:g(()=>[e("i",{class:"pi pi-search text-2xl",onClick:r[4]||(r[4]=t=>F.value=!0),style:n(a(_).current_chat_theme.text)},null,4)]),_:1}),e("div",{class:"notifications",style:{position:"relative",cursor:"pointer"},onClick:r[5]||(r[5]=t=>b.value=!b.value)},[h(o,{class:"options",text:"",style:{opacity:".5"}},{default:g(()=>[e("i",{class:"pi pi-bell text-2xl notifications",style:n(a(_).current_chat_theme.text)},null,4)]),_:1}),e("div",{class:_e(te.value?"load":""),style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",position:"absolute",top:"-1rem",right:"-.7rem",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold",padding:".8rem"}},[e("span",rt,f(((X=(ee=(A=a(l))==null?void 0:A.notifications)==null?void 0:ee[d.value.id])==null?void 0:X.length)||0),1)],2)]),h(o,{class:"options",text:""},{default:g(()=>[e("i",{class:"pi pi-bars text-2xl",style:n(a(_).current_chat_theme.text)},null,4)]),_:1})])]),e("div",nt,[(u(),k(ge,null,ve(E,(t,p)=>h(o,{style:n([{"border-radius":".3rem",padding:"0.3rem","text-transform":"capitalize"},t.label===O.value.label?{backgroundColor:t.bg,color:"#fff"}:{backgroundColor:"#ffffff20",color:t.bg}]),text:"",icon:t.icon,key:p,onClick:()=>le(t),class:"status",label:t.label.toLowerCase()},null,8,["icon","onClick","label","style"])),64))]),e("div",{class:_e(["",V.value?"chats active-new":"chats"]),ref_key:"chatsContainer",ref:$,onScroll:T},[(u(!0),k(ge,null,ve(((q=a(l).sidebars[d.value.id])==null?void 0:q.filter(t=>O.value.label==="TODO"?!0:O.value.label==="SIN LEER"?t.unreaded>0:O.value.label==="LEIDOS"?t.unreaded==0:t.clasification===O.value.label).slice(0,100))||[],(t,p)=>(u(),L(v,{"active-class":a(_).current_chat_theme.name=="dark"?"active":"active-light",key:p,to:`/chat/chats/messages/${d.value.id}/${t.wa_id}/${t.nombre}/${t.color}?expirado=${t.expirado}&?expira-en?=${t.tiempo_para_expirar}`},{default:g(()=>[e("div",{class:"chat",onClick:()=>N(t)},[e("div",ct,[e("div",{style:n([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${t.color||"black"}`])},f(se(t.nombre)),5)]),e("div",{style:n([{"grid-area":"nombre","text-transform":"capitalize","font-weight":"500"},a(_).current_chat_theme.text])},f(t.nombre),5),e("div",{style:n([{"grid-area":"numero","text-transform":"capitalize",opacity:".7"},a(_).current_chat_theme.text])},"+"+f(t.wa_id),5),e("span",{style:n([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},a(_).current_chat_theme.text])},f(t.mensaje_truncado),5),e("span",{style:n([{"grid-area":"fecha","text-align":"end"},a(_).current_chat_theme.text])},f(t.abreviatura||t.fecha_ultimo_mensaje),5),e("span",{style:n([{"grid-area":"hora",color:"#ffffff80",opacity:".5","text-align":"end"},a(_).current_chat_theme.text])},f(t.hora_ultimo_mensaje),5),e("div",dt,[t.unreaded>0?(u(),k("div",ut,[e("span",mt,f(t.unreaded),1)])):C("",!0),pt])],8,lt)]),_:2},1032,["active-class","to"]))),128)),J.value&&((ce=a(l).sidebars[d.value.id])==null?void 0:ce.length)<2?(u(),k("div",{key:0,style:n(`bottom:0;padding-bottom:1rem; background:linear-gradient(to bottom , transparent 3%, ${a(_).current_chat_theme.gradient});display:flex; position: absolute; z-index: 100;width:100%; color: white`)},[(u(),L(s,{key:0,style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".3s","aria-label":"Custom ProgressSpinner"}))],4)):C("",!0),P.value?(u(),k("div",ft,"No hay más chats.")):C("",!0)],34)])}}}),Ee=ke(_t,[["__scopeId","data-v-ca8379a5"]]),Se=R=>(Le("data-v-ed74fb8a"),R=R(),De(),R),ht={class:"top-bar-left"},gt={style:{height:"3rem",width:"3rem",display:"flex","align-items":"center"}},vt={class:"top-bar-info"},yt={style:{display:"flex","flex-direction":"column"}},bt={style:{display:"flex","align-items":"center",gap:"1rem"}},xt={style:{height:"100%",overflow:"auto"}},wt={class:"message-area"},kt=Se(()=>e("i",{class:"fas fa-laugh-wink emoji-picker"},null,-1)),$t=["onKeydown"],St=["src"],Ct={style:{position:"relative",transition:".2s"}},Et=Se(()=>e("i",{class:"pi pi-send text-2xl"},null,-1)),Tt={style:{display:"flex",gap:"1rem"}},Lt=["src"],Dt={class:"flex gap-2"},jt=Se(()=>e("div",{style:{width:"100%",display:"flex","justify-content":"end"}},null,-1)),Nt=Te({__name:"Main",setup(R){const b=$e();function F(s){return{APPROVED:"success",PENDING:"warning",REJECTED:"danger"}[s]||"info"}const Q=s=>{te(s),H.value=!1};async function te(s){const o=s,c=new FormData;c.append("messaging_product","whatsapp"),c.append("employer_id",G.rawUserData.id.toString()),c.append("context_message_id",""),c.append("restaurant_id",l.params.restaurant_id),c.append("to",l.params.user_id),c.append("type","template"),c.append("template",JSON.stringify(o));try{$.sending=!0,await D.post(`${I}/webhook/send/template/`,c,!1),console.log(`✅ Template enviado a ${to}`)}catch(x){console.error(`✗ Error al enviar template a ${to}`,x)}finally{$.sending=!1}}const ae=y([{}]),_=s=>{s.target.closest(".emoji-picker")||(d.value=!1)};pe(()=>{document.addEventListener("click",_),B()}),fe(()=>{document.removeEventListener("click",_)});const H=y(!1);y([]);const l=Ne(),G=Ue(),d=y(!1),N=y(""),W=y(!1),E=y(null),O=y(!1),he=y(!0),M=Ie(()=>{var s,o;return he.value&&(((s=l.query)==null?void 0:s.expirado)==="true"||((o=l.query)==null?void 0:o.expirado)===!0)}),J=s=>{he.value=s};we(()=>{var s;return(s=l.params)==null?void 0:s.restaurant_id},()=>{B()}),we(M,s=>{N.value=s?"Conversación expirada":""},{immediate:!0});const P={"SIN DATOS":{bg:"#7f8c8d",icon:"fa-circle-question"},PREOCUPANTE:{bg:"#e74c3c",icon:"fa-triangle-exclamation"},CASUAL:{bg:"#e67e22",icon:"fa-person-walking"},FRECUENTE:{bg:"#27ae60",icon:"fa-repeat"},TOP:{bg:"#2980b9",icon:"fa-ranking-star"},ESTRELLA:{bg:"#8e44ad",icon:"fa-star"}},$=je();y([{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}]);const se=(s="")=>{const o=s.trim().split(" ");return(Array.from(o[0]||"")[0]||"")+(o[1]?Array.from(o[1])[0]:"")},oe=s=>{N.value+=s.i,d.value=!1};let T=null,ie=[],S=null;const re=async()=>{if(W.value&&T){T.stop();return}try{S=await navigator.mediaDevices.getUserMedia({audio:!0});const s=MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")?"audio/ogg;codecs=opus":"audio/webm;codecs=opus";T=new MediaRecorder(S,{mimeType:s}),T.ondataavailable=o=>o.data.size&&ie.push(o.data),T.onstop=()=>{const o=new Blob(ie,{type:s.split(";")[0]});ie=[],S.getTracks().forEach(x=>x.stop());const c=s.startsWith("audio/ogg")?"ogg":"webm";E.value={file:new File([o],`audio_${Date.now()}.${c}`,{type:o.type}),url:URL.createObjectURL(o)},W.value=!1},T.start(),W.value=!0}catch(s){console.error("No se pudo abrir el micrófono:",s.name,s.message),W.value=!1,S&&S.getTracks().forEach(o=>o.stop())}},K=()=>{E.value&&URL.revokeObjectURL(E.value.url),E.value=null};fe(()=>{T&&W.value&&T.stop(),S&&S.getTracks().forEach(s=>s.stop())});const ne={messaging_product:"whatsapp",employer_id:G.rawUserData.id,context_message_id:null},V=async(s,o=null)=>{var x,U;if(M.value||!s.trim())return;const c=new FormData;c.append("messaging_product","whatsapp"),c.append("employer_id",G.rawUserData.id),c.append("context_message_id",((x=o==null?void 0:o.message_data)==null?void 0:x.wa_id)||null),c.append("restaurant_id",(U=l.params.restaurant_id)==null?void 0:U.toString()),c.append("to",l.params.user_id),c.append("type","text"),c.append("text",JSON.stringify({body:s})),N.value="";try{$.sending=!0,await D.post(`${I}/webhook/send/text/`,c,!1)}catch(w){console.error("Error al enviar texto",w)}$.sending=!1},le=async()=>{var x;if(M.value||!E.value||O.value)return;const s=E.value;K(),O.value=!0;const o=new FormData;o.append("files",s.file);const c={...ne,restaurant_id:(x=l.params.restaurant_id)==null?void 0:x.toString(),to:l.params.user_id,type:"audio",text:{body:""},file_index:0};o.append("payloads",JSON.stringify(c));try{await D.post(`${I}/webhook/send`,o,!1)}catch(U){console.error("Error al enviar audio",U)}O.value=!1},i=async s=>{var U;if(M.value||!(s!=null&&s.length))return;const o=new FormData,c={restaurant_id:(U=l.params.restaurant_id)==null?void 0:U.toString(),to:l.params.user_id,messaging_product:"whatsapp",employer_id:G.rawUserData.id,context_message_id:null},x=w=>{var q;const{type:A,name:ee}=w;if(A.startsWith("image/"))return"image";if(A.startsWith("audio/"))return"audio";if(A.startsWith("video/"))return"video";if(A==="application/pdf")return"document";const X=(q=ee.split(".").pop())==null?void 0:q.toLowerCase();return["jpg","jpeg","png","webp"].includes(X)?"image":["mp3","wav","ogg","opus"].includes(X)?"audio":"document"};s.forEach((w,A)=>{o.append("files",w.file),o.append("payloads",JSON.stringify({...c,type:x(w.file),text:{body:w.caption||""},file_index:A}))}),$.sending=!0;try{await D.post(`${I}/webhook/send`,o,!1)}catch(w){console.error("Error al enviar archivos",w)}$.sending=!1},r=s=>{s.key==="Enter"&&(s.preventDefault(),N.value.trim()&&V(N.value))},v=s=>{s.key==="Enter"&&E.value&&(s.preventDefault(),le())};pe(()=>window.addEventListener("keydown",v)),fe(()=>window.removeEventListener("keydown",v));async function B(){if(l.params.restaurant_id){const o=(await D.get(`${Re}/restaurants`)||[]).find(c=>{var x;return c.id==((x=l.params)==null?void 0:x.restaurant_id)})||null;o&&(ae.value=await D.get(`${I}/wabas/${o.waba_id}/templates/`))}}return(s,o)=>{var q,ce,t,p;const c=j("Button"),x=j("RouterView"),U=j("Textarea"),w=j("Column"),A=j("Tag"),ee=j("DataTable"),X=j("Dialog");return u(),k("div",{class:"main-container",style:n([a(b).current_chat_theme.bg_image,{}])},[(q=a(l).params)!=null&&q.user_id?(u(),k("div",{key:0,tabindex:"0",class:"top-bar",style:n([{"border-radius":".5rem",gap:"1rem"},a(b).current_chat_theme.bg_bars])},[e("div",ht,[e("div",gt,[e("div",{class:"cliente-img",style:n([`background-color:${a(l).params.color}`,{height:"100%",color:"white",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"}])},f(se(a(l).params.user_name)),5)]),e("div",vt,[e("div",yt,[e("strong",null,[e("h5",{style:n([{"text-transform":"capitalize",margin:"0"},a(b).current_chat_theme.text])},f((ce=a(l).params.user_name)==null?void 0:ce.substring(0,20)),5)]),e("span",null,"+"+f(a(l).params.user_id),1)]),e("div",null,[a($).current_user.clasification?(u(),L(c,{key:0,style:n({height:"2.3rem",display:"flex",alignItems:"center",textTransform:"capitalize",gap:"0.35rem",backgroundColor:((t=P[a($).current_user.clasification])==null?void 0:t.bg)||"#7f8c8d",color:"#fff"})},{default:g(()=>{var m,z;return[e("i",{class:_e(["fa-solid",(m=P[a($).current_user.clasification])==null?void 0:m.icon]),"aria-hidden":"true",style:{"font-size":"0.9rem"}},null,2),xe(" "+f((z=a($).current_user.clasification)==null?void 0:z.toLowerCase())+" "+f(a($).current_user.times_purchased)+" compras ",1)]}),_:1},8,["style"])):C("",!0)])])]),e("div",bt,[h(c,{icon:"pi pi-shopping-cart",class:"p-2",style:{color:"white","min-width":"max-content"},severity:"warning",label:"Ing. Ped"}),h(c,{text:"",class:"p-2"},{default:g(()=>[e("i",{style:n(a(b).current_chat_theme.text),class:"pi pi-search text-2xl"},null,4)]),_:1}),h(c,{text:"",class:"p-2"},{default:g(()=>[e("i",{style:n(a(b).current_chat_theme.text),class:"pi pi-bars text-2xl"},null,4)]),_:1})])],4)):C("",!0),e("div",xt,[h(x,null,{default:g(()=>[a(l).params.user_id?(u(),L(Ve,{key:0,send_function:i,send_text:V,change_expiration:J,ref:"Messages_element"},null,512)):C("",!0)]),_:1})]),(p=a(l).params)!=null&&p.user_id?(u(),k("div",{key:1,class:"chat-bar",tabindex:"0",style:n(a(b).current_chat_theme.bg_bars)},[d.value?(u(),L(a(ze),{key:0,native:!0,style:{position:"absolute",bottom:"4rem","z-index":"1000"},onSelect:oe,class:"emoji-picker"})):C("",!0),e("div",wt,[h(c,{text:"",style:{"font-size":"2rem","padding-left":"0"},onClick:o[0]||(o[0]=m=>d.value=!d.value)},{default:g(()=>[kt]),_:1}),E.value?(u(),k("div",{key:1,class:"audio-chip",onKeydown:Oe(Ae(le,["prevent"]),["enter"])},[e("audio",{style:{width:"100%","min-width":"28rem","max-width":"42rem"},src:E.value.url,controls:""},null,8,St),h(c,{text:"",class:"btn-audio-trash p-2",onClick:K},{default:g(()=>[e("i",{style:n(a(b).current_chat_theme.text),class:"pi pi-trash text-2xl p-0"},null,4)]),_:1})],40,$t)):(u(),L(U,{key:0,modelValue:N.value,"onUpdate:modelValue":o[1]||(o[1]=m=>N.value=m),autoResize:"",class:"message",disabled:M.value,onKeydown:r,style:n(`${a(b).current_chat_theme.text} ; ${a(b).current_chat_theme.border} `)},null,8,["modelValue","disabled","style"]))]),e("div",Ct,[!E.value&&N.value.trim()===""?(u(),L(c,{key:0,text:"",style:{height:"100%"},onClick:re},{default:g(()=>[e("i",{style:n(a(b).current_chat_theme.text),class:_e(W.value?"pi pi-stop text-2xl text-red-500":"pi pi-microphone text-2xl ")},null,6)]),_:1})):E.value?(u(),L(c,{key:1,disabled:O.value,text:"",onClick:le},{default:g(()=>[e("i",{style:n(a(b).current_chat_theme.text),class:"pi pi-send text-2xl"},null,4)]),_:1},8,["disabled"])):(u(),L(c,{key:2,style:n(a(b).current_chat_theme.text),text:"",onClick:o[2]||(o[2]=m=>V(N.value))},{default:g(()=>[Et]),_:1},8,["style"]))]),e("div",Tt,[h(c,{severity:"danger",style:{},icon:"pi pi-clock",class:"p-2",onClick:o[3]||(o[3]=()=>H.value=!0)}),a(l).query.expirado?(u(),L(c,{key:0,icon:"pi pi-bolt",severity:"warning",style:{},class:"p-2",onClick:o[4]||(o[4]=()=>H.value=!0)})):C("",!0)])],4)):C("",!0),h(X,{visible:H.value,"onUpdate:visible":o[5]||(o[5]=m=>H.value=m),modal:"",header:"Envio de plantilla",style:{width:"90rem"}},{default:g(()=>[h(ee,{value:ae.value,dataKey:"id",paginator:"",rows:10,responsiveLayout:"scroll",class:"shadow-md rounded-xl overflow-hidden"},{default:g(()=>[h(w,{class:"my-1 py-1",field:"name",header:"Nombre",bodyClass:"font-medium"}),h(w,{class:"my-1 py-1",header:"Texto"},{body:g(({data:m})=>{var z,Y;return[xe(f((Y=(z=m==null?void 0:m.components)==null?void 0:z.find(Z=>Z.type=="BODY"))==null?void 0:Y.text),1)]}),_:1}),h(w,{class:"my-1 py-1",header:"Imagen"},{body:g(({data:m})=>{var z,Y,Z,de,ue,me;return[(Z=(Y=(z=m==null?void 0:m.components)==null?void 0:z.find(be=>be.type=="HEADER"))==null?void 0:Y.example)!=null&&Z.header_handle[0]?(u(),k("img",{key:0,style:{height:"10rem",width:"10rem","aspect-ratio":"1 / 1","object-fit":"cover","border-radius":".5rem",border:"1px solid"},src:(me=(ue=(de=m==null?void 0:m.components)==null?void 0:de.find(be=>be.type=="HEADER"))==null?void 0:ue.example)==null?void 0:me.header_handle[0],alt:""},null,8,Lt)):C("",!0)]}),_:1}),h(w,{class:"my-1 py-1",header:"Estado"},{body:g(({data:m})=>[h(A,{severity:F(m.status)},{default:g(()=>[xe(f(m.status),1)]),_:2},1032,["severity"])]),_:1}),h(w,{class:"my-1 py-1",headerStyle:"width:8rem",header:"Acciones"},{body:g(({data:m})=>[e("div",Dt,[h(c,{icon:"pi pi-send",label:"Enviar",severity:"help",onClick:z=>Q(m)},null,8,["onClick"])])]),_:1})]),_:1},8,["value"]),jt]),_:1},8,["visible"])],4)}}}),Ut=ke(Nt,[["__scopeId","data-v-ed74fb8a"]]);const It={__name:"chats",setup(R){const b=$e();return(F,Q)=>(u(),k("div",{class:"chat-container",style:n(a(b).current_chat_theme.bg)},[h(Ee,{style:{"box-shadow":".5rem 0 1rem #00000010"},class:"sidebar-left",restaurant:{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}}),h(Ut),h(Ee,{style:{"box-shadow":"-.5rem 0 1rem #00000010"},class:"sidebar-right",restaurant:{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}})],4))}},Mt=ke(It,[["__scopeId","data-v-ef52e81a"]]);export{Mt as default};
