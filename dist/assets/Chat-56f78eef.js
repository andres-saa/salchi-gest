import{_ as M,C as W,h as m,i as T,D as q,y as O,G as J,g as f,o as r,c as p,a as e,f as a,e as c,t as u,k as A,F,r as L,d as j,n as B,u as k,j as N,H as X,p as G,m as K,l as Q,I as Y}from"./index-25fedaca.js";import{u as Z,M as P}from"./Messages-f92254e9.js";const E=d=>(G("data-v-f89ea940"),d=d(),K(),d),ee={class:"sidebar-container"},te={class:"header"},se={class:"flex align-items-center"},oe=["src"],ae={style:{}},ne={class:"flex align-items-center"},ie=["src"],re={style:{color:"white"}},le={style:{display:"flex",gap:"1rem"}},ce=E(()=>e("i",{class:"pi pi-bars text-2xl text-white"},null,-1)),de={style:{position:"relative"}},ue=E(()=>e("i",{class:"pi pi-bell text-2xl text-white"},null,-1)),pe=E(()=>e("div",{style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156, 39, 176)",position:"absolute",top:"-1rem",right:"-.7rem",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold"}},[e("span",{style:{color:"white"}},u(9))],-1)),_e={class:"busqueda"},me={class:"statuses"},fe={class:"chats"},he={class:"chat"},ge={style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},xe={style:{"grid-area":"nombre","text-transform":"capitalize"}},ye={key:0,style:{"grid-area":"expiration","text-align":"end","text-transform":"capitalize",color:"#ffffff80"}},ve={key:1,style:{"grid-area":"expiration","text-align":"end","text-transform":"capitalize",color:"#ff000080"}},be={style:{"grid-area":"mensaje",color:"#ffffff80"}},we={style:{"grid-area":"fecha","text-align":"end","text-transform":"capitalize"}},ke={style:{"grid-area":"check","text-align":"end",display:"flex",width:"100%","justify-content":"end",gap:".5rem"}},$e={key:0,style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156, 39, 176)",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold"}},Ce={style:{color:"white"}},Se=E(()=>e("i",{style:{color:"greenyellow"},class:"fa-solid fa-check-double"},null,-1)),Ie={__name:"Sidebar",props:{restaurant:Object},setup(d){const i=d,w=Z(),v=W(),h=[{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}],g=m({id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}),$=m([{label:"Todos",bgColor:"ffffff00",textColor:"#4CAF50"},{label:"Sin leer",bgColor:"ffffff00",textColor:"#2196F3"},{label:"Favoritos",bgColor:"ffffff00",textColor:"#FFC107"},{label:"Preocupantes",bgColor:"ffffff00",textColor:"#F44336"},{label:"Top",bgColor:"ffffff00",textColor:"#9C27B0"}]),x=m({}),S=m(!0);T(()=>{i.restaurant&&(g.value=i.restaurant)});const z=s=>{if(!s)return"";const n=s.split(" "),_=Array.from(n[0])[0],y=n[1]?Array.from(n[1])[0]:"";return _+y};q(g,s=>{v.params.restaurant_id!==g.value.id&&O.push("/chat")});const I=async()=>{var s,n;w.last_messages[(s=i.restaurant)==null?void 0:s.id]=await N.get(`${X}/last-contact-messages/${(n=i.restaurant)==null?void 0:n.id}`,!1),S.value=!1};let o=null;const l=()=>{var n;const s=`wss://sockets-service.salchimonster.com/ws/salchimonster-${(n=i.restaurant)==null?void 0:n.id}`;o=new WebSocket(s),o.onopen=()=>{console.log("Conectado a:",s)},o.onmessage=_=>{console.log("Mensaje recibido:",_.data),_.data==="nuevo mensaje"&&I()},o.onerror=_=>{console.error("Error en WebSocket:",_)},o.onclose=()=>{console.warn("WebSocket cerrado. Se intentará reconectar en 5 segundos..."),setTimeout(l,5e3)}};return T(async()=>{await I(),l()}),J(()=>{o&&o.close()}),(s,n)=>{var U;const _=f("Dropdown"),y=f("Button"),V=f("InputText"),b=f("IconField"),H=f("RouterLink");return r(),p("div",ee,[e("div",te,[a(_,{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=t=>g.value=t),options:h,optionLabel:"name",style:{"background-color":"#ffffff20",border:"none",color:"white",outline:"none","box-shadow":"none"}},{option:c(t=>[e("div",se,[e("img",{src:t.option.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,oe),e("span",ae,[e("b",null,u(t.option.name),1)])])]),value:c(t=>[e("div",ne,[t.value?(r(),p("img",{key:0,src:t.value.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,ie)):A("",!0),e("span",re,u(t.value?t.value.name:"Selecciona"),1)])]),_:1},8,["modelValue"]),e("div",le,[a(y,{class:"options",text:""},{default:c(()=>[ce]),_:1}),e("div",de,[a(y,{class:"options",text:"",style:{opacity:".5"}},{default:c(()=>[ue]),_:1}),pe])])]),e("div",_e,[a(b,{style:{display:"flex"}},{default:c(()=>[a(V,{style:{color:"white"},class:"search",modelValue:s.value1,"onUpdate:modelValue":n[1]||(n[1]=t=>s.value1=t),placeholder:"Buscar..."},null,8,["modelValue"])]),_:1})]),e("div",me,[(r(!0),p(F,null,L($.value,(t,D)=>(r(),j(y,{style:B([{height:"2.3rem","border-radius":".3rem",padding:".5rem"},t===x.value?{backgroundColor:t.textColor,color:"#fff"}:{backgroundColor:"#ffffff20",color:t.textColor}]),text:"",key:D,onClick:()=>x.value=t,class:"status",label:t.label},null,8,["onClick","label","style"]))),128))]),e("div",fe,[(r(!0),p(F,null,L(k(w).last_messages[(U=i.restaurant)==null?void 0:U.id],(t,D)=>(r(),j(H,{"active-class":"active",key:D,to:`/chat/messages/${g.value.id}/${t.wa_id}/${t.nombre}/${t.color}?expirado=${t.expirado}&?expira-en?=${t.tiempo_para_expirar}`},{default:c(()=>[e("div",he,[e("div",ge,[e("div",{style:B([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${t.color}`])},u(z(t==null?void 0:t.nombre)),5)]),e("div",xe,u(t.nombre),1),t.tiempo_para_expirar||!t.expirado?(r(),p("div",ye," Expira en "+u(t.tiempo_para_expirar),1)):(r(),p("div",ve," Expirado ")),e("span",be,u(t.mensaje_truncado),1),e("span",we,u(t.abreviatura||t.fecha_ultimo_mensaje),1),e("div",ke,[t.unreaded>0?(r(),p("div",$e,[e("span",Ce,u(t.unreaded),1)])):A("",!0),Se])])]),_:2},1032,["to"]))),128))])])}}},R=M(Ie,[["__scopeId","data-v-f89ea940"]]);const C=d=>(G("data-v-70728c12"),d=d(),K(),d),Ve={class:"main-container"},je={class:"top-bar",style:{"border-radius":".5rem",gap:"1rem"}},Be={class:"top-bar-left"},Ee={style:{height:"3rem",width:"3rem",display:"flex","align-items":"center"}},ze={class:"top-bar-info"},De={style:{"text-transform":"capitalize",margin:"0"}},Fe=["src"],Le={style:{display:"flex","align-items":"center",gap:"1rem"}},Me=C(()=>e("i",{class:"pi pi-search text-2xl text-white"},null,-1)),Ue=C(()=>e("i",{class:"pi pi-bars text-2xl text-white"},null,-1)),Te={style:{height:"100%",overflow:"auto"}},Ae={class:"chat-bar"},Re={class:"message-area"},We=C(()=>e("i",{class:"pi pi-plus text-2xl text-white"},null,-1)),qe={style:{position:"relative",transition:"all ease .2s"}},Ne=C(()=>e("i",{class:"pi pi-microphone text-2xl text-white"},null,-1)),Xe=C(()=>e("i",{class:"pi pi-send text-2xl text-white"},null,-1)),Ge={__name:"Main",setup(d){const i=W(),w=Q(),v=m(null),h=m(""),g=m([{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}]),$=Y(()=>{var o,l;return((o=i.query)==null?void 0:o.expirado)==="true"||((l=i.query)==null?void 0:l.expirado)===!0});q($,o=>{h.value=o?"Conversación expirada":""},{immediate:!0}),m(null);const x=m({messaging_product:"whatsapp",type:"text",template:{name:"string",language:{code:"string"},components:[{additionalProp1:{}}]},text:{body:""},employer_id:w.rawUserData.id,context_message_id:null}),S=async()=>{var o;if(!$.value){x.value.restaurant_id=(o=i.params.restaurant_id)==null?void 0:o.toString(),x.value.to=i.params.user_id,x.value.text.body=h.value.toString(),h.value="";try{await N.post(`${X}/webhook/send`,x.value,!1,{headers:{Authorization:`Bearer ${w.token}`}}),setTimeout(()=>{},1e3)}catch(l){console.error("Error al enviar el mensaje:",l)}}},z=o=>{if(o.key==="Enter"){if(o.preventDefault(),x.value.text.body.trim()==="")return;S()}},I=o=>{if(!o)return"";const l=o.split(" "),s=Array.from(l[0])[0],n=l[1]?Array.from(l[1])[0]:"";return s+n};return(o,l)=>{var y,V;const s=f("Button"),n=f("RouterView"),_=f("Textarea");return r(),p("div",Ve,[e("div",je,[e("div",Be,[e("div",Ee,[e("div",{class:"cliente-img",style:B([`background-color:${k(i).params.color}`,{height:"3rem",width:"3rem",color:"white","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"}])},u(I(k(i).params.user_name)),5)]),e("div",ze,[e("strong",null,[e("h5",De,u((y=k(i).params.user_name)==null?void 0:y.substring(0,40)),1)])])]),(r(!0),p(F,null,L(g.value.filter(b=>b.id==k(i).params.restaurant_id),b=>(r(),p("div",null,[e("img",{src:b.img,alt:"",style:{"max-height":"2rem","object-fit":"contain"}},null,8,Fe)]))),256)),e("div",Le,[a(s,{icon:"pi pi-shopping-cart",class:"p-2",style:B([{color:"white"},`background-color:${k(i).params.color}`]),label:"Compras"},null,8,["style"]),a(s,{icon:"pi pi-shopping-cart",class:"p-2",style:{color:"white","min-width":"max-content"},severity:"warning",label:"Ing. Ped"}),a(s,{text:"",class:"p-2"},{default:c(()=>[Me]),_:1}),a(s,{text:"",class:"p-2"},{default:c(()=>[Ue]),_:1})])]),e("div",Te,[a(n,null,{default:c(()=>[a(P,{ref_key:"Messages_element",ref:v},null,512)]),_:1})]),e("div",Ae,[e("div",Re,[a(s,{text:""},{default:c(()=>[We]),_:1}),a(_,{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=b=>h.value=b),autoResize:"",class:"message",disabled:$.value,onKeydown:z},null,8,["modelValue","disabled"])]),e("div",qe,[a(s,{class:"btn-descuento",icon:"pi pi-send btn-descuento",style:{transition:"all ease .2s"},label:"Enviar Descuento"}),((V=h.value)==null?void 0:V.trim())===""?(r(),j(s,{key:0,text:""},{default:c(()=>[Ne]),_:1})):(r(),j(s,{key:1,onClick:S,text:""},{default:c(()=>[Xe]),_:1}))])])])}}},Ke=M(Ge,[["__scopeId","data-v-70728c12"]]);const He={class:"chat-container"},Oe={class:"icons-bar",style:{display:"flex","flex-direction":"column",height:"100%",gap:"1rem","background-color":"#ffffff20",padding:".5rem","border-radius":".5rem"}},Je={__name:"Chat",setup(d){return(i,w)=>{const v=f("Button");return r(),p("div",He,[e("div",Oe,[a(v,{severity:"success",icon:"pi pi-bell text-2xl",text:""}),a(v,{severity:"danger",icon:"pi pi-sync text-2xl",text:""}),a(v,{severity:"warning",icon:"pi pi-chart-bar text-2xl",text:""})]),a(R,{restaurant:{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}}),a(Ke),a(R,{restaurant:{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}})])}}},Ze=M(Je,[["__scopeId","data-v-c7f2b8c6"]]);export{Ze as default};
