import{A as R}from"./auditService-57391c60.js";import{_ as re,j as u,k as oe,r as g,o as s,c as a,a as e,e as n,u as q,F as f,b,i as p,g as C,f as i,at as ue,U as H,t as l,h as y,q as _e,x as me}from"./index-3fffce46.js";import{s as pe}from"./siteService-4d83c6d6.js";const h=D=>(_e("data-v-c70e4c12"),D=D(),me(),D),he={class:"grid shadow-1 mx-2 py-0 px-0 md:px-1 my-4",style:{"align-items":"center",position:"sticky",top:"3rem","background-color":"white","z-index":"900","border-radius":"0.5rem"}},ye=h(()=>e("span",{class:"px-4 col",style:{"font-weight":"bold"}}," CALIDOMETRO ",-1)),ve={class:"px-4 col p-0",style:{"font-weight":"bold",gap:"0.5rem","align-items":"center",display:"flex","justify-content":"space-between"}},fe=h(()=>e("span",{class:"p-0 m-0"}," SEDES",-1)),ge={class:"px-4 col",style:{"font-weight":"bold",gap:"0.5rem","align-items":"center",display:"flex","justify-content":"space-between"}},be=h(()=>e("span",{class:"p-0 m-0"}," COORDINADORES",-1)),xe={class:"col p-0",style:{display:"flex","align-items":"center","justify-content":"space-between"}},we=h(()=>e("span",{class:"px-4",style:{"font-weight":"bold"}}," VISTA ",-1)),ke={class:"col p-0 justify-content-space-between md:justify-content-start",style:{display:"flex","align-items":"center"}},Ce=h(()=>e("span",{class:"px-4",style:{"font-weight":"bold"}}," COLUMNAS ",-1)),Ve={key:0,class:"px-2 md:px-4 mb-2 pb-2 md:justify-content-center",style:{display:"flex",gap:"2rem","overflow-x":"auto"}},Ae={style:{display:"flex","align-items":"center","flex-direction":"column","justify-content":"center",gap:"0.5rem"}},Ie={class:"cara",style:{width:"min-content",position:"relative","align-items":"center",display:"flex","justify-content":"center"}},Se=["src","onError"],Le={style:{width:"max-content","font-weight":"bold"}},Pe={key:1,class:"px-2 md:mx-4 mb-2 pb-2",style:{display:"flex",gap:"2rem","justify-content":"","overflow-x":"auto"}},Re={style:{display:"flex","align-items":"center","flex-direction":"column","justify-content":"center",gap:"0.5rem"}},De={class:"cara",style:{width:"min-content",position:"relative","align-items":"center",display:"flex","justify-content":"center"}},je=["src"],Ue={style:{width:"max-content","font-weight":"bold"}},Te={class:"m-0 p-0 md:p-4"},Fe=h(()=>e("div",{class:"flex flex-wrap align-items-center justify-content-between gap-2"},[e("span",{class:"text-xl text-900 font-bold"},"Auditorias")],-1)),$e={style:{"min-width":"max-content"}},Ee={style:{display:"flex",gap:"1rem","justify-content":"space-between","align-items":"center"}},Ne={style:{display:"flex",gap:"1rem","justify-content":"space-between","align-items":"center"}},ze={style:{}},Oe={class:"",style:{"min-width":"max-content"}},Be={class:"mr-4 text-sm",style:{"min-width":"max-content"}},Me=h(()=>e("i",{class:"pi pi-check"},null,-1)),Ke={style:{}},We={class:"",style:{"min-width":"max-content"}},Ge={class:"mr-4 text-sm",style:{"min-width":"max-content"}},qe=h(()=>e("i",{class:"pi pi-times"},null,-1)),He={style:{display:"flex"}},Je=h(()=>e("i",{class:"fa-solid fa-eye text-2xl"},null,-1)),Qe=h(()=>e("div",{class:"flex flex-wrap align-items-center justify-content-between gap-2"},[e("span",{class:"text-xl text-900 font-bold"},"Auditorias")],-1)),Xe={style:{display:"flex"}},Ye=h(()=>e("i",{class:"fa-solid fa-eye text-2xl"},null,-1)),Ze={key:0,class:""},et={style:{"text-transform":"capitalize"}},tt={class:"text-xl"},st=h(()=>e("b",null,"Fecha de auditoría:",-1)),at={key:0},lt=h(()=>e("b",null,"Pendientes",-1)),ot=[lt],nt={class:"p-0"},it={style:{"list-style":"none"},class:"my-2 p-0"},dt=h(()=>e("br",null,null,-1)),ct={key:0},rt={style:{"list-style":"none"},class:"text-danger"},ut={class:"py-0 my-0",style:{"font-weight":"bold"}},_t={style:{color:"red"}},mt={key:0},pt={class:"p-0"},ht={key:0,class:"col-12 p-0",style:{display:"flex",gap:"1rem"}},yt={key:1},vt={style:{"text-transform":"capitalize"}},ft={class:"text-xl"},gt=h(()=>e("b",null,"Fecha de auditoría:",-1)),bt={key:0},xt=h(()=>e("b",null,"Pendientes",-1)),wt=[xt],kt={class:"p-0"},Ct={style:{"list-style":"none"},class:"my-2 p-0"},Vt=h(()=>e("br",null,null,-1)),At={key:0},It={style:{"list-style":"none"},class:"text-danger"},St={class:"py-0 my-0",style:{"font-weight":"bold"}},Lt={style:{color:"red"}},Pt={key:0},Rt={class:"p-0"},Dt={key:0},jt={key:1},Ut={__name:"listAudit",setup(D){const j=u([]),J=u([]),Q=o=>{const c={};return o.forEach(_=>{var V;const w=`${_.site_name}-${_.coordinator_name}-${_.audit_date}`;c[w]?(V=c[w].audits)==null||V.push(_):c[w]={id:w,audits:[{..._}]}}),Object.values(c)},ne=async o=>{E.value=!0,T.value=o,S.value=await R.getAuditCheckGroupsWithItemsFiltered(o.coordinator_id,o.audit_date,o.site_id)},E=u(!1),U=u(),T=u({}),I=u({}),S=u({}),F=u({}),X=u([]),N=u(!1),L=u(0),z=u(!1),O=u(!0),ie=(o,c)=>{const _={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"};!o||o==""||o=="N/A"?c.target.src=_.default:c.target.src=_[o.trim().toLowerCase()]},de=async o=>{N.value=!0,I.value=o,F.value=await R.getAuditCheckGroupsWithItems(o.id)},Y=u([{id:1,name:"INDIVIDUAL"},{id:2,name:"AGRUPADOS"}]),B=u(Y.value[1]),Z=u(["Coordinador","Sede","Fecha","Calificacion Sede","Rendimiento coordinador","Checklists Realizados","Checklists Faltantes"]),x=u([...Z.value]);oe(async()=>{R.getAudits().then(o=>{U.value=Q(o),console.log(Q(o)),X.value=o}),J.value=await R.getCoordinators(),L.value=await R.getChecklist()});const ee=u([]);oe(async()=>{ee.value=await pe.getSites()});const ce=o=>{if(confirm(`Are you sure you want to delete the audit with ID: ${o.id}?`)){const c=`${H}/audits/${o.id}`;fetch(c,{method:"DELETE"}).then(_=>{if(_.ok){const w=U.value.findIndex(V=>V.id===o.id);w!==-1&&U.value.splice(w,1),console.log(`Audit with ID: ${o.id} has been successfully deleted.`)}else throw new Error(`HTTP error! status: ${_.status}`)}).catch(_=>{console.error("Error deleting audit:",_)})}},te=o=>{const c=Math.round(o);return{0:"danger",1:"danger",2:"danger",3:"warning",4:"success",5:"success"}[c]||"unknown"};return(o,c)=>{const _=g("InputSwitch"),w=g("Dropdown"),V=g("Knob"),v=g("Column"),$=g("Tag"),M=g("Rating"),K=g("Button"),se=g("DataTable"),ae=g("Checkbox"),le=g("Dialog");return s(),a("div",null,[e("div",he,[ye,e("span",ve,[fe,n(_,{modelValue:z.value,"onUpdate:modelValue":c[0]||(c[0]=t=>z.value=t),class:"p-0 m-0"},null,8,["modelValue"])]),e("span",ge,[be,n(_,{modelValue:O.value,"onUpdate:modelValue":c[1]||(c[1]=t=>O.value=t),class:"p-0 m-0"},null,8,["modelValue"])]),e("span",xe,[we,n(w,{options:Y.value,optionLabel:"name",modelValue:B.value,"onUpdate:modelValue":c[2]||(c[2]=t=>B.value=t),style:{"min-width":"10rem","box-shadow":"none","background-color":"transparent",border:"none","font-weight":"bold"}},null,8,["options","modelValue"])]),e("span",ke,[Ce,n(q(ue),{placeholder:"Columnas",options:Z.value,modelValue:x.value,"onUpdate:modelValue":c[3]||(c[3]=t=>x.value=t),style:{"max-width":"10rem","box-shadow":"none","background-color":"transparent",border:"none","font-weight":"bold","text-transform":"uppercase"}},null,8,["options","modelValue"])])]),O.value?(s(),a("div",Ve,[(s(!0),a(f,null,b(J.value,t=>(s(),a("div",Ae,[e("div",Ie,[n(V,{strokeWidth:10,valueTemplate:"",modelValue:j.value[t.name],"onUpdate:modelValue":r=>j.value[t.name]=r},null,8,["modelValue","onUpdate:modelValue"]),e("img",{class:"p-4",style:{width:"7rem","z-index":"-1","aspect-ratio":"1/1",position:"absolute","object-fit":"cover","border-radius":"50%"},src:`${q(H)}/read-product-image/96/employer-${t.dni}`,onError:r=>ie(t.gender,r)},null,40,Se)]),e("span",Le,l(t.name.split(" ").slice(0,2).join(" ")),1)]))),256))])):p("",!0),z.value?(s(),a("div",Pe,[(s(!0),a(f,null,b(ee.value.filter(t=>t.show_on_web),t=>(s(),a("div",Re,[e("div",De,[n(V,{strokeWidth:10,valueTemplate:"",modelValue:j.value[t.site_name],"onUpdate:modelValue":r=>j.value[t.site_name]=r},null,8,["modelValue","onUpdate:modelValue"]),e("img",{class:"p-4",style:{width:"7rem","z-index":"-1","aspect-ratio":"1/1",position:"absolute","object-fit":"cover","border-radius":"50%"},src:`${q(H)}/read-product-image/96/site-${t.site_id}`},null,8,je)]),e("span",Ue,l(t.site_name),1)]))),256))])):p("",!0),e("div",Te,[B.value.id==2?(s(),C(se,{key:0,style:{},value:U.value,tableStyle:"min-width: 50rem",class:"p-0",dataKey:"id",paginator:!0,rows:10,filters:o.filters,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],stripedRows:"",currentPageReportTemplate:"Mostrando {first} to {last} de {totalRecords} Auditorias",responsiveLayout:"scroll",scrollable:""},{header:i(()=>[Fe]),default:i(()=>[x.value.includes("Coordinador")?(s(),C(v,{key:0,class:"mx-3",header:"Coordinador",headerStyle:"min-width:20rem"},{body:i(t=>[e("span",$e,l(t.data.audits[0].coordinator_name),1)]),_:1})):p("",!0),x.value.includes("Sede")?(s(),C(v,{key:1,header:"Sede",class:"py-0 px-3",headerStyle:"min-width:10rem"},{body:i(t=>[y(l(t.data.audits[0].site_name),1)]),_:1})):p("",!0),x.value.includes("Fecha")?(s(),C(v,{key:2,header:"Fecha",class:"p-0 m-0",style:{"min-width":"10rem"}},{body:i(t=>[y(l(t.data.audits[0].audit_date),1)]),_:1})):p("",!0),x.value.includes("Calificacion Sede")?(s(),C(v,{key:3,class:"p-0 m-0",field:"rating",header:"Calificacion Sede",style:{"min-width":"12rem"}},{body:i(t=>[e("div",Ee,[n($,{severity:te(t.data.audits.length),class:"text-xl",style:{"font-weight":"bold","min-width":"max-content",height:"min-content"}},{default:i(()=>[y(l(t.data.audits.length)+" / "+l(L.value.length),1)]),_:2},1032,["severity"]),n(M,{color:"red",cancel:!1,modelValue:t.data.audits.length},null,8,["modelValue"])])]),_:1})):p("",!0),x.value.includes("Rendimiento coordinador")?(s(),C(v,{key:4,class:"px-3 m-0",field:"rating",header:"Rendimiento coordinador",style:{"min-width":"12rem"}},{body:i(t=>[e("div",Ne,[n($,{severity:te(5/L.value.length*t.data.audits.length),class:"text-xl",style:{"font-weight":"bold","min-width":"max-content",height:"min-content"}},{default:i(()=>[y(l(t.data.audits.length)+" / "+l(L.value.length),1)]),_:2},1032,["severity"]),n(M,{cancel:!1,modelValue:5/L.value.length*t.data.audits.length},null,8,["modelValue"])])]),_:1})):p("",!0),x.value.includes("Checklists Realizados")?(s(),C(v,{key:5,class:"py-2 m-0",field:"rating",header:"Checklists Realizados",style:{"min-width":"50rem"}},{body:i(t=>[e("div",ze,[(s(!0),a(f,null,b(t.data.audits,(r,k)=>(s(),a("span",Oe,[e("span",Be,[e("b",null,l(k+1)+". ",1),y(l(r.checklist_name)+" ",1),Me])]))),256))])]),_:1})):p("",!0),x.value.includes("Checklists Faltantes")?(s(),C(v,{key:6,class:"py-2 m-0",field:"rating",header:"Checklists Faltantes",style:{"min-width":"50rem"}},{body:i(t=>[e("div",Ke,[(s(!0),a(f,null,b(t.data.audits,(r,k)=>(s(),a("span",We,[e("span",Ge,[e("b",null,l(k+1)+". ",1),y(l(r.checklist_name)+" ",1),qe])]))),256))])]),_:1})):p("",!0),n(v,{class:"p-0 m-0",field:"inventoryStatus",frozen:"",alignFrozen:"right",sortable:"",style:{}},{body:i(t=>[e("div",He,[n(K,{onClick:r=>ne(t.data.audits[0]),text:"",severity:"help"},{default:i(()=>[Je]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["value","filters"])):(s(),C(se,{key:1,value:X.value,tableStyle:"min-width: 50rem",class:"p-0",dataKey:"id",paginator:!0,rows:10,filters:o.filters,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],stripedRows:"",currentPageReportTemplate:"Mostrando {first} to {last} de {totalRecords} Auditorias",responsiveLayout:"scroll",scrollable:""},{header:i(()=>[Qe]),default:i(()=>[n(v,{header:"Coordinador"},{body:i(t=>[y(l(t.data.coordinator_name),1)]),_:1}),n(v,{header:"Sede",class:"p-0 m-0"},{body:i(t=>[y(l(t.data.site_name),1)]),_:1}),n(v,{header:"Fecha",class:"p-0 m-0"},{body:i(t=>[y(l(t.data.audit_date),1)]),_:1}),n(v,{header:"Checklist",class:"p-0 m-0"},{body:i(t=>[y(l(t.data.checklist_name),1)]),_:1}),n(v,{class:"p-0 m-0",field:"rating",header:"Calificacion",sortable:"",style:{"min-width":"12rem"}},{body:i(t=>[n(M,{cancel:!1,modelValue:t.data.score},null,8,["modelValue"])]),_:1}),n(v,{class:"p-0 m-0",field:"inventoryStatus",sortable:"",style:{}},{body:i(t=>[e("div",Xe,[n(K,{onClick:r=>de(t.data),text:"",severity:"help"},{default:i(()=>[Ye]),_:2},1032,["onClick"]),n(K,{onClick:r=>ce(t.data),text:"",icon:"fa-solid fa-trash text-2xl",class:"p-button-danger"},null,8,["onClick"])])]),_:1})]),_:1},8,["value","filters"]))]),n(le,{class:"mx-2",visible:E.value,"onUpdate:visible":c[4]||(c[4]=t=>E.value=t),modal:"",header:"Detalles de la Auditoría",style:{width:"40rem"}},{default:i(()=>{var t,r,k;return[S.value?(s(),a("div",Ze,[e("h4",et,[e("b",null,l((t=T.value.site_name)==null?void 0:t.toLowerCase())+" - "+l((r=T.value.coordinator_name)==null?void 0:r.toLowerCase()),1)]),e("p",tt,[st,y(" "+l(T.value.audit_date),1)]),((k=S.value[1])==null?void 0:k.length)>[0]?(s(),a("h5",at,ot)):p("",!0),(s(!0),a(f,null,b(S.value[1],(d,A)=>(s(),a("div",{key:A},[e("ul",nt,[e("li",it,[n($,{class:"",severity:d.resolved?"succes":"danger"},{default:i(()=>[y(l(d.resolved?"resuelto":"pendiente"),1)]),_:2},1032,["severity"]),dt,e("span",null,l(d.item_description),1),d.warning_text?(s(),a("div",ct,[e("div",rt,[e("p",ut," ("+l(d.warning_date)+")",1),e("span",_t,l(d.warning_text),1)])])):p("",!0)])])]))),128)),(s(!0),a(f,null,b(S.value[0],(d,A)=>{var P;return s(),a("div",{key:A},[(P=d==null?void 0:d.items)!=null&&P.some(m=>m==null?void 0:m.status)?(s(),a("h5",mt,[e("b",null,l(d.group_name),1)])):p("",!0),e("ul",pt,[(s(!0),a(f,null,b(d.items,(m,W)=>(s(),a("li",{style:{"list-style":"none"},class:"my-2 p-0",key:W},[m.status?(s(),a("div",ht,[n(ae,{class:"",readonly:"",modelValue:m.status,"onUpdate:modelValue":G=>m.status=G,binary:!0},null,8,["modelValue","onUpdate:modelValue"]),e("span",null,l(m.description),1)])):p("",!0)]))),128))])])}),128))])):(s(),a("p",yt,"Información de la auditoría no disponible."))]}),_:1},8,["visible"]),n(le,{visible:N.value,"onUpdate:visible":c[5]||(c[5]=t=>N.value=t),modal:"",header:"Detalles de la Auditoría",style:{width:"30rem"}},{default:i(()=>{var t,r,k;return[I.value?(s(),a(f,{key:0},[e("h4",vt,[e("b",null,l((t=I.value.site_name)==null?void 0:t.toLowerCase())+" - "+l((r=I.value.coordinator_name)==null?void 0:r.toLowerCase()),1)]),e("p",ft,[gt,y(" "+l(I.value.audit_date),1)]),((k=F.value[1])==null?void 0:k.length)>[0]?(s(),a("h5",bt,wt)):p("",!0),(s(!0),a(f,null,b(F.value[1],(d,A)=>(s(),a("div",{key:A},[e("ul",kt,[e("li",Ct,[n($,{class:"my-1",severity:d.resolved?"succes":"danger"},{default:i(()=>[y(l(d.resolved?"resuelto":"pendiente"),1)]),_:2},1032,["severity"]),Vt,y(" "+l(d.item_description)+" ",1),d.warning_text?(s(),a("ul",At,[e("li",It,[e("p",St," ("+l(d.warning_date)+")",1),e("span",Lt,l(d.warning_text),1)])])):p("",!0)])])]))),128)),(s(!0),a(f,null,b(F.value[0],(d,A)=>{var P;return s(),a("div",{key:A},[(P=d==null?void 0:d.items)!=null&&P.some(m=>m==null?void 0:m.status)?(s(),a("h5",Pt,[e("b",null,l(d.group_name),1)])):p("",!0),e("ul",Rt,[(s(!0),a(f,null,b(d.items,(m,W)=>(s(),a("li",{style:{"list-style":"none"},class:"my-2 p-0",key:W},[m.status?(s(),a("div",Dt,[n(ae,{class:"mr-3",readonly:"",modelValue:m.status,"onUpdate:modelValue":G=>m.status=G,binary:!0},null,8,["modelValue","onUpdate:modelValue"]),y(" "+l(m.description),1)])):p("",!0)]))),128))])])}),128))],64)):(s(),a("p",jt,"Información de la auditoría no disponible."))]}),_:1},8,["visible"])])}}},Et=re(Ut,[["__scopeId","data-v-c70e4c12"]]);export{Et as default};
