import{_ as ee,r,l as te,Q as ae,G as se,v as oe,I as ne,h as le,a6 as d,k as ie,a as p,o as x,c as re,d as a,w as l,b as s,X as U,q as E,t as h,u as A,f as M,s as de,m as N,p as ce,g as ue}from"./index-3dce908f.js";import"./index-3ec6abaa.js";import"./_commonjsHelpers-de833af9.js";const D=y=>(ce("data-v-36866e4b"),y=y(),ue(),y),pe={class:"container"},me=D(()=>s("h3",null,[s("b",null,"Rechazar esta solicitud")],-1)),ve=D(()=>s("h3",null,[s("b",null,"Aprobar esta solicitud")],-1)),_e={class:"grid",style:{"align-items":"center","justify-content":"space-between"}},he={class:"col-12 md:col-6 p-3"},ye={class:"text-xl",style:{width:"100%"}},be={style:{"text-transform":"capitalize"}},ge={class:"md:mt-0 p-input-icon-right m-3"},fe=D(()=>s("i",{class:"pi pi-search"},null,-1)),we={style:{"min-width":"max-content"}},Ce={style:{"min-width":"max-content"}},xe={style:{"min-width":"max-content"}},Se={style:{display:"flex",gap:"0.5rem"}},qe={__name:"cancellationOrderRequestSesion",setup(y){const b=r(!1),v=r([]),g=r(!1),F=te(),i=r({}),I=r([]),S=r({}),j=r({1:"#27ae60",2:"#3498db",3:"#f1c40f",4:"#e74c3c",5:"#9b59b6"}),H=new Audio("/sound/pip1.wav"),G=new Audio("/sound/pip2.wav"),J=new Audio("/sound/pip3.wav"),z=ae(),Q=r(null),q={revisar:d.getPendientsCancellationRequest,aprobadas:d.getaceptedCancellationAcepted,rechazadas:d.getPendientsCancellationRejected},X={revisar:d.getPendientsCancellationRequestNoLoading,aprobadas:d.getaceptedCancellationAceptedNoLoading,rechazadas:d.getPendientsCancellationRejectedNoLoading};se(()=>{O()});const L=(n,t)=>{i.value.id=t,n?g.value=!0:b.value=!0},T=async(n,t)=>{const m={authorized:n,responsible_id:F.rawUserData.id,responsible_observation:i.value.reason||"sin observaciones",category_id:S.value.id||5};await d.resolveCancellationRequest(t,m),g.value=!1,b.value=!1,v.value=await q[c.params.request_status]()},$=n=>{const t=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],m=n.split("T"),u=m[0].split("-"),f=u[2],P=parseInt(u[1],10)-1,R=u[0],o=t[P],w=m[1].split(":"),C=parseInt(w[0],10),e=w[1],k=C>=12,V=C%12||12,Y=V<10?`0${V}`:`${V}`,Z=k?"PM":"AM";return{date:`${f}-${o}-${R}`,time:`${Y}:${e} ${Z}`}},c=oe(),_=r(),O=()=>{_.value={global:{value:null,matchMode:ne.CONTAINS}}};O(),le(async()=>{K(),Q.value=setInterval(async()=>{const n=await d.is_recent_order_generated();if(n&&z.numberCancellationRequests!=n){const t=Math.floor(Math.random()*B.length);B[t].play(),z.numberCancellationRequests=n,W()}},1e4),I.value=await d.getCancellationCategories()});const K=async()=>{v.value=await q[c.params.request_status]()},B=[H,G,J],W=async()=>{const n=c.params.request_status||"revisar";v.value=await X[n]()};return ie(()=>c.params.request_status,async()=>{v.value=await q[c.params.request_status]()},{deep:!0}),(n,t)=>{const m=p("Textarea"),u=p("Button"),f=p("Dialog"),P=p("Dropdown"),R=p("InputText"),o=p("Column"),w=p("Tag"),C=p("DataTable");return x(),re("div",pe,[a(f,{visible:b.value,"onUpdate:visible":t[2]||(t[2]=e=>b.value=e),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:l(()=>[me]),default:l(()=>[s("form",{onSubmit:t[1]||(t[1]=U(e=>T(!1,i.value.id,i.value.reason),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[a(m,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:i.value.reason,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value.reason=e),rows:"5",placeholder:"Porque desea rechazar esta solicitud?"},null,8,["modelValue"]),a(u,{style:{width:"100%","border-radius":"0.5rem"},label:"Rechazar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),a(f,{visible:g.value,"onUpdate:visible":t[6]||(t[6]=e=>g.value=e),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:l(()=>[ve]),default:l(()=>[a(P,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=e=>S.value=e),optionLabel:"name",options:I.value,placeholder:"CATEGORIA DE LA CANCELACION",class:"mb-3",style:{width:"100%"}},null,8,["modelValue","options"]),s("form",{onSubmit:t[5]||(t[5]=U(e=>T(!0,i.value.id,i.value.reason),["prevent"])),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[a(m,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:i.value.reason,"onUpdate:modelValue":t[4]||(t[4]=e=>i.value.reason=e),rows:"5",placeholder:"Notas para el solicitante"},null,8,["modelValue"]),a(u,{style:{width:"100%","border-radius":"0.5rem"},label:"Aprobar",type:"submit",class:"p-button-success"})],32)]),_:1},8,["visible"]),a(C,{paginator:!0,rows:15,filters:_.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} solicitudes",rowsPerPageOptions:[5,10,25,100],scrollable:"",scrollHeight:"65vh",stripedRows:"",style:{},"onUpdate:filters":t[8]||(t[8]=e=>_.value=e),class:"col-12 m-auto",value:v.value,tableStyle:"min-width: 50rem;"},{header:l(()=>[s("div",_e,[s("div",he,[s("span",ye,[E(" Solicitudes de cancelacion - "),s("span",be,h(A(c).params.request_status.split("-").join(" ")),1)])]),s("span",ge,[fe,a(R,{class:"",modelValue:_.value.global.value,"onUpdate:modelValue":t[7]||(t[7]=e=>_.value.global.value=e),placeholder:"Buscar Solicitud..."},null,8,["modelValue"])])])]),default:l(()=>[a(o,{style:{},class:"py-1 pl-0",field:"order_id",header:"ID orden",frozen:""},{body:l(e=>[s("p",we,h(e.data.order_id),1)]),_:1}),a(o,{class:"py-1",field:"site_name",header:"Sede"}),a(o,{class:"py-1",field:"site_name",header:"Fecha"},{body:l(e=>[s("p",Ce,h($(e.data.timestamp).date),1)]),_:1}),a(o,{class:"py-1",field:"site_name",header:"Hora"},{body:l(e=>[s("p",xe,h($(e.data.timestamp).time),1)]),_:1}),a(o,{style:{"min-width":"15rem"},class:"py-1",field:"cancellation_categorie",header:"Categoria"},{body:l(e=>[e.data.cancellation_categorie?(x(),M(w,{key:0,style:de(`background-color:${j.value[e.data.cancellation_category_id]} ;`)},{default:l(()=>[E(h(e.data.cancellation_categorie),1)]),_:2},1032,["style"])):N("",!0)]),_:1}),a(o,{style:{"min-width":"30rem"},class:"py-1",field:"reason",header:"Motivo"}),a(o,{style:{"min-width":"30rem"},class:"py-1",field:"responsible_observation",header:"Observacion Call center"}),a(o,{style:{"min-width":"10rem"},class:"py-1",field:"responsible",header:"Quien solicita?"}),a(o,{style:{"min-width":"20em"},class:"py-1",field:"user_name",header:"Nombre del cliente"}),a(o,{style:{"min-width":"10rem"},class:"py-1",field:"user_phone",header:"Cel. cliente"}),a(o,{style:{},class:"py-1 px-0",field:"date",header:"Action",frozen:"",alignFrozen:"right"},{body:l(e=>[s("div",Se,[A(c).params.request_status!="aprobadas"?(x(),M(u,{key:0,size:"",onClick:k=>L(!0,e.data.id),style:{height:"1.8rem",width:"2rem"},severity:"success",class:"p-1",icon:"pi pi-check"},null,8,["onClick"])):N("",!0),A(c).params.request_status!="rechazadas"?(x(),M(u,{key:1,onClick:k=>L(!1,e.data.id),style:{height:"1.8rem",width:"2rem",background:"var(--primary-color)",border:"none"},severity:"danger",class:"p-1",icon:"pi pi-times"},null,8,["onClick"])):N("",!0)])]),_:1})]),_:1},8,["filters","value"])])}}},Ve=ee(qe,[["__scopeId","data-v-36866e4b"]]);export{Ve as default};
