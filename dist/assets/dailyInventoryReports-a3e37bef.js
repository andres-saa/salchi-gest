import{_ as q,x as H,l as G,r as d,i as O,a as r,o as W,c as Y,d as s,w as c,b as a,F as z,B as J,s as F,t as B,p as K,g as Q}from"./index-cb2baabe.js";import{s as X}from"./siteService-7f1f71e7.js";import{d as U}from"./dailyInventoryService-1e62f987.js";import{u as _,w as R}from"./xlsx-4f9172c7.js";/* empty css                                                                              */import"./sass.default-b8072c4d.js";const b=k=>(K("data-v-27dc3528"),k=k(),Q(),k),Z={class:"grid"},ee={class:"col-12 px-0 mx-0"},te={class:"col-12",style:{display:"flex","flex-direction":"column"}},ae=b(()=>a("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),se={class:"col-12",style:{display:"flex","flex-direction":"column"}},le=b(()=>a("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),oe={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},ne={class:"col-12",style:{display:"flex","justify-content":"center"}},ie={class:"m-auto",style:{"max-width":"1024px"}},de={class:"m-0 col-12 p-3",style:{"align-items":"center"}},re={class:"p-0 mb-3",style:{display:"flex",gap:"1rem","align-items":"center","justify-content":"start"}},ce=b(()=>a("span",{class:"text-xl",style:{}},[a("b",null,"Sedes")],-1)),pe={class:"col p-0",style:{display:"flex","justify-content":"start",gap:"1rem","align-items":"center"}},ue=b(()=>a("span",{class:"text-xl"},[a("b",null,"Periodo")],-1)),me={class:"col-12 px-3",style:{display:"flex","justify-content":"end"}},ve={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},ye={class:"grid",style:{"align-items":"center"}},_e=b(()=>a("div",{class:"col-12 md:col-6 p-3"},[a("span",{class:"text-xl",style:{width:"100%"}}," Gestionar reportes de inventario")],-1)),he={class:"col-12 md:col-6 p-3"},xe={style:{"text-transform":"uppercase"}},ge={style:{display:"flex",gap:"0.5rem"}},we={__name:"dailyInventoryReports",setup(k){const j=H(),T=G(),I=d([]),S=d([{}]),u=d(!1),m=d(new Date(new Date().setDate(new Date().getDate()))),p=d(new Date),h=d(new Date(new Date().setDate(new Date().getDate()))),x=d(new Date),V=d(),g=d(),A=(i,e)=>{h.value=i,x.value=e},w=i=>{const e=new Date,l=new Date(e);l.setDate(l.getDate()+1);const o=new Date(e);o.setDate(e.getDate()-i),m.value=o,i==1?(p.value=o,x.value=p.value,h.value=m.value,u.value=!1):(p.value=e,h.value=m.value,x.value=p.value,u.value=!1),$()};O(async()=>{I.value=await X.getSites(),S.value=I.value,$()}),(()=>{g.value={global:{value:null,matchMode:J.CONTAINS}}})();function C(i){const e=new Date(i),l=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0");return`${l}-${o}-${n}`}const $=async()=>{const i=S.value.map(o=>o.site_id);T.rawUserData.id;const e=C(h.value),l=C(x.value);V.value=await U.getAllDailyInventoryReportsFiltered(i,e,l)},f=d([]),P=async(i,e,l)=>{f.value=await U.getDailyInventoryEntriesByDailyInventoryID(i);const o=f.value.map(y=>({Producto:y.item_name,Cantidad:y.quantity,"Unidad de medida":y.unit_measure})),n=_.json_to_sheet(o);n["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const v=_.book_new();_.book_append_sheet(v,n,"Usuarios"),R(v,`Inventario_${e}_${l.split("-").reverse().join("-")} .xlsx`)},N=async()=>{j.setLoading(!0,"generando descargas");const i=V.value;for(const n of i){const v=await U.getDailyInventoryEntriesByDailyInventoryID(n.daily_inventory_id);f.value.push(...v)}console.log(f.value);const e=f.value.map(n=>({Fecha:n.date.split("-").reverse().join("-"),Sede:n.site_name,Producto:n.item_name,Cantidad:n.quantity,"Unidad de medida":n.unit_measure})),l=_.json_to_sheet(e);l["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const o=_.book_new();_.book_append_sheet(o,l,"Usuarios"),R(o,"Inventario todas las sedes.xlsx"),j.setLoading(!1,"generando descargas")};return(i,e)=>{const l=r("Button"),o=r("Calendar"),n=r("Dialog"),v=r("MultiSelect"),y=r("InputText"),D=r("Column"),E=r("router-link"),L=r("DataTable");return W(),Y(z,null,[s(n,{class:"mx-2",visible:u.value,"onUpdate:visible":e[8]||(e[8]=t=>u.value=t),modal:"",header:"Periodo",style:{width:"25rem"}},{default:c(()=>[a("div",Z,[a("div",ee,[s(l,{text:"",label:"Hoy",onClick:e[0]||(e[0]=t=>w(0)),class:"p-button-text col-12 p-1 m-0"}),s(l,{text:"",label:"Ayer",onClick:e[1]||(e[1]=t=>w(1)),class:"p-button-text col-12 p-1 m-0"}),s(l,{text:"",label:"Últimos 7 días",onClick:e[2]||(e[2]=t=>w(7)),class:"p-button-text col-12 p-1 m-0"}),s(l,{text:"",label:"Últimos 14 días",onClick:e[3]||(e[3]=t=>w(14)),class:"p-button-text col-12 p-1"}),s(l,{text:"",label:"Últimos 28 días",onClick:e[4]||(e[4]=t=>w(28)),class:"p-button-text col-12 p-0"})]),a("div",te,[ae,s(o,{style:{"min-width":"max-content"},modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value=t)},null,8,["modelValue"])]),a("div",se,[le,s(o,{style:{"min-width":"max-content"},modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),showWeek:""},null,8,["modelValue"])]),a("div",oe,[a("div",ne,[s(l,{onClick:e[7]||(e[7]=()=>{A(m.value,p.value),u.value=!1})},{default:c(()=>[F("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),a("div",ie,[a("div",de,[a("div",re,[ce,s(v,{style:{},display:"chip",multiple:"",modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=t=>S.value=t),optionLabel:"site_name",options:I.value.filter(t=>t.site_id!=12&t.site_id!=13),class:"text-sm multi p-0"},null,8,["modelValue","options"])]),a("div",pe,[ue,s(y,{class:"",onClick:e[10]||(e[10]=t=>u.value=!0),style:{height:"2.7rem",width:"16rem"},value:`${C(h.value)}  |  ${C(x.value)}`,placeholder:"periodo"},null,8,["value"]),s(l,{onClick:$,icon:"pi pi-search",severity:"help",class:"text-center p-0 col-12 md:p-0",style:{height:"2.5rem",width:"min-content","aspect-ratio":"1 / 1","font-weight":"bold","border-radius":"50%",display:"flex","justify-content":"center"}})])]),a("div",me,[s(l,{severity:"help",icon:"pi pi-download",label:"Descargar todo",onClick:N})])]),a("div",ve,[s(L,{style:{"max-width":"1024px"},filters:g.value,"onUpdate:filters":e[12]||(e[12]=t=>g.value=t),class:"col-12 m-auto",value:V.value,tableStyle:"min-width: 50rem;"},{header:c(()=>[a("div",ye,[_e,a("div",he,[s(y,{style:{width:"100%"},class:"",modelValue:g.value.global.value,"onUpdate:modelValue":e[11]||(e[11]=t=>g.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:c(()=>[s(D,{class:"py-1",field:"daily_inventory_id",header:"ID"}),s(D,{class:"py-1",field:"employer_name",header:"Responsable"},{body:c(t=>[a("div",xe,B(t.data.employer_name),1)]),_:1}),s(D,{class:"py-1",field:"site_name",header:"Sede"}),s(D,{class:"py-1",field:"date",header:"Fecha"},{body:c(t=>{var M;return[F(B((M=t.data.date)==null?void 0:M.split("-").reverse().join("-")),1)]}),_:1}),s(D,{style:{},class:"py-1 px-0",field:"date",header:"Action"},{body:c(t=>[a("div",ge,[s(E,{to:`/daily-inventory/daily-inventory-view/${t.data.daily_inventory_id}`},{default:c(()=>[s(l,{style:{height:"2rem"},severity:"help",class:"p-1",icon:"pi pi-eye"})]),_:2},1032,["to"]),s(l,{onClick:M=>P(t.data.daily_inventory_id,t.data.site_name,t.data.date),style:{height:"2rem",background:"var(--primary-color)",border:"none"},severity:"success",class:"p-1",icon:"pi pi-download"},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])])],64)}}},Ve=q(we,[["__scopeId","data-v-27dc3528"]]);export{Ve as default};
