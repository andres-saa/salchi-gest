import{_ as Ve,f as n,x as je,C as Fe,h as We,g as Ne,a2 as le,U as x,r as F,o as p,c as m,d as o,w as c,a as t,l as W,F as ne,b as ie,k as C,t as v,n as re,a4 as Me,y as ue,a5 as Be,p as Re,e as Ae}from"./index-13dbe25d.js";import{u as pe,f as me,s as Y,e as ee,a as He,b as ve,c as ye,d as ge}from"./subMonths-88a4f072.js";import{s as qe}from"./siteService-538cb5c5.js";import{l as ze}from"./user-bad88813.js";const y=z=>(Re("data-v-3e80a075"),z=z(),Ae(),z),Pe={key:0},Je={key:0,class:"user-info",style:{display:"flex","flex-direction":"column","align-items":"center"}},Ke=["src"],Ze={class:"col-12 p-0 mt-4"},Ge={key:0},Qe={key:0,class:"p-0 my-1"},Xe=y(()=>t("b",null," Desde: ",-1)),Ye={key:1,class:"p-0 my-1"},et=y(()=>t("b",null," Hasta: ",-1)),tt={key:2,class:"p-0 my-1 text-xl",style:{color:"green"}},at=y(()=>t("b",null," Descansa ",-1)),st=[at],ot={class:"p-0 my-1"},lt=y(()=>t("b",null,"Cargo:",-1)),nt={class:"p-0 my-1"},it=y(()=>t("b",null,"Telefono:",-1)),rt={class:"p-0 my-1"},dt=y(()=>t("b",null,"Contrato",-1)),ct={class:""},ut={class:"col-12 p-0 m-0 my-2"},pt={class:"col-12 p-0 m-0 my-2"},mt={class:"col-12 p-0 m-0 my-2"},vt={class:"col-12 p-0 m-0 my-2"},yt={class:"col-12 p-0 my-2"},gt={class:"col-12 p-0 my-2"},_t=y(()=>t("p",{class:"col-12 m-0 p-0 py-2"},"Desde:",-1)),ft=y(()=>t("p",{class:"col-12 m-0 p-0 py-2"},"Hasta:",-1)),ht=y(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este día de trabajo y todos sus registros?")],-1)),wt=y(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este registro?")],-1)),bt={style:{},class:"p-0 m-0"},Dt=y(()=>t("h3",null,"Nuevo dia",-1)),kt={class:"col-12 p-0 m-0 mb-8"},xt={class:"grid p-0 mx-auto"},St={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},Ct={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},Tt={class:"col-12 md:col-2 py-2",style:{display:"flex",height:"4rem","justify-content":"end"}},Lt={class:"grid"},Ut={class:"col-2 p-0",style:{height:"80vh","overflow-y":"auto"}},$t={class:"p-0 text-sm",style:{display:"flex","justify-content":"center"}},It={style:{display:"flex",gap:"1rem","flex-direction":"column"},class:"pb-3 m-auto"},Et=["onClick","onDragstart"],Ot=["onClick","src","onError"],Vt={class:"my-0 py-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},jt={class:"my-0 py-0",style:{"min-width":"min-content","text-transform":"uppercase","text-align":"center"}},Ft={class:"col-10",style:{height:"80vh","overflow-y":"auto"}},Wt={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},Nt={class:"col-12 pb-6",style:{}},Mt={style:{display:"flex",gap:"0rem","flex-direction":"column"}},Bt={class:"py-0 px-4 text-center col-12 m-0 p-0 text",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},Rt={style:{"overflow-x":"auto"}},At={style:{"min-width":"max-content"}},Ht=["onDrop"],qt={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},zt=["onClick","src","onError"],Pt={key:0,class:"text-sm"},Jt={class:"py-0 my-0 text-sm text-center"},Kt={key:1,class:"text-sm"},Zt={class:"py-0 my-0"},Gt=y(()=>t("p",{class:"py-0 my-0"},[t("b",{style:{color:"green"}},"DESCANSA")],-1)),Qt={class:"",style:{"text-transform":"uppercase"}},Xt=y(()=>t("p",null,"Hora de llegada:",-1)),Yt=y(()=>t("p",null,"Hora de salida:",-1)),ea={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},ta={__name:"work_schedule",setup(z){const P=n(!1),u=n(null),te=s=>{u.value=s,P.value=!0},T=n(null),L=n(!1),J=n(new Date),N=n(!1),g=n(new Date),h=n(new Date),K=ze(),d=je(),M=n(!1),Z=n(null),_=n(),B=n(),U=n(),$=n(),I=n(!1),b=n(null),R=n(null),E=n(new Date),O=n(new Date),de=Fe(()=>!U.value||!$.value?"":`${me(U.value,"dd/MM/yyyy")} - ${me($.value,"dd/MM/yyyy")}`),_e=()=>{g.value=U.value||new Date,h.value=$.value||new Date,N.value=!0},fe=()=>{N.value=!1},S=()=>{U.value=g.value,$.value=h.value,N.value=!1,V()},ae=()=>{const s=new Date;g.value=Y(s,{weekStartsOn:1}),h.value=ee(s,{weekStartsOn:1}),S()},he=()=>{const s=Y(new Date,{weekStartsOn:1});g.value=He(s,7),h.value=ee(g.value,{weekStartsOn:1}),S()},we=()=>{const s=new Date;g.value=ve(s),h.value=ye(s),S()},be=()=>{const s=new Date;g.value=ve(ge(s,1)),h.value=ye(ge(s,1)),S()},De=s=>{Z.value=s,M.value=!0},ke=async()=>{if(M.value=!1,d.setLoading(!0,"borrando"),!Z.value)return;const s=await fetch(`${x}/work_records/${Z.value}`,{method:"DELETE"});s.ok?(V(),d.setLoading(!1,"borrando")):(console.error("Error al eliminar el registro:",await s.text()),alert("Hubo un error al eliminar el registro."),d.setLoading(!1,"borrando")),Z.value=null},A=n(!1),G=n(null),xe=s=>{G.value=s,A.value=!0},Se=async()=>{if(A.value=!1,!G.value)return;d.setLoading(!0,"borrando"),(await fetch(`${x}/work_days/${G.value}`,{method:"DELETE"})).ok?(X.value=X.value.filter(e=>e.id!==G.value),d.setLoading(!1,"borrando")):(alert("Hubo un error al eliminar el día de trabajo."),d.setLoading(!1,"borrando"))},Ce={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},Te=s=>{if(!(s instanceof Date))return console.error("getDayColor: date is not a Date object",s),"#FFFFFF";const e=s.toLocaleDateString("en-US",{weekday:"long"});return Ce[e]},Q=n([]),X=n([]),se=(s,e)=>{const l={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},i=s==null?void 0:s.trim().toLowerCase();e.target.src=l[i]||l.default};We(async()=>{B.value=await qe.getSites(),_.value=B.value.filter(e=>e.site_id==K.rawUserData.site_id)[0],T.value=B.value.filter(e=>e.site_id==K.rawUserData.site_id)[0];const s=await pe.getUsersBySiteId(K.rawUserData.site_id);Q.value=s.filter(e=>e.status=="activo"),ae(),V()}),Ne(_,async(s,e)=>{var l,i;if(le()==1104&&((l=_.value.site_name)==null?void 0:l.toLowerCase())!="kennedy"&&((i=_.value.site_name)==null?void 0:i.toLowerCase())!="montes"){alert("No tienes permiso para administrar esta sede"),_.value=e;return}else{const w=await pe.getUsersBySiteId(s.site_id);Q.value=w.filter(j=>j.status=="activo"),T.value=s,ae(),V()}});const V=async()=>{var i,w;if(le()==1104&&((i=_.value.site_name)==null?void 0:i.toLowerCase())!="kennedy"&&((w=_.value.site_name)==null?void 0:w.toLowerCase())!="montes")return;if(d.setLoading(!0,"cargando horario"),!_.value||!U.value||!$.value){alert("Please select a site and date range.");return}const s=U.value.toISOString().split("T")[0],e=$.value.toISOString().split("T")[0],l=await fetch(`${x}/filtered_work_days?site_id=${_.value.site_id}&start_date=${s}&end_date=${e}`);if(l.ok){d.setLoading(!1,"cargando horario");const j=await l.json();X.value=j.map(f=>(f.date=new Date(f.date),f.date.setDate(f.date.getDate()+1),f.users=f.records.map(k=>{let H=Q.value.find(D=>D.id===k.employer_id);if(H){let D={...H};const q=new Date(`${f.date.toISOString().split("T")[0]}T${k.start_time}`),a=new Date(`${f.date.toISOString().split("T")[0]}T${k.end_time}`);return D.arrivalTime=q,D.departureTime=a,D.hoursWorked=(a-q)/36e5,D}return null}).filter(k=>k!=null),d.setLoading(!1,"cargando horario"),f))}else d.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")},Le=async()=>{if(L.value=!1,d.setLoading(!0,"guardando"),!T.value||!J.value){alert("Please select a site and date.");return}let s=new Date(J.value.getTime());const e=new Date(s.getTime()-s.getTimezoneOffset()*6e4).toISOString().split("T")[0],l=await fetch(`${x}/work_days`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:e,site_id:T.value.site_id})});if(l.ok){const i=await l.json();i.date=new Date(i.date),i.date.setDate(i.date.getDate()+1),d.setLoading(!1,"guardando"),V()}else{const i=await l.json();i.detail&&i.detail==="El día con el mismo site_id ya está registrado."?alert("Este dia ya esta registrado para esta sede"):alert("Failed to add new workday"),d.setLoading(!1,"guardando")}},Ue=()=>{const s=new Date,e=new Date(s.setDate(s.getDate()+(7-s.getDay())+1));g.value=Y(e,{weekStartsOn:1}),h.value=ee(e,{weekStartsOn:1}),S()},$e=()=>{const s=new Date,e=new Date(s.setDate(s.getDate()+(7-s.getDay())+8));g.value=Y(e,{weekStartsOn:1}),h.value=ee(e,{weekStartsOn:1}),S()},Ie=s=>{b.value=s},Ee=s=>{R.value=s,I.value=!0},Oe=async()=>{if(I.value=!1,d.setLoading(!0,"cargando"),!b.value||!R.value)return;if(E.value.getTime()>=O.value.getTime()){alert("La hora de llegada no puede ser mayor o igual a la hora de salida."),d.setLoading(!1,"cargando"),I.value=!0;return}let s=E.value.toISOString().split("T")[1].slice(0,8),e=O.value.toISOString().split("T")[1].slice(0,8);const l={employer_id:b.value.id,work_day_id:R.value.id,start_time:s,end_time:e};await fetch(`${x}/work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),b.value.arrivalTime=E.value,b.value.departureTime=O.value,b.value.hoursWorked=(O.value-E.value)/36e5,R.value.users.push(b.value),I.value=!1,b.value=null,R.value=null,d.setLoading(!1,"cargando")};return(s,e)=>{var H,D,q;const l=F("Button"),i=F("Dialog"),w=F("Calendar"),j=F("Dropdown"),f=F("InputText"),k=F("InputIcon");return p(),m("div",Pe,[o(i,{visible:P.value,"onUpdate:visible":e[2]||(e[2]=a=>P.value=a),modal:"",style:{width:"30rem"}},{footer:c(()=>[o(l,{label:"Cerrar",onClick:e[1]||(e[1]=a=>P.value=!1)})]),default:c(()=>{var a;return[t("h4",null,v(u.value.name),1),u.value?(p(),m("div",Je,[t("img",{class:"shadow-3",src:`${W(x)}/read-product-image/300/employer-${u.value.dni}`,onError:e[0]||(e[0]=r=>se(u.value.gender,r)),alt:"Foto del empleado",style:{width:"100%","aspect-ratio":"1 / 1","border-radius":"0.5rem","object-fit":"cover"}},null,40,Ke),t("div",Ze,[u.value.arrivalTime&&u.value.departureTime?(p(),m("div",Ge,[u.value.rest?re("",!0):(p(),m("p",Qe,[Xe,C(v(new Date(u.value.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)])),u.value.rest?(p(),m("p",tt,st)):(p(),m("p",Ye,[et,C(" "+v(new Date(u.value.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)]))])):re("",!0),t("p",ot,[lt,C(" "+v(u.value.position),1)]),t("p",nt,[it,C(" "+v(u.value.phone),1)]),t("p",rt,[dt,C(" "+v((a=u.value.contract_type)==null?void 0:a.toLowerCase()),1)])])])):re("",!0)]}),_:1},8,["visible"]),o(i,{visible:N.value,"onUpdate:visible":e[5]||(e[5]=a=>N.value=a),modal:"",closable:""},{footer:c(()=>[o(l,{severity:"danger",label:"Cancelar",onClick:fe,class:"p-button-text"}),o(l,{severity:"success",label:"Aceptar",onClick:S})]),default:c(()=>[t("div",ct,[t("div",ut,[o(l,{class:"col-12 p-1",severity:"success",label:"Semana entrante",onClick:Ue})]),t("div",pt,[o(l,{class:"col-12 p-1",severity:"secondary",label:"Dentro de 2 semanas",onClick:$e})]),t("div",mt,[o(l,{class:"col-12 p-1",severity:"danger",label:"Esta semana",onClick:ae})]),t("div",vt,[o(l,{class:"col-12 p-1",severity:"help",label:"Semana pasada",onClick:he})]),t("div",yt,[o(l,{class:"col-12 p-1",severity:"warning",label:"Este mes",onClick:we})]),t("div",gt,[o(l,{class:"col-12 p-1",severity:"primary",label:"Mes pasado",onClick:be})])]),_t,o(w,{class:"col-12 m-0 p-0",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),showIcon:""},null,8,["modelValue"]),ft,o(w,{class:"col-12 m-0 p-0",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),o(i,{visible:A.value,"onUpdate:visible":e[7]||(e[7]=a=>A.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:c(()=>[o(l,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[6]||(e[6]=a=>A.value=!1)}),o(l,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:Se})]),default:c(()=>[ht]),_:1},8,["visible"]),o(i,{visible:M.value,"onUpdate:visible":e[9]||(e[9]=a=>M.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:c(()=>[o(l,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[8]||(e[8]=()=>M.value=!1)}),o(l,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:ke})]),default:c(()=>[wt]),_:1},8,["visible"]),t("div",bt,[o(i,{visible:L.value,"onUpdate:visible":e[13]||(e[13]=a=>L.value=a),style:{width:"22rem"},modal:"",closeOnEscape:"",onClose:e[14]||(e[14]=a=>L.value=!1)},{footer:c(()=>[o(l,{label:"cancelar",onClick:e[12]||(e[12]=a=>L.value=!1),class:"p-button-danger"}),o(l,{label:"Agregar",onClick:Le,class:"p-button-success"})]),default:c(()=>[Dt,o(w,{class:"my-4",modelValue:J.value,"onUpdate:modelValue":e[10]||(e[10]=a=>J.value=a),showIcon:""},null,8,["modelValue"]),o(j,{class:"col-12 p-0",disabled:"",modelValue:T.value,"onUpdate:modelValue":e[11]||(e[11]=a=>T.value=a),options:B.value,optionLabel:"site_name",placeholder:"Select a site"},null,8,["modelValue","options"])]),_:1},8,["visible"]),t("div",kt,[t("div",xt,[t("div",St,[o(j,{disabled:!((q=W(Me)["Horarios de trabajo admin"])!=null&&q.includes((D=(H=W(K))==null?void 0:H.rawUserData)==null?void 0:D.rol))&&W(le)()!=1104,style:{height:"100%"},class:"col-12 p-0 m-0",modelValue:_.value,"onUpdate:modelValue":e[15]||(e[15]=a=>_.value=a),options:B.value,optionLabel:"site_name"},null,8,["disabled","modelValue","options"])]),t("div",Ct,[o(f,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:de.value,"onUpdate:modelValue":e[16]||(e[16]=a=>de.value=a),onClick:_e},null,8,["modelValue"])]),t("div",Tt,[o(l,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:V})])])]),t("div",Lt,[t("div",Ut,[t("div",$t,[t("div",It,[(p(!0),m(ne,null,ie(Q.value,a=>(p(),m("div",{onClick:r=>te(a),key:a.id,draggable:"true",style:{display:"flex","flex-direction":"column","align-items":"center"},onDragstart:r=>Ie(a)},[t("img",{onClick:r=>te(a),class:"shadow-2 p-1",src:`${W(x)}/read-product-image/96/employer-${a.dni}`,alt:"user.name",onError:r=>se(a.gender,r),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,Ot),t("p",Vt,v(a.name.split(" ").slice(0,2).join(" ")),1),t("span",jt,v(a.position),1)],40,Et))),128))])])]),t("div",Ft,[t("div",Wt,[o(l,{class:"mb-3",icon:"pi pi-plus",severity:"info",label:"Nuevo dia",onClick:e[17]||(e[17]=a=>L.value=!0)})]),t("div",Nt,[t("div",Mt,[(p(!0),m(ne,null,ie(X.value,a=>(p(),m("div",{class:"p-0 m-0",key:a.id,style:{position:"relative"}},[t("div",{class:"shadow-2",style:ue({"background-color":Te(a.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[t("p",Bt,v(a.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"}))+" ",1)],4),t("div",Rt,[o(l,{style:{position:"absolute",right:"-1rem",top:"-1rem"},icon:"pi pi-trash text-2xl ",class:"p-button-rounded p-button-danger shadow-5",onClick:r=>xe(a.id)},null,8,["onClick"]),t("div",At,[t("div",{class:"shadow-5 p-3 m-0",style:{"border-radius":"0 0 0.5rem 0.5rem",display:"flex","overflow-x":"auto","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"},onDragover:e[18]||(e[18]=Be(()=>{},["prevent"])),onDrop:r=>Ee(a)},[(p(!0),m(ne,null,ie(a.users,r=>{var ce;return p(),m("div",{class:"shadow-2 p-2",key:r.id,style:ue([{"text-align":"center",width:"7rem","aspect-ratio":"1 / 1","background-color":"white",color:"black",position:"relative","border-radius":"0.5rem"},r.rest?"outline:2px solid green;  ":"background-color: white;"])},[t("p",qt,v(r.name.split(" ").slice(0,1).join(" ")),1),t("img",{class:"shadow-2 p-1",onClick:oe=>te(r),src:`${W(x)}/read-product-image/96/employer-${r.dni}`,alt:"user.name",onError:oe=>se(r.gender,oe),style:{width:"3rem","object-fit":"cover",height:"3rem","border-radius":"50%"}},null,40,zt),r.rest?(p(),m("div",Kt,[t("p",Zt,[t("b",null,v((ce=r.contract_type)==null?void 0:ce.toLowerCase().slice(0,13)),1)]),Gt])):(p(),m("div",Pt,[t("p",Jt," De: "+v(new Date(r.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}))+" A: "+v(new Date(r.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)])),o(l,{style:{position:"absolute",width:"1.5rem",height:"1.5rem",top:"-0.5rem",right:"-0.5rem","font-weight":"bold"},icon:"pi pi-times fw-bold",class:"p-button-rounded p-button-danger p-0",onClick:oe=>De(r.id)},null,8,["onClick"])],4)}),128))],40,Ht)])])]))),128)),C(" ` ")])])])]),o(i,{visible:I.value,"onUpdate:visible":e[21]||(e[21]=a=>I.value=a),style:{width:"20rem"},modal:!0},{header:c(()=>[C(" . ")]),footer:c(()=>[t("div",ea,[o(l,{severity:"success",label:"Aceptar",onClick:Oe})])]),default:c(()=>[t("h5",Qt,"Cuantas horas trabajo "+v(b.value.name)+"?",1),Xt,o(w,{modelValue:E.value,"onUpdate:modelValue":e[19]||(e[19]=a=>E.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:c(({clickCallback:a})=>[o(k,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"]),Yt,o(w,{modelValue:O.value,"onUpdate:modelValue":e[20]||(e[20]=a=>O.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:c(({clickCallback:a})=>[o(k,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])])}}},na=Ve(ta,[["__scopeId","data-v-3e80a075"]]);export{na as default};
