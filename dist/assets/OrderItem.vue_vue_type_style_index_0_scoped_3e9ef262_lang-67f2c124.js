import{_ as G,r as h,Z as Y,G as j,i as J,j as K,U as Q,a as O,o as d,c as g,g as i,w as _,b as e,a2 as A,u as s,a1 as k,m as c,t as n,e as z,f as x,F as R,d as S,p as W,h as X}from"./index-87ceccd5.js";import{f as C}from"./formatoPesos-8aa989a0.js";const r=V=>(W("data-v-4ce2ef60"),V=V(),X(),V),ee=r(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),te=r(()=>e("span",{for:"responsible"},"Responsable",-1)),oe=r(()=>e("span",{for:"reason"},"Razón",-1)),se=r(()=>e("h3",null,[e("b",null,"Cancelar Orden")],-1)),le=r(()=>e("span",{class:"advert",style:{"text-transform":"lowercase",color:"red","font-weight":"bold"}}," Desde el 16 de mayo de 2024, la cancelación de órdenes requerirá autorización.",-1)),ne=r(()=>e("span",{for:"responsible"},"Responsable",-1)),re=r(()=>e("span",{for:"reason"},"Razón",-1)),ie={style:{"text-transform":"capitalize"}},ae={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},de={id:"factura",style:{width:"100%"}},ce=r(()=>e("i",{class:"pi pi-whatsapp mr-2"},null,-1)),ue=r(()=>e("br",null,null,-1)),pe={class:"",style:{width:"auto"}},me={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},_e={class:"",id:"id",style:{"font-weight":"bold","min-width":"100%",width:"max-content","text-align":"center",color:"black",margin:"0rem"}},be={style:{padding:"0",color:"black","text-align":"center",margin:"auto","margin-bottom":"1rem",width:"max-content","min-width":"max-content",display:"flex","justify-content":"center","flex-direction":"column"}},ve=r(()=>e("div",{class:"",style:{"font-weight":"bold",color:"white",margin:"0","background-color":"black","align-items":"center",display:"grid","grid-template-columns":"auto auto"}},[e("div",{style:{width:"100%"}},[e("b",null," productos")]),e("div",null,[e("p",{style:{"text-align":"end","font-weight":"bold"}},[e("b",null," total ")])])],-1)),ye={style:{display:"grid","grid-template-columns":"auto auto"}},he={class:"p-0 m-0"},ge=r(()=>e("br",null,null,-1)),fe={style:{"text-align":"end",color:"black"}},we={key:0,class:"p-0 m-0"},xe=r(()=>e("b",null,"COMBO INCLUYE",-1)),Oe=[xe],ke={class:"p-0 m-0 ml-5",style:{}},Ce={style:{display:"flex",width:"","justify-content":"space-between"},class:"p-0 m-0"},Ve={class:"p-0 m-0 ml-5",style:{}},De={class:"p-0 m-0",style:{"text-align":"end"}},Te=r(()=>e("div",{style:{"background-color":"rgba(0, 0, 0, 0.286)",height:"1px"}},null,-1)),ze={class:"",style:{display:"grid",color:"","margin-top":"0.5rem","grid-template-columns":"auto auto"}},Ie=r(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Subtotal")])],-1)),Re={class:""},Se={style:{"text-align":"end","font-weight":"bold",color:"black"}},Ee=r(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold"}},[e("b",null,"Domicilio")])],-1)),Ne={class:""},Pe={style:{"text-align":"end","font-weight":"bold",color:"black"}},Be=r(()=>e("div",{class:""},[e("span",{style:{"font-weight":"bold",color:"black"}},[e("b",null,"Total")])],-1)),Le={class:""},Me={style:{"text-align":"end",color:"black","font-weight":"bold"}},Ue=r(()=>e("div",{class:""},null,-1)),je=r(()=>e("p",{style:{"font-weight":"bold","background-color":"black",color:"white",padding:"0",margin:"0","margin-top":"0.5rem"}},[e("b",null,"Notas")],-1)),Ae={class:"notas",style:{border:"1px solid",margin:"0",color:"black",padding:"0.5rem"}},Fe=r(()=>e("p",{style:{"background-color":"black","font-weight":"bold","margin-top":"1rem",color:"white"}},[e("b",null,"cliente")],-1)),$e={style:{display:"grid","grid-template-columns":"auto auto"}},qe=r(()=>e("div",{class:"",style:{}},[e("span",null,[e("b",null,"NOMBRE")])],-1)),He={class:""},Ze={style:{"text-align":"end",color:"black"}},Ge=r(()=>e("div",{style:{}},[e("span",null,[e("b",null,"telefono")])],-1)),Ye={style:{"text-align":"end",color:"black"}},Je=r(()=>e("div",{style:{}},[e("span",null,[e("b",null,"direccion ")])],-1)),Ke={style:{"text-align":"end",color:"black"}},Qe=r(()=>e("div",null,[e("span",null,[e("b",null,"metodo de pago")])],-1)),We={style:{"text-align":"end",color:"black"}},Xe={class:"col-12 mb-0 pb-0 px-0 m-0",style:{display:"flex","justify-content":"space-between",gap:"1rem"}},et={__name:"DialogoPedido",setup(V){h(0);const D=h(!1),o=Y(),E=j(()=>o.currentOrder.pe_json.listaPedidos.reduce((u,t)=>{var b;let v=t.pedido_cantidad*t.pedido_precio;if(t.modificadorseleccionList&&t.modificadorseleccionList.length>0){const f=((b=t.modificadorseleccionList)==null?void 0:b.filter(w=>w.pedido_productoid==t.pedido_productoid)).reduce((w,l)=>w+l.modificadorseleccion_cantidad*l.pedido_precio,0);v+=f}return u+v},0)),F=j(()=>E.value+o.currentOrder.delivery_price),$=async()=>{var t;const u={order_id:o.currentOrder.order_id,responsible:(t=a.value.responsible)==null?void 0:t.name,reason:a.value.reason};await k.create_cancellling_request(u),D.value=!1,o.Notification.pause(),o.Notification.currentTime=0},T=h(!1),q=()=>{const u=document.getElementById("factura").innerHTML,t=window.open("","_blank");t.document.write("<html><head><title>Factura</title>");const v=document.getElementsByTagName("style");for(let b=0;b<v.length;b++)t.document.write(v[b].outerHTML);t.document.write("<style>  @media print { html{height: min-content;}  *{text-transform:uppercase;align-items:center; width:100%; font-family: sans-serif;padding:0;margin:0; font-size:o.9rem !IMPORTANT} body { padding:0; -webkit-print-color-adjust: exact; /* Chrome, Safari */ color-adjust: exact; /* Firefox */ } }  </style>"),t.document.write("</head><body>"),t.document.write(u),t.document.write("</body></html>"),t.document.close(),t.print(),setTimeout(()=>{t.close()},.01)},H=h([]);J(async()=>{o.currentOrder.value=o.currentOrder,H.value=await K.get(`${Q}/sites`)});const I=h(!1);h(!1);const a=h({responsible:null,reason:"Sin razon"}),N=h([{name:"Restaurante",value:"restaurant"},{name:"Cliente",value:"client"}]),Z=()=>{a.value.responsible&&k.cancelOrder(o.currentOrder.order_id,a.value.reason,a.value.responsible.name).then(u=>{u&&(I.value=!1,console.log("Order canceled successfully"))}).catch(u=>{console.error("Failed to cancel order:",u)})};return(u,t)=>{const v=O("Dropdown"),b=O("Textarea"),p=O("Button"),f=O("Dialog"),w=O("Tag");return d(),g("div",null,[i(f,{visible:I.value,"onUpdate:visible":t[2]||(t[2]=l=>I.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:_(()=>[ee]),default:_(()=>[e("form",{onSubmit:A(Z,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[te,i(v,{style:{width:"100%"},id:"responsible",modelValue:a.value.responsible,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.responsible=l),options:N.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),oe,i(b,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:a.value.reason,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.reason=l),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),i(p,{style:{width:"100%","border-radius":"0.5rem"},label:"cancelar",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),i(f,{visible:D.value,"onUpdate:visible":t[5]||(t[5]=l=>D.value=l),closeOnEscape:"",closable:!0,modal:"",style:{width:"30rem"}},{header:_(()=>[se]),default:_(()=>[e("form",{onSubmit:A($,["prevent"]),style:{display:"flex",gap:"1rem","flex-direction":"column","align-items":"start"}},[le,ne,i(v,{style:{width:"100%"},id:"responsible",modelValue:a.value.responsible,"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.responsible=l),options:N.value,optionLabel:"name",placeholder:"Selecciona un responsable"},null,8,["modelValue","options"]),re,i(b,{style:{resize:"none","text-transform":"lowercase",width:"100%"},id:"reason",modelValue:a.value.reason,"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.reason=l),rows:"5",placeholder:"Escribe la razón de la cancelación"},null,8,["modelValue"]),i(p,{style:{width:"100%","border-radius":"0.5rem"},label:"solicitar cancelacion",type:"submit",class:"p-button-danger"})],32)]),_:1},8,["visible"]),i(f,{closable:!1,style:{width:"30rem"},modal:"",visible:T.value,"onUpdate:visible":t[8]||(t[8]=l=>T.value=l)},{footer:_(()=>[e("div",ae,[i(p,{text:"",size:"small",onClick:t[6]||(t[6]=()=>{s(k).deliveryZero(s(o).currentOrder.order_id),T.value=!1}),style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"si"}),i(p,{onClick:t[7]||(t[7]=l=>T.value=!1),size:"small",style:{"border-radius":"0.3rem",width:"100%"},severity:"danger",label:"no"})])]),default:_(()=>[e("span",ie,[c(" Esta seguro de llevar a $0.00 el valor del domicilio para la orden "),e("b",null,n(s(o).currentOrder.order_id),1),c(" del cliente "),e("b",null,n(s(o).currentOrder.user_name),1),c("? ")])]),_:1},8,["visible"]),i(f,{class:"mx-3",closeOnEscape:"",closable:!1,visible:s(o).visibles.currentOrder,"onUpdate:visible":t[13]||(t[13]=l=>s(o).visibles.currentOrder=l),modal:"",style:{"max-height":"95vh",width:"35rem",position:"relative"}},{footer:_(()=>[e("div",Xe,[s(o).currentOrder.current_status=="generada"?(d(),z(p,{key:0,size:"small",onClick:t[9]||(t[9]=l=>s(k).prepareOrder(s(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"Preparar"})):x("",!0),s(o).currentOrder.current_status=="en preparacion"?(d(),z(p,{key:1,size:"small",onClick:t[10]||(t[10]=l=>s(k).sendOrder(s(o).currentOrder.order_id)),style:{"border-radius":"0.3rem",width:"100%"},severity:"success",label:"enviar"})):x("",!0),i(p,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:q,severity:"warning",label:"imprimir"}),i(p,{size:"small",style:{"border-radius":"0.3rem",width:"100%"},onClick:t[11]||(t[11]=l=>D.value=!0),severity:"danger",label:"CANCELAR "})])]),default:_(()=>{var l,P,B,L,M;return[e("div",de,[s(o).currentOrder.responsible_id?(d(),z(w,{key:0,style:{},class:"tag mb-2",severity:"success"},{default:_(()=>[ce,c(" TRANSFERENCIA APROBADA")]),_:1})):x("",!0),c(),ue,s(o).currentOrder.responsible_id?(d(),z(w,{key:1,class:"tag",severity:"success"},{default:_(()=>[c(n(s(o).currentOrder.name),1)]),_:1})):x("",!0),e("div",pe,[e("p",me," ID:"+n(s(o).currentOrder.order_id),1),e("p",_e,n(s(o).currentOrder.user_name),1),e("p",be,[e("b",null," fecha: "+n((l=s(o).currentOrder.latest_status_timestamp)==null?void 0:l.split("T")[0]),1),e("b",null," Hora: "+n((M=(L=(B=(P=s(o).currentOrder.latest_status_timestamp)==null?void 0:P.split("T")[1])==null?void 0:B.split(":"))==null?void 0:L.slice(0,2))==null?void 0:M.join(":")),1)]),ve,(d(!0),g(R,null,S(s(o).currentOrder.pe_json.listaPedidos,m=>{var U;return d(),g("div",null,[e("div",ye,[e("p",he,[c(n(m.pedido_cantidad)+" "+n(m.pedido_nombre_producto)+" ",1),ge]),e("div",null,[e("p",fe,n(s(C)(m.pedido_precio*m.pedido_cantidad)),1)])]),m.lista_productocombo?(d(),g("p",we,Oe)):x("",!0),m.lista_productocombo?(d(!0),g(R,{key:1},S(m.lista_productocombo,y=>(d(),g("p",ke,[c(" -- "),e("b",null,n(y.pedido_cantidad),1),c(" "+n(y.pedido_nombre),1)]))),256)):x("",!0),(d(!0),g(R,null,S((U=m.modificadorseleccionList)==null?void 0:U.filter(y=>y.pedido_productoid==m.pedido_productoid),y=>(d(),g("div",Ce,[e("p",Ve,[c(" -- "),e("b",null,n(y.modificadorseleccion_cantidad),1),c(" "+n(y.modificador_nombre),1)]),e("p",De,n(s(C)(y.pedido_precio)),1)]))),256)),Te])}),256)),e("div",ze,[Ie,e("div",Re,[e("p",Se,[e("b",null,n(s(C)(E.value)),1)])]),Ee,e("div",Ne,[e("p",Pe,[e("b",null,n(s(C)(s(o).currentOrder.delivery_price)),1)])]),Be,e("div",Le,[e("p",Me,[e("b",null,n(s(C)(F.value)),1)])]),Ue]),je,e("p",Ae,n(s(o).currentOrder.order_notes),1),Fe,e("div",$e,[qe,e("div",He,[e("p",Ze,n(s(o).currentOrder.user_name),1)]),Ge,e("div",null,[e("p",Ye,n(s(o).currentOrder.user_phone),1)]),Je,e("div",null,[e("p",Ke,n(s(o).currentOrder.user_address),1)]),Qe,e("div",null,[e("p",We,n(s(o).currentOrder.payment_method),1)])])])]),i(p,{class:"shadow-4",onClick:t[12]||(t[12]=m=>s(o).setVisible("currentOrder",!1)),icon:"pi pi-times",rounded:"",severity:"danger",style:{position:"absolute",top:"-1rem","border-radius":"50%",right:"-1rem"}})]}),_:1},8,["visible"])])}}},st=G(et,[["__scopeId","data-v-4ce2ef60"]]);export{st as D};
