import{H as xe,h as g,i as oe,I as ie,j as L,J as U,D as pe,g as N,o as u,c as S,a as t,n as c,u as n,F as ce,r as de,d as z,e as m,t as b,f as p,k as W,b as re,p as ke,m as we,_ as me,C as Te,l as Le,G as De,U as Ne,q as ue,K as Ue,L as Re}from"./index-e813e6cb.js";import{c as fe,u as $e,P as je}from"./Messages.vue_vue_type_style_index_0_scoped_09e7a26a_lang-3a2dcd62.js";/* empty css                                                             */import Ie from"./Messages-a1315047.js";const Se=R=>(ke("data-v-2c683e71"),R=R(),we(),R),Oe={class:"sidebar-container",style:{position:"relative"}},ze={class:"header"},Ae=Se(()=>t("strong",null," Notificaciones ",-1)),Me=[Ae],Ve=["onClick"],Fe={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},Pe={class:"flex align-items-center"},Be=["src"],We={class:"flex align-items-center"},Je=["src"],Ke={style:{display:"flex",gap:"1rem"}},qe={style:{position:"relative"}},Ge={style:{color:"white"}},He={class:"statuses"},Xe=["onClick"],Ye={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},Ze={style:{"grid-area":"check",display:"flex","justify-content":"end",gap:".5rem"}},Qe={key:0,style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold"}},et={style:{color:"white"}},tt=Se(()=>t("i",{style:{color:"greenyellow"},class:"fa-solid fa-check-double"},null,-1)),at={key:0,style:{bottom:"0","padding-bottom":"1rem",background:"linear-gradient(to bottom , transparent 3%, black)",display:"flex",position:"absolute","z-index":"100",width:"100%",color:"white"}},st={key:1,style:{"text-align":"center",padding:".5rem",color:"#ffffff80"}},ye=1e3,ot=xe({__name:"Sidebar",props:{restaurant:Object},setup(R){const f=g(!1),K=g(!1),Y=o=>{o.target.closest(".notifications")||(f.value=!1)};oe(()=>{document.addEventListener("click",Y)}),ie(()=>{document.removeEventListener("click",Y)});const x=fe(),ne=R,h=$e(),V=[{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}],r=g(ne.restaurant||V[0]);g([{label:"Todos",textColor:"#4CAF50"},{label:"Sin leer",textColor:"#2196F3"},{label:"Favoritos",textColor:"#FFC107"},{label:"Preocupantes",textColor:"#F44336"},{label:"Top",textColor:"#9C27B0"}]);const q=async o=>{h.current_user=o,f.value=!1;try{await L.post(`${U}/read-message/${o.user_id}/${r.value.id}`,!1)}catch(l){console.error("No se pudo marcar como leído",l)}o.unreaded=0},J=async o=>{var l;h.current_user=o.user_info,f.value=!1;try{await L.post(`${U}/read-message/${o.user_info.user_id}/${r.value.id}`,!1),await L.post(`${U}/view_notification/${o.id}`,!1),h.notifications[r.value.id]=await L.get(`${U}/notifications/${r.value.id}`);const d=(l=h.sidebars[r.value.id])==null?void 0:l.findIndex(v=>v.user_id==o.user_info.user_id);console.log(d),d!==-1&&(h.sidebars[r.value.id][d].unreaded=0)}catch(d){console.error("No se pudo marcar como leído",d)}},j=[{label:"SIN LEER",bg:"#f39c12",icon:"fa-solid fa-envelope-open"},{label:"LEIDOS",bg:"#16a085",icon:"fa-solid fa-envelope-circle-check"},{label:"TODO",bg:"#34495e",icon:"fa-solid fa-inbox"},{label:"SIN DATOS",bg:"#95a5a6",icon:"fa-solid fa-circle-question"},{label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-solid fa-triangle-exclamation"},{label:"CASUAL",bg:"#e67e22",icon:"fa-solid fa-person-walking"},{label:"FRECUENTE",bg:"#27ae60",icon:"fa-solid fa-repeat"},{label:"TOP",bg:"#2980b9",icon:"fa-solid fa-ranking-star"},{label:"ESTRELLA",bg:"#8e44ad",icon:"fa-solid fa-star"}],T=g({label:"SIN LEER",bg:"#f39c12",icon:"fa-solid fa-envelope-open"}),E=g(0);let F=0;const P=g(!1),I=g(!1),G=g(null),Z=o=>{var d;if(!o)return"";const l=o.split(" ");return(l[0][0]||"")+(((d=l[1])==null?void 0:d[0])||"")};oe(async()=>{h.notifications[r.value.id]=await L.get(`${U}/notifications/${r.value.id}`)});const $=o=>o==="9+"?10:Number(o??0),le=(o,l)=>{const d=h.sidebars[o]||[];l.forEach(v=>{const e=d.findIndex(a=>a.wa_id===v.wa_id);if(e===-1)d.push(v);else{const a=d[e],i=a.ultimo_mensaje_id!==v.ultimo_mensaje_id,_=a.color!==v.color,C=a.nombre!==v.nombre,y=$(v.unreaded)<$(a.unreaded);(i||y||_||C)&&(d[e]=v)}}),h.sidebars[o]=d,E.value=d.reduce((v,e)=>v+$(e.unreaded),0)},Q=async()=>{if(P.value||I.value)return;P.value=!0;const o=`${U}/last-contact-messages/${r.value.id}?limit=${ye}&offset=${F}`,l=await L.get(o,!1);l.length<ye&&(I.value=!0),F+=l.length,le(r.value.id,l),P.value=!1},D=()=>{const o=G.value;if(!o||P.value||I.value)return;o.scrollTop+o.clientHeight>=o.scrollHeight-120&&Q()},ee=o=>{const l=r.value.id,d=h.sidebars[l]||[],v=d.findIndex(e=>e.wa_id===o.wa_id);v!==-1?(d.splice(v,1),h.sidebars[l]=[o,...d]):h.sidebars[l]=[o,...d],E.value=h.sidebars[l].reduce((e,a)=>e+Number(a.unreaded||0),0)};let k=null;const te=()=>{const o=`wss://sockets-service.salchimonster.com/ws/salchimonster-${r.value.id}`;k=new WebSocket(o),k.onopen=()=>console.log("WebSocket conectado a",o),k.onerror=l=>console.error("WebSocket error",l),k.onclose=()=>setTimeout(te,5e3),k.onmessage=async l=>{const d=JSON.parse(l.data);d!=null&&d.user_id&&ee(d)}};let B=null;const ae=()=>{const o=`wss://sockets-service.salchimonster.com/ws/salchimonster-notifications-${r.value.id}`;B=new WebSocket(o),B.onopen=()=>console.log("WebSocket conectado a",o),B.onerror=l=>console.error("WebSocket error",l),B.onclose=()=>setTimeout(ae,5e3),B.onmessage=async l=>{h.notifications[r.value.id]=await L.get(`${U}/notifications/${r.value.id}`),K.value=!0,setTimeout(()=>{K.value=!1},1e3)}};pe(r,async o=>{F=0,I.value=!1,h.sidebars[o.id]=[],k&&k.close(),te(),ae(),await Q(),M.value=!1,setTimeout(()=>{M.value=!0},0)}),oe(async()=>{var o;await Q(),(o=G.value)==null||o.addEventListener("scroll",D),te(),ae()}),ie(()=>{var o;(o=G.value)==null||o.removeEventListener("scroll",D),k&&k.close()});const M=g(!0),se=o=>{T.value=o,M.value=!1,setTimeout(()=>{M.value=!0},0)};return(o,l)=>{var i,_,C,y,O,H;const d=N("RouterLink"),v=N("Dropdown"),e=N("Button"),a=N("ProgressSpinner");return u(),S("div",Oe,[t("div",ze,[t("div",{class:"notifications",style:c([f.value?{height:"80vh",top:"4rem",boxShadow:"0 1rem 1rem #00000040"}:{height:0,overflow:"hidden",top:"-2rem"},{width:"100%","max-width":"20rem","background-color":"#ffffff90","max-height":"80vh",overflow:"auto",padding:"1rem",position:"absolute","z-index":"9",transition:"all linear .2s","border-radius":".5rem",right:"0","backdrop-filter":"blur(5px)",display:"flex","flex-direction":"column",gap:".3rem"}])},[t("h4",{class:"my-3",style:c(n(x).current_chat_theme.text)},Me,4),(u(!0),S(ce,null,de((_=(i=n(h))==null?void 0:i.notifications)==null?void 0:_[r.value.id],(s,A)=>(u(),z(d,{"active-class":n(x).current_chat_theme.name==="dark"?"active":"active-light",key:A,to:`/chat/chats/messages/${r.value.id}/${s.user_info.wa_id}/${(s.user_info.nombre||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^A-Za-z0-9_-]/g,"")||"n"}/${s.user_info.color}?expirado=${s.user_info.expirado}&expira-en=${s.user_info.tiempo_para_expirar}`},{default:m(()=>[t("div",{class:"chat2",onClick:()=>J(s),style:c(s.resolved?"background-color: #fff":"background-color: #b6f8ff59")},[t("div",Fe,[t("div",{style:c([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${s.color||"black"}`])},b(Z(s.user_info.nombre)),5)]),t("div",{style:c([{"grid-area":"nombre"},`${n(x).current_chat_theme.text} ; ${s.resolved?"":"font-weight: bold;"}`])},b(s.description),5),t("span",{style:c([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},n(x).current_chat_theme.text])},b(s.user_info.nombre),5)],12,Ve)]),_:2},1032,["active-class","to"]))),128))],4),p(v,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=s=>r.value=s),options:V,optionLabel:"name",style:c([{"background-color":"#ffffff20",outline:"none","box-shadow":"none"},n(x).current_chat_theme.border])},{option:m(s=>[t("div",Pe,[t("img",{src:s.option.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,Be),t("span",null,[t("b",null,b(s.option.name),1)])])]),value:m(s=>[t("div",We,[s.value?(u(),S("img",{key:0,src:s.value.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,Je)):W("",!0),t("span",{style:c(n(x).current_chat_theme.text)},b(s.value?s.value.name:"Selecciona"),5)])]),_:1},8,["modelValue","style"]),t("div",Ke,[p(e,{class:"options",text:""},{default:m(()=>[t("i",{class:"pi pi-search text-2xl",style:c(n(x).current_chat_theme.text)},null,4)]),_:1}),t("div",qe,[p(e,{class:"options",text:"",style:{opacity:".5"}},{default:m(()=>[t("i",{class:"pi pi-bell text-2xl notifications",onClick:l[1]||(l[1]=s=>f.value=!f.value),style:c(n(x).current_chat_theme.text)},null,4)]),_:1}),t("div",{class:re(K.value?"load":""),style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",position:"absolute",top:"-1rem",right:"-.7rem",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold",padding:".8rem"}},[t("span",Ge,b(((O=(y=(C=n(h))==null?void 0:C.notifications)==null?void 0:y[r.value.id])==null?void 0:O.length)||0),1)],2)]),p(e,{class:"options",text:""},{default:m(()=>[t("i",{class:"pi pi-bars text-2xl",style:c(n(x).current_chat_theme.text)},null,4)]),_:1})])]),t("div",He,[(u(),S(ce,null,de(j,(s,A)=>p(e,{style:c([{"border-radius":".3rem",padding:"0.3rem","text-transform":"capitalize"},s.label===T.value.label?{backgroundColor:s.bg,color:"#fff"}:{backgroundColor:"#ffffff20",color:s.bg}]),text:"",icon:s.icon,key:A,onClick:()=>se(s),class:"status",label:s.label.toLowerCase()},null,8,["icon","onClick","label","style"])),64))]),t("div",{class:re(["",M.value?"chats active-new":"chats"]),ref_key:"chatsContainer",ref:G,onScroll:D},[(u(!0),S(ce,null,de(((H=n(h).sidebars[r.value.id])==null?void 0:H.filter(s=>T.value.label==="TODO"?!0:T.value.label==="SIN LEER"?s.unreaded>0:T.value.label==="LEIDOS"?s.unreaded==0:s.clasification===T.value.label))||[],(s,A)=>(u(),z(d,{"active-class":n(x).current_chat_theme.name=="dark"?"active":"active-light",key:A,to:`/chat/chats/messages/${r.value.id}/${s.wa_id}/${s.nombre}/${s.color}?expirado=${s.expirado}&?expira-en?=${s.tiempo_para_expirar}`},{default:m(()=>[t("div",{class:"chat",onClick:()=>q(s)},[t("div",Ye,[t("div",{style:c([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${s.color||"black"}`])},b(Z(s.nombre)),5)]),t("div",{style:c([{"grid-area":"nombre","text-transform":"capitalize"},n(x).current_chat_theme.text])},b(s.nombre),5),s.tiempo_para_expirar||!s.expirado?(u(),S("div",{key:0,style:c([{"grid-area":"expiration","text-align":"end","text-transform":"capitalize",opacity:".5"},n(x).current_chat_theme.text])}," Expira en "+b(s.tiempo_para_expirar),5)):(u(),S("div",{key:1,style:c([{"grid-area":"expiration","text-align":"end","text-transform":"capitalize",opacity:".5"},n(x).current_chat_theme.text])}," Expirado ",4)),t("span",{style:c([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},n(x).current_chat_theme.text])},b(s.mensaje_truncado),5),t("span",{style:c([{"grid-area":"fecha","text-align":"end"},n(x).current_chat_theme.text])},b(s.abreviatura||s.fecha_ultimo_mensaje),5),t("div",Ze,[s.unreaded>0?(u(),S("div",Qe,[t("span",et,b(s.unreaded),1)])):W("",!0),tt])],8,Xe)]),_:2},1032,["active-class","to"]))),128)),P.value?(u(),S("div",at,[(u(),z(a,{key:0,style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".3s","aria-label":"Custom ProgressSpinner"}))])):W("",!0),I.value?(u(),S("div",st,"No hay más chats.")):W("",!0)],34)])}}}),be=me(ot,[["__scopeId","data-v-2c683e71"]]),Ee=R=>(ke("data-v-5ca3d81f"),R=R(),we(),R),it={class:"top-bar-left"},nt={style:{height:"3rem",width:"3rem",display:"flex","align-items":"center"}},rt={class:"top-bar-info"},lt={style:{display:"flex","align-items":"center",gap:"1rem"}},ct={style:{height:"100%",overflow:"auto"}},dt={key:1,style:{display:"flex","justify-content":"center","align-items":"center",height:"100%"}},ut={class:"message-area"},pt=Ee(()=>t("i",{class:"fas fa-laugh-wink emoji-picker"},null,-1)),mt=["onKeydown"],ft=["src"],_t={style:{position:"relative",transition:".2s"}},ht=Ee(()=>t("i",{class:"pi pi-send text-2xl"},null,-1)),gt={style:{display:"flex",gap:"1rem"}},vt={class:"flex gap-2"},yt={style:{width:"100%",display:"flex","justify-content":"end"}},bt=xe({__name:"Main",setup(R){const f=fe();function K(e){return{APPROVED:"success",PENDING:"warning",REJECTED:"danger"}[e]||"info"}const Y=e=>{x(e),V.value=!1};async function x(e){const a=e,i=new FormData;i.append("messaging_product","whatsapp"),i.append("employer_id",q.rawUserData.id.toString()),i.append("context_message_id",""),i.append("restaurant_id",r.params.restaurant_id),i.append("to",r.params.user_id),i.append("type","template"),i.append("template",JSON.stringify(a));try{$.sending=!0,await L.post(`${U}/webhook/send/template/`,i,!1),console.log(`✅ Template enviado a ${to}`)}catch(_){console.error(`✗ Error al enviar template a ${to}`,_)}finally{$.sending=!1}}const ne=g([{}]),h=e=>{e.target.closest(".emoji-picker")||(J.value=!1)};oe(()=>{document.addEventListener("click",h),v()}),ie(()=>{document.removeEventListener("click",h)});const V=g(!1);g([]);const r=Te(),q=Le(),J=g(!1),j=g(""),T=g(!1),E=g(null),F=g(!1),P=g(!0),I=De(()=>{var e,a;return P.value&&(((e=r.query)==null?void 0:e.expirado)==="true"||((a=r.query)==null?void 0:a.expirado)===!0)}),G=e=>{P.value=e};pe(()=>{var e;return(e=r.params)==null?void 0:e.restaurant_id},()=>{v()}),pe(I,e=>{j.value=e?"Conversación expirada":""},{immediate:!0});const Z={"SIN DATOS":{bg:"#7f8c8d",icon:"fa-circle-question"},PREOCUPANTE:{bg:"#e74c3c",icon:"fa-triangle-exclamation"},CASUAL:{bg:"#e67e22",icon:"fa-person-walking"},FRECUENTE:{bg:"#27ae60",icon:"fa-repeat"},TOP:{bg:"#2980b9",icon:"fa-ranking-star"},ESTRELLA:{bg:"#8e44ad",icon:"fa-star"}},$=$e();g([{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}]);const le=(e="")=>{const a=e.trim().split(" ");return(Array.from(a[0]||"")[0]||"")+(a[1]?Array.from(a[1])[0]:"")},Q=e=>{j.value+=e.i,J.value=!1};let D=null,ee=[],k=null;const te=async()=>{if(T.value&&D){D.stop();return}try{k=await navigator.mediaDevices.getUserMedia({audio:!0});const e=MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")?"audio/ogg;codecs=opus":"audio/webm;codecs=opus";D=new MediaRecorder(k,{mimeType:e}),D.ondataavailable=a=>a.data.size&&ee.push(a.data),D.onstop=()=>{const a=new Blob(ee,{type:e.split(";")[0]});ee=[],k.getTracks().forEach(_=>_.stop());const i=e.startsWith("audio/ogg")?"ogg":"webm";E.value={file:new File([a],`audio_${Date.now()}.${i}`,{type:a.type}),url:URL.createObjectURL(a)},T.value=!1},D.start(),T.value=!0}catch(e){console.error("No se pudo abrir el micrófono:",e.name,e.message),T.value=!1,k&&k.getTracks().forEach(a=>a.stop())}},B=()=>{E.value&&URL.revokeObjectURL(E.value.url),E.value=null};ie(()=>{D&&T.value&&D.stop(),k&&k.getTracks().forEach(e=>e.stop())});const ae={messaging_product:"whatsapp",employer_id:q.rawUserData.id,context_message_id:null},M=async(e,a=null)=>{var _,C;if(I.value||!e.trim())return;const i=new FormData;i.append("messaging_product","whatsapp"),i.append("employer_id",q.rawUserData.id),i.append("context_message_id",((_=a==null?void 0:a.message_data)==null?void 0:_.wa_id)||null),i.append("restaurant_id",(C=r.params.restaurant_id)==null?void 0:C.toString()),i.append("to",r.params.user_id),i.append("type","text"),i.append("text",JSON.stringify({body:e})),j.value="";try{$.sending=!0,await L.post(`${U}/webhook/send/text/`,i,!1)}catch(y){console.error("Error al enviar texto",y)}$.sending=!1},se=async()=>{var _;if(I.value||!E.value||F.value)return;const e=E.value;B(),F.value=!0;const a=new FormData;a.append("files",e.file);const i={...ae,restaurant_id:(_=r.params.restaurant_id)==null?void 0:_.toString(),to:r.params.user_id,type:"audio",text:{body:""},file_index:0};a.append("payloads",JSON.stringify(i));try{await L.post(`${U}/webhook/send`,a,!1)}catch(C){console.error("Error al enviar audio",C)}F.value=!1},o=async e=>{var C;if(I.value||!(e!=null&&e.length))return;const a=new FormData,i={restaurant_id:(C=r.params.restaurant_id)==null?void 0:C.toString(),to:r.params.user_id,messaging_product:"whatsapp",employer_id:q.rawUserData.id,context_message_id:null},_=y=>{var A;const{type:O,name:H}=y;if(O.startsWith("image/"))return"image";if(O.startsWith("audio/"))return"audio";if(O.startsWith("video/"))return"video";if(O==="application/pdf")return"document";const s=(A=H.split(".").pop())==null?void 0:A.toLowerCase();return["jpg","jpeg","png","webp"].includes(s)?"image":["mp3","wav","ogg","opus"].includes(s)?"audio":"document"};e.forEach((y,O)=>{a.append("files",y.file),a.append("payloads",JSON.stringify({...i,type:_(y.file),text:{body:y.caption||""},file_index:O}))}),$.sending=!0;try{await L.post(`${U}/webhook/send`,a,!1)}catch(y){console.error("Error al enviar archivos",y)}$.sending=!1},l=e=>{e.key==="Enter"&&(e.preventDefault(),j.value.trim()&&M(j.value))},d=e=>{e.key==="Enter"&&E.value&&(e.preventDefault(),se())};oe(()=>window.addEventListener("keydown",d)),ie(()=>window.removeEventListener("keydown",d));async function v(){if(r.params.restaurant_id){const a=(await L.get(`${Ne}/restaurants`)||[]).find(i=>{var _;return i.id==((_=r.params)==null?void 0:_.restaurant_id)})||null;a&&(ne.value=await L.get(`${U}/wabas/${a.waba_id}/templates/`))}}return(e,a)=>{var _e,he,ge;const i=N("Button"),_=N("RouterView"),C=N("Textarea"),y=N("Column"),O=N("Tag"),H=N("DataTable"),s=N("RouterLink"),A=N("Dialog");return u(),S("div",{class:"main-container",style:c([n(f).current_chat_theme.bg_image,{}])},[t("div",{class:"top-bar",style:c([{"border-radius":".5rem",gap:"1rem"},n(f).current_chat_theme.bg_bars])},[t("div",it,[t("div",nt,[t("div",{class:"cliente-img",style:c([`background-color:${n(r).params.color}`,{height:"100%",color:"white",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"}])},b(le(n(r).params.user_name)),5)]),t("div",rt,[t("strong",null,[t("h5",{style:c([{"text-transform":"capitalize",margin:"0"},n(f).current_chat_theme.text])},b((_e=n(r).params.user_name)==null?void 0:_e.substring(0,20)),5)]),t("div",null,[n($).current_user.clasification?(u(),z(i,{key:0,style:c({height:"2.3rem",display:"flex",alignItems:"center",textTransform:"capitalize",gap:"0.35rem",backgroundColor:((he=Z[n($).current_user.clasification])==null?void 0:he.bg)||"#7f8c8d",color:"#fff"})},{default:m(()=>{var w,X;return[t("i",{class:re(["fa-solid",(w=Z[n($).current_user.clasification])==null?void 0:w.icon]),"aria-hidden":"true",style:{"font-size":"0.9rem"}},null,2),ue(" "+b((X=n($).current_user.clasification)==null?void 0:X.toLowerCase())+" "+b(n($).current_user.times_purchased)+" compras ",1)]}),_:1},8,["style"])):W("",!0)])])]),t("div",lt,[p(i,{icon:"pi pi-shopping-cart",class:"p-2",style:{color:"white","min-width":"max-content"},severity:"warning",label:"Ing. Ped"}),p(i,{text:"",class:"p-2"},{default:m(()=>[t("i",{style:c(n(f).current_chat_theme.text),class:"pi pi-search text-2xl"},null,4)]),_:1}),p(i,{text:"",class:"p-2"},{default:m(()=>[t("i",{style:c(n(f).current_chat_theme.text),class:"pi pi-bars text-2xl"},null,4)]),_:1})])],4),t("div",ct,[p(_,null,{default:m(()=>[n(r).params.user_id?(u(),z(Ie,{key:0,send_function:o,send_text:M,change_expiration:G,ref:"Messages_element"},null,512)):(u(),S("div",dt,[t("h2",{style:c([{color:"white","font-size":"3rem",opacity:".5"},n(f).current_chat_theme.text])},"Selecciona un chat...",4)]))]),_:1})]),(ge=n(r).params)!=null&&ge.user_id?(u(),S("div",{key:0,class:"chat-bar",tabindex:"0",style:c(n(f).current_chat_theme.bg_bars)},[J.value?(u(),z(n(je),{key:0,native:!0,style:{position:"absolute",bottom:"4rem","z-index":"1000"},onSelect:Q,class:"emoji-picker"})):W("",!0),t("div",ut,[p(i,{text:"",style:{"font-size":"2rem"},onClick:a[0]||(a[0]=w=>J.value=!J.value)},{default:m(()=>[pt]),_:1}),E.value?(u(),S("div",{key:1,class:"audio-chip",onKeydown:Ue(Re(se,["prevent"]),["enter"])},[t("audio",{style:{width:"100%","min-width":"28rem","max-width":"42rem"},src:E.value.url,controls:""},null,8,ft),p(i,{text:"",class:"btn-audio-trash p-2",onClick:B},{default:m(()=>[t("i",{style:c(n(f).current_chat_theme.text),class:"pi pi-trash text-2xl p-0"},null,4)]),_:1})],40,mt)):(u(),z(C,{key:0,modelValue:j.value,"onUpdate:modelValue":a[1]||(a[1]=w=>j.value=w),autoResize:"",class:"message",disabled:I.value,onKeydown:l,style:c(`${n(f).current_chat_theme.text} ; ${n(f).current_chat_theme.border} `)},null,8,["modelValue","disabled","style"]))]),t("div",_t,[!E.value&&j.value.trim()===""?(u(),z(i,{key:0,text:"",style:{height:"100%"},onClick:te},{default:m(()=>[t("i",{style:c(n(f).current_chat_theme.text),class:re(T.value?"pi pi-stop text-2xl text-red-500":"pi pi-microphone text-2xl ")},null,6)]),_:1})):E.value?(u(),z(i,{key:1,disabled:F.value,text:"",onClick:se},{default:m(()=>[t("i",{style:c(n(f).current_chat_theme.text),class:"pi pi-send text-2xl"},null,4)]),_:1},8,["disabled"])):(u(),z(i,{key:2,style:c(n(f).current_chat_theme.text),text:"",onClick:a[2]||(a[2]=w=>M(j.value))},{default:m(()=>[ht]),_:1},8,["style"]))]),t("div",gt,[p(i,{severity:"danger",style:{},icon:"pi pi-clock",class:"p-2",onClick:a[3]||(a[3]=()=>V.value=!0)}),n(r).query.expirado?(u(),z(i,{key:0,icon:"pi pi-bolt",severity:"warning",style:{},class:"p-2",onClick:a[4]||(a[4]=()=>V.value=!0)})):W("",!0)])],4)):W("",!0),p(A,{visible:V.value,"onUpdate:visible":a[5]||(a[5]=w=>V.value=w),header:"Envio de plantilla",style:{width:"50rem"}},{default:m(()=>[p(H,{value:ne.value,dataKey:"id",paginator:"",rows:10,responsiveLayout:"scroll",class:"shadow-md rounded-xl overflow-hidden"},{default:m(()=>[p(y,{class:"my-1 py-1",field:"name",header:"Nombre",bodyClass:"font-medium"}),p(y,{class:"my-1 py-1",header:"Estado"},{body:m(({data:w})=>[p(O,{severity:K(w.status)},{default:m(()=>[ue(b(w.status),1)]),_:2},1032,["severity"])]),_:1}),p(y,{class:"my-1 py-1",header:"Estado"},{body:m(({data:w})=>{var X,ve;return[ue(b((ve=(X=w==null?void 0:w.components)==null?void 0:X.find(Ce=>Ce.type=="BODY"))==null?void 0:ve.text),1)]}),_:1}),p(y,{class:"my-1 py-1",headerStyle:"width:8rem",header:"Acciones"},{body:m(({data:w})=>[t("div",vt,[p(i,{icon:"pi pi-send",label:"Enviar",severity:"help",onClick:X=>Y(w)},null,8,["onClick"])])]),_:1})]),_:1},8,["value"]),t("div",yt,[p(s,{to:"/chat/templates"},{default:m(()=>[p(i,{severity:"help",icon:"pi pi-plus",label:"Agregar otro"})]),_:1})])]),_:1},8,["visible"])],4)}}}),xt=me(bt,[["__scopeId","data-v-5ca3d81f"]]);const kt={__name:"chats",setup(R){const f=fe();return(K,Y)=>(u(),S("div",{class:"chat-container",style:c(n(f).current_chat_theme.bg)},[p(be,{style:{"box-shadow":".5rem 0 1rem #00000010"},class:"sidebar-left",restaurant:{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}}),p(xt),p(be,{style:{"box-shadow":"-.5rem 0 1rem #00000010"},class:"sidebar-right",restaurant:{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}})],4))}},Ct=me(kt,[["__scopeId","data-v-5877f5bf"]]);export{Ct as default};
