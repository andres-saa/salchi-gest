import{H as xe,h as g,i as oe,I as ie,j as L,J as U,D as pe,g as N,o as p,c as T,a as t,n as c,u as r,F as ce,r as de,d as A,e as m,t as b,f as u,k as W,b as re,p as we,m as ke,_ as me,C as Te,l as Le,G as De,U as Ne,q as ue,K as Ue,L as Re}from"./index-e15a18ee.js";import{c as fe,u as $e,P as je}from"./Messages.vue_vue_type_style_index_0_scoped_09e7a26a_lang-98560f25.js";/* empty css                                                             */import Ie from"./Messages-e6c3d0ef.js";const Se=R=>(we("data-v-529c77b4"),R=R(),ke(),R),Oe={class:"sidebar-container",style:{position:"relative"}},Ae={class:"header"},ze=Se(()=>t("strong",null," Notificaciones ",-1)),Me=[ze],Ve=["onClick"],Fe={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},Pe={class:"flex align-items-center"},Be=["src"],We={class:"flex align-items-center"},Je=["src"],Ke={style:{display:"flex",gap:"1rem"}},qe={style:{color:"white"}},Ge={class:"statuses"},He=["onClick"],Xe={class:"avatar",style:{"grid-area":"imagen",height:"100%",width:"100%",display:"flex","align-items":"center"}},Ye={style:{"grid-area":"check",display:"flex","justify-content":"end",gap:".5rem"}},Ze={key:0,style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold"}},Qe={style:{color:"white"}},et=Se(()=>t("i",{style:{color:"greenyellow"},class:"fa-solid fa-check-double"},null,-1)),tt={key:0,style:{bottom:"0","padding-bottom":"1rem",background:"linear-gradient(to bottom , transparent 3%, black)",display:"flex",position:"absolute","z-index":"100",width:"100%",color:"white"}},at={key:1,style:{"text-align":"center",padding:".5rem",color:"#ffffff80"}},ye=1e3,st=xe({__name:"Sidebar",props:{restaurant:Object},setup(R){const f=g(!1),K=g(!1),Y=o=>{o.target.closest(".notifications")||(f.value=!1)};oe(()=>{document.addEventListener("click",Y)}),ie(()=>{document.removeEventListener("click",Y)});const k=fe(),ne=R,h=$e(),V=[{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}],i=g(ne.restaurant||V[0]);g([{label:"Todos",textColor:"#4CAF50"},{label:"Sin leer",textColor:"#2196F3"},{label:"Favoritos",textColor:"#FFC107"},{label:"Preocupantes",textColor:"#F44336"},{label:"Top",textColor:"#9C27B0"}]);const q=async o=>{h.current_user=o,f.value=!1;try{await L.post(`${U}/read-message/${o.user_id}/${i.value.id}`,!1)}catch(l){console.error("No se pudo marcar como leído",l)}o.unreaded=0},J=async o=>{var l;h.current_user=o.user_info,f.value=!1;try{await L.post(`${U}/read-message/${o.user_info.user_id}/${i.value.id}`,!1),await L.post(`${U}/view_notification/${o.id}`,!1),h.notifications[i.value.id]=await L.get(`${U}/notifications/${i.value.id}`);const d=(l=h.sidebars[i.value.id])==null?void 0:l.findIndex(v=>v.user_id==o.user_info.user_id);console.log(d),d!==-1&&(h.sidebars[i.value.id][d].unreaded=0)}catch(d){console.error("No se pudo marcar como leído",d)}},j=[{label:"SIN LEER",bg:"#f39c12",icon:"fa-solid fa-envelope-open"},{label:"LEIDOS",bg:"#16a085",icon:"fa-solid fa-envelope-circle-check"},{label:"TODO",bg:"#34495e",icon:"fa-solid fa-inbox"},{label:"SIN DATOS",bg:"#95a5a6",icon:"fa-solid fa-circle-question"},{label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-solid fa-triangle-exclamation"},{label:"CASUAL",bg:"#e67e22",icon:"fa-solid fa-person-walking"},{label:"FRECUENTE",bg:"#27ae60",icon:"fa-solid fa-repeat"},{label:"TOP",bg:"#2980b9",icon:"fa-solid fa-ranking-star"},{label:"ESTRELLA",bg:"#8e44ad",icon:"fa-solid fa-star"}],C=g({label:"SIN LEER",bg:"#f39c12",icon:"fa-solid fa-envelope-open"}),S=g(0);let F=0;const P=g(!1),I=g(!1),G=g(null),Z=o=>{var d;if(!o)return"";const l=o.split(" ");return(l[0][0]||"")+(((d=l[1])==null?void 0:d[0])||"")};oe(async()=>{h.notifications[i.value.id]=await L.get(`${U}/notifications/${i.value.id}`)});const $=o=>o==="9+"?10:Number(o??0),le=(o,l)=>{const d=h.sidebars[o]||[];l.forEach(v=>{const e=d.findIndex(a=>a.wa_id===v.wa_id);if(e===-1)d.push(v);else{const a=d[e],n=a.ultimo_mensaje_id!==v.ultimo_mensaje_id,_=a.color!==v.color,E=a.nombre!==v.nombre,y=$(v.unreaded)<$(a.unreaded);(n||y||_||E)&&(d[e]=v)}}),h.sidebars[o]=d,S.value=d.reduce((v,e)=>v+$(e.unreaded),0)},Q=async()=>{if(P.value||I.value)return;P.value=!0;const o=`${U}/last-contact-messages/${i.value.id}?limit=${ye}&offset=${F}`,l=await L.get(o,!1);l.length<ye&&(I.value=!0),F+=l.length,le(i.value.id,l),P.value=!1},D=()=>{const o=G.value;if(!o||P.value||I.value)return;o.scrollTop+o.clientHeight>=o.scrollHeight-120&&Q()},ee=o=>{const l=i.value.id,d=h.sidebars[l]||[],v=d.findIndex(e=>e.wa_id===o.wa_id);v!==-1?(d.splice(v,1),h.sidebars[l]=[o,...d]):h.sidebars[l]=[o,...d],S.value=h.sidebars[l].reduce((e,a)=>e+Number(a.unreaded||0),0)};let x=null;const te=()=>{const o=`wss://sockets-service.salchimonster.com/ws/salchimonster-${i.value.id}`;x=new WebSocket(o),x.onopen=()=>console.log("WebSocket conectado a",o),x.onerror=l=>console.error("WebSocket error",l),x.onclose=()=>setTimeout(te,5e3),x.onmessage=async l=>{const d=JSON.parse(l.data);d!=null&&d.user_id&&ee(d)}};let B=null;const ae=()=>{const o=`wss://sockets-service.salchimonster.com/ws/salchimonster-notifications-${i.value.id}`;B=new WebSocket(o),B.onopen=()=>console.log("WebSocket conectado a",o),B.onerror=l=>console.error("WebSocket error",l),B.onclose=()=>setTimeout(ae,5e3),B.onmessage=async l=>{h.notifications[i.value.id]=await L.get(`${U}/notifications/${i.value.id}`),K.value=!0,setTimeout(()=>{K.value=!1},1e3)}};pe(i,async o=>{F=0,I.value=!1,h.sidebars[o.id]=[],x&&x.close(),te(),ae(),await Q(),M.value=!1,setTimeout(()=>{M.value=!0},0)}),oe(async()=>{var o;await Q(),(o=G.value)==null||o.addEventListener("scroll",D),te(),ae()}),ie(()=>{var o;(o=G.value)==null||o.removeEventListener("scroll",D),x&&x.close()});const M=g(!0),se=o=>{C.value=o,M.value=!1,setTimeout(()=>{M.value=!0},0)};return(o,l)=>{var n,_,E,y,O,H;const d=N("RouterLink"),v=N("Dropdown"),e=N("Button"),a=N("ProgressSpinner");return p(),T("div",Oe,[t("div",Ae,[t("div",{class:"notifications",style:c([f.value?{height:"80vh",top:"4rem",boxShadow:"0 1rem 1rem #00000040"}:{height:0,overflow:"hidden",top:"-2rem"},{width:"100%","max-width":"20rem","background-color":"#ffffff90","max-height":"80vh",overflow:"auto",padding:"1rem",position:"absolute","z-index":"9",transition:"all linear .2s","border-radius":".5rem",right:"0","backdrop-filter":"blur(5px)",display:"flex","flex-direction":"column",gap:".3rem"}])},[t("h4",{class:"my-3",style:c(r(k).current_chat_theme.text)},Me,4),(p(!0),T(ce,null,de((_=(n=r(h))==null?void 0:n.notifications)==null?void 0:_[i.value.id],(s,z)=>(p(),A(d,{"active-class":r(k).current_chat_theme.name==="dark"?"active":"active-light",key:z,to:`/chat/chats/messages/${i.value.id}/${s.user_info.wa_id}/${(s.user_info.nombre||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^A-Za-z0-9_-]/g,"")||"n"}/${s.user_info.color}?expirado=${s.user_info.expirado}&expira-en=${s.user_info.tiempo_para_expirar}`},{default:m(()=>[t("div",{class:"chat2",onClick:()=>J(s),style:c(s.resolved?"background-color: #fff":"background-color: #b6f8ff59")},[t("div",Fe,[t("div",{style:c([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${s.color||"black"}`])},b(Z(s.user_info.nombre)),5)]),t("div",{style:c([{"grid-area":"nombre"},`${r(k).current_chat_theme.text} ; ${s.resolved?"":"font-weight: bold;"}`])},b(s.description),5),t("span",{style:c([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},r(k).current_chat_theme.text])},b(s.user_info.nombre),5)],12,Ve)]),_:2},1032,["active-class","to"]))),128))],4),u(v,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=s=>i.value=s),options:V,optionLabel:"name",style:c([{"background-color":"#ffffff20",outline:"none","box-shadow":"none"},r(k).current_chat_theme.border])},{option:m(s=>[t("div",Pe,[t("img",{src:s.option.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,Be),t("span",null,[t("b",null,b(s.option.name),1)])])]),value:m(s=>[t("div",We,[s.value?(p(),T("img",{key:0,src:s.value.img,alt:"Logo",style:{width:"24px",height:"24px","margin-right":"8px","object-fit":"contain"}},null,8,Je)):W("",!0),t("span",{style:c(r(k).current_chat_theme.text)},b(s.value?s.value.name:"Selecciona"),5)])]),_:1},8,["modelValue","style"]),t("div",Ke,[u(e,{class:"options",text:""},{default:m(()=>[t("i",{class:"pi pi-search text-2xl",style:c(r(k).current_chat_theme.text)},null,4)]),_:1}),t("div",{class:"notifications",style:{position:"relative",cursor:"pointer"},onClick:l[1]||(l[1]=s=>f.value=!f.value)},[u(e,{class:"options",text:"",style:{opacity:".5"}},{default:m(()=>[t("i",{class:"pi pi-bell text-2xl notifications",style:c(r(k).current_chat_theme.text)},null,4)]),_:1}),t("div",{class:re(K.value?"load":""),style:{height:"1.5rem",width:"1.5rem","border-radius":"50%","background-color":"rgb(156,39,176)",position:"absolute",top:"-1rem",right:"-.7rem",display:"flex","align-items":"center","justify-content":"center","font-weight":"bold",padding:".8rem"}},[t("span",qe,b(((O=(y=(E=r(h))==null?void 0:E.notifications)==null?void 0:y[i.value.id])==null?void 0:O.length)||0),1)],2)]),u(e,{class:"options",text:""},{default:m(()=>[t("i",{class:"pi pi-bars text-2xl",style:c(r(k).current_chat_theme.text)},null,4)]),_:1})])]),t("div",Ge,[(p(),T(ce,null,de(j,(s,z)=>u(e,{style:c([{"border-radius":".3rem",padding:"0.3rem","text-transform":"capitalize"},s.label===C.value.label?{backgroundColor:s.bg,color:"#fff"}:{backgroundColor:"#ffffff20",color:s.bg}]),text:"",icon:s.icon,key:z,onClick:()=>se(s),class:"status",label:s.label.toLowerCase()},null,8,["icon","onClick","label","style"])),64))]),t("div",{class:re(["",M.value?"chats active-new":"chats"]),ref_key:"chatsContainer",ref:G,onScroll:D},[(p(!0),T(ce,null,de(((H=r(h).sidebars[i.value.id])==null?void 0:H.filter(s=>C.value.label==="TODO"?!0:C.value.label==="SIN LEER"?s.unreaded>0:C.value.label==="LEIDOS"?s.unreaded==0:s.clasification===C.value.label))||[],(s,z)=>(p(),A(d,{"active-class":r(k).current_chat_theme.name=="dark"?"active":"active-light",key:z,to:`/chat/chats/messages/${i.value.id}/${s.wa_id}/${s.nombre}/${s.color}?expirado=${s.expirado}&?expira-en?=${s.tiempo_para_expirar}`},{default:m(()=>[t("div",{class:"chat",onClick:()=>q(s)},[t("div",Xe,[t("div",{style:c([{height:"3rem",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"},`background-color:${s.color||"black"}`])},b(Z(s.nombre)),5)]),t("div",{style:c([{"grid-area":"nombre","text-transform":"capitalize","font-weight":"500"},r(k).current_chat_theme.text])},b(s.nombre),5),t("div",{style:c([{"grid-area":"numero","text-transform":"capitalize",opacity:".7"},r(k).current_chat_theme.text])},"+"+b(s.wa_id),5),t("span",{style:c([{"grid-area":"mensaje",color:"#ffffff80",opacity:".5"},r(k).current_chat_theme.text])},b(s.mensaje_truncado),5),t("span",{style:c([{"grid-area":"fecha","text-align":"end"},r(k).current_chat_theme.text])},b(s.abreviatura||s.fecha_ultimo_mensaje),5),t("div",Ye,[s.unreaded>0?(p(),T("div",Ze,[t("span",Qe,b(s.unreaded),1)])):W("",!0),et])],8,He)]),_:2},1032,["active-class","to"]))),128)),P.value?(p(),T("div",tt,[(p(),A(a,{key:0,style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".3s","aria-label":"Custom ProgressSpinner"}))])):W("",!0),I.value?(p(),T("div",at,"No hay más chats.")):W("",!0)],34)])}}}),be=me(st,[["__scopeId","data-v-529c77b4"]]),Ee=R=>(we("data-v-aa100914"),R=R(),ke(),R),ot={class:"top-bar-left"},it={style:{height:"3rem",width:"3rem",display:"flex","align-items":"center"}},nt={class:"top-bar-info"},rt={style:{display:"flex","flex-direction":"column"}},lt={style:{display:"flex","align-items":"center",gap:"1rem"}},ct={style:{height:"100%",overflow:"auto"}},dt={key:1,style:{display:"flex","justify-content":"center","align-items":"center",height:"100%"}},ut={class:"message-area"},pt=Ee(()=>t("i",{class:"fas fa-laugh-wink emoji-picker"},null,-1)),mt=["onKeydown"],ft=["src"],_t={style:{position:"relative",transition:".2s"}},ht=Ee(()=>t("i",{class:"pi pi-send text-2xl"},null,-1)),gt={style:{display:"flex",gap:"1rem"}},vt={class:"flex gap-2"},yt={style:{width:"100%",display:"flex","justify-content":"end"}},bt=xe({__name:"Main",setup(R){const f=fe();function K(e){return{APPROVED:"success",PENDING:"warning",REJECTED:"danger"}[e]||"info"}const Y=e=>{k(e),V.value=!1};async function k(e){const a=e,n=new FormData;n.append("messaging_product","whatsapp"),n.append("employer_id",q.rawUserData.id.toString()),n.append("context_message_id",""),n.append("restaurant_id",i.params.restaurant_id),n.append("to",i.params.user_id),n.append("type","template"),n.append("template",JSON.stringify(a));try{$.sending=!0,await L.post(`${U}/webhook/send/template/`,n,!1),console.log(`✅ Template enviado a ${to}`)}catch(_){console.error(`✗ Error al enviar template a ${to}`,_)}finally{$.sending=!1}}const ne=g([{}]),h=e=>{e.target.closest(".emoji-picker")||(J.value=!1)};oe(()=>{document.addEventListener("click",h),v()}),ie(()=>{document.removeEventListener("click",h)});const V=g(!1);g([]);const i=Te(),q=Le(),J=g(!1),j=g(""),C=g(!1),S=g(null),F=g(!1),P=g(!0),I=De(()=>{var e,a;return P.value&&(((e=i.query)==null?void 0:e.expirado)==="true"||((a=i.query)==null?void 0:a.expirado)===!0)}),G=e=>{P.value=e};pe(()=>{var e;return(e=i.params)==null?void 0:e.restaurant_id},()=>{v()}),pe(I,e=>{j.value=e?"Conversación expirada":""},{immediate:!0});const Z={"SIN DATOS":{bg:"#7f8c8d",icon:"fa-circle-question"},PREOCUPANTE:{bg:"#e74c3c",icon:"fa-triangle-exclamation"},CASUAL:{bg:"#e67e22",icon:"fa-person-walking"},FRECUENTE:{bg:"#27ae60",icon:"fa-repeat"},TOP:{bg:"#2980b9",icon:"fa-ranking-star"},ESTRELLA:{bg:"#8e44ad",icon:"fa-star"}},$=$e();g([{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"},{id:7,name:"Distrimoster",img:"https://backend.salchimonster.com/read-photo-product/iX6UiE6e"}]);const le=(e="")=>{const a=e.trim().split(" ");return(Array.from(a[0]||"")[0]||"")+(a[1]?Array.from(a[1])[0]:"")},Q=e=>{j.value+=e.i,J.value=!1};let D=null,ee=[],x=null;const te=async()=>{if(C.value&&D){D.stop();return}try{x=await navigator.mediaDevices.getUserMedia({audio:!0});const e=MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")?"audio/ogg;codecs=opus":"audio/webm;codecs=opus";D=new MediaRecorder(x,{mimeType:e}),D.ondataavailable=a=>a.data.size&&ee.push(a.data),D.onstop=()=>{const a=new Blob(ee,{type:e.split(";")[0]});ee=[],x.getTracks().forEach(_=>_.stop());const n=e.startsWith("audio/ogg")?"ogg":"webm";S.value={file:new File([a],`audio_${Date.now()}.${n}`,{type:a.type}),url:URL.createObjectURL(a)},C.value=!1},D.start(),C.value=!0}catch(e){console.error("No se pudo abrir el micrófono:",e.name,e.message),C.value=!1,x&&x.getTracks().forEach(a=>a.stop())}},B=()=>{S.value&&URL.revokeObjectURL(S.value.url),S.value=null};ie(()=>{D&&C.value&&D.stop(),x&&x.getTracks().forEach(e=>e.stop())});const ae={messaging_product:"whatsapp",employer_id:q.rawUserData.id,context_message_id:null},M=async(e,a=null)=>{var _,E;if(I.value||!e.trim())return;const n=new FormData;n.append("messaging_product","whatsapp"),n.append("employer_id",q.rawUserData.id),n.append("context_message_id",((_=a==null?void 0:a.message_data)==null?void 0:_.wa_id)||null),n.append("restaurant_id",(E=i.params.restaurant_id)==null?void 0:E.toString()),n.append("to",i.params.user_id),n.append("type","text"),n.append("text",JSON.stringify({body:e})),j.value="";try{$.sending=!0,await L.post(`${U}/webhook/send/text/`,n,!1)}catch(y){console.error("Error al enviar texto",y)}$.sending=!1},se=async()=>{var _;if(I.value||!S.value||F.value)return;const e=S.value;B(),F.value=!0;const a=new FormData;a.append("files",e.file);const n={...ae,restaurant_id:(_=i.params.restaurant_id)==null?void 0:_.toString(),to:i.params.user_id,type:"audio",text:{body:""},file_index:0};a.append("payloads",JSON.stringify(n));try{await L.post(`${U}/webhook/send`,a,!1)}catch(E){console.error("Error al enviar audio",E)}F.value=!1},o=async e=>{var E;if(I.value||!(e!=null&&e.length))return;const a=new FormData,n={restaurant_id:(E=i.params.restaurant_id)==null?void 0:E.toString(),to:i.params.user_id,messaging_product:"whatsapp",employer_id:q.rawUserData.id,context_message_id:null},_=y=>{var z;const{type:O,name:H}=y;if(O.startsWith("image/"))return"image";if(O.startsWith("audio/"))return"audio";if(O.startsWith("video/"))return"video";if(O==="application/pdf")return"document";const s=(z=H.split(".").pop())==null?void 0:z.toLowerCase();return["jpg","jpeg","png","webp"].includes(s)?"image":["mp3","wav","ogg","opus"].includes(s)?"audio":"document"};e.forEach((y,O)=>{a.append("files",y.file),a.append("payloads",JSON.stringify({...n,type:_(y.file),text:{body:y.caption||""},file_index:O}))}),$.sending=!0;try{await L.post(`${U}/webhook/send`,a,!1)}catch(y){console.error("Error al enviar archivos",y)}$.sending=!1},l=e=>{e.key==="Enter"&&(e.preventDefault(),j.value.trim()&&M(j.value))},d=e=>{e.key==="Enter"&&S.value&&(e.preventDefault(),se())};oe(()=>window.addEventListener("keydown",d)),ie(()=>window.removeEventListener("keydown",d));async function v(){if(i.params.restaurant_id){const a=(await L.get(`${Ne}/restaurants`)||[]).find(n=>{var _;return n.id==((_=i.params)==null?void 0:_.restaurant_id)})||null;a&&(ne.value=await L.get(`${U}/wabas/${a.waba_id}/templates/`))}}return(e,a)=>{var _e,he,ge;const n=N("Button"),_=N("RouterView"),E=N("Textarea"),y=N("Column"),O=N("Tag"),H=N("DataTable"),s=N("RouterLink"),z=N("Dialog");return p(),T("div",{class:"main-container",style:c([r(f).current_chat_theme.bg_image,{}])},[t("div",{class:"top-bar",style:c([{"border-radius":".5rem",gap:"1rem"},r(f).current_chat_theme.bg_bars])},[t("div",ot,[t("div",it,[t("div",{class:"cliente-img",style:c([`background-color:${r(i).params.color}`,{height:"100%",color:"white",width:"3rem","aspect-ratio":"1/1","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase","font-size":"1.3rem"}])},b(le(r(i).params.user_name)),5)]),t("div",nt,[t("div",rt,[t("strong",null,[t("h5",{style:c([{"text-transform":"capitalize",margin:"0"},r(f).current_chat_theme.text])},b((_e=r(i).params.user_name)==null?void 0:_e.substring(0,20)),5)]),t("span",null,"+"+b(r(i).params.user_id),1)]),t("div",null,[r($).current_user.clasification?(p(),A(n,{key:0,style:c({height:"2.3rem",display:"flex",alignItems:"center",textTransform:"capitalize",gap:"0.35rem",backgroundColor:((he=Z[r($).current_user.clasification])==null?void 0:he.bg)||"#7f8c8d",color:"#fff"})},{default:m(()=>{var w,X;return[t("i",{class:re(["fa-solid",(w=Z[r($).current_user.clasification])==null?void 0:w.icon]),"aria-hidden":"true",style:{"font-size":"0.9rem"}},null,2),ue(" "+b((X=r($).current_user.clasification)==null?void 0:X.toLowerCase())+" "+b(r($).current_user.times_purchased)+" compras ",1)]}),_:1},8,["style"])):W("",!0)])])]),t("div",lt,[u(n,{icon:"pi pi-shopping-cart",class:"p-2",style:{color:"white","min-width":"max-content"},severity:"warning",label:"Ing. Ped"}),u(n,{text:"",class:"p-2"},{default:m(()=>[t("i",{style:c(r(f).current_chat_theme.text),class:"pi pi-search text-2xl"},null,4)]),_:1}),u(n,{text:"",class:"p-2"},{default:m(()=>[t("i",{style:c(r(f).current_chat_theme.text),class:"pi pi-bars text-2xl"},null,4)]),_:1})])],4),t("div",ct,[u(_,null,{default:m(()=>[r(i).params.user_id?(p(),A(Ie,{key:0,send_function:o,send_text:M,change_expiration:G,ref:"Messages_element"},null,512)):(p(),T("div",dt,[t("h2",{style:c([{color:"white","font-size":"3rem",opacity:".5"},r(f).current_chat_theme.text])},"Selecciona un chat...",4)]))]),_:1})]),(ge=r(i).params)!=null&&ge.user_id?(p(),T("div",{key:0,class:"chat-bar",tabindex:"0",style:c(r(f).current_chat_theme.bg_bars)},[J.value?(p(),A(r(je),{key:0,native:!0,style:{position:"absolute",bottom:"4rem","z-index":"1000"},onSelect:Q,class:"emoji-picker"})):W("",!0),t("div",ut,[u(n,{text:"",style:{"font-size":"2rem"},onClick:a[0]||(a[0]=w=>J.value=!J.value)},{default:m(()=>[pt]),_:1}),S.value?(p(),T("div",{key:1,class:"audio-chip",onKeydown:Ue(Re(se,["prevent"]),["enter"])},[t("audio",{style:{width:"100%","min-width":"28rem","max-width":"42rem"},src:S.value.url,controls:""},null,8,ft),u(n,{text:"",class:"btn-audio-trash p-2",onClick:B},{default:m(()=>[t("i",{style:c(r(f).current_chat_theme.text),class:"pi pi-trash text-2xl p-0"},null,4)]),_:1})],40,mt)):(p(),A(E,{key:0,modelValue:j.value,"onUpdate:modelValue":a[1]||(a[1]=w=>j.value=w),autoResize:"",class:"message",disabled:I.value,onKeydown:l,style:c(`${r(f).current_chat_theme.text} ; ${r(f).current_chat_theme.border} `)},null,8,["modelValue","disabled","style"]))]),t("div",_t,[!S.value&&j.value.trim()===""?(p(),A(n,{key:0,text:"",style:{height:"100%"},onClick:te},{default:m(()=>[t("i",{style:c(r(f).current_chat_theme.text),class:re(C.value?"pi pi-stop text-2xl text-red-500":"pi pi-microphone text-2xl ")},null,6)]),_:1})):S.value?(p(),A(n,{key:1,disabled:F.value,text:"",onClick:se},{default:m(()=>[t("i",{style:c(r(f).current_chat_theme.text),class:"pi pi-send text-2xl"},null,4)]),_:1},8,["disabled"])):(p(),A(n,{key:2,style:c(r(f).current_chat_theme.text),text:"",onClick:a[2]||(a[2]=w=>M(j.value))},{default:m(()=>[ht]),_:1},8,["style"]))]),t("div",gt,[u(n,{severity:"danger",style:{},icon:"pi pi-clock",class:"p-2",onClick:a[3]||(a[3]=()=>V.value=!0)}),r(i).query.expirado?(p(),A(n,{key:0,icon:"pi pi-bolt",severity:"warning",style:{},class:"p-2",onClick:a[4]||(a[4]=()=>V.value=!0)})):W("",!0)])],4)):W("",!0),u(z,{visible:V.value,"onUpdate:visible":a[5]||(a[5]=w=>V.value=w),header:"Envio de plantilla",style:{width:"50rem"}},{default:m(()=>[u(H,{value:ne.value,dataKey:"id",paginator:"",rows:10,responsiveLayout:"scroll",class:"shadow-md rounded-xl overflow-hidden"},{default:m(()=>[u(y,{class:"my-1 py-1",field:"name",header:"Nombre",bodyClass:"font-medium"}),u(y,{class:"my-1 py-1",header:"Estado"},{body:m(({data:w})=>[u(O,{severity:K(w.status)},{default:m(()=>[ue(b(w.status),1)]),_:2},1032,["severity"])]),_:1}),u(y,{class:"my-1 py-1",header:"Estado"},{body:m(({data:w})=>{var X,ve;return[ue(b((ve=(X=w==null?void 0:w.components)==null?void 0:X.find(Ce=>Ce.type=="BODY"))==null?void 0:ve.text),1)]}),_:1}),u(y,{class:"my-1 py-1",headerStyle:"width:8rem",header:"Acciones"},{body:m(({data:w})=>[t("div",vt,[u(n,{icon:"pi pi-send",label:"Enviar",severity:"help",onClick:X=>Y(w)},null,8,["onClick"])])]),_:1})]),_:1},8,["value"]),t("div",yt,[u(s,{to:"/chat/templates"},{default:m(()=>[u(n,{severity:"help",icon:"pi pi-plus",label:"Agregar otro"})]),_:1})])]),_:1},8,["visible"])],4)}}}),xt=me(bt,[["__scopeId","data-v-aa100914"]]);const wt={__name:"chats",setup(R){const f=fe();return(K,Y)=>(p(),T("div",{class:"chat-container",style:c(r(f).current_chat_theme.bg)},[u(be,{style:{"box-shadow":".5rem 0 1rem #00000010"},class:"sidebar-left",restaurant:{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}}),u(xt),u(be,{style:{"box-shadow":"-.5rem 0 1rem #00000010"},class:"sidebar-right",restaurant:{id:1,name:"Salchimonster",img:"https://backend.salchimonster.com/read-photo-product/xai0dVnL"}})],4))}},Ct=me(wt,[["__scopeId","data-v-5877f5bf"]]);export{Ct as default};
