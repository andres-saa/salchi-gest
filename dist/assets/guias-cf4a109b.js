import{_ as Fe,E as He,C as Ue,G as Pe,j as i,z as Be,I as J,k as Ie,U as _,H as je,r as E,aa as Re,o as F,c as W,e as o,f as y,a as t,u as d,w as me,g as fe,i as ye,A as Oe,af as c,N as Q,h as _e,t as L,n as ze,q as Me,x as Ke}from"./index-58581f28.js";const qe="/images/file.png";const T=H=>(Me("data-v-5ec01009"),H=H(),Ke(),H),Ge={class:"flex align-items-center gap-3"},Je=T(()=>t("small",{class:"mt-3 block p-text-secondary"},"Esta acción elimina el elemento del catálogo (no los archivos ya cargados).",-1)),We=T(()=>t("p",null,"¿Estás seguro de que quieres eliminar este archivo?",-1)),Qe={class:"flex gap-2 justify-content-end"},Xe={class:"flex justify-content-end"},Ye={class:"flex justify-content-end"},Ze={class:"wrapper"},ea={class:"hero"},aa=T(()=>t("div",{class:"hero__left"},[t("i",{class:"fa-solid fa-person-chalkboard"}),t("div",null,[t("h2",{class:"m-0"},"Gestión de guías"),t("p",{class:"m-0"},"Organiza y comparte documentos por área y tipo")])],-1)),la={class:"hero__actions"},oa={class:"controls card shadow-1"},ta={class:"grid align-items-center m-0 w-full"},sa={class:"col-12 lg:col-5 p-1"},ia={class:"col-12 lg:col-4 p-1"},ra={class:"col-12 lg:col-3 p-1 flex justify-content-end gap-2"},na={class:"flex flex-wrap gap-2 mt-2"},da={class:"p-input-icon-left mt-3"},ca=T(()=>t("i",{class:"pi pi-search"},null,-1)),ua=T(()=>t("div",{class:"py-6 text-center"},[t("i",{class:"pi pi-folder-open text-4xl block mb-2"}),t("span",null,"No hay archivos para los filtros actuales.")],-1)),va=T(()=>t("img",{class:"file-badge__icon",src:qe,alt:"file"},null,-1)),pa={class:"file-badge__ext"},ma={class:"flex flex-column"},fa={class:"font-semibold"},ya={class:"p-text-secondary"},_a={class:"flex gap-2 justify-content-end"},ha=T(()=>t("i",{class:"pi pi-upload text-2xl mb-2"},null,-1)),wa={key:0},ga={key:1},ba={class:"flex justify-content-between w-full"},Ca={__name:"guias",setup(H){const r=He(),u=Ue();Pe();const U=i(!1),k=i(null),X=i([]),P=i(!1),B=i(!1),V=i({area_name:""}),D=i({type_name:""}),A=i(!1),I=i(null),v=i({}),N=i([]),Y=i([]),j=i(!1),Z=i(null),x=i({file:null}),g=i(!1),S=i([]),$=i([]),p=i(null),m=i(null),he={pdf:"#E74C3C",doc:"#3498DB",docx:"#3498DB",xls:"#27AE60",xlsx:"#27AE60",ppt:"#E67E22",pptx:"#E67E22",psd:"#34495E",ai:"#F39C12",indd:"#EB4D4B",jpg:"#F1C40F",jpeg:"#F1C40F",png:"#1ABC9C",gif:"#F39C12",bmp:"#2ECC71",tiff:"#D35400",svg:"#9B59B6",mp3:"#2ECC71",wav:"#3498DB",aac:"#9B59B6",flac:"#E74C3C",ogg:"#E67E22",csv:"#27AE60"},we=e=>{var a;return he[(a=e==null?void 0:e.toLowerCase)==null?void 0:a.call(e)]||"#8E44AD"},R=i(null);Be(()=>{R.value={global:{value:null,matchMode:Oe.CONTAINS}}});const ge=J(()=>S.value.filter(e=>e.id_area!=="all")),be=J(()=>$.value.filter(e=>e.id_type!=="all")),ee=J(()=>{var e,a,n,s;return!!((e=v.value)!=null&&e.area&&((a=v.value)!=null&&a.type)&&((s=(n=v.value)==null?void 0:n.file_name)!=null&&s.trim())&&x.value.file)});Ie(async()=>{await Ce()});async function Ce(){await Promise.all([O(),z(),M()]),p.value=S.value.find(e=>e.id_area==="all")||null,m.value=$.value.find(e=>e.id_type==="all")||null,await q()}async function O(){g.value=!0,r.setLoading(!0,"cargando archivos");try{const e=await fetch(`${_}/archived-files`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);N.value=await e.json()}catch(e){console.error(e),u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los archivos",life:3e3})}finally{g.value=!1,r.setLoading(!1,"cargando archivos")}}async function z(){r.setLoading(!0,"cargando áreas");try{const e=await fetch(`${_}/areas`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const a=await e.json();S.value=[{id_area:"all",area_name:"Todas las áreas"},...a]}catch(e){console.error(e),u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las áreas",life:3e3})}finally{r.setLoading(!1,"cargando áreas")}}async function M(){r.setLoading(!0,"cargando tipos");try{const e=await fetch(`${_}/archived-file-types`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const a=await e.json();$.value=[{id_type:"all",type_name:"Todos los tipos"},...a]}catch(e){console.error(e),u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los tipos",life:3e3})}finally{r.setLoading(!1,"cargando tipos")}}const q=async()=>{await Promise.all([O(),z(),M()]),X.value=[...S.value.filter(e=>e.id_area!=="all").map(e=>({id:e.id_area,name:e.area_name,type:"area"})),...$.value.filter(e=>e.id_type!=="all").map(e=>({id:e.id_type,name:e.type_name,type:"type"}))]},Ee=()=>{k.value=null},ae=async()=>{var e;if((e=V.value.area_name)!=null&&e.trim()){r.setLoading(!0,"creando área");try{const a=await fetch(`${_}/area`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V.value)});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);u.add({severity:"success",summary:"Éxito",detail:"Área creada correctamente",life:3e3}),await z(),P.value=!1}catch(a){u.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}finally{r.setLoading(!1,"creando área")}}},le=async()=>{var e;if((e=D.value.type_name)!=null&&e.trim()){r.setLoading(!0,"creando tipo");try{const a=await fetch(`${_}/archived-file-type`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D.value)});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);u.add({severity:"success",summary:"Éxito",detail:"Tipo de archivo creado correctamente",life:3e3}),await M(),B.value=!1}catch(a){u.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}finally{r.setLoading(!1,"creando tipo")}}},Te=async()=>{if(!k.value)return;const{id:e,type:a}=k.value;let n=`${_}/`;n+=a==="area"?`area/${e}`:`archived-file-type/${e}`;try{const s=await fetch(n,{method:"DELETE"});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);u.add({severity:"success",summary:"Éxito",detail:`${a==="area"?"Área":"Tipo"} eliminado correctamente`,life:3e3}),await(a==="area"?z():M()),await q(),U.value=!1}catch(s){u.add({severity:"error",summary:"Error",detail:s.message,life:3e3})}},ke=e=>{I.value=e,A.value=!0},xe=async()=>{if(I.value){r.setLoading(!0,"borrando archivo");try{const e=await fetch(`${_}/archived-file/${I.value}`,{method:"DELETE"});if(!e.ok)throw new Error(`Error al eliminar el archivo: ${e.statusText}`);u.add({severity:"success",summary:"Éxito",detail:"Archivo eliminado correctamente",life:3e3}),await K()}catch(e){u.add({severity:"error",summary:"Error",detail:e.message,life:3e3})}finally{r.setLoading(!1,"borrando archivo"),A.value=!1,I.value=null}}},Se=e=>{x.value.file=e.target.files[0]},G=()=>{j.value=!1,x.value={file:null},v.value={}},oe=async()=>{if(!ee.value){u.add({severity:"warn",summary:"Advertencia",detail:"Completa todos los campos",life:2500});return}const e=new FormData;e.append("file",x.value.file),e.append("id_area",v.value.area.id_area),e.append("id_type",v.value.type.id_type),e.append("file_name",v.value.file_name);try{const a=await fetch(`${_}/upload-archived-file/`,{method:"POST",body:e});if(!a.ok)throw new Error(`Error al subir el archivo: ${a.statusText}`);u.add({severity:"success",summary:"Éxito",detail:"Archivo subido correctamente",life:3e3}),G(),await K()}catch(a){u.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}},$e=(e,a,n)=>{const s=`${_}/get-archived-file/${e}/${a}/${(n||"").split(".")[0]}`;fetch(s).then(f=>{if(f.ok)return f.blob();throw new Error("No se pudo descargar el archivo.")}).then(f=>{const h=window.URL.createObjectURL(f),w=document.createElement("a");w.href=h,w.download=n||"archivo",document.body.appendChild(w),w.click(),w.remove(),window.URL.revokeObjectURL(h)}).catch(f=>u.add({severity:"error",summary:"Error",detail:f.message,life:3e3}))};async function Le(){if(p.value){g.value=!0,r.setLoading(!0,"cargando archivos");try{const e=await fetch(`${_}/archived-files/area/${p.value.id_area}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);N.value=await e.json()}finally{g.value=!1,r.setLoading(!1,"cargando archivos")}}}async function Ve(){if(m.value){g.value=!0,r.setLoading(!0,"cargando archivos");try{const e=await fetch(`${_}/archived-files/type/${m.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);N.value=await e.json()}finally{g.value=!1,r.setLoading(!1,"cargando archivos")}}}async function De(){if(!(!m.value||!p.value)){g.value=!0,r.setLoading(!0,"cargando archivos");try{const e=await fetch(`${_}/archived-files/${p.value.id_area}/${m.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);N.value=await e.json()}finally{g.value=!1,r.setLoading(!1,"cargando archivos")}}}const K=async()=>{var e,a,n,s,f,h;p.value&&m.value&&((e=p.value)==null?void 0:e.id_area)!=="all"&&((a=m.value)==null?void 0:a.id_type)!=="all"?await De():((n=p.value)==null?void 0:n.id_area)==="all"&&((s=m.value)==null?void 0:s.id_type)!=="all"?await Ve():((f=p.value)==null?void 0:f.id_area)!=="all"&&((h=m.value)==null?void 0:h.id_type)==="all"?await Le():await O()},Ae=async()=>{p.value=S.value.find(e=>e.id_area==="all"),m.value=$.value.find(e=>e.id_type==="all"),await O()};return je([p,m],async()=>{await K()}),(e,a)=>{var se,ie,re,ne,de,ce,ue,ve;const n=E("Dropdown"),s=E("Button"),f=E("Dialog"),h=E("InputText"),w=E("Tag"),b=E("Column"),Ne=E("DataTable"),te=Re("tooltip");return F(),W("div",null,[o(f,{visible:U.value,"onUpdate:visible":a[1]||(a[1]=l=>U.value=l),header:"Eliminar área o tipo",modal:"",closable:!0,onHide:Ee,style:{"max-width":"36rem"}},{default:y(()=>[t("div",Ge,[o(n,{class:"w-9",modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=l=>k.value=l),options:X.value,optionLabel:"name",placeholder:"Seleccione un área o tipo"},null,8,["modelValue","options"]),o(s,{class:"w-3",label:"Eliminar",icon:d(c).TRASH,severity:"danger",disabled:!k.value,onClick:Te},null,8,["icon","disabled"])]),Je]),_:1},8,["visible"]),o(f,{visible:A.value,"onUpdate:visible":a[3]||(a[3]=l=>A.value=l),header:"Confirmar eliminación",modal:"",closable:!1,style:{"max-width":"28rem"}},{default:y(()=>[We,t("div",Qe,[o(s,{label:"No",icon:d(c).TIMES,onClick:a[2]||(a[2]=l=>A.value=!1),text:""},null,8,["icon"]),o(s,{label:"Sí",icon:d(c).CHECK,onClick:xe,severity:"danger"},null,8,["icon"])])]),_:1},8,["visible"]),o(f,{visible:P.value,"onUpdate:visible":a[5]||(a[5]=l=>P.value=l),header:"Crear nueva área",modal:"",closable:!0,onHide:e.resetNewAreaForm,style:{"max-width":"28rem"}},{default:y(()=>{var l;return[t("form",{onSubmit:Q(ae,["prevent"]),class:"flex flex-column gap-3"},[o(h,{modelValue:V.value.area_name,"onUpdate:modelValue":a[4]||(a[4]=C=>V.value.area_name=C),placeholder:"Nombre del área",class:"w-full"},null,8,["modelValue"]),t("div",Xe,[o(s,{label:"Crear",icon:d(c).CHECK,disabled:!((l=V.value.area_name)!=null&&l.trim()),onClick:ae},null,8,["icon","disabled"])])],32)]}),_:1},8,["visible","onHide"]),o(f,{visible:B.value,"onUpdate:visible":a[7]||(a[7]=l=>B.value=l),header:"Crear nuevo tipo de archivo",modal:"",closable:!0,onHide:e.resetNewTypeForm,style:{"max-width":"28rem"}},{default:y(()=>{var l;return[t("form",{onSubmit:Q(le,["prevent"]),class:"flex flex-column gap-3"},[o(h,{modelValue:D.value.type_name,"onUpdate:modelValue":a[6]||(a[6]=C=>D.value.type_name=C),placeholder:"Nombre del tipo de archivo",class:"w-full"},null,8,["modelValue"]),t("div",Ye,[o(s,{label:"Crear",icon:d(c).CHECK,disabled:!((l=D.value.type_name)!=null&&l.trim()),onClick:le},null,8,["icon","disabled"])])],32)]}),_:1},8,["visible","onHide"]),t("div",Ze,[t("div",ea,[aa,t("div",la,[o(s,{class:"minw",icon:d(c).UPLOAD,label:"Nuevo archivo",severity:"success",onClick:a[8]||(a[8]=l=>j.value=!0)},null,8,["icon"]),o(s,{class:"minw",icon:d(c).PLUS,label:"Nueva área",severity:"warning",onClick:a[9]||(a[9]=l=>P.value=!0)},null,8,["icon"]),o(s,{class:"minw",icon:d(c).PLUS,label:"Nuevo tipo",severity:"info",onClick:a[10]||(a[10]=l=>B.value=!0)},null,8,["icon"]),o(s,{class:"minw",icon:d(c).TRASH,label:"Eliminar área/tipo",severity:"danger",onClick:a[11]||(a[11]=()=>{U.value=!0,q()})},null,8,["icon"])])]),t("div",oa,[t("div",ta,[t("div",sa,[o(n,{class:"w-full h-3rem",optionLabel:"area_name",modelValue:p.value,"onUpdate:modelValue":a[12]||(a[12]=l=>p.value=l),options:S.value,placeholder:"Área de la empresa"},null,8,["modelValue","options"])]),t("div",ia,[o(n,{class:"w-full h-3rem",modelValue:m.value,"onUpdate:modelValue":a[13]||(a[13]=l=>m.value=l),optionLabel:"type_name",options:$.value,placeholder:"Tipo de archivo"},null,8,["modelValue","options"])]),t("div",ra,[me(o(s,{onClick:Ae,icon:d(c).ERASER,class:"",severity:"danger",size:"small"},null,8,["icon"]),[[te,"Limpiar filtros",void 0,{bottom:!0}]]),me(o(s,{onClick:K,icon:d(c).SEARCH,class:"",severity:"help",size:"small"},null,8,["icon"]),[[te,"Buscar",void 0,{bottom:!0}]])])]),t("div",na,[((se=p.value)==null?void 0:se.id_area)!=="all"?(F(),fe(w,{key:0,icon:d(c).BOOK,severity:"success",value:`Área: ${(ie=p.value)==null?void 0:ie.area_name}`},null,8,["icon","value"])):ye("",!0),((re=m.value)==null?void 0:re.id_type)!=="all"?(F(),fe(w,{key:1,icon:d(c).FILE,severity:"info",value:`Tipo: ${(ne=m.value)==null?void 0:ne.type_name}`},null,8,["icon","value"])):ye("",!0)]),t("div",da,[ca,o(h,{class:"w-full",modelValue:R.value.global.value,"onUpdate:modelValue":a[14]||(a[14]=l=>R.value.global.value=l),placeholder:"Buscar por nombre, tipo, área, fecha..."},null,8,["modelValue"])])]),o(Ne,{class:"table glow",value:N.value,dataKey:"id_file",selection:Y.value,"onUpdate:selection":a[15]||(a[15]=l=>Y.value=l),paginator:!0,rows:10,stripedRows:"",rowHover:"",showGridlines:"",filters:R.value,loading:g.value,removableSort:"",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} archivos"},{empty:y(()=>[ua]),default:y(()=>[o(b,{selectionMode:"multiple",headerStyle:"width: 3rem",frozen:"",class:"p-2"}),o(b,{field:"id_file",header:"ID",sortable:"",headerStyle:"width: 8rem",class:"p-2"},{body:y(l=>[_e(L(l.data.id_file),1)]),_:1}),o(b,{header:"",headerStyle:"width: 6rem",class:"p-2"},{body:y(l=>{var C,pe;return[t("div",{class:"file-badge",style:ze(`background-color:${we(l.data.file_extension)};`)},[va,t("span",pa,L((pe=(C=l.data.file_extension)==null?void 0:C.slice(0,4))==null?void 0:pe.toUpperCase()),1)],4)]}),_:1}),o(b,{field:"file_name",header:"Nombre",sortable:"",headerStyle:"min-width: 22rem",class:"p-2"},{body:y(l=>[t("div",ma,[t("span",fa,L(l.data.file_name),1),t("small",ya,"Versión: "+L(l.data.version??"—"),1)])]),_:1}),o(b,{field:"type_name",header:"Tipo",sortable:"",class:"p-2",headerStyle:"width: 12rem"},{body:y(l=>[o(w,{value:l.data.type_name,severity:"info"},null,8,["value"])]),_:1}),o(b,{field:"area_name",header:"Área",sortable:"",class:"p-2",headerStyle:"width: 12rem"},{body:y(l=>[o(w,{value:l.data.area_name,severity:"success"},null,8,["value"])]),_:1}),o(b,{field:"upload_date",header:"Fecha",sortable:"",class:"p-2",headerStyle:"width: 11rem"},{body:y(l=>[_e(L(l.data.upload_date),1)]),_:1}),o(b,{header:"Acciones",frozen:"",alignFrozen:"right",class:"p-2",headerStyle:"width:10rem"},{body:y(l=>[t("div",_a,[o(s,{text:"",icon:d(c).DOWNLOAD,severity:"success",onClick:C=>$e(l.data.id_area,l.data.id_type,l.data.file_name)},null,8,["icon","onClick"]),o(s,{text:"",icon:d(c).TRASH,severity:"danger",onClick:C=>ke(l.data.id_file)},null,8,["icon","onClick"])])]),_:1})]),_:1},8,["value","selection","filters","loading"])]),o(f,{visible:j.value,"onUpdate:visible":a[20]||(a[20]=l=>j.value=l),header:`Subir ${((ce=(de=v.value)==null?void 0:de.type)==null?void 0:ce.type_name)||"archivo"} para ${((ve=(ue=v.value)==null?void 0:ue.area)==null?void 0:ve.area_name)||"alguna área"}`,modal:"",closable:!0,onHide:G,style:{width:"100%","max-width":"34rem"}},{footer:y(()=>[t("div",ba,[o(s,{text:"",icon:d(c).TIMES,label:"Cancelar",onClick:G},null,8,["icon"]),o(s,{disabled:!ee.value,severity:"success",icon:d(c).CHECK,label:"Enviar",onClick:oe},null,8,["disabled","icon"])])]),default:y(()=>[t("form",{onSubmit:Q(oe,["prevent"]),enctype:"multipart/form-data",class:"flex flex-column gap-3"},[o(h,{placeholder:"Nombre del archivo",class:"w-full",modelValue:v.value.file_name,"onUpdate:modelValue":a[16]||(a[16]=l=>v.value.file_name=l)},null,8,["modelValue"]),o(n,{optionLabel:"area_name",placeholder:"Área de la empresa",class:"w-full",modelValue:v.value.area,"onUpdate:modelValue":a[17]||(a[17]=l=>v.value.area=l),options:ge.value},null,8,["modelValue","options"]),o(n,{class:"w-full",placeholder:"Tipo de archivo",modelValue:v.value.type,"onUpdate:modelValue":a[18]||(a[18]=l=>v.value.type=l),optionLabel:"type_name",options:be.value},null,8,["modelValue","options"]),t("div",{class:"dropzone",onClick:a[19]||(a[19]=()=>{var l;return(l=Z.value)==null?void 0:l.click()})},[ha,x.value.file?(F(),W("span",ga,L(x.value.file.name),1)):(F(),W("span",wa,"Haz clic para seleccionar un archivo")),t("input",{type:"file",ref_key:"fileInput",ref:Z,onChange:Se,hidden:""},null,544)])],32)]),_:1},8,["visible","header"])])}}},ka=Fe(Ca,[["__scopeId","data-v-5ec01009"]]);export{ka as default};
