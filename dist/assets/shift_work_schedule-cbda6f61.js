import{_ as Ee,f as n,x as Ve,C as Oe,h as je,U as f,g as Fe,r as E,o as g,c as h,d as l,w as v,a as t,l as A,F as X,b as te,k as V,t as u,n as We,a4 as Ne,y as re,a5 as Me,a6 as Be,p as Re,e as Ae}from"./index-90c38b00.js";import{u as de,f as ce,s as ue,e as pe,a as He,b as ve,c as me,d as ye}from"./subMonths-8dda982b.js";import{s as ze}from"./siteService-5d5fe0f8.js";import{l as Pe}from"./user-801cd779.js";const m=H=>(Re("data-v-77363eea"),H=H(),Ae(),H),qe={key:0,class:"user-info",style:{display:"flex","flex-direction":"column","align-items":"center"}},Je=["src"],Ke={class:"col-12"},Ze=m(()=>t("b",null,"Nombre:",-1)),Ge=m(()=>t("b",null,"Cargo:",-1)),Qe=m(()=>t("b",null,"Telefono:",-1)),Xe=m(()=>t("b",null,"Contrato",-1)),Ye={class:""},et={class:"col-12 p-0 m-0"},tt={class:"col-12 p-0 m-0"},at={class:"col-12 p-0"},st={class:"col-12 p-0"},ot=m(()=>t("p",null,"Desde:",-1)),lt=m(()=>t("p",null,"Hasta:",-1)),nt=m(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este día de trabajo y todos sus registros?")],-1)),it=m(()=>t("div",{class:"confirmation-content"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"¿Estás seguro de que quieres eliminar este registro?")],-1)),rt={style:{},class:"p-0 m-0"},dt=m(()=>t("h3",null,"Nueva semana",-1)),ct={class:"col-12 p-0 m-0 mb-8"},ut={class:"grid p-0 mx-auto"},pt={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},vt={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},mt={class:"col-12 md:col-2 py-2",style:{display:"flex",height:"4rem","justify-content":"end"}},yt={class:"grid"},ft={class:"col-2",style:{height:"80vh","overflow-y":"auto"}},gt={class:"p-0",style:{display:"flex","justify-content":"center"}},ht={style:{display:"flex",gap:"1rem","flex-direction":"column"},class:"pb-3 m-auto"},_t=["onDragstart"],bt=["onClick","src","onError"],wt={class:"my-0 py-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},kt={class:"my-0 py-0",style:{"min-width":"min-content","text-transform":"uppercase","text-align":"center"}},Dt={class:"col-10",style:{height:"80vh","overflow-y":"auto"}},xt={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},St={class:"col-12 pb-6",style:{}},Ct={style:{display:"flex",gap:"3rem","flex-direction":"column"}},Tt={class:"py-0 px-4 text-center col-12 text-xl",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},$t={style:{"overflow-x":"auto"}},Lt={style:{"min-width":"max-content","background-color":"#f4f1d6"}},Ut=["onDrop"],It={class:"py-0 my-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},Et={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","text-transform":"uppercase"}},Vt=["onClick","src","onError"],Ot={key:0},jt={class:"py-0 my-0"},Ft={class:"py-0 my-0"},Wt={class:"py-0 my-0"},Nt={class:"py-0 my-0"},Mt={key:1},Bt=Be('<p class="py-0 my-0" data-v-77363eea><b style="color:green;" data-v-77363eea>.</b></p><p class="py-0 my-0" data-v-77363eea><b style="color:green;" data-v-77363eea>.</b></p><p class="py-0 my-0" data-v-77363eea><b style="color:green;" data-v-77363eea>DESCANSA</b></p>',3),Rt={class:"py-0 my-0"},At={class:"",style:{"text-transform":"uppercase"}},Ht=m(()=>t("p",null,"Hora de llegada:",-1)),zt=m(()=>t("p",null,"Hora de salida:",-1)),Pt={class:"col-12 p-0",style:{display:"flex","justify-content":"space-between"}},qt={__name:"shift_work_schedule",setup(H){const z=n(!1),_=n(null),ae=s=>{_.value=s,z.value=!0},O=n(!1),b=n(new Date),S=n(new Date),P=Pe(),r=Ve(),j=n(!1),q=n(null),T=n(),F=n(),$=n(),L=n(),C=n(!1),c=n(null),w=n(null),k=n(new Date),D=n(new Date),se=Oe(()=>!$.value||!L.value?"":`${ce($.value,"dd/MM/yyyy")} - ${ce(L.value,"dd/MM/yyyy")}`),fe=()=>{b.value=$.value||new Date,S.value=L.value||new Date,O.value=!0},ge=()=>{O.value=!1},W=()=>{$.value=b.value,L.value=S.value,O.value=!1,M()},oe=()=>{const s=new Date;b.value=ue(s,{weekStartsOn:1}),S.value=pe(s,{weekStartsOn:1}),W()},he=()=>{const s=ue(new Date,{weekStartsOn:1});b.value=He(s,7),S.value=pe(b.value,{weekStartsOn:1}),W()},_e=()=>{const s=new Date;b.value=ve(s),S.value=me(s),W()},be=()=>{const s=new Date;b.value=ve(ye(s,1)),S.value=me(ye(s,1)),W()},we=s=>{q.value=s,j.value=!0},ke=async()=>{if(j.value=!1,r.setLoading(!0,"borrando"),!q.value)return;const s=await fetch(`${f}/shift_work_records/${q.value}`,{method:"DELETE"});s.ok?(M(),r.setLoading(!1,"borrando")):(console.error("Error al eliminar el registro:",await s.text()),alert("Hubo un error al eliminar el registro."),r.setLoading(!1,"borrando")),q.value=null},N=n(!1),J=n(null),De=s=>{J.value=s,N.value=!0},xe=async()=>{if(N.value=!1,!J.value)return;r.setLoading(!0,"borrando"),(await fetch(`${f}/shift_work_days/${J.value}`,{method:"DELETE"})).ok?(Z.value=Z.value.filter(e=>e.id!==J.value),r.setLoading(!1,"borrando")):(alert("Hubo un error al eliminar el día de trabajo."),r.setLoading(!1,"borrando"))},Se={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},Ce=s=>{if(!(s instanceof Date))return console.error("getDayColor: date is not a Date object",s),"#FFFFFF";const e=s.toLocaleDateString("en-US",{weekday:"long"});return Se[e]},K=n([]),Z=n([]),Y=(s,e)=>{const o={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},d=s==null?void 0:s.trim().toLowerCase();e.target.src=o[d]||o.default},U=n(null),I=n(!1),G=n(new Date);je(async()=>{F.value=await ze.getSites(),T.value=F.value.filter(e=>e.site_id==P.rawUserData.site_id)[0],U.value=F.value.filter(e=>e.site_id==P.rawUserData.site_id)[0];const s=await de.getUsersBySiteId(P.rawUserData.site_id);K.value=s.filter(e=>e.status=="activo"),await fetch(`${f}/shift_work_days_with_records`)}),Fe(T,async s=>{const e=await de.getUsersBySiteId(s.site_id);K.value=e.filter(o=>o.status=="activo"),U.value=s,oe(),M()});const M=async()=>{if(r.setLoading(!0,"cargando horario"),!T.value||!$.value||!L.value){alert("Please select a site and date range.");return}const s=$.value.toISOString().split("T")[0],e=L.value.toISOString().split("T")[0],o=await fetch(`${f}/shift_filtered_work_days?site_id=${T.value.site_id}&start_date=${s}&end_date=${e}`);if(o.ok){r.setLoading(!1,"cargando horario");const d=await o.json();Z.value=d.map(p=>(p.date=new Date(p.date),p.date.setDate(p.date.getDate()+1),p.users=p.records.map(x=>{let Q=K.value.find(y=>y.id===x.employer_id);if(Q){let y={...Q};const B=new Date(`${p.date.toISOString().split("T")[0]}T${x.start_time}`),R=new Date(`${p.date.toISOString().split("T")[0]}T${x.end_time}`);return y.arrivalTime=B,y.departureTime=R,y.hoursWorked=(R-B)/36e5,y.rest=x.rest,y}return null}).filter(x=>x!=null),r.setLoading(!1,"cargando horario"),p))}else r.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")},Te=async()=>{if(I.value=!1,r.setLoading(!0,"guardando"),!U.value||!G.value){alert("Please select a site and date.");return}let s=new Date(G.value.getTime());const e=new Date(s.getTime()-s.getTimezoneOffset()*6e4).toISOString().split("T")[0],o=await fetch(`${f}/shift_work_days`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:e,site_id:U.value.site_id})});if(o.ok){const d=await o.json();d.date=new Date(d.date),d.date.setDate(d.date.getDate()+1),r.setLoading(!1,"guardando"),M()}else{const d=await o.json();d.detail&&d.detail==="El día con el mismo site_id ya está registrado."?alert("Este dia ya esta registrado para esta sede"):alert("Failed to add new workday"),r.setLoading(!1,"guardando")}},$e=s=>{c.value=s},Le=s=>{w.value=s,C.value=!0},Ue=async()=>{if(C.value=!1,r.setLoading(!0,"cargando"),!c.value||!w.value)return;if(k.value.getTime()>=D.value.getTime()){alert("La hora de llegada no puede ser mayor o igual a la hora de salida."),r.setLoading(!1,"cargando"),C.value=!0;return}let s=k.value.toISOString().split("T")[1].slice(0,8),e=D.value.toISOString().split("T")[1].slice(0,8);const o={employer_id:c.value.id,work_day_id:w.value.id,start_time:s,end_time:e};await fetch(`${f}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),c.value.arrivalTime=k.value,c.value.departureTime=D.value,c.value.hoursWorked=(D.value-k.value)/36e5,w.value.users.push(c.value),C.value=!1,c.value=null,w.value=null,r.setLoading(!1,"cargando")},Ie=async()=>{if(C.value=!1,r.setLoading(!0,"cargando"),!c.value||!w.value)return;let s=k.value.toISOString().split("T")[1].slice(0,8),e=D.value.toISOString().split("T")[1].slice(0,8);const o={employer_id:c.value.id,work_day_id:w.value.id,start_time:s,end_time:e,rest:!0};await fetch(`${f}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),c.value.arrivalTime=k.value,c.value.departureTime=D.value,c.value.hoursWorked=(D.value-k.value)/36e5,c.value.rest=!0,w.value.users.push(c.value),C.value=!1,c.value=null,w.value=null,r.setLoading(!1,"cargando")};return(s,e)=>{var B,R,le;const o=E("Button"),d=E("Dialog"),p=E("Calendar"),x=E("Dropdown"),Q=E("InputText"),y=E("InputIcon");return g(),h(X,null,[l(d,{visible:z.value,"onUpdate:visible":e[2]||(e[2]=a=>z.value=a),modal:"",style:{width:"20rem"}},{footer:v(()=>[l(o,{label:"Cerrar",onClick:e[1]||(e[1]=a=>z.value=!1)})]),default:v(()=>{var a;return[t("h3",null,u(_.value.name),1),_.value?(g(),h("div",qe,[t("img",{class:"shadow-3 p-1",src:`${A(f)}/read-product-image/300/employer-${_.value.dni}`,onError:e[0]||(e[0]=i=>Y(_.value.gender,i)),alt:"Foto del empleado",style:{width:"100px",height:"100px","border-radius":"50%","object-fit":"cover"}},null,40,Je),t("div",Ke,[t("p",null,[Ze,V(" "+u(_.value.name),1)]),t("p",null,[Ge,V(" "+u(_.value.position),1)]),t("p",null,[Qe,V(" "+u(_.value.phone),1)]),t("p",null,[Xe,V(" "+u((a=_.value.contract_type)==null?void 0:a.toLowerCase()),1)])])])):We("",!0)]}),_:1},8,["visible"]),l(d,{visible:O.value,"onUpdate:visible":e[5]||(e[5]=a=>O.value=a),modal:"",closable:""},{footer:v(()=>[l(o,{severity:"danger",label:"Cancelar",onClick:ge,class:"p-button-text"}),l(o,{severity:"success",label:"Aceptar",onClick:W})]),default:v(()=>[t("div",Ye,[t("div",et,[l(o,{class:"col-12",severity:"danger",text:"",label:"Esta semana",onClick:oe})]),t("div",tt,[l(o,{class:"col-12",severity:"help",text:"",label:"Semana pasada",onClick:he})]),t("div",at,[l(o,{class:"col-12",severity:"warning",text:"",label:"Este mes",onClick:_e})]),t("div",st,[l(o,{class:"col-12",severity:"primary",text:"",label:"Mes pasado",onClick:be})])]),ot,l(p,{class:"col-12",modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),showIcon:""},null,8,["modelValue"]),lt,l(p,{class:"col-12",modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=a=>S.value=a),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),l(d,{visible:N.value,"onUpdate:visible":e[7]||(e[7]=a=>N.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:v(()=>[l(o,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[6]||(e[6]=a=>N.value=!1)}),l(o,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:xe})]),default:v(()=>[nt]),_:1},8,["visible"]),l(d,{visible:j.value,"onUpdate:visible":e[9]||(e[9]=a=>j.value=a),modal:"",style:{width:"350px"},header:"Confirmar eliminación",closable:!1},{footer:v(()=>[l(o,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[8]||(e[8]=()=>j.value=!1)}),l(o,{label:"Sí",icon:"pi pi-check",class:"p-button",onClick:ke})]),default:v(()=>[it]),_:1},8,["visible"]),t("div",rt,[l(d,{visible:I.value,"onUpdate:visible":e[13]||(e[13]=a=>I.value=a),style:{width:"22rem"},modal:"",closeOnEscape:"",onClose:e[14]||(e[14]=a=>I.value=!1)},{footer:v(()=>[l(o,{label:"cancelar",onClick:e[12]||(e[12]=a=>I.value=!1),class:"p-button-danger"}),l(o,{label:"Agregar",onClick:Te,class:"p-button-success"})]),default:v(()=>[dt,l(p,{class:"my-4",modelValue:G.value,"onUpdate:modelValue":e[10]||(e[10]=a=>G.value=a),showIcon:""},null,8,["modelValue"]),l(x,{class:"col-12 p-0",disabled:"",modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=a=>U.value=a),options:F.value,optionLabel:"site_name",placeholder:"Select a site"},null,8,["modelValue","options"])]),_:1},8,["visible"]),t("div",ct,[t("div",ut,[t("div",pt,[l(x,{disabled:!((le=A(Ne)["Horarios de trabajo admin"])!=null&&le.includes((R=(B=A(P))==null?void 0:B.rawUserData)==null?void 0:R.rol)),style:{height:"100%"},class:"col-12 p-0 m-0",modelValue:T.value,"onUpdate:modelValue":e[15]||(e[15]=a=>T.value=a),options:F.value,optionLabel:"site_name"},null,8,["disabled","modelValue","options"])]),t("div",vt,[l(Q,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:se.value,"onUpdate:modelValue":e[16]||(e[16]=a=>se.value=a),onClick:fe},null,8,["modelValue"])]),t("div",mt,[l(o,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:M})])])]),t("div",yt,[t("div",ft,[t("div",gt,[t("div",ht,[(g(!0),h(X,null,te(K.value,a=>(g(),h("div",{key:a.id,draggable:"true",style:{display:"flex","flex-direction":"column","align-items":"center"},onDragstart:i=>$e(a)},[t("img",{onClick:i=>ae(a),class:"shadow-2 mb-3 p-1",src:`${A(f)}/read-product-image/96/employer-${a.dni}`,alt:"user.name",onError:i=>Y(a.gender,i),style:{width:"4rem","object-fit":"cover",height:"4rem","border-radius":"50%"}},null,40,bt),t("p",wt,u(a.name.split(" ").slice(0,2).join(" ")),1),t("span",kt,u(a.position),1)],40,_t))),128))])])]),t("div",Dt,[t("div",xt,[l(o,{class:"mb-3",icon:"pi pi-plus",severity:"info",label:"Nueva semana",onClick:e[17]||(e[17]=a=>I.value=!0)})]),t("div",St,[t("div",Ct,[(g(!0),h(X,null,te(Z.value,a=>(g(),h("div",{class:"",key:a.id,style:{position:"relative"}},[t("div",{class:"p-2 shadow-2",style:re({"background-color":Ce(a.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[t("p",Tt,u(a.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"}))+" ",1)],4),t("div",$t,[l(o,{style:{position:"absolute",right:"-1rem",top:"-1rem"},icon:"pi pi-trash text-2xl ",class:"p-button-rounded p-button-danger shadow-5",onClick:i=>De(a.id)},null,8,["onClick"]),t("div",Lt,[t("div",{class:"shadow-5 p-5",style:{"min-height":"15rem","border-radius":"0 0 0.5rem 0.5rem",display:"flex","overflow-x":"auto","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"},onDragover:e[18]||(e[18]=Me(()=>{},["prevent"])),onDrop:i=>Le(a)},[(g(!0),h(X,null,te(a.users,i=>{var ne,ie;return g(),h("div",{class:"shadow-2 p-3",key:i.id,style:re([{"text-align":"center",width:"10rem","aspect-ratio":"1 / 1","background-color":"white",color:"black",position:"relative","border-radius":"0.5rem"},i.rest?"background-color: #68cc497a;  ":"background-color: white;"])},[t("p",It,u(i.name.split(" ").slice(0,1).join(" "))+" ` ",1),t("p",Et,u(i.position.slice(0,15)),1),t("img",{class:"shadow-2 mb-3 p-1",onClick:ee=>ae(i),src:`${A(f)}/read-product-image/96/employer-${i.dni}`,alt:"user.name",onError:ee=>Y(i.gender,ee),style:{width:"4rem","object-fit":"cover",height:"4rem","border-radius":"50%"}},null,40,Vt),i.rest?(g(),h("div",Mt,[Bt,t("p",Rt,[t("b",null,u((ie=i.contract_type)==null?void 0:ie.toLowerCase().slice(0,13)),1)])])):(g(),h("div",Ot,[t("p",jt,"De: "+u(new Date(i.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1),t("p",Ft,"A: "+u(new Date(i.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1),t("p",Wt,"por: "+u(i.hoursWorked.toFixed(2))+" hrs",1),t("p",Nt,[t("b",null,u((ne=i.contract_type)==null?void 0:ne.toLowerCase().slice(0,13)),1)])])),l(o,{size:"small",style:{position:"absolute",top:"-1rem",right:"-1rem"},icon:"pi pi-trash text-2xl",class:"p-button-rounded p-button-danger shadow-3",onClick:ee=>we(i.id)},null,8,["onClick"])],4)}),128))],40,Ut)])])]))),128)),V(" ` ")])])])]),l(d,{visible:C.value,"onUpdate:visible":e[21]||(e[21]=a=>C.value=a),style:{width:"20rem"},modal:!0},{header:v(()=>[V(" . ")]),footer:v(()=>[t("div",Pt,[l(o,{severity:"help",label:"Descansa",onClick:Ie}),l(o,{severity:"success",label:"Aceptar",onClick:Ue})])]),default:v(()=>[t("h5",At,"Cuantas horas trabajo "+u(c.value.name)+"?",1),Ht,l(p,{modelValue:k.value,"onUpdate:modelValue":e[19]||(e[19]=a=>k.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:v(({clickCallback:a})=>[l(y,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"]),zt,l(p,{modelValue:D.value,"onUpdate:modelValue":e[20]||(e[20]=a=>D.value=a),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:v(({clickCallback:a})=>[l(y,{class:"pi pi-clock cursor-pointer",onClick:a},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])],64)}}},Qt=Ee(qt,[["__scopeId","data-v-77363eea"]]);export{Qt as default};
