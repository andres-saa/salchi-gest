import{r as Ue}from"./resumen-96451d10.js";import{a as Ne,u as Ee}from"./site-c5e796e6.js";import{_ as Ae,j as S,I as U,k as De,m as O,U as G,T as Te,H as N,r as C,o as c,c as m,g as M,f,i as v,a as r,e as n,u as t,F as q,h as k,t as p,q as Oe,x as Me}from"./index-bc571c19.js";import{u as Be}from"./user-a037868b.js";import"./ventas-5c424dc4.js";import"./formatoPesos-2bac1853.js";const y=E=>(Oe("data-v-3a266391"),E=E(),Me(),E),$e={class:"finalizar-compra-container"},Le={key:0,style:{display:"flex","flex-direction":"column",gap:"1rem"}},Re={class:"form-group"},Pe={class:"flex flex-col"},je={key:1},Fe={key:2},Ge={style:{"font-size":"1.5rem"}},qe={style:{display:"flex",gap:"1rem"}},ze=y(()=>r("p",{class:"title"},"FINALIZAR COMPRA",-1)),Je={style:{margin:"auto","max-width":"800px"}},He={class:"title",style:{margin:"3rem .5rem"}},Ke={class:"form-grid"},Ye={class:"form-column"},Ze=y(()=>r("span",null,"NOMBRE",-1)),Qe={class:"form-group"},We={key:0},Xe=y(()=>r("span",null,"Ubicación",-1)),eo={class:"form-group"},oo=y(()=>r("span",null,"Método Entrega",-1)),so={class:"form-group"},to=y(()=>r("span",null,"Dirección",-1)),lo=y(()=>r("span",null,"Dirección",-1)),ro={class:"form-group"},ao=y(()=>r("span",null,"Correo Electrónico",-1)),no={class:"form-group"},io=y(()=>r("span",null,"Teléfono",-1)),uo={class:"form-group"},co=y(()=>r("span",null,"Placa de tu vehículo",-1)),po={class:"form-group"},_o={style:{display:"flex","align-items":"center",gap:"1rem"}},mo={key:4,class:"form-group"},vo={key:0},yo={key:1},go=y(()=>r("span",null,"Método de pago",-1)),ho={class:"form-group"},fo={key:5},bo={class:"form-group"},Vo=y(()=>r("span",null,"Notas",-1)),So=5,ve="salchi:deliveryCache:v1",Co={__name:"pay",setup(E){const w=S(!1),z=S({}),A=Ne(),i=Ee(),o=Be(),B=S([]),ye=S([]),$=S(!1),ge=S([]),L=U(()=>{var e;return(((e=o==null?void 0:o.lang)==null?void 0:e.name)||"es").toString().toLowerCase()==="en"?"en":"es"}),R={es:{site_selector:"Seleccionar sede",address_placeholder:"Escribe tu dirección",in_coverage:"En cobertura",not_in_coverage:"Fuera de cobertura",distance:"Distancia",miles:"Millas",ships_from_site:"Sale de la sede",delivery_price:"Costo de envío",cancel:"Cancelar",save:"Guardar"},en:{site_selector:"Site selector",address_placeholder:"Type your address",in_coverage:"In coverage",not_in_coverage:"Out of coverage",distance:"Distance",miles:"Miles",ships_from:"Ships from",ships_from_site:"Ships from",delivery_price:"Delivery price",cancel:"Cancel",save:"Save"}},g=s=>R[L.value]&&R[L.value][s]||R.es[s]||s,he={}.VITE_GEO_API_BASE||{}.VITE_PLACES_API_URI||"https://api.stripe.salchimonster.com",D=S([]),P=S(null),j=S(null),fe=()=>{P.value=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}_${Math.random().toString(36).slice(2)}`},be=U(()=>{var s,e;return((e=(s=i.location)==null?void 0:s.site)==null?void 0:e.country_code)??"co"});De(async()=>{o.user.order_type={},ye.value=await O.get(`${G}/payment_methods`),B.value=await O.get(`${G}/get_all_order_types`),z.value=await O.get(`${G}/site-payments-call-center`)});const h=U(()=>{var s,e;return[33,35,36].includes(((e=(s=i.location)==null?void 0:s.site)==null?void 0:e.site_id)??-1)}),T=U(()=>{var s,e;return((e=(s=i.location)==null?void 0:s.site)==null?void 0:e.site_id)??-1}),b=Te({manual:{},calc:{}});function Ve(){try{const s=localStorage.getItem(ve);if(!s)return;const e=JSON.parse(s);e!=null&&e.manual&&typeof e.manual=="object"&&Object.assign(b.manual,e.manual),e!=null&&e.calc&&typeof e.calc=="object"&&Object.assign(b.calc,e.calc)}catch(s){console.warn("No se pudo cargar deliveryCache:",s)}}function Se(){try{localStorage.setItem(ve,JSON.stringify({manual:b.manual,calc:b.calc}))}catch(s){console.warn("No se pudo guardar deliveryCache:",s)}}Ve(),N(b,Se,{deep:!0}),N(()=>{var s,e;return(e=(s=i.location)==null?void 0:s.neigborhood)==null?void 0:e.delivery_price},s=>{var e;!h.value&&(((e=o.user.order_type)==null?void 0:e.id)??0)!==2&&s!=null&&(b.manual[T.value]=Number(s))}),N(()=>{var s;return(s=o.user.site)==null?void 0:s.delivery_cost_usd},s=>{var e;h.value&&s!=null&&(b.calc[T.value]=Number(s),(((e=o.user.order_type)==null?void 0:e.id)??0)!==2&&(i.location.neigborhood.delivery_price=Number(s)))}),N([()=>{var s;return(s=o.user.order_type)==null?void 0:s.id},h,T],([s,e])=>{var a,u,x;const _=T.value;if(s===2){i.location.neigborhood.delivery_price=0;return}if(e){const d=((a=o.user.site)==null?void 0:a.delivery_cost_usd)??b.calc[_]??0;i.location.neigborhood.delivery_price=Number(d)}else{const d=b.manual[_]??((x=(u=i.location)==null?void 0:u.neigborhood)==null?void 0:x.delivery_price)??0;i.location.neigborhood.delivery_price=Number(d)}},{immediate:!0}),N(()=>{var s,e;return(e=(s=i.location)==null?void 0:s.site)==null?void 0:e.site_id},()=>{o.user.order_type=null,o.user.placa=null,h.value?o.user.address="":(w.value=!1,o.user.site=null)});const Ce=U(()=>{var e,_;return((_=(e=i.location)==null?void 0:e.site)==null?void 0:_.site_id)===33?B.value.filter(a=>(a==null?void 0:a.id)!==3):B.value.filter(a=>(a==null?void 0:a.id)!==1)}),ke=async s=>{const e=((s==null?void 0:s.query)??"").trim();if(!e){D.value=[],j.value=null;return}P.value||fe();const _=new URLSearchParams({input:e,session_token:P.value,language:L.value,region:be.value||"",limit:String(So)});try{const a=`${he}/places/autocomplete?${_.toString()}`,u=await O.get(a,!1),x=Array.isArray(u)?u:Array.isArray(u==null?void 0:u.predictions)?u.predictions:[];D.value=x.filter(d=>(d==null?void 0:d.description)&&(d==null?void 0:d.place_id)),j.value=u&&!Array.isArray(u)&&u.error?u.error:null}catch(a){console.error("Autocomplete error:",a),D.value=[],j.value=null}},we=()=>{var e,_;w.value=!1;const s=((e=o.user.site)==null?void 0:e.delivery_cost_usd)??0;i.location.neigborhood.delivery_price=Number(s),o.user.address=((_=o.user.site)==null?void 0:_.description)||o.user.address||""};return(s,e)=>{var H,K,Y,Z,Q,W,X,ee,oe,se,te,le;const _=C("AutoComplete"),a=C("Tag"),u=C("Button"),x=C("Dialog"),d=C("InputText"),F=C("Dropdown"),xe=C("Checkbox"),Ie=C("InputNumber"),J=C("Textarea");return c(),m("div",$e,[h.value?(c(),M(x,{key:0,header:g("site_selector"),modal:"",visible:w.value,"onUpdate:visible":e[2]||(e[2]=l=>w.value=l),style:{width:"100%","max-width":"30rem",margin:".5rem"}},{footer:f(()=>{var l,I;return[r("div",qe,[n(u,{onClick:e[1]||(e[1]=()=>{w.value=!1}),label:g("cancel"),severity:"danger",text:""},null,8,["label"]),n(u,{style:{"background-color":"black",border:"none",color:"white"},label:g("save"),onClick:we,disabled:!((I=(l=t(o).user.site)==null?void 0:l.nearest)!=null&&I.in_coverage)},null,8,["label","disabled"])])]}),default:f(()=>{var l,I,re,ae,ne,ie,de,ue,ce,pe,_e;return[!t(o).user.order_type||t(o).user.order_type.id!==2?(c(),m("div",Le,[r("div",Re,[n(_,{size:"large",style:{"min-width":"100%"},modelValue:t(o).user.site,"onUpdate:modelValue":e[0]||(e[0]=V=>t(o).user.site=V),suggestions:D.value,optionLabel:"description",minLength:1,delay:250,forceSelection:"",placeholder:g("address_placeholder"),onComplete:ke,class:"w-full"},{item:f(({item:V})=>[r("div",Pe,[r("span",null,p(V.description),1)])]),_:1},8,["modelValue","suggestions","placeholder"])]),(l=t(o).user.site)!=null&&l.nearest?(c(),M(a,{key:0,style:{width:"max-content"},severity:(re=(I=t(o).user.site)==null?void 0:I.nearest)!=null&&re.in_coverage?"success":"danger"},{default:f(()=>{var V,me;return[k(p((me=(V=t(o).user.site)==null?void 0:V.nearest)!=null&&me.in_coverage?g("in_coverage"):g("not_in_coverage")),1)]}),_:1},8,["severity"])):v("",!0),(ae=t(o).user.site)!=null&&ae.nearest?(c(),m("span",je,[r("strong",null,p(g("distance"))+": ",1),k(" "+p((ie=(ne=t(o).user.site)==null?void 0:ne.nearest)==null?void 0:ie.distance_miles)+" "+p(g("miles")),1)])):v("",!0),(de=t(o).user.site)!=null&&de.delivery_cost_usd?(c(),m("span",Fe,[r("strong",null,p(g("ships_from_site"))+": ",1),k(" "+p((pe=(ce=(ue=t(o).user.site)==null?void 0:ue.nearest)==null?void 0:ce.site)==null?void 0:pe.site_name),1)])):v("",!0),(_e=t(o).user.site)!=null&&_e.delivery_cost_usd?(c(),M(a,{key:3,severity:"success"},{default:f(()=>{var V;return[r("span",null,[r("strong",Ge,p(g("delivery_price"))+": $"+p((V=t(o).user.site)==null?void 0:V.delivery_cost_usd),1)])]}),_:1})):v("",!0)])):v("",!0)]}),_:1},8,["header","visible"])):v("",!0),ze,r("div",Je,[r("div",He,[n(a,{severity:"success",class:"advertice"},{default:f(()=>[k(" El tiempo promedio de entrega es de 60 a 75 minutos, por favor téngalo en cuenta antes de ordenar ")]),_:1})])]),r("div",Ke,[r("div",Ye,[Ze,r("div",Qe,[n(d,{id:"username",placeholder:"NOMBRE",modelValue:t(o).user.name,"onUpdate:modelValue":e[3]||(e[3]=l=>t(o).user.name=l)},null,8,["modelValue"])]),h.value?v("",!0):(c(),m("div",We,[Xe,r("div",eo,[n(d,{onClick:e[4]||(e[4]=l=>t(i).setVisible("currentSite",!0)),modelValue:t(i).location.neigborhood.name,id:"neighborhood",placeholder:"Ubicación",readonly:""},null,8,["modelValue"])])])),oo,r("div",so,[n(F,{style:{width:"100%"},modelValue:t(o).user.order_type,"onUpdate:modelValue":e[5]||(e[5]=l=>t(o).user.order_type=l),id:"metodo_de_entrega",placeholder:"Método de entrega",options:Ce.value.filter(l=>[1,2,3].includes(l.id)),optionLabel:"name"},null,8,["modelValue","options"])]),h.value&&(!t(o).user.order_type||((H=t(o).user.order_type)==null?void 0:H.id)!==2)?(c(),m(q,{key:1},[to,n(d,{onClick:e[6]||(e[6]=()=>w.value=!0),value:t(o).user.address,readonly:""},null,8,["value"])],64)):!h.value&&(!t(o).user.order_type||((K=t(o).user.order_type)==null?void 0:K.id)!==2)?(c(),m(q,{key:2},[lo,r("div",ro,[n(d,{modelValue:t(o).user.address,"onUpdate:modelValue":e[7]||(e[7]=l=>t(o).user.address=l),id:"address",placeholder:"DIRECCIÓN"},null,8,["modelValue"])])],64)):v("",!0),ao,r("div",no,[n(d,{modelValue:t(o).user.email,"onUpdate:modelValue":e[8]||(e[8]=l=>t(o).user.email=l),id:"email",placeholder:"Correo Electrónico"},null,8,["modelValue"])]),io,r("div",uo,[n(d,{modelValue:t(o).user.phone_number,"onUpdate:modelValue":e[9]||(e[9]=l=>t(o).user.phone_number=l),id:"phone_number",mask:"999 999 9999",placeholder:"TELÉFONO"},null,8,["modelValue"])]),t(o).user.order_type&&((Y=t(o).user.order_type)==null?void 0:Y.id)===2&&((Q=(Z=t(i).location)==null?void 0:Z.site)==null?void 0:Q.site_id)===33?(c(),m(q,{key:3},[co,r("div",po,[n(d,{modelValue:t(o).user.placa,"onUpdate:modelValue":e[10]||(e[10]=l=>t(o).user.placa=l),id:"placa",placeholder:"Placa de tu vehículo"},null,8,["modelValue"])])],64)):v("",!0),r("span",_o,[n(xe,{modelValue:$.value,"onUpdate:modelValue":e[11]||(e[11]=l=>$.value=l),binary:""},null,8,["modelValue"]),k(" Es una cortesía? ")]),$.value?(c(),m("div",mo,[n(F,{style:{width:"100%"},modelValue:t(o).user.payment_method_option,"onUpdate:modelValue":e[12]||(e[12]=l=>t(o).user.payment_method_option=l),id:"payment_method",placeholder:"Porcentaje de cortesía",options:ge.value},{option:f(l=>[k(p(l.option.name)+" ",1),n(a,null,{default:f(()=>[k(p(l.option.percentage),1)]),_:2},1024)]),value:f(l=>[l.value?(c(),m("span",vo,[k(p(l.value.name)+" ",1),n(a,null,{default:f(()=>[k(p(l.value.percentage),1)]),_:2},1024)])):(c(),m("span",yo," Selecciona un porcentaje "))]),_:1},8,["modelValue","options"])])):v("",!0),go,r("div",ho,[n(F,{style:{width:"100%"},modelValue:t(o).user.payment_method_option,"onUpdate:modelValue":e[13]||(e[13]=l=>t(o).user.payment_method_option=l),id:"payment_method",placeholder:"MÉTODO DE PAGO",options:(ee=z.value)==null?void 0:ee[(X=(W=t(i).location)==null?void 0:W.site)==null?void 0:X.site_id],optionLabel:"name"},null,8,["modelValue","options"])]),((se=(oe=t(o).user)==null?void 0:oe.order_type)==null?void 0:se.id)!=2?(c(),m("span",fo,"Domicilio")):v("",!0),r("div",bo,[((le=(te=t(o).user)==null?void 0:te.order_type)==null?void 0:le.id)!=2?(c(),M(Ie,{key:0,style:{width:"100%"},prefix:"$",min:"0",maxFractionDigits:2,modelValue:t(i).location.neigborhood.delivery_price,"onUpdate:modelValue":e[14]||(e[14]=l=>t(i).location.neigborhood.delivery_price=l),id:"delivery_price",readonly:h.value,placeholder:h.value?"Calculado automáticamente":"Defínelo en el diálogo de Ubicación"},null,8,["modelValue","readonly","placeholder"])):v("",!0)]),Vo,n(J,{modelValue:t(A).cart.order_notes,"onUpdate:modelValue":e[15]||(e[15]=l=>t(A).cart.order_notes=l),class:"order-notes",placeholder:"Notas adicionales"},null,8,["modelValue"]),r("template",null,[n(J,{modelValue:t(A).cart.order_notes,"onUpdate:modelValue":e[16]||(e[16]=l=>t(A).cart.order_notes=l),class:"order-notes",placeholder:"Notas"},null,8,["modelValue"])])]),n(Ue,{class:"resumen-column"})])])}}},Eo=Ae(Co,[["__scopeId","data-v-3a266391"]]);export{Eo as default};
