import{_ as $e,l as Le,h as i,G as z,Z as Se,i as Ie,j as C,U as Ne,D as J,g as Oe,o as y,c as b,f as s,e as g,u as o,a as l,F as A,$ as p,q as E,t as h,r as q,d as Re,n as Pe,a0 as ae,a1 as w,a2 as le,a3 as S,a4 as j,a5 as te,k as se,a6 as De,a7 as Ae,p as je,m as Fe,J as I}from"./index-a94103e7.js";const d=N=>(je("data-v-a2771b92"),N=N(),Fe(),N),Be={style:{height:"100%"}},Ge={style:{display:"grid","grid-template-columns":"repeat(2, 1fr)","max-width":"max-content",gap:".5rem","align-items":"center"}},Ye=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Id plantilla :")],-1)),Me={class:"m-0 p-0"},He=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Nombre plantilla :")],-1)),Ke={class:"m-0 p-0"},ze=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Estado :")],-1)),Je={class:"m-0 p-0"},qe=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Categoria :")],-1)),Qe={class:"m-0 p-0"},We=d(()=>l("h6",{class:"m-0 p-0"},[l("strong",null,"Mensaje :")],-1)),Ze={class:"m-0",style:{"background-color":"#0a3744",padding:"1rem","border-radius":".5rem",color:"white"}},Xe=d(()=>l("h5",null,[l("strong",null,"Usuarios")],-1)),ea={class:"statuses",style:{display:"flex",gap:"1rem"}},aa={style:{width:"100%",height:"50vh","margin-top":"1rem"}},la={class:"p-4 templates-container",style:{"max-width":"70rem",width:"100%",margin:"auto","background-color":"white","border-radius":"1rem",transition:"all .3s ease"}},ta={style:{height:"100%"}},sa={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",style:{"align-items":"center"}},oa=d(()=>l("h2",{class:"text-2xl font-bold whitespace-nowrap m-0 p-0",style:{"min-width":"max-content"}},"Plantillas de WhatsApp",-1)),na={class:"p-input-icon-left w-full md:w-80 my-3",style:{height:"100%"}},ia=d(()=>l("i",{class:"pi pi-search"},null,-1)),ra={class:"flex gap-2"},ua={style:{display:"flex",width:"100%","justify-content":"end","margin-top":"1rem"}},da={class:"space-y-4"},ca={class:"md:grid-cols-2 gap-3"},pa={class:"field"},ma=d(()=>l("h6",{class:"font-medium mb-2"},"Imagen (HEADER)",-1)),va={key:0,style:{position:"relative",width:"300px","margin-top":".5rem"}},fa=["src"],ga={class:"field"},ya=d(()=>l("label",{class:"font-medium"},"Nombre",-1)),ha={class:"field"},_a=d(()=>l("label",{class:"font-medium"},"Categoría",-1)),ba={class:"field"},wa=d(()=>l("label",{class:"font-medium"},"Idioma",-1)),xa={class:"font-medium"},Ua={class:"opacity-70"},Ca={key:0,class:"",style:{display:"flex","flex-direction":"column",gap:"1rem","justify-content":"center"}},Ea=d(()=>l("h5",{class:"font-medium m-0 p-0 py-3"},"Ejemplos de variables",-1)),Ta={class:"space-y-2"},Va={class:"flex items-center my-4",style:{"align-items":"center",gap:"1rem"}},ka=d(()=>l("h5",{class:"m-0"},"Botones",-1)),$a={style:{display:"flex","flex-direction":"column",gap:"1rem","max-width":"100%",overflow:"hidden"}},La={__name:"templates",setup(N){const oe=Le();function ne({files:t}){if(!(t!=null&&t.length))return;const a=t[0];k.value=a,P.value=URL.createObjectURL(a)}function ie(){k.value=null,P.value=""}i("");const re=i(!1),F=i([]),_=i({}),B=i(!1),O=i(""),T=i(!1),G=i(!1),R=i(null),Y=i([]),f=i({name:"",category:"UTILITY",language:"es_ES"}),V=i(""),x=i([]),c=i({}),ue=i(null),m=i({}),M=i([{}]);i({label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-triangle-exclamation"});const k=i(null),P=i(""),v=i([]),de=i([{label:"SIN DATOS",bg:"#7f8c8d",icon:"fa-circle-question"},{label:"PREOCUPANTE",bg:"#e74c3c",icon:"fa-triangle-exclamation"},{label:"CASUAL",bg:"#e67e22",icon:"fa-person-walking"},{label:"FRECUENTE",bg:"#27ae60",icon:"fa-repeat"},{label:"TOP",bg:"#2980b9",icon:"fa-ranking-star"},{label:"ESTRELLA",bg:"#8e44ad",icon:"fa-star"}]);function ce(t){const a=t.label;if(a==="TODO"){v.value=[];return}const n=v.value.indexOf("TODO");n>-1&&v.value.splice(n,1);const e=v.value.indexOf(a);e===-1?v.value.push(a):v.value.splice(e,1)}const Q=z(()=>v.value.length===0?M.value:M.value.filter(t=>v.value.includes(t.clasification))),pe=Se(),$=i(!1),me=[{label:"AUTHENTICATION",value:"AUTHENTICATION"},{label:"MARKETING",value:"MARKETING"},{label:"UTILITY",value:"UTILITY"}],ve=[{label:"Español (CO)",value:"es_CO"},{label:"Español (ES)",value:"es_ES"},{label:"English (US)",value:"en_US"}],fe=[{label:"URL",value:"URL"},{label:"QUICK_REPLY",value:"QUICK_REPLY"}],ge=z(()=>{if(!O.value)return F.value;const t=O.value.toLowerCase();return F.value.filter(a=>`${a.name} ${a.category}`.toLowerCase().includes(t))});Ie(async()=>{Y.value=await C.get(`${Ne}/restaurants`),m.value=Y.value[0]||null,m.value});const ye=t=>{_.value=t,$.value=!0};J($,()=>{v.value=[]});const D=i([]);J(V,t=>{const a=Array.from(new Set((t.match(/{{\s*([^{}\s]+)\s*}}/g)||[]).map(n=>n.replace(/{{|}}/g,"").trim())));D.value=a,c.value=Object.fromEntries(Object.entries(c.value).filter(([n])=>a.includes(n))),a.forEach(n=>{n in c.value||(c.value[n]="")})});async function H(){B.value=!0;try{F.value=await C.get(`${I}/wabas/${m.value.waba_id}/templates/`)}finally{B.value=!1}}const he=async()=>{M.value=await C.get(`${I}/wabas/${m.value.waba_id}/templates/users/${m.value.id}`)};J(m,async t=>{t&&(H(),v.value=[],await he())},{deep:!0});function _e(t){return{APPROVED:"success",PENDING:"warning",REJECTED:"danger"}[t]||"info"}function W(){f.value={name:"",category:"UTILITY",language:"es_ES"},V.value="",x.value=[],c.value={},R.value=null}function be(){W(),T.value=!0}const we=z(()=>ue.value?"Editar plantilla":"Nueva plantilla");function xe(t){var e,u;R.value=t.id,f.value={name:t.name,category:t.category,language:t.language};const a=t.components.find(r=>r.type==="BODY")||{text:""};V.value=a.text,c.value={},(e=a.example)!=null&&e.body_text_named_params?a.example.body_text_named_params.forEach(({param_name:r,example:L})=>{c.value[r]=L}):(u=a.example)!=null&&u.body_text&&a.example.body_text[0].forEach((r,L)=>{c.value[String(L+1)]=r});const n=t.components.find(r=>r.type==="BUTTONS")||{buttons:[]};x.value=n.buttons.map(r=>({type:r.type,text:r.text,url:r.url||""})),T.value=!0}function Ue(){x.value.push({type:"URL",text:"",url:""})}function Ce(){const t=D.value;return t.length?t.every(n=>/^\d+$/.test(n))?{body_text:[t.sort((e,u)=>+e-+u).map(e=>c.value[e]||"")]}:{body_text_named_params:t.map(n=>({param_name:n,example:c.value[n]||""}))}:void 0}async function Ee(){if(f.value.name.trim()){G.value=!0;try{const t=Ce(),a=[{type:"BODY",data:{text:V.value,...t?{example:t}:{}}}];x.value.length&&a.push({type:"BUTTONS",data:{buttons:x.value}});const n={...f.value,components:a},e=`${I}/wabas/${m.value.waba_id}/templates`;if(k.value){const u=new FormData;u.append("template_json",JSON.stringify(n)),u.append("header_image",k.value);const r=`${e}/with-header`;await C.postFormData(r,u,"Guardando…")}else{const u=R.value?`${e}/${R.value}`:e;await C.post(u,n,"Guardando…")}await H(),T.value=!1,W(),k.value=null,P.value=""}catch(t){console.error("✗ Error guardando plantilla:",t)}finally{G.value=!1}}}function Te(t){pe.require({message:`¿Eliminar la plantilla "${t.name}"?`,header:"Confirmar eliminación",icon:"pi pi-exclamation-triangle",acceptLabel:"Sí",rejectLabel:"No",accept:async()=>{await C.delete(`${I}/wabas/${m.value.waba_id}/templates/${t.name}`),await H()}})}const K=i(!1);async function Ve(){if(!_.value)return;const t=Q.value.map(n=>n.wa_id),a=new FormData;a.append("messaging_product","whatsapp"),a.append("employer_id",oe.rawUserData.id.toString()),a.append("context_message_id",""),a.append("restaurant_id",m.value.id),a.append("template",JSON.stringify(_.value)),t.forEach(n=>a.append("recipients",n)),K.value=!0;try{await C.post(`${I}/webhook/send/template/bulk/`,a,!1),console.log(`✅ Difusión iniciada para ${t.length} usuarios`),$.value=!1}catch(n){console.error("✗ Error en difusión masiva:",n)}finally{K.value=!1}}return(t,a)=>{const n=Oe("FileUpload");return y(),b(A,null,[s(o(le),{visible:$.value,"onUpdate:visible":a[1]||(a[1]=e=>$.value=e),modal:"",header:"Difundir Plantilla",style:{width:"100vw","max-width":"80rem","background-color":"white"}},{footer:g(()=>[s(o(p),{label:"Cancelar",text:"",severity:"secondary",onClick:a[0]||(a[0]=e=>$.value=!1)}),s(o(p),{label:"Enviar a todos",severity:"help",icon:"pi pi-broadcast",loading:K.value,onClick:Ve,autofocus:""},null,8,["loading"])]),default:g(()=>{var e,u,r,L,Z,X,ee;return[l("div",Be,[l("div",Ge,[Ye,E(),l("h6",Me,h((e=_.value)==null?void 0:e.id),1),He,E(),l("h6",Ke,h((u=_.value)==null?void 0:u.name),1),ze,E(),l("h6",Je,h((r=_.value)==null?void 0:r.status),1),qe,E(),l("h6",Qe,h((L=_.value)==null?void 0:L.category),1),We,l("h6",Ze,h((ee=(X=(Z=_.value)==null?void 0:Z.components)==null?void 0:X.find(U=>U.type=="BODY"))==null?void 0:ee.text),1)]),Xe,l("div",ea,[(y(!0),b(A,null,q(de.value,(U,ke)=>(y(),Re(o(p),{key:ke,style:Pe([{height:"2.3rem","border-radius":".3rem",padding:".5rem"},v.value.includes(U.label)?{backgroundColor:U.bg,color:"#fff"}:{backgroundColor:"#ffffff20",color:U.bg}]),text:"",onClick:Sa=>ce(U),class:"status",label:U.label},null,8,["onClick","label","style"]))),128))]),l("div",aa,[s(o(ae),{rows:10,paginator:"",stripedRows:"",showGridlines:"",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,15,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} clientes",responsiveLayout:"scroll",scrollable:"",value:Q.value,header:"clientes"},{default:g(()=>[s(o(w),{class:"py-1",header:"Nombre",field:"nombre"}),s(o(w),{class:"py-1",header:"Número",field:"wa_id"}),s(o(w),{class:"py-1",header:"Clasificación",field:"clasification"})]),_:1},8,["value"])])])]}),_:1},8,["visible"]),l("div",la,[l("div",ta,[l("div",sa,[oa,l("span",na,[ia,s(o(S),{modelValue:O.value,"onUpdate:modelValue":a[2]||(a[2]=e=>O.value=e),modelModifiers:{trim:!0},placeholder:"Buscar…",class:"w-full"},null,8,["modelValue"])]),s(o(j),{modelValue:m.value,"onUpdate:modelValue":a[3]||(a[3]=e=>m.value=e),options:Y.value.filter(e=>e.exist),optionLabel:"name",placeholder:"Selecciona un restaurante",class:"w-full md:w-80 my-3"},null,8,["modelValue","options"])]),s(o(ae),{value:ge.value,dataKey:"id",paginator:"",rows:10,responsiveLayout:"scroll",loading:B.value,globalFilterFields:["name","category"],class:"shadow-md rounded-xl overflow-hidden"},{default:g(()=>[s(o(w),{class:"my-1 py-1",field:"name",header:"Nombre",bodyClass:"font-medium"}),s(o(w),{class:"my-1 py-1",field:"category",header:"Categoría"}),s(o(w),{class:"my-1 py-1",field:"language",header:"Idioma"}),s(o(w),{class:"my-1 py-1",header:"Estado"},{body:g(({data:e})=>[s(o(te),{severity:_e(e.status)},{default:g(()=>[E(h(e.status),1)]),_:2},1032,["severity"])]),_:1}),s(o(w),{class:"my-1 py-1",headerStyle:"width:8rem",header:"Acciones"},{body:g(({data:e})=>[l("div",ra,[s(o(p),{icon:"pi pi-eye",severity:"warning",onClick:u=>xe(e)},null,8,["onClick"]),s(o(p),{icon:"pi pi-trash",severity:"danger",onClick:u=>Te(e)},null,8,["onClick"]),s(o(p),{icon:"pi pi-sync",label:"Difundir",severity:"help",onClick:u=>ye(e)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"]),l("div",ua,[s(o(p),{label:"Nueva plantilla",icon:"pi pi-plus",severity:"help",class:"w-full md:w-auto",onClick:be})]),s(o(le),{visible:T.value,"onUpdate:visible":a[9]||(a[9]=e=>T.value=e),header:we.value,modal:"",class:"",style:{width:"90vw","max-width":"60rem","min-width":"50rem"}},{footer:g(()=>[s(o(p),{label:"Cancelar",text:"",severity:"secondary",onClick:a[8]||(a[8]=e=>T.value=!1)}),s(o(p),{label:"Guardar",severity:"help",icon:"pi pi-check",onClick:Ee,loading:G.value,autofocus:""},null,8,["loading"])]),default:g(()=>[l("div",da,[l("div",ca,[l("div",pa,[ma,s(n,{name:"file",mode:"advanced",customUpload:"",chooseLabel:"Seleccionar",uploadLabel:"Subir",cancelLabel:"Cancelar",accept:"image/*",maxFileSize:2e6,multiple:!1,disabled:re.value,onUploader:ne},null,8,["disabled"]),k.value?(y(),b("div",va,[l("img",{src:P.value,style:{width:"100%",height:"100%","object-fit":"cover","border-radius":".5rem"}},null,8,fa),s(o(p),{icon:"pi pi-times",severity:"danger",size:"small",style:{position:"absolute",top:".1rem",right:".1rem"},onClick:ie})])):se("",!0)]),l("div",ga,[ya,s(o(S),{modelValue:f.value.name,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value.name=e),class:"w-full"},null,8,["modelValue"])]),l("div",ha,[_a,s(o(j),{modelValue:f.value.category,"onUpdate:modelValue":a[5]||(a[5]=e=>f.value.category=e),options:me,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),l("div",ba,[wa,s(o(j),{modelValue:f.value.language,"onUpdate:modelValue":a[6]||(a[6]=e=>f.value.language=e),options:ve,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),l("div",null,[l("h6",xa,[E("Cuerpo del mensaje "),l("small",Ua,"(usa "+h(t.param)+" o "+h(1)+")",1)]),s(o(De),{"auto-resize":"",modelValue:V.value,"onUpdate:modelValue":a[7]||(a[7]=e=>V.value=e),rows:"6",class:"w-full"},null,8,["modelValue"])]),D.value.length?(y(),b("div",Ca,[Ea,(y(!0),b(A,null,q(D.value,e=>(y(),b("div",{key:e,style:{"align-items":"center",display:"flex",gap:"1rem"},class:""},[s(o(te),{severity:"info",style:{padding:"0 1rem",height:"2.8rem","min-width":"2.8rem"},class:"min-w-[5rem] text-center text-xl"},{default:g(()=>[E(h(e),1)]),_:2},1024),s(o(S),{modelValue:c.value[e],"onUpdate:modelValue":u=>c.value[e]=u,placeholder:`Ejemplo para ${e}`,class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])):se("",!0),l("div",Ta,[l("div",Va,[ka,s(o(p),{icon:"pi pi-plus",severity:"success",onClick:Ue})]),l("div",$a,[(y(!0),b(A,null,q(x.value,(e,u)=>(y(),b("div",{key:u,class:"",style:{display:"grid","grid-template-columns":"10rem  1fr 1fr 3rem",gap:".5rem"}},[s(o(j),{modelValue:e.type,"onUpdate:modelValue":r=>e.type=r,options:fe,optionLabel:"label",optionValue:"value"},null,8,["modelValue","onUpdate:modelValue"]),s(o(S),{modelValue:e.text,"onUpdate:modelValue":r=>e.text=r,placeholder:"Texto"},null,8,["modelValue","onUpdate:modelValue"]),s(o(S),{modelValue:e.url,"onUpdate:modelValue":r=>e.url=r,placeholder:"URL"},null,8,["modelValue","onUpdate:modelValue"]),s(o(p),{icon:"pi pi-times",severity:"danger",onClick:r=>x.value.splice(u,1)},null,8,["onClick"])]))),128))])])])]),_:1},8,["visible","header"]),s(o(Ae))])])],64)}}},Na=$e(La,[["__scopeId","data-v-a2771b92"]]);export{Na as default};
