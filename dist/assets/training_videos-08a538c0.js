import{_ as z,l as G,G as H,j as u,k as O,I as C,r,aa as K,o as U,c as Y,e as t,f as o,a as e,t as i,u as N,h as p,g as Z,i as J,w as Q,q as W,x as X,A as ee,m as se,U as ae}from"./index-58581f28.js";import{v as te}from"./videoTrainingService-d63d6b20.js";import{u as oe}from"./urlService-89e3f0c9.js";const _=f=>(W("data-v-35217ae4"),f=f(),X(),f),le={class:"container py-2 px-2"},ie={class:"p-0 m-0"},ne={style:{display:"flex","justify-content":"end",width:"100%"}},de={style:{height:"100%"}},ce=["src"],re={class:"page-hero"},ue={class:"page-hero__content"},_e={class:"title-wrap"},ve=_(()=>e("i",{class:"fa fa-book"},null,-1)),pe={class:"uppercase"},me={class:"stats-wrap"},he={class:"progress-wrap"},fe={class:"muted"},ye=_(()=>e("div",{class:"hero-accent"},null,-1)),be={class:"table-card shadow-2"},ge={class:"grid p-2 header-row"},we=_(()=>e("h4",{class:"px-2"},[e("i",{class:"fa fa-book"}),p(),e("b",null,"Clases")],-1)),ke={class:"p-input-icon-left search-input"},xe=_(()=>e("i",{class:"pi pi-search"},null,-1)),Ce=_(()=>e("div",{class:"empty-state"},[e("i",{class:"fa-solid fa-circle-play bounce"}),e("p",null,[e("b",null,"No hay clases aún")]),e("p",{class:"muted"},"Cuando el curso tenga clases, aparecerán aquí.")],-1)),Se={class:"name-cell"},Pe={class:"name-text"},Te={class:"name-actions"},Ve={class:"desc-cell"},De=_(()=>e("i",{class:"fa-regular fa-message"},null,-1)),Ie={class:"truncate"},Be=["onClick"],Ue=["src"],Ne=_(()=>e("div",{class:"thumb-overlay"},[e("i",{class:"fa-solid fa-play"})],-1)),Me={class:"date"},Re={class:"date"},qe={class:"creator-cell"},Le={class:"avatar"},$e={__name:"training_videos",setup(f){const S=G(),P=H(),w=u(!1),m=u(!1),y=u([]),d=u({}),T=u({}),k=u({}),b=u({global:{value:null,matchMode:ee.CONTAINS}}),M=(l="")=>{const a=l.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]+)(?:\?.*)?/);return a!=null&&a[1]?`https://www.youtube.com/embed/${a[1]}`:""},V=l=>{T.value=l,w.value=!0},R=async l=>{const a={user_id:S.rawUserData.id,video_id:l.video_id};await se.post(`${ae}/mark-video-user`,a,"marcando video como visto"),await D(),m.value=!1},D=async()=>{const l=P.params.sequence_id,a=S.rawUserData.id,n=await te.getVideosBySequenceIdAndStudentId(l,a),h={};n.forEach(v=>{h[v.video_id]=!!v.video_user_mark}),d.value=h,y.value=n};O(async()=>{await D()});const q=(l,a)=>{m.value=!0,a&&(d.value[l.video_id]=!1,k.value=l)},L=(l="")=>l.split(" ").filter(Boolean).slice(0,2).map(a=>{var n;return(n=a[0])==null?void 0:n.toUpperCase()}).join(""),x=C(()=>y.value.length),I=C(()=>y.value.reduce((l,a)=>l+(d.value[a.video_id]?1:0),0)),B=C(()=>x.value?Math.round(I.value*100/x.value):0);return(l,a)=>{const n=r("Button"),h=r("Dialog"),v=r("Tag"),$=r("ProgressBar"),F=r("InputText"),A=r("Checkbox"),c=r("Column"),j=r("DataTable"),E=K("tooltip");return U(),Y("div",le,[t(h,{header:"Completar clase",visible:m.value,"onUpdate:visible":a[2]||(a[2]=s=>m.value=s),modal:"",style:{width:"30rem",textTransform:"capitalize"},class:"modern-dialog"},{footer:o(()=>[e("div",ne,[t(n,{onClick:a[0]||(a[0]=s=>m.value=!1),severity:"help",label:"No, no lo he visto aún"}),t(n,{onClick:a[1]||(a[1]=s=>R(k.value)),text:"",severity:"danger",label:"Sí, marcar como visto"})])]),default:o(()=>[e("h5",ie,[p(" Esta acción no se puede deshacer. ¿Seguro que deseas marcar el video "),e("b",null,i(k.value.video_name),1),p(" como completado? ")])]),_:1},8,["visible"]),t(h,{visible:w.value,"onUpdate:visible":a[3]||(a[3]=s=>w.value=s),class:"p-0 m-3 modern-dialog",header:"Reproductor de video",modal:"",style:{width:"min(90vw, 64rem)"}},{default:o(()=>[e("div",de,[e("iframe",{class:"p-0",width:"100%",style:{"aspect-ratio":"16 / 9"},src:M(T.value.video_link),title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:""},null,8,ce)])]),_:1},8,["visible"]),e("section",re,[e("div",ue,[e("div",_e,[ve,e("h2",pe,[e("b",null,i(N(P).params.sequence_name),1)])]),e("div",me,[t(v,{severity:"success",class:"ml-2"},{default:o(()=>[p(i(I.value)+" / "+i(x.value)+" completadas ",1)]),_:1}),e("div",he,[t($,{value:B.value},null,8,["value"]),e("small",fe,i(B.value)+"%",1)])])]),ye]),e("div",be,[t(j,{value:y.value,dataKey:"video_id",paginator:!0,rows:15,rowsPerPageOptions:[5,10,25,100],scrollable:"",showGridlines:"",scrollHeight:"65vh",stripedRows:"",tableStyle:"min-width: 64rem",filters:b.value,"onUpdate:filters":a[5]||(a[5]=s=>b.value=s),filterDisplay:"menu",globalFilterFields:["video_name","description","created_date","created_time","creator_name","video_id"],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} clases",class:"col-12 m-auto"},{header:o(()=>[e("div",ge,[we,e("span",ke,[xe,t(F,{modelValue:b.value.global.value,"onUpdate:modelValue":a[4]||(a[4]=s=>b.value.global.value=s),placeholder:"Buscar clase, creador, fecha…"},null,8,["modelValue"])])])]),empty:o(()=>[Ce]),default:o(()=>[t(c,{header:"Check",class:"px-4",style:{"min-width":"7rem"}},{body:o(({data:s})=>[t(A,{disabled:d.value[s.video_id],onChange:g=>q(s,d.value[s.video_id]),binary:"",modelValue:d.value[s.video_id],"onUpdate:modelValue":g=>d.value[s.video_id]=g},null,8,["disabled","onChange","modelValue","onUpdate:modelValue"])]),_:1}),t(c,{header:"ID",class:"px-4",field:"video_id",style:{"min-width":"8rem"}},{body:o(({data:s})=>[t(v,{severity:"info"},{default:o(()=>[p("#"+i(s.video_id),1)]),_:2},1024)]),_:1}),t(c,{header:"Nombre",class:"px-4",field:"video_name",style:{"min-width":"22rem"}},{body:o(({data:s})=>[e("div",Se,[e("h6",Pe,i(s.video_name),1),d.value[s.video_id]?(U(),Z(v,{key:0,severity:"success",class:"ml-2"},{default:o(()=>[p(" Completada ")]),_:1})):J("",!0)]),e("div",Te,[Q(t(n,{text:"",icon:"fa-solid fa-play",onClick:g=>V(s)},null,8,["onClick"]),[[E,"Reproducir",void 0,{bottom:!0}]]),t(n,{text:"",icon:"fa-solid fa-ellipsis-vertical"})])]),_:1}),t(c,{header:"Descripción",class:"px-4",field:"description",style:{"min-width":"28rem"}},{body:o(({data:s})=>[e("div",Ve,[De,e("span",Ie,i(s.description),1)])]),_:1}),t(c,{header:"Miniatura",class:"px-4",style:{"min-width":"16rem"}},{body:o(({data:s})=>[e("div",{class:"thumb",onClick:g=>V(s)},[e("img",{class:"thumb-img",src:N(oe).getThumbnail(s.video_link),alt:"Miniatura"},null,8,Ue),Ne],8,Be)]),_:1}),t(c,{header:"Fecha",class:"px-4",field:"created_date",style:{"min-width":"12rem"}},{body:o(({data:s})=>[e("h6",Me,i(s.created_date),1)]),_:1}),t(c,{header:"Hora",class:"px-4",field:"created_time",style:{"min-width":"10rem"}},{body:o(({data:s})=>[e("h6",Re,i(s.created_time),1)]),_:1}),t(c,{header:"Creador",class:"px-4",field:"creator_name",style:{"min-width":"16rem"}},{body:o(({data:s})=>[e("div",qe,[e("span",Le,i(L(s.creator_name)),1),e("h6",null,i(s.creator_name),1)])]),_:1})]),_:1},8,["value","filters"])])])}}},Ee=z($e,[["__scopeId","data-v-35217ae4"]]);export{Ee as default};
