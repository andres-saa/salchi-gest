import{z as Fe,f as n,Q as Se,h as $e,B as Ee,u as De,r as $,o as T,c as E,d as o,w as i,F as Ve,a as l,R as Ae,U as f,a4 as J,q as C,l as w,P as F,k as g,t as m,a2 as Pe,J as Ue,n as de,v as Ne}from"./index-224de96d.js";import{_ as je}from"./file-4fa33ca9.js";const Be=l("h4",null,"Seleccione el elemento a eliminar:",-1),He={style:{display:"flex",gap:"1rem"}},Re=l("p",null,"¿Estás seguro de que quieres eliminar este archivo?",-1),Ie=["onSubmit"],Oe={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},Me=["onSubmit"],ze={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},qe=l("p",{class:"col-12 text-center text-3xl p-0 m-0",style:{"font-weight":"bold"}},"Guias, formatos, manuales y mas",-1),Je=l("p",{class:"col-12 text-center text-xl p-0 mb-5",style:{"font-weight":"bold"}},"Asi lo hacemos en salchimonster",-1),Ge={class:"grid gap-3"},Ke={class:"grid col-12 p-0 gap-3 my-4"},Qe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},We={key:0,class:"m-0 text-2xl my-4"},Xe={key:1,class:"m-0 text-2xl my-4"},Ye={key:2,class:"m-0 text-2xl my-4"},Ze={key:3,class:"m-0 text-2xl my-4"},ea={class:"block mt-2 md:mt-0 p-input-icon-left"},aa=l("i",{class:"pi pi-search"},null,-1),ta=l("span",{class:"p-column-title"},"Code",-1),oa={class:"",style:{position:"relative",display:"flex","justify-content":"center"}},la={style:{color:"white",position:"absolute","font-weight":"bold",bottom:"0.9rem","text-transform":"uppercase"}},sa=l("span",{class:"p-column-title"},"Code",-1),ra=l("span",{class:"p-column-title"},"Code",-1),na=l("span",{class:"p-column-title"},"Code",-1),ia=l("span",{class:"p-column-title"},"Code",-1),da={class:"text-right"},ca={class:"text-right"},ua=["onSubmit"],pa={class:"field my-3",style:{display:"flex",gap:"1rem","justify-content":"end","flex-direction":"column"}},ma={key:0,style:{"background-color":"var(--green-100)","border-radius":"0.2rem"},class:"col-12 my-4"},va={style:{display:"flex",gap:"1rem","justify-content":"end"}},ga={__name:"guias",setup(fa){const s=Fe(),ce={pdf:"#FF0000",doc:"#2B579A",docx:"#2B579A",xls:"#217346",xlsx:"#217346",ppt:"#D24726",pptx:"#D24726",psd:"#001E36",ai:"#FF9A00",indd:"#FF3366",jpg:"#F0D0A0",jpeg:"#F0D0A0",png:"#0DB7ED",gif:"#FFD700",bmp:"#4B5320",tiff:"#FF7D40",svg:"#FFB6C1",mp3:"#008000",wav:"#0000FF",aac:"#800080",flac:"#FF4500",ogg:"#FF6347",csv:"#217346"},P=n(!1),D=n(null),G=n([]),ue=()=>{D.value=null},U=async()=>{await O().then(e=>k.value=e),await z().then(e=>{_.value=e}),await q().then(e=>{x.value=e}),G.value=[..._.value.map(e=>({id:e.id_area,name:e.area_name,type:"area"})),...x.value.map(e=>({id:e.id_type,name:e.type_name,type:"type"}))]},pe=async()=>{if(!D.value)return;const{id:e,type:a}=D.value;let v=`${f}/`;a==="area"?v+=`area/${e}`:a==="type"&&(v+=`archived-file-type/${e}`);try{const r=await fetch(v,{method:"DELETE"});if(!r.ok)throw new Error(`HTTP error! Status: ${r.status}`);y.add({severity:"success",summary:"Éxito",detail:`${a==="area"?"Área":"Tipo"} eliminado correctamente`,life:3e3}),a==="area"?z().then(c=>{_.value=c,U()}):q().then(c=>{U(),x.value=c}),P.value=!1}catch(r){y.add({severity:"error",summary:"Error",detail:r.message,life:3e3})}},N=n(!1),j=n({area_name:""}),B=n(!1),H=n({type_name:""}),me=()=>{j.value={area_name:""}},ve=()=>{H.value={type_name:""}},K=async()=>{s.setLoading(!0,"creando area");try{const e=await fetch(`${f}/area`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j.value)});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);y.add({severity:"success",summary:"Éxito",detail:"Área creada correctamente",life:3e3}),z().then(a=>_.value=a),N.value=!1,s.setLoading(!1,"cargando archivos")}catch(e){y.add({severity:"error",summary:"Error",detail:e.message,life:3e3}),s.setLoading(!1,"cargando archivos")}},Q=async()=>{s.setLoading(!0,"creando tipo");try{const e=await fetch(`${f}/archived-file-type`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H.value)});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);y.add({severity:"success",summary:"Éxito",detail:"Tipo de archivo creado correctamente",life:3e3}),q().then(a=>x.value=a),B.value=!1,s.setLoading(!1,"cargando archivos")}catch(e){y.add({severity:"error",summary:"Error",detail:e.message,life:3e3}),s.setLoading(!1,"cargando archivos")}},_=n([]),x=n([]),V=n(!1),R=n(null),fe=e=>{R.value=e,V.value=!0},he=async()=>{if(s.setLoading(!0,"borrando archivo"),!!R.value)try{const e=await fetch(`${f}/archived-file/${R.value}`,{method:"DELETE"});if(e.ok)s.setLoading(!1,"borrando archivo"),y.add({severity:"success",summary:"Éxito",detail:"Archivo eliminado correctamente",life:3e3}),O().then(a=>k.value=a);else throw new Error(`Error al eliminar el archivo: ${e.statusText}`)}catch(e){s.setLoading(!1,"borrando archivo"),y.add({severity:"error",summary:"Error",detail:e.message,life:3e3})}finally{s.setLoading(!1,"borrando archivo"),V.value=!1,R.value=null}},d=n(x.value[0]),u=n(_.value[0]),h=n({}),ye=n({}),k=n([]),W=n(null),A=n(!1),S=n({archived_file_id:"",custom_filename:"",file:null}),ge=()=>{A.value=!0},X=()=>{A.value=!1,S.value={archived_file_id:"",custom_filename:"",file:null}},_e=e=>{S.value.file=e.target.files[0]},Y=async()=>{if(S.value.file){const e=new FormData;e.append("file",S.value.file),e.append("id_area",h.value.area.id_area),e.append("id_type",h.value.type.id_type),e.append("file_name",h.value.file_name);try{const a=await fetch(`${f}/upload-archived-file/`,{method:"POST",body:e});if(a.ok){const v=await a.json();y.add({severity:"success",summary:"Éxito",detail:"Archivo subido correctamente",life:3e3}),X(),O().then(r=>k.value=r)}else throw new Error(`Error al subir el archivo: ${a.statusText}`)}catch(a){y.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}}else y.add({severity:"warn",summary:"Advertencia",detail:"Por favor, selecciona un archivo",life:3e3})},Z=n();n([]);const I=n(null),be=()=>{I.value={global:{value:null,matchMode:Ae.CONTAINS}}};Se(()=>{be()});const we=(e,a,v)=>{const r=`${f}/get-archived-file/${e}/${a}/${v.split(".")[0]}`;fetch(r).then(c=>{if(c.ok)return c.blob();throw new Error("Network response was not ok.")}).then(c=>{const L=window.URL.createObjectURL(c),p=document.createElement("a");p.href=L,p.download=v,document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(L)}).catch(c=>console.error("Error downloading the file:",c))};async function O(){s.setLoading(!0,"cargando archivos");try{const e=await fetch(`${f}/archived-files`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return s.setLoading(!1,"cargando archivos"),a}catch(e){s.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function z(){s.setLoading(!0,"cargando areas");try{const e=await fetch(`${f}/areas`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return s.setLoading(!1,"cargando archivos"),a}catch(e){s.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function q(){s.setLoading(!0,"cargando tipos");try{const e=await fetch(`${f}/archived-file-types    `);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return s.setLoading(!1,"cargando archivos"),a}catch(e){s.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}$e(()=>{U()});async function xe(){if(s.setLoading(!0,"cargando archivos"),!u.value){s.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${f}/archived-files/area/${u.value.id_area}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return s.setLoading(!1,"cargando archivos"),a}catch(e){s.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function ke(){if(s.setLoading(!0,"cargando archivos"),!d.value){s.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${f}/archived-files/type/${d.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return s.setLoading(!1,"cargando archivos"),a}catch(e){s.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function Le(){if(s.setLoading(!0,"cargando archivos"),!d.value||!u.value){s.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${f}/archived-files/${u.value.id_area}/${d.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return s.setLoading(!1,"cargando archivos"),a}catch(e){console.error("Error al obtener usuarios agrupados por sede:",e),s.setLoading(!1,"cargando archivos")}}const Te=()=>{u.value&&d.value?Le().then(e=>k.value=e):!u.value&&d.value?xe().then(e=>k.value=e):u.value&&!d.value?ke().then(e=>k.value=e):O()},y=Ee();return De(),(e,a)=>{var ee,ae,te,oe;const v=$("Dropdown"),r=$("Button"),c=$("Dialog"),L=$("InputText"),p=$("Column"),Ce=$("DataTable");return T(),E(Ve,null,[o(c,{visible:P.value,"onUpdate:visible":a[1]||(a[1]=t=>P.value=t),header:"Eliminar área o tipo",modal:"",closable:!0,onHide:ue},{default:i(()=>[l("div",null,[Be,l("div",He,[o(v,{style:{width:"60%"},modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=t=>D.value=t),options:G.value,optionLabel:"name",placeholder:"Seleccione un área o tipo"},null,8,["modelValue","options"]),o(r,{style:{width:"40%"},label:"Eliminar",icon:"pi pi-check",class:"p-button-danger",onClick:pe})])])]),_:1},8,["visible"]),o(c,{visible:V.value,"onUpdate:visible":a[3]||(a[3]=t=>V.value=t),header:"Confirmar eliminación",modal:"",closable:!1},{default:i(()=>[Re,o(r,{label:"No",icon:"pi pi-times",onClick:a[2]||(a[2]=t=>V.value=!1),class:"p-button-text"}),o(r,{label:"Sí",icon:"pi pi-check",onClick:he,class:"p-button-danger"})]),_:1},8,["visible"]),o(c,{visible:N.value,"onUpdate:visible":a[5]||(a[5]=t=>N.value=t),header:"Crear nueva área",modal:"",closable:!0,onHide:me},{default:i(()=>[l("form",{onSubmit:J(K,["prevent"])},[o(L,{modelValue:j.value.area_name,"onUpdate:modelValue":a[4]||(a[4]=t=>j.value.area_name=t),placeholder:"Nombre del área",class:"w-full"},null,8,["modelValue"]),l("div",Oe,[o(r,{rounded:"",class:"mt-4",label:"Crear",icon:"pi pi-check",onClick:K})])],40,Ie)]),_:1},8,["visible"]),o(c,{visible:B.value,"onUpdate:visible":a[7]||(a[7]=t=>B.value=t),header:"Crear nuevo tipo de archivo",modal:"",closable:!0,onHide:ve},{default:i(()=>[l("form",{onSubmit:J(Q,["prevent"])},[o(L,{modelValue:H.value.type_name,"onUpdate:modelValue":a[6]||(a[6]=t=>H.value.type_name=t),placeholder:"Nombre del tipo de archivo",class:"w-full"},null,8,["modelValue"]),l("div",ze,[o(r,{rounded:"",class:"mt-4",label:"Crear",icon:"pi pi-check",onClick:Q})])],40,Me)]),_:1},8,["visible"]),qe,Je,o(Ce,{class:"card mb-4 p-0 my-0 xl:shadow-5 p-4",grid:"",style:{"max-width":"900px",border:"none",margin:"auto","background-color":"transparent"},ref:"dt",value:k.value,selection:Z.value,"onUpdate:selection":a[15]||(a[15]=t=>Z.value=t),dataKey:"id",paginator:!0,rows:10,filters:I.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} archivos",responsiveLayout:"scroll",scrollable:"","scroll-height":"62vh"},{header:i(()=>{var t,M,le,se,re,ne,ie;return[l("div",Ge,[o(r,{onClick:a[8]||(a[8]=b=>A.value=!0),rounded:"",severity:"success"},{default:i(()=>[l("i",{class:C([w(F).UPLOAD,"pr-3"])},null,2),g(" Nuevo archivo")]),_:1}),o(r,{rounded:"",severity:"warning",onClick:a[9]||(a[9]=b=>N.value=!0)},{default:i(()=>[l("i",{class:C([w(F).PLUS,"pr-3"])},null,2),g(" Nueva area ")]),_:1}),o(r,{rounded:"",severity:"info",onClick:a[10]||(a[10]=b=>B.value=!0)},{default:i(()=>[l("i",{class:C([w(F).PLUS,"pr-3"])},null,2),g(" Nuevo tipo de archivo ")]),_:1}),o(r,{rounded:"",severity:"danger",onClick:a[11]||(a[11]=()=>{P.value=!0,U()})},{default:i(()=>[l("i",{class:C([w(F).TRASH,"pr-3"])},null,2),g(" Eliminar área o tipo ")]),_:1})]),l("div",Ke,[o(v,{style:{height:"3rem","text-justify":"center"},class:"col-12 lg:col-5 p-0",optionLabel:"area_name",modelValue:u.value,"onUpdate:modelValue":a[12]||(a[12]=b=>u.value=b),options:_.value,placeholder:"Area de la empresa"},null,8,["modelValue","options"]),o(v,{style:{height:"3rem","text-justify":"center"},class:"col-12 lg:col-5 p-0",modelValue:d.value,"onUpdate:modelValue":a[13]||(a[13]=b=>d.value=b),optionLabel:"type_name",options:x.value,placeholder:"Tipo de archivo"},null,8,["modelValue","options"]),o(r,{onClick:Te,style:{height:"3rem","border-radius":"50%","aspect-ratio":"1/1",display:"flex","align-items":"center","justify-content":"center"},class:"text-center",severity:"success",size:"small"},{default:i(()=>[l("i",{class:C(w(F).SEARCH)},null,2)]),_:1})]),l("div",Qe,[!d.value&&!u.value?(T(),E("p",We,m((t=d.value)==null?void 0:t.type_name)+" Todos los tipos de archivos de todas las areas "+m((M=u.value)==null?void 0:M.area_name),1)):d.value&&!u.value?(T(),E("p",Xe,m((le=d.value)==null?void 0:le.type_name)+" de todas las areas ",1)):!d.value&&u.value?(T(),E("p",Ye,m((se=d.value)==null?void 0:se.type_name)+" Todos los tipos de archivos del area "+m((re=u.value)==null?void 0:re.area_name),1)):(T(),E("p",Ze,m((ne=d.value)==null?void 0:ne.type_name)+" del area de "+m((ie=u.value)==null?void 0:ie.area_name),1)),w(Pe)()==ye.value.creator_id?(T(),Ue(r,{key:4,label:"Subir archivo",icon:"pi pi-upload",class:"p-button-success ml-4 p-2",onClick:ge})):de("",!0),l("span",ea,[aa,o(L,{class:"",modelValue:I.value.global.value,"onUpdate:modelValue":a[14]||(a[14]=b=>I.value.global.value=b),placeholder:"Buscar..."},null,8,["modelValue"])])])]}),default:i(()=>[o(p,{class:"p-2",selectionMode:"multiple",headerStyle:"width: 3rem; ",frozen:""}),o(p,{class:"p-2",field:"id",header:"Id",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ta,g(" "+m(t.data.id_file),1)]),_:1}),o(p,{class:"p-2",field:"id",header:"",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[l("div",oa,[l("img",{style:Ne([{height:"4rem","aspect-ratio":"1 / 1","object-fit":"contain","border-radius":"0.5rem"},`background-color:${ce[t.data.file_extension]} `]),class:"p-1",src:je,alt:""},null,4),l("span",la,m(t.data.file_extension.slice(0,4)),1)])]),_:1}),o(p,{class:"p-2",field:"file_name",header:"Nombre",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[sa,g(" "+m(t.data.file_name),1)]),_:1}),o(p,{class:"p-2",field:"type",header:"Tipo",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ra,g(" "+m(t.data.type_name),1)]),_:1}),o(p,{class:"p-2",field:"type",header:"Area",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[na,g(" "+m(t.data.area_name),1)]),_:1}),o(p,{class:"p-2",field:"upload_date",header:"Fecha",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ia,g(" "+m(t.data.upload_date),1)]),_:1}),o(p,{class:"p-2",field:"location",header:"Acciones",sortable:!0,frozen:"",alignFrozen:"right",headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[o(r,{text:"",class:"p-0 mx-2",severity:"success",onClick:M=>we(t.data.id_area,t.data.id_type,t.data.file_name)},{default:i(()=>[l("span",da,[l("i",{class:C(w(F).DOWNLOAD)},null,2)])]),_:2},1032,["onClick"]),o(r,{text:"",class:"p-0 mx-2",severity:"danger",onClick:M=>fe(t.data.id_file)},{default:i(()=>[l("span",ca,[l("i",{class:C(w(F).TRASH)},null,2)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),o(c,{visible:A.value,"onUpdate:visible":a[20]||(a[20]=t=>A.value=t),style:{width:"450px"},header:`Subir ${(ae=(ee=h.value)==null?void 0:ee.type)==null?void 0:ae.type_name} para el area de ${(oe=(te=h.value)==null?void 0:te.area)==null?void 0:oe.area_name}`,modal:"",closable:!0,onHide:X},{default:i(()=>[l("form",{onSubmit:J(Y,["prevent"]),enctype:"multipart/form-data"},[o(L,{optionLabel:"area_name",placeholder:"Nombre del archivo",class:"col-12 my-0",style:{padding:"0.8rem 10px"},modelValue:h.value.file_name,"onUpdate:modelValue":a[16]||(a[16]=t=>h.value.file_name=t),options:_.value},null,8,["modelValue","options"]),o(v,{optionLabel:"area_name",placeholder:"Area de la empresa",class:"col-12 p-0 my-3",modelValue:h.value.area,"onUpdate:modelValue":a[17]||(a[17]=t=>h.value.area=t),options:_.value},null,8,["modelValue","options"]),o(v,{class:"col-12 p-0",placeholder:"Tipo de archivo",modelValue:h.value.type,"onUpdate:modelValue":a[18]||(a[18]=t=>h.value.type=t),optionLabel:"type_name",options:x.value},null,8,["modelValue","options"]),l("div",pa,[S.value.file?(T(),E("div",ma,m(S.value.file.name),1)):de("",!0),l("div",va,[l("input",{type:"file",id:"file",ref_key:"fileInput",ref:W,onChange:_e,required:"",style:{display:"none"}},null,544),o(r,{rounded:"",onClick:a[19]||(a[19]=()=>{W.value.click()})},{default:i(()=>[g(" Cargar archivo")]),_:1}),o(r,{rounded:"",severity:"success",label:"Enviar",class:"",onClick:Y})])])],40,ua)]),_:1},8,["visible","header"])],64)}}};export{ga as default};
