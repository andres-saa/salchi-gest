import{_ as H,l as q,r as i,i as G,a as c,o as L,c as W,d as s,w as d,b as a,F as Y,B as z,s as R,t as $,p as J,g as K}from"./index-cb2baabe.js";import{s as Q}from"./siteService-7f1f71e7.js";import"./sass.default-b8072c4d.js";import{p as T}from"./purchaseOrderService-794d5b0e.js";import{u as F,w as X}from"./xlsx-4f9172c7.js";const f=D=>(J("data-v-9a36b23e"),D=D(),K(),D),Z={class:"grid"},ee={class:"col-12 px-0 mx-0"},te={class:"col-12",style:{display:"flex","flex-direction":"column"}},se=f(()=>a("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),ae={class:"col-12",style:{display:"flex","flex-direction":"column"}},le=f(()=>a("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),oe={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},ne={class:"col-12",style:{display:"flex","justify-content":"center"}},ie={class:"m-auto",style:{"max-width":"1024px"}},de={class:"m-0 col-12",style:{"align-items":"center"}},ce={class:"p-0 mb-3",style:{display:"flex","align-items":"center",gap:"1rem"}},re=f(()=>a("span",{class:"text-xl"},[a("b",null,"Sedes")],-1)),pe={class:"col p-0",style:{display:"flex",gap:"1rem","align-items":"center"}},ue=f(()=>a("span",{class:"text-xl"},[a("b",null,"Periodo")],-1)),me={class:"col-12 px-3",style:{display:"flex","justify-content":"end"}},_e={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},ve={class:"grid",style:{"align-items":"center"}},ye=f(()=>a("div",{class:"col-12 md:col-6 p-3"},[a("span",{class:"text-xl",style:{width:"100%"}}," Gestionar ordenes de compra")],-1)),he={class:"col-12 md:col-6 p-3"},xe={style:{"min-width":"max-content"}},we={style:{"min-width":"max-content"}},ge={class:"m-0 p-0",style:{display:"flex",width:"min-content","justify-content":"start","align-items":"center",gap:"0.5rem"}},fe={__name:"purchaseOrderReports",setup(D){const B=q(),V=i([]),b=i([{}]),u=i(!1),m=i(new Date(new Date().setDate(new Date().getDate()-7))),r=i(new Date),h=i(new Date(new Date().setDate(new Date().getDate()-7))),x=i(new Date),k=i(),w=i(),j=(o,e)=>{h.value=o,x.value=e},g=o=>{const e=new Date,l=new Date(e);l.setDate(l.getDate()+1);const n=new Date(e);n.setDate(e.getDate()-o),m.value=n,o==1?(r.value=e,x.value=r.value,h.value=m.value,u.value=!1):(r.value=l,h.value=m.value,x.value=r.value,u.value=!1),M()};G(async()=>{V.value=await Q.getSites(),b.value=V.value,k.value=await T.getAllpurchaseOrderReports()}),(()=>{w.value={global:{value:null,matchMode:z.CONTAINS}}})();function S(o){const e=new Date(o),l=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),_=e.getDate().toString().padStart(2,"0");return`${l}-${n}-${_}`}const M=async()=>{const o=b.value.map(n=>n.site_id);B.rawUserData.id;const e=S(h.value),l=S(x.value);k.value=await T.getAllpurchaseOrderReportsFiltered(o,e,l)},O=i([]),U=async(o,e,l)=>{O.value=await T.getpurchaseOrderEntriesBypurchaseOrderID(o);const n=O.value.map(v=>({Producto:v.item_name,Cantidad:v.quantity,"Unidad de medida":v.unit_measure})),_=F.json_to_sheet(n);_["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const C=F.book_new();F.book_append_sheet(C,_,"Usuarios"),X(C,`Orden_de_compra_${e}_${l} .xlsx`)},A=async()=>{k.value.forEach(e=>{var l;U(e.purchase_order_id,e.site_name,(l=e.expedition_date)==null?void 0:l.split("T")[0])})};return(o,e)=>{const l=c("Button"),n=c("Calendar"),_=c("Dialog"),C=c("MultiSelect"),v=c("InputText"),p=c("Column"),E=c("Tag"),N=c("router-link"),P=c("DataTable");return L(),W(Y,null,[s(_,{class:"mx-2",visible:u.value,"onUpdate:visible":e[8]||(e[8]=t=>u.value=t),modal:"",header:"Periodo",style:{width:"25rem"}},{default:d(()=>[a("div",Z,[a("div",ee,[s(l,{text:"",label:"Hoy",onClick:e[0]||(e[0]=t=>g(0)),class:"p-button-text col-12 p-1 m-0"}),s(l,{text:"",label:"Ayer",onClick:e[1]||(e[1]=t=>g(1)),class:"p-button-text col-12 p-1 m-0"}),s(l,{text:"",label:"Últimos 7 días",onClick:e[2]||(e[2]=t=>g(7)),class:"p-button-text col-12 p-1 m-0"}),s(l,{text:"",label:"Últimos 14 días",onClick:e[3]||(e[3]=t=>g(14)),class:"p-button-text col-12 p-1"}),s(l,{text:"",label:"Últimos 28 días",onClick:e[4]||(e[4]=t=>g(28)),class:"p-button-text col-12 p-0"})]),a("div",te,[se,s(n,{style:{"min-width":"max-content"},modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value=t)},null,8,["modelValue"])]),a("div",ae,[le,s(n,{style:{"min-width":"max-content"},modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=t=>r.value=t),showWeek:""},null,8,["modelValue"])]),a("div",oe,[a("div",ne,[s(l,{onClick:e[7]||(e[7]=()=>{j(m.value,r.value),u.value=!1})},{default:d(()=>[R("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),a("div",ie,[a("div",de,[a("div",ce,[re,s(C,{style:{},display:"chip",multiple:"",modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=t=>b.value=t),optionLabel:"site_name",options:V.value.filter(t=>t.site_id!=12&t.site_id!=13),class:"text-sm multi p-0"},null,8,["modelValue","options"])]),a("div",pe,[ue,s(v,{class:"",onClick:e[10]||(e[10]=t=>u.value=!0),style:{height:"2.7rem"},value:`${S(h.value)}  |  ${S(x.value)}`,placeholder:"periodo"},null,8,["value"]),s(l,{onClick:M,icon:"pi pi-search",severity:"help",class:"text-center p-0 col-12 md:p-0",style:{height:"2.5rem",width:"min-content","aspect-ratio":"1 / 1","font-weight":"bold","border-radius":"50%",display:"flex","justify-content":"center"}})])]),a("div",me,[s(l,{severity:"help",icon:"pi pi-download",label:"Descargar todo",onClick:A})])]),a("div",_e,[s(P,{style:{"max-width":"1024px"},filters:w.value,"onUpdate:filters":e[12]||(e[12]=t=>w.value=t),class:"col-12 m-auto",value:k.value,tableStyle:"min-width: 50rem;"},{header:d(()=>[a("div",ve,[ye,a("div",he,[s(v,{style:{width:"100%"},class:"",modelValue:w.value.global.value,"onUpdate:modelValue":e[11]||(e[11]=t=>w.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:d(()=>[s(p,{class:"py-1",field:"purchase_order_id",header:"ID"}),s(p,{class:"py-1",field:"employer_name",header:"Responsable"}),s(p,{class:"py-1",field:"site_name",header:"Sede"}),s(p,{class:"py-1",field:"date",header:"Fecha"},{body:d(t=>{var y;return[a("p",xe,$((y=t.data.expedition_date)==null?void 0:y.split("T")[0]),1)]}),_:1}),s(p,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:d(t=>{var y;return[a("span",we,$((y=t.data.expedition_date)==null?void 0:y.split("T")[1]),1)]}),_:1}),s(p,{class:"py-1",field:"date",header:"Estado actual"},{body:d(t=>[s(E,{severity:"danger",style:{width:"100%",height:"2rem"}},{default:d(()=>[R($(t.data.current_status),1)]),_:2},1024)]),_:1}),s(p,{style:{width:"20px"},class:"py-1 mx-0 px-0",field:"date",header:"Acciones"},{body:d(t=>[a("div",ge,[s(N,{to:`/purchase-order/purchase-order-view/${t.data.purchase_order_id}`},{default:d(()=>[s(l,{style:{height:"2rem"},severity:"help",class:"p-1",icon:"pi pi-eye"})]),_:2},1032,["to"]),s(l,{style:{height:"2rem"},onClick:y=>{var I;return U(t.data.purchase_order_id,t.data.site_name,(I=t.data.expedition_date)==null?void 0:I.split("T")[0])},severity:"success",class:"p-1",icon:"pi pi-download"},null,8,["onClick"]),s(l,{style:{height:"2rem"},severity:"warning",class:"p-1",icon:"pi pi-history p-0 m-0"})])]),_:1})]),_:1},8,["filters","value"])])],64)}}},$e=H(fe,[["__scopeId","data-v-9a36b23e"]]);export{$e as default};
