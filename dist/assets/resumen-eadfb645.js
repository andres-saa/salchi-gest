import{ab as de,U as le,B as ce,l as ge,_ as ye,G as fe,D as ke,j as W,k as we,H as xe,I as F,r as J,o as r,c as d,a as e,F as z,b as U,t as s,h as m,u as t,i as g,n as Se,g as A,f as w,e as P,q as Pe,x as De}from"./index-9852904f.js";import{a as K,u as he}from"./site-2942a7b5.js";import{u as ve}from"./user-77287ecc.js";import{u as me}from"./ventas-7faf1005.js";import{f as x}from"./formatoPesos-e824e30b.js";const L=me(),D=K(),V=he(),b=ve(),ue=()=>{var q,T,M,G,I,B;b.user.was_reserva=!1,D.sending_order=!0;const a=D.cart,i=ge(),p=V.location.site.site_id,C=V.location.site.pe_site_id,v=(q=b.user.payment_method_option)==null?void 0:q.id,u=(T=b.user.order_type)==null?void 0:T.id;if(!u){alert("Error: Debe seleccionar un método de entrega.");return}const o=b.user.placa,S=v===7?0:V.location.neigborhood.delivery_price;if(u===2&&p===33&&(!o||o.trim()==="")){alert("Error: Debe proporcionar la placa del vehículo para recogida.");return}let O=((M=D==null?void 0:D.cart)==null?void 0:M.order_notes)??"";const j={user_name:b.user.name,user_phone:(G=b.user.phone_number)==null?void 0:G.split(" ").join(""),user_address:` ${b.user.address} ${(B=(I=V.location)==null?void 0:I.neigborhood)==null?void 0:B.name}`||"",email:b.user.email};return{order_products:[],site_id:p,pe_site_id:C,order_type_id:u,placa:o,delivery_person_id:4,payment_method_id:v,delivery_price:S,order_notes:O||"SIN NOTAS",user_data:j,order_aditionals:[],pe_json:a,total:0,inserted_by:i.rawUserData.id}},Ne=()=>{var o,S;b.user.was_reserva=!0,D.sending_order=!0;const a=D.cart.products.map(f=>({product_instance_id:f.product.id,quantity:f.quantity})),i=V.location.siteReservas.site_id,p=(o=b.user.payment_method_option)==null?void 0:o.id,C=D.cart.order_notes,v={user_name:b.user.name,user_phone:(S=b.user.phone_number)==null?void 0:S.split(" ").join(""),user_address:"Debe ir a la sede",email:b.user.email};return{order_products:a,site_id:i,delivery_person_id:4,payment_method_id:p,delivery_price:0,order_notes:C||"SIN NOTAS",user_data:v,order_aditionals:[]}},_e={async sendOrder(){const a=ue(),i=K();if(!pe(a))return i.sending_order=!1,null;try{L.setLoading(!0,`enviando tu pedido ${b.user.name}`);const p=await de.post(`${le}/order`,a);if(p.status===200)i.sending_order=!1,i.last_order=p.data,L.setLoading(!0,"enviando tu pedido"),ce.push("/call-center-vender/gracias");else return console.error("An error occurred while sending the order:",p.status),alert("An error occurred while sending the order. Please try again."),L.setLoading(!1,"enviando tu pedido"),i.sending_order=!1,null}catch(p){return console.error("An error occurred while sending the order:",p),L.setLoading(!1,"enviando tu pedido"),i.sending_order=!1,alert("An error occurred while sending the order. Please check your internet connection and try again."),i.sending_order=!1,null}},preparar_orden(){ue()},async sendOrderReserva(){const a=Ne(),i=K();if(b.user.was_reserva=!0,!pe(a))return i.sending_order=!1,null;try{L.setLoading(!0,`enviando tu pedido ${b.user.name}`);const p=await de.post(`${le}/order`,a);if(p.status===200)i.sending_order=!1,i.last_order=p.data,L.setLoading(!1,"enviando tu pedido"),ce.push("/gracias");else return console.error("An error occurred while sending the order:",p.status),alert("An error occurred while sending the order. Please try again."),L.setLoading(!1,"enviando tu pedido"),i.sending_order=!1,null}catch(p){return console.error("An error occurred while sending the order:",p),L.setLoading(!1,"enviando tu pedido"),i.sending_order=!1,alert("An error occurred while sending the order. Please check your internet connection and try again."),i.sending_order=!1,null}}};function pe(a){return!a.user_data.user_name||a.user_data.user_name.trim()==""||!a.user_data.user_phone||a.user_data.user_phone.trim()==""||!a.user_data.user_address||a.user_data.user_address.trim()==""||a.user_data.email.trim()==""?(alert("Sus datos estan incompletos por favor reviselos"),D.sending_order=!1,!1):!a.site_id||a.delivery_price==null?(alert("Site information is missing. Please select a valid site."),D.sending_order=!1,!1):!0}const l=a=>(Pe("data-v-a3a0c16c"),a=a(),De(),a),Ce={class:"43f1 43f5 md:43f0 43f12"},Ae={class:"sticky-summary 43f12 43f3 43f0"},Le=l(()=>e("h5",null,[e("b",null,"Resumen")],-1)),Te=l(()=>e("h5",null,[e("b",null,"productos")],-1)),$e={class:"43f0 43f0 product-line"},Fe={class:"43f6 43f2 43f0 43f0"},Ie={class:"43f0"},Ee={class:"span-minwidth"},Re={style:{"font-weight":"400"}},Oe={style:{"margin-right":".5rem"}},Be={class:"font-weight-400"},ze={class:"43f6 43f0 text-right 43f2"},Ue={key:0,class:"text-end"},Ve={key:1,class:"text-end"},je={class:"addition-ite43finner"},qe={class:"text adicion"},Me={key:0,class:"pl-2 text-sm"},Ge=l(()=>e("hr",{class:"43f0 43f2"},null,-1)),He={class:"grid summary-grid"},Je=l(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Subtotal")])],-1)),Ke={class:"col-6 my-0 text-right py-0 text-right text-end"},Qe={class:"col-6 my-0 py-0"},We=l(()=>e("b",null,"Domicilio",-1)),Xe=[We],Ye={class:"col-6 my-0 text-right py-0 text-end"},Ze={key:0,class:"primary-color"},et=l(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Total")])],-1)),tt={key:0,class:"col-6 my-0 text-right py-0 text-end"},st={key:4},ot={key:5},rt={key:6},nt=l(()=>e("h3",{style:{margin:"0"}},[e("b",null,"Confirmar pedido")],-1)),it={key:0,class:"validation-box"},at={class:"errors-list"},dt={class:"confirm-grid"},lt={class:"confirm-section"},ct=l(()=>e("h4",null,"Datos del cliente",-1)),ut={class:"clean-list"},_t=l(()=>e("b",null,"Nombre:",-1)),pt=l(()=>e("b",null,"Teléfono:",-1)),ht={key:0},vt=l(()=>e("b",null,"Email:",-1)),mt=l(()=>e("b",null,"Método de entrega:",-1)),bt={key:1},gt=l(()=>e("b",null,"Dirección:",-1)),yt=l(()=>e("b",null,"Sede:",-1)),ft={key:2},kt=l(()=>e("b",null,"Placa:",-1)),wt={style:{display:"flex",gap:".5rem","flex-wrap":"wrap",margin:".25rem 0"}},xt={key:0,class:"notes-box"},St=l(()=>e("b",null,"Notas:",-1)),Pt={class:"confirm-section"},Dt=l(()=>e("h4",null,"Productos",-1)),Nt={class:"items-table"},Ct=l(()=>e("div",{class:"items-head"},[e("div",null,"Producto"),e("div",{class:"text-right"},"Cant."),e("div",{class:"text-right"},"Unit."),e("div",{class:"text-right"},"Total")],-1)),At={class:"ellipsis"},Lt={class:"text-right"},Tt={class:"text-right"},$t={class:"text-right"},Ft={class:"items-foot"},It=l(()=>e("div",{class:"grow"},null,-1)),Et=l(()=>e("div",{class:"text-right",style:{"grid-column":"span 2"}},[e("b",null,"Subtotal")],-1)),Rt={class:"text-right"},Ot=l(()=>e("div",{class:"grow"},null,-1)),Bt=l(()=>e("div",{class:"text-right",style:{"grid-column":"span 2"}},"Domicilio",-1)),zt={class:"text-right"},Ut=l(()=>e("div",{class:"grow"},null,-1)),Vt=l(()=>e("div",{class:"text-right",style:{"grid-column":"span 2"}},[e("b",null,"Total a pagar")],-1)),jt={class:"text-right"},qt={style:{display:"flex",gap:".5rem",width:"100%","justify-content":"flex-end"}},Mt={__name:"resumen",setup(a){const i=fe(),p=ke(),C=me(),v=K(),u=he(),o=ve(),S=W(!1);W({}),we(()=>{}),xe(()=>v.cart.additions,()=>{},{deep:!0});const f=W({visible:!1,action:null}),O=n=>{f.value.action=n,f.value.visible=!0},j=F(()=>{var n;return!o.user.order_type||((n=o.user.order_type)==null?void 0:n.id)!==2}),Q=F(()=>{var n,_,y;return((n=o.user.order_type)==null?void 0:n.id)===2&&((y=(_=u.location)==null?void 0:_.site)==null?void 0:y.site_id)===33}),q=F(()=>{var n;return o.user.address||((n=o.user.site)==null?void 0:n.description)||"—"}),T=F(()=>{var n,_;return Number(((_=(n=u==null?void 0:u.location)==null?void 0:n.neigborhood)==null?void 0:_.delivery_price)??0)}),M=n=>String(n||"").replace(/\D/g,""),G=F(()=>f.value.action==="send_order_callcenter_pay"||f.value.action==="cart_to_pay"),I=F(()=>{var y,E,N,H;const n=[];(!Array.isArray(v.cart)||v.cart.length===0)&&n.push("El carrito está vacío."),o.user.name||n.push("Falta el nombre.");const _=M(o.user.phone_number);if((!_||_.length<7)&&n.push("Teléfono inválido o incompleto."),(y=o.user.order_type)!=null&&y.id||n.push("Selecciona el método de entrega."),j.value&&(o.user.address||(E=o.user.site)!=null&&E.description||n.push("Falta la dirección de entrega."),[33,35,36].includes(((H=(N=u.location)==null?void 0:N.site)==null?void 0:H.site_id)||0)&&o.user.site&&o.user.site.nearest&&!o.user.site.nearest.in_coverage&&n.push("La dirección está fuera de cobertura de la sede seleccionada.")),Q.value&&!o.user.placa&&n.push("Ingresa la placa del vehículo (requerido para recoger en sede 33)."),G.value){const $=o.user.payment_method_option;(!$||!($.id||$.name))&&n.push("Selecciona un método de pago.")}return n}),B=F(()=>I.value.length===0),be=async()=>{if(B.value){f.value.visible=!1,S.value=!0;try{switch(f.value.action){case"to_callcenter_pay_from_cart":await p.push("/call-center-vender/pay");break;case"reservas_finalize":try{await _e.sendOrderReserva()}catch(n){console.error(n)}await p.push("/pay");break;case"cart_to_pay":await p.push("/pay");break;case"send_order_callcenter_pay":await _e.sendOrder();break}}catch(n){console.error("Error al continuar:",n)}finally{S.value=!1}}};return(n,_)=>{var $,X,Y,Z;const y=J("Button"),E=J("router-link"),N=J("Tag"),H=J("Dialog");return r(),d("div",Ce,[e("div",Ae,[Le,Te,(r(!0),d(z,null,U(t(v).cart,c=>(r(),d("div",{key:c.productogeneral_id},[e("div",$e,[e("div",Fe,[e("h6",Ie,[e("span",Ee,"( "+s(c.pedido_cantidad)+" ) ",1),e("span",Re,s(c.pedido_nombre_producto),1)]),(r(!0),d(z,null,U(c.lista_productocombo,k=>(r(),d("h6",{class:"43f0 43f3",style:{"margin-left":"1rem"},key:k.producto_id},[m(" ( "+s(c.pedido_cantidad)+" ) ",1),e("b",Oe,s(parseInt(k.pedido_cantidad)),1),e("span",Be,s(k.pedido_nombre),1)]))),128))]),e("div",ze,[c.modificadorseleccionList.length<1?(r(),d("h6",Ue,s(t(x)(c.pedido_precio*c.pedido_cantidad)),1)):(r(),d("h6",Ve,s(t(x)(c.pedido_base_price*c.pedido_cantidad)),1))])]),(r(!0),d(z,null,U(c.modificadorseleccionList,k=>(r(),d("div",{class:"addition-item",key:k},[e("div",je,[e("span",qe,[e("span",null,[e("b",null,"- ( "+s(c.pedido_cantidad)+" ) "+s(k.modificadorseleccion_cantidad),1)]),m(" "+s(k.modificadorseleccion_nombre),1)]),k.pedido_precio>0?(r(),d("span",Me,[e("b",null,s(t(x)(k.pedido_precio*k.modificadorseleccion_cantidad*c.pedido_cantidad)),1)])):g("",!0)])]))),128))]))),128)),Ge,e("div",He,[Je,e("div",Ke,[e("span",null,[e("b",null,s(t(x)(t(v).cartTotal)),1)])]),e("div",Qe,[e("span",{style:Se(t(u).location.neigborhood.delivery_price==0?"text-decoration: line-through;":"")},Xe,4)]),e("div",Ye,[t(u).location.neigborhood.delivery_price===0&&(($=t(u).location.site)==null?void 0:$.site_id)!=33?(r(),d("span",Ze,[e("b",null,s(t(i).path.includes("reservas")?"Ir a la sede":"$0"),1)])):g("",!0),e("span",null,[e("b",null,s(t(x)(t(u).location.neigborhood.delivery_price)),1)])]),et,t(u).location.neigborhood.delivery_price||t(u).location.neigborhood.delivery_price===0?(r(),d("div",tt,[e("span",null,[e("b",null,s(t(x)(t(v).cartTotal+t(u).location.neigborhood.delivery_price)),1)])])):g("",!0)]),t(i).path.includes("cart")?(r(),A(E,{key:0,to:"/call-center-vender"},{default:w(()=>[P(y,{outlined:"",icon:"pi pi-shopping-cart",label:"Volver al menu'",class:"43f4 button-common button-transparent button-fullwidth button-bold",severity:"danger"})]),_:1})):t(i).path!="/reservas"?(r(),A(E,{key:1,to:"/call-center-vender/cart"},{default:w(()=>[P(y,{outlined:"",icon:"pi pi-arrow-left",label:"Volver al carrito",class:"43f4 button-common button-transparent button-fullwidth button-bold",severity:"danger"})]),_:1})):g("",!0),((X=t(u).status)==null?void 0:X.status)=="closed"&&t(i).path!="/reservas"?(r(),A(N,{key:2,class:"43f2 tag-fullheight",severity:"danger"},{default:w(()=>[m(" Cerrado, abre a las "+s(t(u).status.next_opening_time),1)]),_:1})):g("",!0),t(i).path.includes("cart")?(r(),A(E,{key:3,to:"/call-center-vender/pay"},{default:w(()=>[P(y,{iconPos:"right",icon:"pi pi-arrow-right",label:"Pedir",class:"43f2 button-common button-black button-fullwidth button-bold button-no-border button-no-outline",severity:"help"})]),_:1})):t(i).path.includes("reservas")?(r(),d("div",st,[P(y,{iconPos:"right",icon:"pi pi-arrow-right",label:"Finalizar pedido",class:"43f2 button-common button-black button-fullwidth button-bold button-no-border button-no-outline",severity:"help",disabled:S.value||t(C).loading.visible,onClick:_[0]||(_[0]=c=>O("reservas_finalize"))},null,8,["disabled"])])):((Y=t(u).status)==null?void 0:Y.status)!=="closed"&&((Z=t(u).status)!=null&&Z.status)&&t(i).path=="/cart"?(r(),d("div",ot,[P(y,{iconPos:"right",icon:"pi pi-arrow-right",label:"Finalizar pedido",class:"43f2 button-common button-black button-fullwidth button-bold button-no-border button-no-outline",severity:"help",disabled:S.value||t(C).loading.visible,onClick:_[1]||(_[1]=c=>O("cart_to_pay"))},null,8,["disabled"])])):t(i).path=="/call-center-vender/pay"?(r(),d("div",rt,[P(y,{disabled:t(C).loading.visible||S.value,iconPos:"right",icon:"pi pi-arrow-right",label:"Finalizar pedido",class:"43f2 button-common button-black button-fullwidth button-bold button-no-border button-no-outline",severity:"help",onClick:_[2]||(_[2]=c=>O("send_order_callcenter_pay"))},null,8,["disabled"])])):g("",!0)]),P(H,{visible:f.value.visible,"onUpdate:visible":_[5]||(_[5]=c=>f.value.visible=c),modal:"",closable:!0,closeOnEscape:"",style:{width:"100%","max-width":"46rem"}},{header:w(()=>[nt]),footer:w(()=>[e("div",qt,[P(y,{label:"Editar",class:"p-button-secondary",text:"",onClick:_[3]||(_[3]=c=>f.value.visible=!1)}),P(y,{label:"Continuar",style:{background:"black",border:"none",color:"white"},disabled:!B.value||S.value||t(C).loading.visible,onClick:_[4]||(_[4]=c=>be())},null,8,["disabled"])])]),default:w(()=>{var c,k,ee,te,se,oe,re,ne;return[I.value.length?(r(),d("div",it,[P(N,{severity:"danger",class:"mb-2"},{default:w(()=>[m("Faltan datos para continuar")]),_:1}),e("ul",at,[(r(!0),d(z,null,U(I.value,(h,R)=>(r(),d("li",{key:R},"• "+s(h),1))),128))])])):g("",!0),e("div",dt,[e("div",lt,[ct,e("ul",ut,[e("li",null,[_t,m(" "+s(t(o).user.name||"—"),1)]),e("li",null,[pt,m(" "+s(t(o).user.phone_number||"—"),1)]),t(o).user.email?(r(),d("li",ht,[vt,m(" "+s(t(o).user.email),1)])):g("",!0),e("li",null,[mt,m(" "+s(((c=t(o).user.order_type)==null?void 0:c.name)||"—"),1)]),j.value?(r(),d("li",bt,[gt,m(" "+s(q.value),1)])):g("",!0),e("li",null,[yt,m(" "+s(((ee=(k=t(u).location)==null?void 0:k.site)==null?void 0:ee.site_name)||"—"),1)]),Q.value?(r(),d("li",ft,[kt,m(" "+s(t(o).user.placa||"—"),1)])):g("",!0)]),e("div",wt,[(te=t(o).user.site)!=null&&te.nearest?(r(),A(N,{key:0,severity:t(o).user.site.nearest.in_coverage?"success":"danger"},{default:w(()=>{var h,R;return[m(s((R=(h=t(o).user.site)==null?void 0:h.nearest)!=null&&R.in_coverage?"En cobertura":"Fuera de cobertura"),1)]}),_:1},8,["severity"])):g("",!0),(oe=(se=t(o).user.site)==null?void 0:se.nearest)!=null&&oe.distance_miles?(r(),A(N,{key:1},{default:w(()=>[m(" Distancia: "+s(t(o).user.site.nearest.distance_miles)+" millas ",1)]),_:1})):g("",!0),T.value>=0?(r(),A(N,{key:2,severity:"success"},{default:w(()=>[m(" Domicilio: "+s(t(x)(T.value)),1)]),_:1})):g("",!0),(re=t(o).user.payment_method_option)!=null&&re.name?(r(),A(N,{key:3,severity:"contrast"},{default:w(()=>[m(" Pago: "+s(t(o).user.payment_method_option.name),1)]),_:1})):g("",!0)]),(ne=t(v).cart)!=null&&ne.order_notes?(r(),d("div",xt,[St,m(" "+s(t(v).cart.order_notes),1)])):g("",!0)]),e("div",Pt,[Dt,e("div",Nt,[Ct,(r(!0),d(z,null,U(t(v).cart,(h,R)=>{var ie,ae;return r(),d("div",{key:h.productogeneral_id||h.id||R,class:"items-row"},[e("div",At,s(h.pedido_nombre_producto||h.name||"Producto"),1),e("div",Lt,s(Number(h.pedido_cantidad??1)),1),e("div",Tt,s(t(x)(((ie=h.modificadorseleccionList)!=null&&ie.length?h.pedido_base_price:h.pedido_precio)||0)),1),e("div",$t,s(t(x)(((ae=h.modificadorseleccionList)!=null&&ae.length?h.pedido_base_price:h.pedido_precio)*Number(h.pedido_cantidad??1))),1)])}),128)),e("div",Ft,[It,Et,e("div",Rt,[e("b",null,s(t(x)(t(v).cartTotal)),1)]),Ot,Bt,e("div",zt,s(t(x)(T.value)),1),Ut,Vt,e("div",jt,[e("b",null,s(t(x)(t(v).cartTotal+T.value)),1)])])])])])]}),_:1},8,["visible"])])}}},Wt=ye(Mt,[["__scopeId","data-v-a3a0c16c"]]);export{Wt as r};
