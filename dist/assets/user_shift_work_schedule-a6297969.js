import{_ as _e,f as o,x as ye,C as he,h as ge,U,g as fe,r as L,o as b,c as S,d as n,w as k,a as e,k as W,t as u,F as B,b as K,y as Z,l as we,p as be,e as Se,a6 as ke}from"./index-90c38b00.js";import{u as q,f as G,s as Q,e as X,a as De,b as Y,c as ee,d as te}from"./subMonths-8dda982b.js";import{s as xe}from"./siteService-5d5fe0f8.js";import{l as Te}from"./user-801cd779.js";const F=V=>(be("data-v-1506b064"),V=V(),Se(),V),Ce={class:""},Ie={class:"col-12 p-0 m-0"},Oe={class:"col-12 p-0 m-0"},Ue={class:"col-12 p-0"},Le={class:"col-12 p-0"},Fe=F(()=>e("p",null,"Desde:",-1)),Ve=F(()=>e("p",null,"Hasta:",-1)),$e={style:{},class:"p-0 m-0"},Ee={class:"col-12 p-0 m-0"},je={class:"grid p-0 mx-auto",style:{"max-width":"700px"}},Me={class:"col-12 md:col-5 py-2",style:{height:"4rem"}},We={class:"col-12 md:col-2 py-2 md:mb-8",style:{display:"flex",height:"4rem","justify-content":"end"}},Be={class:"p-3 text-2xl text-center my-2",style:{"font-weight":"bold",color:"black","text-transform":"uppercase"}},Re=F(()=>e("i",{class:"fa-solid fa-folder-open"},null,-1)),Ae={class:"col-12 pb-6"},Ne={class:"grid"},He={style:{"background-color":"#f4f1d6"}},Pe={class:"py-0 px-4 text-center col-12 text-xl",style:{"font-weight":"bold","text-shadow":"0 0 3px black","text-transform":"uppercase"}},Je={class:"shadow-5 p-5",style:{"min-height":"15rem","background-color":"","border-radius":"0 0 0.5rem 0.5rem",display:"flex","flex-wrap":"wrap","align-items":"flex-start",gap:"2rem","justify-content":"start",padding:"10px"}},ze={class:"py-0 my-0",style:{"min-width":"max-content","font-weight":"bold","text-transform":"uppercase"}},Ke={class:"py-0 my-0 text-sm",style:{"min-width":"max-content","text-transform":"uppercase"}},Ze=["onClick","src","onError"],qe={key:0},Ge={class:"py-0 my-0"},Qe={class:"py-0 my-0"},Xe={class:"py-0 my-0"},Ye={class:"py-0 my-0"},et={key:1},tt=ke('<p class="py-0 my-0" data-v-1506b064><b style="color:green;" data-v-1506b064>.</b></p><p class="py-0 my-0" data-v-1506b064><b style="color:green;" data-v-1506b064>.</b></p><p class="py-0 my-0" data-v-1506b064><b style="color:green;" data-v-1506b064>DESCANSA</b></p>',3),at={class:"py-0 my-0"},st={class:"",style:{"text-transform":"uppercase"}},ot=F(()=>e("p",null,"Hora de llegada:",-1)),lt=F(()=>e("p",null,"Hora de salida:",-1)),nt={class:"col-12 p-0",style:{display:"flex","justify-content":"space-between"}},it={__name:"user_shift_work_schedule",setup(V){const ae=o(!1),se=o(null),oe=t=>{se.value=t,ae.value=!0},T=o(!1),p=o(new Date),y=o(new Date),$=Te(),m=ye();o(!1),o(null);const C=o(),E=o(),D=o(),x=o(),w=o(!1),i=o(null),h=o(null),v=o(new Date),_=o(new Date),R=he(()=>!D.value||!x.value?"":`${G(D.value,"dd/MM/yyyy")} - ${G(x.value,"dd/MM/yyyy")}`),le=()=>{p.value=D.value||new Date,y.value=x.value||new Date,T.value=!0},ne=()=>{T.value=!1},I=()=>{D.value=p.value,x.value=y.value,T.value=!1,M()},A=()=>{const t=new Date;p.value=Q(t,{weekStartsOn:1}),y.value=X(t,{weekStartsOn:1}),I()},ie=()=>{const t=Q(new Date,{weekStartsOn:1});p.value=De(t,7),y.value=X(p.value,{weekStartsOn:1}),I()},re=()=>{const t=new Date;p.value=Y(t),y.value=ee(t),I()},ce=()=>{const t=new Date;p.value=Y(te(t,1)),y.value=ee(te(t,1)),I()};o(!1),o(null);const de={Monday:"#22c55e",Tuesday:"#F59E0B",Wednesday:"#EF4444",Thursday:"#3B82F6",Friday:"#A855F7",Saturday:"#10B981",Sunday:"#EC4899"},ue=t=>{if(!(t instanceof Date))return console.error("getDayColor: date is not a Date object",t),"#FFFFFF";const a=t.toLocaleDateString("en-US",{weekday:"long"});return de[a]},j=o([]),N=o([]),pe=(t,a)=>{const l={masculino:"/images/male-avatar.png",femenino:"/images/female-avatar.png",default:"/images/who.png"},g=t==null?void 0:t.trim().toLowerCase();a.target.src=l[g]||l.default},H=o(null);o(!1),o(new Date),ge(async()=>{E.value=await xe.getSites(),C.value=E.value.filter(a=>a.site_id==$.rawUserData.site_id)[0],H.value=E.value.filter(a=>a.site_id==$.rawUserData.site_id)[0];const t=await q.getUsersBySiteId($.rawUserData.site_id);j.value=t.filter(a=>a.status=="activo"),await fetch(`${U}/shift_work_days_with_records`)}),fe(C,async t=>{const a=await q.getUsersBySiteId(t.site_id);j.value=a.filter(l=>l.status=="activo"),H.value=t,A(),M()});const M=async()=>{if(m.setLoading(!0,"cargando horario"),!C.value||!D.value||!x.value){alert("Please select a site and date range.");return}const t=D.value.toISOString().split("T")[0],a=x.value.toISOString().split("T")[0],l=await fetch(`${U}/shift_filtered_work_days?site_id=${C.value.site_id}&start_date=${t}&end_date=${a}`);if(l.ok){m.setLoading(!1,"cargando horario");const g=await l.json();N.value=g.map(c=>(c.date=new Date(c.date),c.date.setDate(c.date.getDate()+1),c.users=c.records.map(f=>{let O=j.value.find(d=>d.id===f.employer_id);if(O){let d={...O};const s=new Date(`${c.date.toISOString().split("T")[0]}T${f.start_time}`),r=new Date(`${c.date.toISOString().split("T")[0]}T${f.end_time}`);return d.arrivalTime=s,d.departureTime=r,d.hoursWorked=(r-s)/36e5,d.rest=f.rest,d}return null}).filter(f=>f!=null),m.setLoading(!1,"cargando horario"),c))}else m.setLoading(!1,"cargando horario"),alert("Failed to fetch workdays")},me=async()=>{if(w.value=!1,m.setLoading(!0,"cargando"),!i.value||!h.value)return;if(v.value.getTime()>=_.value.getTime()){alert("La hora de llegada no puede ser mayor o igual a la hora de salida."),m.setLoading(!1,"cargando"),w.value=!0;return}let t=v.value.toISOString().split("T")[1].slice(0,8),a=_.value.toISOString().split("T")[1].slice(0,8);const l={employer_id:i.value.id,work_day_id:h.value.id,start_time:t,end_time:a};await fetch(`${U}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),i.value.arrivalTime=v.value,i.value.departureTime=_.value,i.value.hoursWorked=(_.value-v.value)/36e5,h.value.users.push(i.value),w.value=!1,i.value=null,h.value=null,m.setLoading(!1,"cargando")},ve=async()=>{if(w.value=!1,m.setLoading(!0,"cargando"),!i.value||!h.value)return;let t=v.value.toISOString().split("T")[1].slice(0,8),a=_.value.toISOString().split("T")[1].slice(0,8);const l={employer_id:i.value.id,work_day_id:h.value.id,start_time:t,end_time:a,rest:!0};await fetch(`${U}/shift_work_records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),i.value.arrivalTime=v.value,i.value.departureTime=_.value,i.value.hoursWorked=(_.value-v.value)/36e5,i.value.rest=!0,h.value.users.push(i.value),w.value=!1,i.value=null,h.value=null,m.setLoading(!1,"cargando")};return(t,a)=>{var d;const l=L("Button"),g=L("Calendar"),c=L("Dialog"),f=L("InputText"),O=L("InputIcon");return b(),S(B,null,[n(c,{visible:T.value,"onUpdate:visible":a[2]||(a[2]=s=>T.value=s),modal:"",closable:""},{footer:k(()=>[n(l,{severity:"danger",label:"Cancelar",onClick:ne,class:"p-button-text"}),n(l,{severity:"success",label:"Aceptar",onClick:I})]),default:k(()=>[e("div",Ce,[e("div",Ie,[n(l,{class:"col-12",severity:"danger",text:"",label:"Esta semana",onClick:A})]),e("div",Oe,[n(l,{class:"col-12",severity:"help",text:"",label:"Semana pasada",onClick:ie})]),e("div",Ue,[n(l,{class:"col-12",severity:"warning",text:"",label:"Este mes",onClick:re})]),e("div",Le,[n(l,{class:"col-12",severity:"primary",text:"",label:"Mes pasado",onClick:ce})])]),Fe,n(g,{class:"col-12",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=s=>p.value=s),showIcon:""},null,8,["modelValue"]),Ve,n(g,{class:"col-12",modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=s=>y.value=s),showIcon:""},null,8,["modelValue"])]),_:1},8,["visible"]),e("div",$e,[e("div",Ee,[e("div",je,[e("div",Me,[n(f,{style:{height:"100%"},class:"col-12 text-center m-0",readonly:"",modelValue:R.value,"onUpdate:modelValue":a[3]||(a[3]=s=>R.value=s),onClick:le},null,8,["modelValue"])]),e("div",We,[n(l,{severity:"help",rounded:"",class:"mb-3",icon:"pi pi-search",onClick:M})])])]),e("p",Be,[Re,W(" Calendario de trabajo "+u((d=C.value)==null?void 0:d.site_name),1)]),e("div",Ae,[e("div",Ne,[(b(!0),S(B,null,K(N.value,s=>(b(),S("div",{class:"col-12",key:s.id,style:{position:"relative"}},[e("div",He,[e("div",{class:"p-2 shadow-2",style:Z({"background-color":ue(s.date),color:"white","border-radius":"0.5rem 0.5rem 0 0",display:"flex","align-items":"center","justify-content":"space-beetwen"})},[e("p",Pe,u(s.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"America/Bogota"}))+" ",1)],4),e("div",Je,[(b(!0),S(B,null,K(s.users,r=>{var P,J;return b(),S("div",{class:"shadow-2 p-3",key:r.id,style:Z([{color:"black","text-align":"center",width:"10rem","aspect-ratio":"1 / 1",position:"relative","border-radius":"0.5rem"},r.rest?"background-color: #68cc497a;  ":"background-color: white;"])},[e("p",ze,u(r.name.split(" ").slice(0,1).join(" "))+" ` ",1),e("p",Ke,u(r.position.slice(0,15)),1),e("img",{class:"shadow-2 mb-3 p-1",onClick:z=>oe(r),src:`${we(U)}/read-product-image/96/employer-${r.dni}`,alt:"user.name",onError:z=>pe(r.gender,z),style:{width:"4rem","object-fit":"cover",height:"4rem","border-radius":"50%"}},null,40,Ze),r.rest?(b(),S("div",et,[tt,e("p",at,[e("b",null,u((J=r.contract_type)==null?void 0:J.toLowerCase().slice(0,13)),1)])])):(b(),S("div",qe,[e("p",Ge,"De: "+u(new Date(r.arrivalTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1),e("p",Qe,"A: "+u(new Date(r.departureTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1),e("p",Xe,"por: "+u(r.hoursWorked.toFixed(2))+" hrs",1),e("p",Ye,[e("b",null,u((P=r.contract_type)==null?void 0:P.toLowerCase().slice(0,13)),1)])]))],4)}),128))])])]))),128)),W(" ` ")])]),n(c,{visible:w.value,"onUpdate:visible":a[6]||(a[6]=s=>w.value=s),style:{width:"20rem"},modal:!0},{header:k(()=>[W(" . ")]),footer:k(()=>[e("div",nt,[n(l,{severity:"help",label:"Descansa",onClick:ve}),n(l,{severity:"success",label:"Aceptar",onClick:me})])]),default:k(()=>[e("h5",st,"Cuantas horas trabajo "+u(i.value.name)+"?",1),ot,n(g,{modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=s=>v.value=s),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:k(({clickCallback:s})=>[n(O,{class:"pi pi-clock cursor-pointer",onClick:s},null,8,["onClick"])]),_:1},8,["modelValue"]),lt,n(g,{modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=s=>_.value=s),showIcon:"",iconDisplay:"input",timeOnly:"",hourFormat:"12"},{inputicon:k(({clickCallback:s})=>[n(O,{class:"pi pi-clock cursor-pointer",onClick:s},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1},8,["visible"])])],64)}}},pt=_e(it,[["__scopeId","data-v-1506b064"]]);export{pt as default};
