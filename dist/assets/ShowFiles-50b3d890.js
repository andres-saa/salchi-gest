import{_ as W,c6 as X,x as Z,f as d,u as ee,B as te,h as N,g as oe,r as m,o as se,c as ae,d as a,a as o,w as l,y as ne,F as le,U as E,t as b,k as A,l as ie,c1 as L,bV as F,q as re,p as ce,e as de}from"./index-a549dd16.js";import{b as ue}from"./dropDownAux-708d0cb4.js";import{u as z}from"./sendFileService-a1b4d202.js";/* empty css                                                                  */const u=w=>(ce("data-v-04419ff3"),w=w(),de(),w),pe={class:"col-12 p-0 m-auto",style:{}},me={class:""},ve={style:{display:"flex","justify-content":"end"}},_e=u(()=>o("i",{class:"fa-solid fa-plus text-2xl"},null,-1)),fe={style:{"min-width":"max-content"}},ye=u(()=>o("span",{class:"p-column-title"},"Category",-1)),he={style:{"min-width":"max-content"}},ge={style:{display:"flex"}},be=u(()=>o("i",{class:"fa-solid fa-file-arrow-down"},null,-1)),we=u(()=>o("i",{class:"fa-solid fa-pen-to-square"},null,-1)),Ce=u(()=>o("i",{class:"fa-solid fa-trash"},null,-1)),xe={class:"col-12 p-0",style:{"max-width":""}},ke=u(()=>o("label",{for:"position"},"FECHA DE RENOVACION",-1)),Se={class:"p-3",style:{"background-color":"rgba(115, 255, 76, 0.306)"}},Ee=u(()=>o("i",{class:"pi pi-check",style:{color:"slateblue"}},null,-1)),De={class:"grid",style:{display:"flex","justify-content":"space-between"}},$e={class:"col-12 xl:col-6"},Oe={class:"col-12 xl:col-6"},Ae={class:"grid",style:{display:"flex",padding:"0",margin:"0"}},Re={class:"col-12 xl:col-6"},Pe=u(()=>o("label",{for:"position"},"TIPO DE DOCUMENTO",-1)),Ie={class:"col-12 xl:col-6"},Te=u(()=>o("label",{for:"position"},"FECHA DE RENOVACION",-1)),Ve={class:"p-3",style:{"background-color":"rgba(19, 164, 0, 0.306)"}},Ne=u(()=>o("i",{class:"pi pi-check",style:{color:"slateblue"}},null,-1)),Le={style:{display:"flex","justify-content":"space-between"}},Fe={__name:"ShowFiles",setup(w){const U=X(),C=Z(),R=d([]),c=d(),p=d(),j=d(["CÁMARA DE COMERCIO","USO DE SUELOS","RUT","BOMBEROS","CONCEPTO SANITARIO","SAYCO Y ACIMPRO","CAMION","CARTA POLICÍA"]),D=d(),v=d(""),_=d(""),x=ee(),g=d({}),y=te();R.value=D.value;const P=t=>{const e=t.target.files[0];e&&(console.log("Archivo seleccionado:",e),c.value=e)},q=t=>{U.require({target:event.currentTarget,message:`Esta seguro de eliminar ${t.document_name}`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-info p-button-outlined p-button-sm",acceptClass:"p-button-sm p-button-danger",rejectLabel:"Cancelar",acceptLabel:"Eliminar",accept:()=>{M(t)},reject:()=>{}})},M=async t=>{try{if(!(await fetch(`${E}/site_document/${t.document_id}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar el documento");h(),y.add({severity:"success",summary:"Documento eliminado",detail:"El documento ha sido eliminado correctamente.",life:3e3})}catch(e){console.error("Error al eliminar el documento:",e),y.add({severity:"error",summary:"Error al eliminar",detail:"No se pudo eliminar el documento.",life:3e3})}},B=async t=>{let e="post";const i=`${E}/site-document/`,f={method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return(await fetch(i,f)).json()},h=async()=>{try{const t=`${E}/get-site-documents-info/${x.params.site_id}`,e=await fetch(t);if(console.log(e),!e.ok)return;const i=await e.json();D.value=i}catch(t){console.error("Error al enviar la solicitud:",t)}},J=async t=>{let e="put";const i={...t},f=`${E}/site-document/${i.document_id}`;i.renovation_date=_.value;const n={method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)};try{const r=await fetch(f,n);if(!r.ok)throw new Error(`Error en la solicitud: ${r.status}`);const O=await r.json();return h(),$(),y.add({severity:"success",summary:"Actualización exitosa",detail:"Documento actualizado correctamente",life:3e3}),O}catch(r){y.add({severity:"error",summary:"Error en la actualización",detail:r.message,life:3e3})}};N(()=>{h(),C.setLoading(!0),C.setLoading(!1)}),oe(()=>x.params.site_id,()=>{h(),C.setLoading(!0),C.setLoading(!1)}),N(()=>{const t=localStorage.getItem("currentSiteFiles");t&&(g.value=JSON.parse(t))});const k=d(!1),S=d(!1),G=(t,e,i)=>{const f={document_name:`${g.value.site_name} ${v.value}`,document_type:v.value,renovation_date:_.value,site_id:x.params.site_id};B(f).then(n=>{console.log(n),z(t,n.document_id,v.value),h()}),y.add({severity:"success",summary:"hecho",detail:"",life:3e3}),$()},H=(t,e)=>{console.log(R,v.value),`${p.value.document_name}`,p.value.document_type,_.value,x.params.site_id,console.log(e),J(e),z(t,e.document_id,e.document_type),y.add({severity:"success",summary:"hecho",detail:"",life:3e3}),$()},Y=t=>{k.value=!0,p.value=t},K=t=>{S.value=!0,p.value=t},$=()=>{k.value=!1,S.value=!1,c.value=null,h()};return(t,e)=>{const i=m("Toast"),f=m("ConfirmPopup"),n=m("Button"),r=m("Column"),O=m("DataTable"),I=m("Calendar"),T=m("Dialog"),Q=m("Dropdown");return se(),ae(le,null,[a(i),o("div",pe,[a(i),a(f),o("div",me,[a(O,{ref:"dt",value:D.value,dataKey:"id",paginator:!0,rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} products",responsiveLayout:"scroll",frozenValue:t.lockedCustomers},{header:l(()=>[]),default:l(()=>[o("div",ve,[a(n,{size:"small ",style:{width:"max-content","font-weight":"bold",display:"flex","align-items":"center","justify-content":"center","aspect-ratio":"1 / 1"},rounded:"",class:"p-button-info p-3",onClick:e[0]||(e[0]=s=>K())},{default:l(()=>[_e]),_:1})]),a(r,{class:"",field:"name",header:"Tipo",sortable:!0,headerStyle:"width:20rem; min-width:max-content; "},{body:l(s=>[o("p",fe,b(s.data.document_type),1)]),_:1}),a(r,{class:"py-0",field:"position",header:"Nombre ",sortable:!0,headerStyle:"width:20rem; min-width:10rem;"},{body:l(s=>[ye,o("p",he,b(s.data.document_name),1)]),_:1}),a(r,{class:"p-0",field:"birth_date",header:"Renovacion",sortable:!0,headerStyle:"width:5rem; min-width:10rem;"},{body:l(s=>[A(b(s.data.renovation_date),1)]),_:1}),a(r,{style:{},class:"py-0",header:"Acciones",fieldheaderStyle:"width:10rem; min-width:max-content",frozen:"",alignFrozen:"right"},{body:l(s=>[o("div",ge,[a(n,{text:"",size:"large",style:{"aspect-ratio":"1 / 1"},class:"p-button-success mr-2 mb-2 p-0 text-3xl",onClick:V=>ie(ue)(s.data.document_id,s.data.document_type)},{default:l(()=>[be]),_:2},1032,["onClick"]),a(n,{text:"",size:"large",style:{},class:"p-button-info mr-2 mb-2 p-0 text-3xl",onClick:V=>Y(s.data)},{default:l(()=>[we]),_:2},1032,["onClick"]),a(n,{text:"",size:"large",style:{},class:"p-button-danger mr-2 mb-2 p-0 text-3xl",onClick:V=>q(s.data)},{default:l(()=>[Ce]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["value","frozenValue"]),a(T,{class:"p-0",closable:!0,style:ne([{"max-width":"500px"},{width:"30vw",padding:"0px"}]),header:` CARGAR ${p.value?p.value.document_type:""} PARA ${g.value.site_name}`,visible:k.value,"onUpdate:visible":e[4]||(e[4]=s=>k.value=s),breakpoints:{"960px":"75vw"},modal:!0},{default:l(()=>[o("input",{ref:"fileInput",type:"file",onChange:P,style:{display:"none"}},null,544),o("div",xe,[ke,a(I,{id:"entry_date",style:{width:"100%",margin:"20px 0"},modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s),required:"true",autofocus:""},null,8,["modelValue"])]),L(o("p",Se,[Ee,A(" "+b(c.value?`${c.value.name} : si este no es
                    su documento por
                    favor carguelo`:""),1)],512),[[F,c.value]]),o("div",De,[o("div",$e,[a(n,{label:"Seleccionar documento",class:"col-12",style:{"background-color":"var(--primary-color)"},onClick:e[2]||(e[2]=s=>{t.$refs.fileInput.click()})})]),o("div",Oe,[a(n,{class:"col-12",label:"Enviar",style:{"background-color":"var(--primary-color)"},onClick:e[3]||(e[3]=s=>H(c.value,p.value))})])])]),_:1},8,["header","visible"]),a(T,{header:` CARGAR ${p.value?p.value:""} PARA ${g.value.site_name}`,visible:S.value,"onUpdate:visible":e[9]||(e[9]=s=>S.value=s),breakpoints:{"960px":"75vw"},style:{width:"50vw",padding:"50p0x"},modal:!0},{default:l(()=>[o("div",Ae,[o("div",Re,[Pe,a(Q,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=s=>v.value=s),modelModifiers:{trim:!0},options:j.value,placeholder:"",required:"true",class:re({"p-invalid":t.submitted}),style:{width:"100%",margin:"20px 0"}},null,8,["modelValue","options","class"])]),o("div",Ie,[Te,a(I,{id:"entry_date",style:{width:"100%",margin:"20px 0"},modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=s=>_.value=s),required:"true",autofocus:""},null,8,["modelValue"])])]),o("input",{ref:"fileInput",type:"file",onChange:P,style:{display:"none"}},null,544),L(o("p",Ve,[Ne,A(" "+b(c.value?`${c.value.name} : verifique si
                    este es su documeto
                    antes de envirlo`:""),1)],512),[[F,c.value]]),o("div",Le,[a(n,{label:"Seleccionar documento",style:{width:"40%","background-color":"var(--primary-color)"},onClick:e[7]||(e[7]=s=>{t.$refs.fileInput.click()})}),a(n,{label:"Enviar",style:{width:"40%","background-color":"var(--primary-color)"},onClick:e[8]||(e[8]=s=>G(c.value,v.value,g.value.site_id))})])]),_:1},8,["header","visible"])])])],64)}}},Me=W(Fe,[["__scopeId","data-v-04419ff3"]]);export{Me as default};
