import{_ as P,l as H,r as i,i as q,a as d,o as G,c as L,d as s,w as r,b as l,F as O,B as W,s as U,t as R,p as Y,g as z}from"./index-a9681f94.js";import{s as J}from"./siteService-71dc16fa.js";import{d as V}from"./dailyInventoryService-4ae27653.js";import{u as $,w as K}from"./xlsx-4f9172c7.js";/* empty css                                                                              */const w=D=>(Y("data-v-85ba9671"),D=D(),z(),D),Q={class:"grid"},X={class:"col-12 px-0 mx-0"},Z={class:"col-12",style:{display:"flex","flex-direction":"column"}},ee=w(()=>l("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),te={class:"col-12",style:{display:"flex","flex-direction":"column"}},le=w(()=>l("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),se={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},ae={class:"col-12",style:{display:"flex","justify-content":"center"}},oe={class:"m-auto",style:{"max-width":"1024px"}},ne={class:"m-0 col-12 p-3",style:{"align-items":"center"}},ie={class:"p-0 mb-3",style:{display:"flex",gap:"1rem","align-items":"center","justify-content":"start"}},de=w(()=>l("span",{class:"text-xl",style:{}},[l("b",null,"Sedes")],-1)),re={class:"col p-0",style:{display:"flex","justify-content":"start",gap:"1rem","align-items":"center"}},ce=w(()=>l("span",{class:"text-xl"},[l("b",null,"Periodo")],-1)),pe={class:"col-12 px-3",style:{display:"flex","justify-content":"end"}},ue={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},ve={class:"grid",style:{"align-items":"center"}},me=w(()=>l("div",{class:"col-12 md:col-6 p-3"},[l("span",{class:"text-xl",style:{width:"100%"}}," Gestionar reportes de inventario")],-1)),ye={class:"col-12 md:col-6 p-3"},_e={style:{"text-transform":"uppercase"}},he={style:{display:"flex",gap:"0.5rem"}},xe={__name:"dailyInventoryReports",setup(D){const B=H(),C=i([]),g=i([{}]),p=i(!1),u=i(new Date(new Date().setDate(new Date().getDate()-7))),c=i(new Date),y=i(new Date(new Date().setDate(new Date().getDate()-7))),_=i(new Date),b=i(),h=i(),T=(o,e)=>{y.value=o,_.value=e},x=o=>{const e=new Date,a=new Date(e);a.setDate(a.getDate()+1);const n=new Date(e);n.setDate(e.getDate()-o),u.value=n,o==1?(c.value=e,_.value=c.value,y.value=u.value,p.value=!1):(c.value=a,y.value=u.value,_.value=c.value,p.value=!1),j()};q(async()=>{C.value=await J.getSites(),g.value=C.value,b.value=await V.getAllDailyInventoryReports()}),(()=>{h.value={global:{value:null,matchMode:W.CONTAINS}}})();function k(o){const e=new Date(o),a=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),v=e.getDate().toString().padStart(2,"0");return`${a}-${n}-${v}`}const j=async()=>{const o=g.value.map(n=>n.site_id);B.rawUserData.id;const e=k(y.value),a=k(_.value);b.value=await V.getAllDailyInventoryReportsFiltered(o,e,a)},F=i([]),M=async(o,e,a)=>{F.value=await V.getDailyInventoryEntriesByDailyInventoryID(o);const n=F.value.map(m=>({Producto:m.item_name,Cantidad:m.quantity,"Unidad de medida":m.unit_measure})),v=$.json_to_sheet(n);v["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const S=$.book_new();$.book_append_sheet(S,v,"Usuarios"),K(S,`Inventario_${e}_${a.split("-").reverse().join("-")} .xlsx`)},A=async()=>{b.value.forEach(e=>{M(e.daily_inventory_id,e.site_name,e.date)})};return(o,e)=>{const a=d("Button"),n=d("Calendar"),v=d("Dialog"),S=d("MultiSelect"),m=d("InputText"),f=d("Column"),N=d("router-link"),E=d("DataTable");return G(),L(O,null,[s(v,{class:"mx-2",visible:p.value,"onUpdate:visible":e[8]||(e[8]=t=>p.value=t),modal:"",header:"Periodo",style:{width:"25rem"}},{default:r(()=>[l("div",Q,[l("div",X,[s(a,{text:"",label:"Hoy",onClick:e[0]||(e[0]=t=>x(0)),class:"p-button-text col-12 p-1 m-0"}),s(a,{text:"",label:"Ayer",onClick:e[1]||(e[1]=t=>x(1)),class:"p-button-text col-12 p-1 m-0"}),s(a,{text:"",label:"Últimos 7 días",onClick:e[2]||(e[2]=t=>x(7)),class:"p-button-text col-12 p-1 m-0"}),s(a,{text:"",label:"Últimos 14 días",onClick:e[3]||(e[3]=t=>x(14)),class:"p-button-text col-12 p-1"}),s(a,{text:"",label:"Últimos 28 días",onClick:e[4]||(e[4]=t=>x(28)),class:"p-button-text col-12 p-0"})]),l("div",Z,[ee,s(n,{style:{"min-width":"max-content"},modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value=t)},null,8,["modelValue"])]),l("div",te,[le,s(n,{style:{"min-width":"max-content"},modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value=t),showWeek:""},null,8,["modelValue"])]),l("div",se,[l("div",ae,[s(a,{onClick:e[7]||(e[7]=()=>{T(u.value,c.value),p.value=!1})},{default:r(()=>[U("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),l("div",oe,[l("div",ne,[l("div",ie,[de,s(S,{style:{},display:"chip",multiple:"",modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=t=>g.value=t),optionLabel:"site_name",options:C.value.filter(t=>t.site_id!=12&t.site_id!=13),class:"text-sm multi p-0"},null,8,["modelValue","options"])]),l("div",re,[ce,s(m,{class:"",onClick:e[10]||(e[10]=t=>p.value=!0),style:{height:"2.7rem",width:"16rem"},value:`${k(y.value)}  |  ${k(_.value)}`,placeholder:"periodo"},null,8,["value"]),s(a,{onClick:j,icon:"pi pi-search",severity:"help",class:"text-center p-0 col-12 md:p-0",style:{height:"2.5rem",width:"min-content","aspect-ratio":"1 / 1","font-weight":"bold","border-radius":"50%",display:"flex","justify-content":"center"}})])]),l("div",pe,[s(a,{severity:"help",icon:"pi pi-download",label:"Descargar todo",onClick:A})])]),l("div",ue,[s(E,{style:{"max-width":"1024px"},filters:h.value,"onUpdate:filters":e[12]||(e[12]=t=>h.value=t),class:"col-12 m-auto",value:b.value,tableStyle:"min-width: 50rem;"},{header:r(()=>[l("div",ve,[me,l("div",ye,[s(m,{style:{width:"100%"},class:"",modelValue:h.value.global.value,"onUpdate:modelValue":e[11]||(e[11]=t=>h.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:r(()=>[s(f,{class:"py-1",field:"daily_inventory_id",header:"ID"}),s(f,{class:"py-1",field:"employer_name",header:"Responsable"},{body:r(t=>[l("div",_e,R(t.data.employer_name),1)]),_:1}),s(f,{class:"py-1",field:"site_name",header:"Sede"}),s(f,{class:"py-1",field:"date",header:"Fecha"},{body:r(t=>{var I;return[U(R((I=t.data.date)==null?void 0:I.split("-").reverse().join("-")),1)]}),_:1}),s(f,{style:{},class:"py-1 px-0",field:"date",header:"Action"},{body:r(t=>[l("div",he,[s(N,{to:`/daily-inventory/daily-inventory-view/${t.data.daily_inventory_id}`},{default:r(()=>[s(a,{style:{height:"2rem"},severity:"help",class:"p-1",icon:"pi pi-eye"})]),_:2},1032,["to"]),s(a,{onClick:I=>M(t.data.daily_inventory_id,t.data.site_name,t.data.date),style:{height:"2rem",background:"var(--primary-color)",border:"none"},severity:"success",class:"p-1",icon:"pi pi-download"},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])])],64)}}},Se=P(xe,[["__scopeId","data-v-85ba9671"]]);export{Se as default};
