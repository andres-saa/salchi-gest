import{_ as ie,M as re,r as c,l as de,i as ce,a as v,o as W,c as J,g as a,w as p,b as o,F as pe,s as ue,m as V,t as f,k as me,f as he,p as _e,h as ve}from"./index-67d4dcac.js";import{s as ye}from"./siteService-bf3de3f6.js";import"./sass.default-a5b7a582.js";import{p as S}from"./purchaseOrderService-1ea2e2f7.js";import{u as M,a as Q}from"./xlsx-4cca7150.js";import{E as fe}from"./exceljs.min-4b158bf5.js";import{F as Y}from"./FileSaver.min-cc8488c4.js";import{f as K}from"./format-8cf56335.js";import{e as X}from"./es-f6133d36.js";import"./_commonjsHelpers-23102255.js";const F=O=>(_e("data-v-d6444a4c"),O=O(),ve(),O),ge={class:"grid"},we={class:"col-12 px-0 mx-0"},xe={class:"col-12",style:{display:"flex","flex-direction":"column"}},be=F(()=>o("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),De={class:"col-12",style:{display:"flex","flex-direction":"column"}},Ce=F(()=>o("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),ke={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},Se={class:"col-12",style:{display:"flex","justify-content":"center"}},Me={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},Fe={class:"m-auto",style:{"max-width":"1024px"}},Te={class:"m-0 col-12",style:{"align-items":"center"}},Ae={class:"p-0 mb-3",style:{display:"flex","align-items":"center",gap:"1rem"}},$e=F(()=>o("span",{class:"text-xl"},[o("b",null,"Sedes")],-1)),Ee={class:"col p-0",style:{display:"flex",gap:"1rem","align-items":"center"}},Oe=F(()=>o("span",{class:"text-xl"},[o("b",null,"Periodo")],-1)),Pe={class:"col-12 px-3 mt-4 pack-butons",style:{display:"flex","justify-content":"end",gap:"1rem"}},Re={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},Ue={class:"grid",style:{"align-items":"center"}},Ie={class:"col-12 md:col-6 p-3"},Le={style:{"min-width":"max-content"}},Ve={style:{"min-width":"max-content"}},Ne={class:"m-0 p-0",style:{display:"flex",width:"100%","justify-content":"center","align-items":"center",gap:"0.5rem"}},je={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},Be=F(()=>o("br",null,null,-1)),He={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},qe={class:"m-0"},ze={class:"m-0"},Ge={key:0},We=F(()=>o("b",null,"Notas",-1)),Je={style:{display:"flex",gap:"1rem"}},Qe=5,Ye={__name:"OrderPathComplete",setup(O){const P=re(),N=c(!1),w=c({}),Z=d=>{N.value=!0,w.value=d},ee={Generada:"#FF0000",Lista:"#FFA500","Entregada al transportista":"#FFFF00",Completada:"#00FF00"},j=c(!1),q=c([]),te=async d=>{j.value=!0,q.value=await S.getPurchaseOrderHistory(d)},se=de(),B=c([]),R=c([{}]),x=c(!1),b=c(new Date(new Date().setDate(new Date().getDate()-7))),g=c(new Date),D=c(new Date(new Date().setDate(new Date().getDate()-7))),C=c(new Date),T=c(),A=c(),ae=(d,t)=>{D.value=d,C.value=t},$=d=>{const t=new Date,s=new Date(t);s.setDate(s.getDate()+1);const i=new Date(t);i.setDate(t.getDate()-d),b.value=i,d==1?(g.value=t,C.value=g.value,D.value=b.value,x.value=!1):(g.value=s,D.value=b.value,C.value=g.value,x.value=!1),z()};ce(async()=>{B.value=await ye.getSites(),R.value=B.value,T.value=await S.getPurchaseOrderByLap_id(Qe)}),(()=>{A.value={global:{value:null,matchMode:ue.CONTAINS}}})();function U(d){const t=new Date(d),s=t.getFullYear(),i=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return`${s}-${i}-${n}`}const z=async()=>{const d=R.value.map(i=>i.site_id);se.rawUserData.id;const t=U(D.value),s=U(C.value);T.value=await S.getAllpurchaseOrderReportsFiltered(d,t,s)},E=c([]),oe=async(d,t,s)=>{E.value=await S.getpurchaseOrderEntriesBypurchaseOrderID(d);const i=E.value.map(m=>({Producto:m.item_name,Cantidad:m.quantity,"Unidad de medida":m.unit_measure})),n=M.json_to_sheet(i);n["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const u=M.book_new();M.book_append_sheet(u,n,"Usuarios"),Q(u,`Orden_de_compra_${t}_${s} .xlsx`)},le=async()=>{P.setLoading(!0,"generando descargas");const d=T.value,t=[];for(const e of d){const l=await S.getpurchaseOrderEntriesBypurchaseOrderID(e.purchase_order_id);t.push(...l)}const s={};t.forEach(e=>{const l=e.site_name,r=e.item_name,y=e.quantity,k=e.unit_measure;s[r]||(s[r]={unit_measure:k}),s[r][l]||(s[r][l]=0),s[r][l]+=y});const i=[...new Set(t.map(e=>e.site_name))],n=[],u=K(D.value,"dd-MMMM-yyyy",{locale:X}),m=K(C.value,"dd-MMMM-yyyy",{locale:X});u==m?n.push([`ORDENES DE COMPRA DEL ${u.toUpperCase()}`,...Array(i.length+2).fill("")]):n.push([`ORDENES DE COMPRA DEL${u.toUpperCase()} AL ${m.toUpperCase()}`,...Array(i.length+2).fill("")]);const I=["PRODUCTO","UNIDAD DE MEDIDA",...i,"TOTAL"];n.push(I);for(const[e,l]of Object.entries(s)){const r=[e,l.unit_measure];let y=0;for(const k of i){const G=l[k]||0;r.push(G),y+=G}r.push(y),n.push(r)}const h=new fe.Workbook,_=h.addWorksheet("Inventario por Sede");n.forEach((e,l)=>{const r=_.addRow(e);l===0?(r.height=40,r.font={name:"Arial",bold:!0,size:14},r.alignment={horizontal:"center",vertical:"middle",wrapText:!0},_.mergeCells(`A1:${_.getColumn(i.length+3).letter}1`),_.getRow(1).eachCell(y=>{y.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF00"}}})):l===1&&(r.font={name:"Arial",bold:!0})}),_.columns.forEach((e,l)=>{e.width=l===0?30:l===1?25:15,e.eachCell(r=>{r.font={name:"Arial"},r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),_.getRow(2).eachCell(e=>{e.font={name:"Arial",bold:!0}}),_.getRow(1).eachCell(e=>{e.font={name:"Arial",bold:!0,size:16}}),_.views=[{showGridLines:!1}];const H=await h.xlsx.writeBuffer(),L=new Blob([H],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});u==m?Y.saveAs(L,`Reporte de inventario del ${u}.xlsx`):Y.saveAs(L,`Reporte de inventario del ${u} al ${m} .xlsx`),P.setLoading(!1,"generando descargas")},ne=async()=>{P.setLoading(!0,"generando descargas");const d=T.value;for(const n of d){const u=await S.getpurchaseOrderEntriesBypurchaseOrderID(n.purchase_order_id);E.value.push(...u)}console.log(E.value);const t=E.value.map(n=>({Fecha:n.date.split("T")[0],Hora:n.date.split("T")[1],Sede:n.site_name,Producto:n.item_name,Cantidad:n.quantity,"Unidad de medida":n.unit_measure})),s=M.json_to_sheet(t);s["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const i=M.book_new();M.book_append_sheet(i,s,"Usuarios"),Q(i,"Compras de todas las sedes.xlsx"),P.setLoading(!1,"generando descargas")};return(d,t)=>{const s=v("Button"),i=v("Calendar"),n=v("Dialog"),u=v("router-link"),m=v("MultiSelect"),I=v("InputText"),h=v("Column"),_=v("Tag"),H=v("DataTable"),L=v("Timeline");return W(),J(pe,null,[a(n,{class:"mx-2",visible:x.value,"onUpdate:visible":t[8]||(t[8]=e=>x.value=e),modal:"",header:"Periodo",style:{width:"25rem"}},{default:p(()=>[o("div",ge,[o("div",we,[a(s,{text:"",label:"Hoy",onClick:t[0]||(t[0]=e=>$(0)),class:"p-button-text col-12 p-1 m-0"}),a(s,{text:"",label:"Ayer",onClick:t[1]||(t[1]=e=>$(1)),class:"p-button-text col-12 p-1 m-0"}),a(s,{text:"",label:"Últimos 7 días",onClick:t[2]||(t[2]=e=>$(7)),class:"p-button-text col-12 p-1 m-0"}),a(s,{text:"",label:"Últimos 14 días",onClick:t[3]||(t[3]=e=>$(14)),class:"p-button-text col-12 p-1"}),a(s,{text:"",label:"Últimos 28 días",onClick:t[4]||(t[4]=e=>$(28)),class:"p-button-text col-12 p-0"})]),o("div",xe,[be,a(i,{style:{"min-width":"max-content"},modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=e=>b.value=e)},null,8,["modelValue"])]),o("div",De,[Ce,a(i,{style:{"min-width":"max-content"},modelValue:g.value,"onUpdate:modelValue":t[6]||(t[6]=e=>g.value=e),showWeek:""},null,8,["modelValue"])]),o("div",ke,[o("div",Se,[a(s,{onClick:t[7]||(t[7]=()=>{ae(b.value,g.value),x.value=!1})},{default:p(()=>[V("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),a(n,{class:"mx-2",visible:N.value,"onUpdate:visible":t[11]||(t[11]=e=>N.value=e),modal:"",header:"Interactuar con la orden",style:{width:"25rem"}},{default:p(()=>[o("div",Me,[a(u,{to:`/purchase-order/recorrido/purchase-order-view/${w.value.purchase_order_id}`},{default:p(()=>[a(s,{text:"",style:{width:"100%"},severity:"help",class:"",label:"Ver detalles",icon:"pi pi-eye"})]),_:1},8,["to"]),a(s,{text:"",label:"Descargar en excel",style:{},onClick:t[9]||(t[9]=e=>{var l;return oe(w.value.purchase_order_id,w.value.site_name,(l=w.value.expedition_date)==null?void 0:l.split("T")[0])}),severity:"success",class:"",icon:"pi pi-download"}),a(s,{onClick:t[10]||(t[10]=e=>te(w.value.purchase_order_id)),text:"",label:"Ver Historial",style:{},severity:"warning",class:"",icon:"pi pi-history p-0 m-0"})])]),_:1},8,["visible"]),o("div",Fe,[o("div",Te,[o("div",Ae,[$e,a(m,{style:{},display:"chip",multiple:"",modelValue:R.value,"onUpdate:modelValue":t[12]||(t[12]=e=>R.value=e),optionLabel:"site_name",options:B.value.filter(e=>e.site_id!=12&e.site_id!=13),class:"text-sm multi p-0"},null,8,["modelValue","options"])]),o("div",Ee,[Oe,a(I,{class:"",onClick:t[13]||(t[13]=e=>x.value=!0),style:{height:"2.7rem"},value:`${U(D.value)}  |  ${U(C.value)}`,placeholder:"periodo"},null,8,["value"]),a(s,{onClick:z,icon:"pi pi-search",severity:"help",class:"text-center p-0 col-12 md:p-0",style:{height:"2.5rem",width:"min-content","aspect-ratio":"1 / 1","font-weight":"bold","border-radius":"50%",display:"flex","justify-content":"center"}})])]),o("div",Pe,[a(s,{severity:"help",icon:"pi pi-download",label:"Descargar Todo",onClick:ne}),a(s,{severity:"help",icon:"pi pi-download",label:"Descargar Informe",onClick:le})])]),o("div",Re,[a(H,{stripedRows:"",showGridlines:"",style:{"max-width":"1024px"},filters:A.value,"onUpdate:filters":t[15]||(t[15]=e=>A.value=e),class:"col-12 m-auto",value:T.value,tableStyle:"min-width: 50rem;",paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reportes"},{header:p(()=>[o("div",Ue,[o("div",Ie,[a(I,{style:{width:"100%"},class:"",modelValue:A.value.global.value,"onUpdate:modelValue":t[14]||(t[14]=e=>A.value.global.value=e),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:p(()=>[a(h,{class:"py-1",field:"purchase_order_id",header:"ID"}),a(h,{class:"py-1",field:"employer_name",header:"Solicitante"}),a(h,{class:"py-1",field:"site_name",header:"Sede"}),a(h,{class:"py-1",field:"date",header:"Fecha"},{body:p(e=>{var l;return[o("p",Le,f((l=e.data.expedition_date)==null?void 0:l.split("T")[0]),1)]}),_:1}),a(h,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:p(e=>{var l,r,y,k;return[o("span",Ve,f((k=(y=(r=(l=e.data.expedition_date)==null?void 0:l.split("T")[1])==null?void 0:r.split(":"))==null?void 0:y.slice(0,2))==null?void 0:k.join(" : ")),1)]}),_:1}),a(h,{class:"py-1",field:"date",header:"Estado actual"},{body:p(e=>[a(_,{style:me([{width:"100%"},`background-color:${ee[e.data.current_status]}`])},{default:p(()=>[V(f(e.data.current_status),1)]),_:2},1032,["style"])]),_:1}),a(h,{style:{"justify-content":"center"},class:"py-0 mx-0 px-0",field:"date",header:"Actuar"},{body:p(e=>[o("div",Ne,[a(s,{label:"",style:{width:"min-content"},text:"",onClick:l=>Z(e.data),severity:"",class:"text-center p-1",icon:"fa-solid fa-hand"},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])]),a(n,{class:"mx-2",visible:j.value,"onUpdate:visible":t[16]||(t[16]=e=>j.value=e),modal:"",header:"Historial de la orden",style:{width:"min-content"}},{default:p(()=>[a(L,{value:q.value},{opposite:p(e=>{var l;return[o("p",je,f(e.item.status_timestamp.split("T")[0]),1),V(),Be,o("p",He,f((l=e.item.status_timestamp.split("T")[1])==null?void 0:l.split(":").slice(0,2).join(":")),1)]}),content:p(e=>[o("p",qe,[o("b",null,f(e.item.lap_name),1)]),o("p",ze,f(e.item.name),1),e.item.notes?(W(),J("p",Ge,[We,V(" "+f(e.item.notes),1)])):he("",!0),o("div",Je,[a(s,{disabled:!e.item.notes,style:{height:"2rem",opacity:"0","border-radius":"0.3rem"},cla:"",severity:"help",class:"",label:"Notas"},null,8,["disabled"]),a(s,{disabled:!e.item.conflict,style:{height:"2rem","border-radius":"0.3rem"},severity:"danger",class:"mb-4",label:"Conflictos"},null,8,["disabled"])])]),_:1},8,["value"])]),_:1},8,["visible"])],64)}}},rt=ie(Ye,[["__scopeId","data-v-d6444a4c"]]);export{rt as default};
