import{z as xe,f as r,Q as Ee,h as Se,B as $e,u as Ce,r as T,o as k,c as x,d as l,w as i,F as Ve,a as s,R as Pe,U as f,a4 as M,q as ne,l as z,P as ie,t as v,a2 as Ue,J as Ae,n as de,k as E}from"./index-1afef542.js";const De=s("h4",null,"Seleccione el elemento a eliminar:",-1),Fe={style:{display:"flex",gap:"1rem"}},Ne=s("p",null,"¿Estás seguro de que quieres eliminar este archivo?",-1),je=["onSubmit"],He={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},Ie=["onSubmit"],Oe={class:"col-12 p-0",style:{display:"flex","justify-content":"end"}},Re=s("p",{class:"col-12 text-center text-3xl p-0 m-0",style:{"font-weight":"bold"}},"Guias, formatos, manuales y mas",-1),Be=s("p",{class:"col-12 text-center text-xl p-0 mb-5",style:{"font-weight":"bold"}},"Asi lo hacemos en salchimonster",-1),Me={class:"grid col-12 p-0 gap-3 my-4"},ze={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},qe={key:0,class:"m-0 text-2xl my-4"},Je={key:1,class:"m-0 text-2xl my-4"},Ge={key:2,class:"m-0 text-2xl my-4"},Ke={key:3,class:"m-0 text-2xl my-4"},Qe={class:"block mt-2 md:mt-0 p-input-icon-left"},We=s("i",{class:"pi pi-search"},null,-1),Xe=s("span",{class:"p-column-title"},"Code",-1),Ye=s("div",null,[s("img",{style:{height:"3rem"},src:"https://upload.wikimedia.org/wikipedia/commons/3/34/Microsoft_Office_Excel_%282019%E2%80%93present%29.svg",alt:""})],-1),Ze=s("span",{class:"p-column-title"},"Code",-1),ea=s("span",{class:"p-column-title"},"Code",-1),aa=s("span",{class:"p-column-title"},"Code",-1),ta=s("span",{class:"p-column-title"},"Code",-1),oa={class:"text-right"},la=["onSubmit"],sa={class:"field my-3",style:{display:"flex",gap:"1rem","justify-content":"end","flex-direction":"column"}},ra={key:0,style:{"background-color":"var(--green-100)","border-radius":"0.2rem"},class:"col-12 my-4"},na={style:{display:"flex",gap:"1rem","justify-content":"end"}},ca={__name:"GuiasUsers",setup(ia){const o=xe(),F=r(!1),S=r(null),q=r([]),ce=()=>{S.value=null},N=async()=>{await D().then(e=>w.value=e),await O().then(e=>{g.value=e}),await R().then(e=>{_.value=e}),q.value=[...g.value.map(e=>({id:e.id_area,name:e.area_name,type:"area"})),..._.value.map(e=>({id:e.id_type,name:e.type_name,type:"type"}))]},ue=async()=>{if(!S.value)return;const{id:e,type:a}=S.value;let m=`${f}/`;a==="area"?m+=`area/${e}`:a==="type"&&(m+=`archived-file-type/${e}`);try{const n=await fetch(m,{method:"DELETE"});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);y.add({severity:"success",summary:"Éxito",detail:`${a==="area"?"Área":"Tipo"} eliminado correctamente`,life:3e3}),a==="area"?O().then(c=>{g.value=c,N()}):R().then(c=>{N(),_.value=c}),F.value=!1}catch(n){y.add({severity:"error",summary:"Error",detail:n.message,life:3e3})}},j=r(!1),C=r({area_name:""}),H=r(!1),V=r({type_name:""}),pe=()=>{C.value={area_name:""}},me=()=>{V.value={type_name:""}},J=async()=>{o.setLoading(!0,"creando area");try{const e=await fetch(`${f}/area`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C.value)});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);y.add({severity:"success",summary:"Éxito",detail:"Área creada correctamente",life:3e3}),O().then(a=>g.value=a),j.value=!1,o.setLoading(!1,"cargando archivos")}catch(e){y.add({severity:"error",summary:"Error",detail:e.message,life:3e3}),o.setLoading(!1,"cargando archivos")}},G=async()=>{o.setLoading(!0,"creando tipo");try{const e=await fetch(`${f}/archived-file-type`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V.value)});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);y.add({severity:"success",summary:"Éxito",detail:"Tipo de archivo creado correctamente",life:3e3}),R().then(a=>_.value=a),H.value=!1,o.setLoading(!1,"cargando archivos")}catch(e){y.add({severity:"error",summary:"Error",detail:e.message,life:3e3}),o.setLoading(!1,"cargando archivos")}},g=r([]),_=r([]),P=r(!1),I=r(null),ve=async()=>{if(o.setLoading(!0,"borrando archivo"),!!I.value)try{const e=await fetch(`${f}/archived-file/${I.value}`,{method:"DELETE"});if(e.ok)o.setLoading(!1,"borrando archivo"),y.add({severity:"success",summary:"Éxito",detail:"Archivo eliminado correctamente",life:3e3}),D().then(a=>w.value=a);else throw new Error(`Error al eliminar el archivo: ${e.statusText}`)}catch(e){o.setLoading(!1,"borrando archivo"),y.add({severity:"error",summary:"Error",detail:e.message,life:3e3})}finally{o.setLoading(!1,"borrando archivo"),P.value=!1,I.value=null}},d=r(_.value[0]),u=r(g.value[0]),h=r({}),fe=r({}),w=r([]),K=r(null),U=r(!1),L=r({archived_file_id:"",custom_filename:"",file:null}),he=()=>{U.value=!0},Q=()=>{U.value=!1,L.value={archived_file_id:"",custom_filename:"",file:null}},ye=e=>{L.value.file=e.target.files[0]},W=async()=>{if(L.value.file){const e=new FormData;e.append("file",L.value.file),e.append("id_area",h.value.area.id_area),e.append("id_type",h.value.type.id_type),e.append("file_name",h.value.file_name);try{const a=await fetch(`${f}/upload-archived-file/`,{method:"POST",body:e});if(a.ok){const m=await a.json();y.add({severity:"success",summary:"Éxito",detail:"Archivo subido correctamente",life:3e3}),Q(),D().then(n=>w.value=n)}else throw new Error(`Error al subir el archivo: ${a.statusText}`)}catch(a){y.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}}else y.add({severity:"warn",summary:"Advertencia",detail:"Por favor, selecciona un archivo",life:3e3})},X=r();r([]);const A=r(null),ge=()=>{A.value={global:{value:null,matchMode:Pe.CONTAINS}}};Ee(()=>{ge()});const _e=(e,a,m)=>{const n=`${f}/get-archived-file/${e}/${a}/${m.split(".")[0]}`;fetch(n).then(c=>{if(c.ok)return c.blob();throw new Error("Network response was not ok.")}).then(c=>{const b=window.URL.createObjectURL(c),p=document.createElement("a");p.href=b,p.download=m,document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(b)}).catch(c=>console.error("Error downloading the file:",c))};async function D(){o.setLoading(!0,"cargando archivos");try{const e=await fetch(`${f}/archived-files`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function O(){o.setLoading(!0,"cargando areas");try{const e=await fetch(`${f}/areas`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function R(){o.setLoading(!0,"cargando tipos");try{const e=await fetch(`${f}/archived-file-types    `);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}Se(()=>{N()});async function we(){if(o.setLoading(!0,"cargando archivos"),!u.value){o.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${f}/archived-files/area/${u.value.id_area}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function be(){if(o.setLoading(!0,"cargando archivos"),!d.value){o.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${f}/archived-files/type/${d.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){o.setLoading(!1,"cargando archivos"),console.error("Error al obtener usuarios agrupados por sede:",e)}}async function ke(){if(o.setLoading(!0,"cargando archivos"),!d.value||!u.value){o.setLoading(!1,"cargando archivos");return}try{const e=await fetch(`${f}/archived-files/${u.value.id_area}/${d.value.id_type}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);let a=await e.json();return o.setLoading(!1,"cargando archivos"),a}catch(e){console.error("Error al obtener usuarios agrupados por sede:",e),o.setLoading(!1,"cargando archivos")}}const Le=()=>{u.value&&d.value?ke().then(e=>w.value=e):!u.value&&d.value?we().then(e=>w.value=e):u.value&&!d.value?be().then(e=>w.value=e):D()},y=$e();return Ce(),(e,a)=>{var Y,Z,ee,ae;const m=T("Dropdown"),n=T("Button"),c=T("Dialog"),b=T("InputText"),p=T("Column"),Te=T("DataTable");return k(),x(Ve,null,[l(c,{visible:F.value,"onUpdate:visible":a[1]||(a[1]=t=>F.value=t),header:"Eliminar área o tipo",modal:"",closable:!0,onHide:ce},{default:i(()=>[s("div",null,[De,s("div",Fe,[l(m,{style:{width:"60%"},modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=t=>S.value=t),options:q.value,optionLabel:"name",placeholder:"Seleccione un área o tipo"},null,8,["modelValue","options"]),l(n,{style:{width:"40%"},label:"Eliminar",icon:"pi pi-check",class:"p-button-danger",onClick:ue})])])]),_:1},8,["visible"]),l(c,{visible:P.value,"onUpdate:visible":a[3]||(a[3]=t=>P.value=t),header:"Confirmar eliminación",modal:"",closable:!1},{default:i(()=>[Ne,l(n,{label:"No",icon:"pi pi-times",onClick:a[2]||(a[2]=t=>P.value=!1),class:"p-button-text"}),l(n,{label:"Sí",icon:"pi pi-check",onClick:ve,class:"p-button-danger"})]),_:1},8,["visible"]),l(c,{visible:j.value,"onUpdate:visible":a[5]||(a[5]=t=>j.value=t),header:"Crear nueva área",modal:"",closable:!0,onHide:pe},{default:i(()=>[s("form",{onSubmit:M(J,["prevent"])},[l(b,{modelValue:C.value.area_name,"onUpdate:modelValue":a[4]||(a[4]=t=>C.value.area_name=t),placeholder:"Nombre del área",class:"w-full"},null,8,["modelValue"]),s("div",He,[l(n,{rounded:"",class:"mt-4",label:"Crear",icon:"pi pi-check",onClick:J})])],40,je)]),_:1},8,["visible"]),l(c,{visible:H.value,"onUpdate:visible":a[7]||(a[7]=t=>H.value=t),header:"Crear nuevo tipo de archivo",modal:"",closable:!0,onHide:me},{default:i(()=>[s("form",{onSubmit:M(G,["prevent"])},[l(b,{modelValue:V.value.type_name,"onUpdate:modelValue":a[6]||(a[6]=t=>V.value.type_name=t),placeholder:"Nombre del tipo de archivo",class:"w-full"},null,8,["modelValue"]),s("div",Oe,[l(n,{rounded:"",class:"mt-4",label:"Crear",icon:"pi pi-check",onClick:G})])],40,Ie)]),_:1},8,["visible"]),Re,Be,l(Te,{class:"card mb-4 p-0 my-0 xl:shadow-5 p-4",grid:"",style:{"max-width":"900px",border:"none",margin:"auto","background-color":"transparent"},ref:"dt",value:w.value,selection:X.value,"onUpdate:selection":a[11]||(a[11]=t=>X.value=t),dataKey:"id",paginator:!0,rows:10,filters:A.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,100],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} archivos",responsiveLayout:"scroll",scrollable:"","scroll-height":"62vh"},{header:i(()=>{var t,B,te,oe,le,se,re;return[s("div",Me,[l(m,{style:{height:"3rem","text-justify":"center"},class:"col-12 lg:col-5 p-0",optionLabel:"area_name",modelValue:u.value,"onUpdate:modelValue":a[8]||(a[8]=$=>u.value=$),options:g.value,placeholder:"Area de la empresa"},null,8,["modelValue","options"]),l(m,{style:{height:"3rem","text-justify":"center"},class:"col-12 lg:col-5 p-0",modelValue:d.value,"onUpdate:modelValue":a[9]||(a[9]=$=>d.value=$),optionLabel:"type_name",options:_.value,placeholder:"Tipo de archivo"},null,8,["modelValue","options"]),l(n,{onClick:Le,style:{height:"3rem","border-radius":"50%","aspect-ratio":"1/1",display:"flex","align-items":"center","justify-content":"center"},class:"text-center",severity:"success",size:"small"},{default:i(()=>[s("i",{class:ne(z(ie).SEARCH)},null,2)]),_:1})]),s("div",ze,[!d.value&&!u.value?(k(),x("p",qe,v((t=d.value)==null?void 0:t.type_name)+" Todos los tipos de archivos de todas las areas "+v((B=u.value)==null?void 0:B.area_name),1)):d.value&&!u.value?(k(),x("p",Je,v((te=d.value)==null?void 0:te.type_name)+" de todas las areas ",1)):!d.value&&u.value?(k(),x("p",Ge,v((oe=d.value)==null?void 0:oe.type_name)+" Todos los tipos de archivos del area "+v((le=u.value)==null?void 0:le.area_name),1)):(k(),x("p",Ke,v((se=d.value)==null?void 0:se.type_name)+" del area de "+v((re=u.value)==null?void 0:re.area_name),1)),z(Ue)()==fe.value.creator_id?(k(),Ae(n,{key:4,label:"Subir archivo",icon:"pi pi-upload",class:"p-button-success ml-4 p-2",onClick:he})):de("",!0),s("span",Qe,[We,l(b,{class:"",modelValue:A.value.global.value,"onUpdate:modelValue":a[10]||(a[10]=$=>A.value.global.value=$),placeholder:"Buscar..."},null,8,["modelValue"])])])]}),default:i(()=>[l(p,{class:"p-2",selectionMode:"multiple",headerStyle:"width: 3rem; ",frozen:""}),l(p,{class:"p-2",field:"id",header:"Id",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[Xe,E(" "+v(t.data.id_file),1)]),_:1}),l(p,{class:"p-2",field:"id",header:"",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[Ye]),_:1}),l(p,{class:"p-2",field:"file_name",header:"Nombre",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[Ze,E(" "+v(t.data.file_name),1)]),_:1}),l(p,{class:"p-2",field:"type",header:"Tipo",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ea,E(" "+v(t.data.type_name),1)]),_:1}),l(p,{class:"p-2",field:"type",header:"Area",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[aa,E(" "+v(t.data.area_name),1)]),_:1}),l(p,{class:"p-2",field:"upload_date",header:"Fecha",sortable:!0,headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[ta,E(" "+v(t.data.upload_date),1)]),_:1}),l(p,{class:"p-2",field:"location",header:"Acciones",sortable:!0,frozen:"",alignFrozen:"right",headerStyle:"width:min-content; min-width:min-content; "},{body:i(t=>[l(n,{text:"",class:"p-0 mx-2",severity:"success",onClick:B=>_e(t.data.id_area,t.data.id_type,t.data.file_name)},{default:i(()=>[s("span",oa,[s("i",{class:ne(z(ie).DOWNLOAD)},null,2)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),l(c,{visible:U.value,"onUpdate:visible":a[16]||(a[16]=t=>U.value=t),style:{width:"450px"},header:`Subir ${(Z=(Y=h.value)==null?void 0:Y.type)==null?void 0:Z.type_name} para el area de ${(ae=(ee=h.value)==null?void 0:ee.area)==null?void 0:ae.area_name}`,modal:"",closable:!0,onHide:Q},{default:i(()=>[s("form",{onSubmit:M(W,["prevent"]),enctype:"multipart/form-data"},[l(b,{optionLabel:"area_name",placeholder:"Nombre del archivo",class:"col-12 my-0",style:{padding:"0.8rem 10px"},modelValue:h.value.file_name,"onUpdate:modelValue":a[12]||(a[12]=t=>h.value.file_name=t),options:g.value},null,8,["modelValue","options"]),l(m,{optionLabel:"area_name",placeholder:"Area de la empresa",class:"col-12 p-0 my-3",modelValue:h.value.area,"onUpdate:modelValue":a[13]||(a[13]=t=>h.value.area=t),options:g.value},null,8,["modelValue","options"]),l(m,{class:"col-12 p-0",placeholder:"Tipo de archivo",modelValue:h.value.type,"onUpdate:modelValue":a[14]||(a[14]=t=>h.value.type=t),optionLabel:"type_name",options:_.value},null,8,["modelValue","options"]),s("div",sa,[L.value.file?(k(),x("div",ra,v(L.value.file.name),1)):de("",!0),s("div",na,[s("input",{type:"file",id:"file",ref_key:"fileInput",ref:K,onChange:ye,required:"",style:{display:"none"}},null,544),l(n,{rounded:"",onClick:a[15]||(a[15]=()=>{K.value.click()})},{default:i(()=>[E(" Cargar archivo")]),_:1}),l(n,{rounded:"",severity:"success",label:"Enviar",class:"",onClick:W})])])],40,la)]),_:1},8,["visible","header"])],64)}}};export{ca as default};
