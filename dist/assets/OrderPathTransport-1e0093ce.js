import{_ as De,H as ke,r as c,l as Ce,h as Te,a as w,o as W,c as K,d as o,w as r,b as a,F as ae,I as je,q as f,t as p,e as Fe,s as N,B as Se,a6 as Ae,m as Oe,p as Pe,g as Ue}from"./index-5ca1b267.js";import{s as Ee}from"./siteService-e2bfc006.js";import"./sass.default-a5b7a582.js";import{p as b}from"./purchaseOrderService-8f9394b0.js";import{u as F,w as se}from"./xlsx-4f9172c7.js";import{E as $e,F as oe}from"./FileSaver.min-192d3dee.js";import{f as le}from"./format-8cf56335.js";import{e as ne}from"./es-f6133d36.js";import"./_commonjsHelpers-de833af9.js";const v=M=>(Pe("data-v-a751ecd3"),M=M(),Ue(),M),Me={class:"grid"},Ie={class:"col-12 px-0 mx-0"},qe={class:"col-12",style:{display:"flex","flex-direction":"column"}},Re=v(()=>a("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),Le={class:"col-12",style:{display:"flex","flex-direction":"column"}},Ne=v(()=>a("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),Ve={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},Be={class:"col-12",style:{display:"flex","justify-content":"center"}},He=v(()=>a("p",null,"Desea ageregar notas?",-1)),ze={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},Ge=v(()=>a("b",null,"Autor de la nota: ",-1)),Qe=v(()=>a("b",null,"Fecha: ",-1)),We={style:{border:"1px solid","border-radius":"0.3rem"},class:"p-2"},Ke=v(()=>a("b",null,"Contenido de la Observacion: ",-1)),Je=v(()=>a("br",null,null,-1)),Ye={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},Xe={class:"m-0 p-0",style:{display:"flex",width:"100%","flex-direction":"column","justify-content":"start",gap:"0.5rem"}},Ze={class:"m-0 p-0"},et=v(()=>a("b",null,"Autorizada por:",-1)),tt={class:"m-0 p-0"},at=v(()=>a("b",null,"Sede:",-1)),st={class:"mt-0 p-0"},ot=v(()=>a("b",null,"Fecha de autorizacion:",-1)),lt={style:{display:"flex","flex-direction":"column","align-items":"start",gap:"0.5rem"}},nt={style:{display:"flex","align-items":"center",gap:"1rem"}},it={class:"text-right"},rt=["max","onUpdate:modelValue"],dt={class:"pt-3",style:{display:"flex","justify-content":"end","align-items":"end"}},ct={class:"m-auto",style:{"max-width":"1024px"}},ut={class:"col-12 px-3 mt-4 pack-butons",style:{display:"flex","justify-content":"end",gap:"1rem"}},pt={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},mt={class:"grid",style:{"align-items":"center"}},ht=v(()=>a("div",{class:"col-12 md:col-6 p-3"},[a("span",{class:"text-xl",style:{width:"100%"}}," Ordenes pendientes por Transportar")],-1)),vt={class:"col-12 md:col-6 p-3"},_t={style:{"min-width":"max-content"}},yt={style:{"min-width":"max-content"}},ft={class:"m-0 p-0",style:{display:"flex",width:"min-content","justify-content":"start","align-items":"center",gap:"0.5rem"}},gt={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},wt=v(()=>a("br",null,null,-1)),bt={style:{"min-width":"max-content"},class:"p-text-secondary m-0 p-0"},xt={class:"m-0"},Dt={class:"m-0"},kt={key:0},Ct=v(()=>a("b",null,"Notas",-1)),Tt={style:{display:"flex",gap:"1rem"}},ie=3,jt={__name:"OrderPathTransport",setup(M){const k=ke(),I=c(!1),S=c([]),A=c(!1),V=c({}),re=l=>{if(l.some(t=>!t.ajustment&&t.ajustment!==0)){alert("por favor complete todos los campos");return}if(l.some(t=>t.ajustment>t.quantity_adjusted)){alert("No puedes enviar mas de lo solicitado");return}A.value=!0},B=c(""),_=c({}),H=c(!1),z=c(!1),J=c([]),de=async l=>{z.value=!0,J.value=await b.getPurchaseOrderHistory(l)},ce=()=>{S.value.forEach(l=>{l.ajustment=l.quantity_adjusted})},q=c(!1),ue=l=>{I.value=!0,_.value=l},pe=async l=>{q.value=!0,S.value=await b.getpurchaseOrderEntriesBypurchaseOrderID(l)},me={Generada:"#FF0000",Lista:"#FFA500","Entregada al transportista":"#FFFF00",Completada:"#00FF00"},he=[{color:"#7fffd4",description:"Esta todo bien"},{color:"rgb(251 53 146)",description:"Cuidado estan enviando mas de lo que reportan"},{color:" rgb(255, 175, 51)",description:"Recibiste menos de lo reportado"}],Y=Ce(),X=c([]),Z=c([{}]),O=c(!1),C=c(new Date(new Date().setDate(new Date().getDate()-7))),x=c(new Date),P=c(new Date(new Date().setDate(new Date().getDate()-7))),U=c(new Date),T=c(),D=c(),ve=(l,t)=>{P.value=l,U.value=t},E=l=>{const t=new Date,s=new Date(t);s.setDate(s.getDate()+1);const d=new Date(t);d.setDate(t.getDate()-l),C.value=d,l==1?(x.value=t,U.value=x.value,P.value=C.value,O.value=!1):(x.value=s,P.value=C.value,U.value=x.value,O.value=!1),_e()};Te(async()=>{X.value=await Ee.getSites(),Z.value=X.value,T.value=await b.getPurchaseOrderByLap_id(ie)}),(()=>{D.value={global:{value:null,matchMode:je.CONTAINS}}})();function ee(l){const t=new Date(l),s=t.getFullYear(),d=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0");return`${s}-${d}-${i}`}const _e=async()=>{const l=Z.value.map(d=>d.site_id);Y.rawUserData.id;const t=ee(P.value),s=ee(U.value);T.value=await b.getAllpurchaseOrderReportsFiltered(l,t,s)},$=c([]),ye=async(l,t,s)=>{$.value=await b.getpurchaseOrderEntriesBypurchaseOrderID(l);const d=$.value.map(g=>({Producto:g.item_name,Cantidad:g.quantity,"Unidad de medida":g.unit_measure})),i=F.json_to_sheet(d);i["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const h=F.book_new();F.book_append_sheet(h,i,"Usuarios"),se(h,`Orden_de_compra_${t}_${s} .xlsx`)},fe=l=>l.map(s=>{if(s.quantity!=s.ajustment)return{order_purchase_entry_id:s.entry_id,quantity_adjusted:s.ajustment}}).filter(s=>s),ge=async l=>{if(l.some(s=>!s.ajustment&&s.ajustment!==0)){alert("por favor complete todos los campos");return}k.setLoading(!0,"Transportando orden");const t={purchase_order_id:_.value.purchase_order_id,lap_id:_.value.lap_id,responsible_id:Y.rawUserData.id,ajusts:fe(l),order_purchase_notes:B.value};await b.PreparePurchaserOrder(t),T.value=await b.getPurchaseOrderByLap_id(ie),I.value=!1,q.value=!1,k.setLoading(!1,"Transportando orden"),H.value=!1,A.value=!1},we=async()=>{k.setLoading(!0,"generando descargas");const l=T.value,t=[];for(const e of l){const n=await b.getpurchaseOrderEntriesBypurchaseOrderID(e.purchase_order_id);t.push(...n)}const s={};t.forEach(e=>{const n=e.site_name,u=e.item_name,j=e.quantity,Q=e.unit_measure;s[u]||(s[u]={unit_measure:Q}),s[u][n]||(s[u][n]=0),s[u][n]+=j});const d=[...new Set(t.map(e=>e.site_name))],i=[],h=le(P.value,"dd-MMMM-yyyy",{locale:ne}),g=le(U.value,"dd-MMMM-yyyy",{locale:ne});h==g?i.push([`ORDENES DE COMPRA DEL ${h.toUpperCase()}`,...Array(d.length+2).fill("")]):i.push([`ORDENES DE COMPRA DEL${h.toUpperCase()} AL ${g.toUpperCase()}`,...Array(d.length+2).fill("")]);const R=["PRODUCTO","UNIDAD DE MEDIDA",...d,"TOTAL"];i.push(R);for(const[e,n]of Object.entries(s)){const u=[e,n.unit_measure];let j=0;for(const Q of d){const te=n[Q]||0;u.push(te),j+=te}u.push(j),i.push(u)}const m=new $e.Workbook,y=m.addWorksheet("Inventario por Sede");i.forEach((e,n)=>{const u=y.addRow(e);n===0?(u.height=40,u.font={name:"Arial",bold:!0,size:14},u.alignment={horizontal:"center",vertical:"middle",wrapText:!0},y.mergeCells(`A1:${y.getColumn(d.length+3).letter}1`),y.getRow(1).eachCell(j=>{j.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF00"}}})):n===1&&(u.font={name:"Arial",bold:!0})}),y.columns.forEach((e,n)=>{e.width=n===0?30:n===1?25:15,e.eachCell(u=>{u.font={name:"Arial"},u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),y.getRow(2).eachCell(e=>{e.font={name:"Arial",bold:!0}}),y.getRow(1).eachCell(e=>{e.font={name:"Arial",bold:!0,size:16}}),y.views=[{showGridLines:!1}];const G=await m.xlsx.writeBuffer(),L=new Blob([G],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});h==g?oe.saveAs(L,`Reporte de inventario del ${h}.xlsx`):oe.saveAs(L,`Reporte de inventario del ${h} al ${g} .xlsx`),k.setLoading(!1,"generando descargas")},be=async()=>{k.setLoading(!0,"generando descargas");const l=T.value;for(const i of l){const h=await b.getpurchaseOrderEntriesBypurchaseOrderID(i.purchase_order_id);$.value.push(...h)}console.log($.value);const t=$.value.map(i=>({Fecha:i.date.split("T")[0],Hora:i.date.split("T")[1],Sede:i.site_name,Producto:i.item_name,Cantidad:i.quantity,"Unidad de medida":i.unit_measure})),s=F.json_to_sheet(t);s["!cols"]=[{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(0,16)},{wch:Math.max(30,8)},{wch:Math.max(0,8)}];const d=F.book_new();F.book_append_sheet(d,s,"Usuarios"),se(d,"Compras de todas las sedes.xlsx"),k.setLoading(!1,"generando descargas")};function xe(l){l.key===","&&(alert("Por favor usa punto ( . ) para los decimales, gracias"),l.preventDefault())}return(l,t)=>{const s=w("Button"),d=w("Calendar"),i=w("Dialog"),h=w("Textarea"),g=w("router-link"),R=w("Tag"),m=w("Column"),y=w("DataTable"),G=w("InputText"),L=w("Timeline");return W(),K(ae,null,[o(i,{class:"mx-2",visible:O.value,"onUpdate:visible":t[8]||(t[8]=e=>O.value=e),modal:"",header:"Periodo",style:{width:"25rem"}},{default:r(()=>[a("div",Me,[a("div",Ie,[o(s,{text:"",label:"Hoy",onClick:t[0]||(t[0]=e=>E(0)),class:"p-button-text col-12 p-1 m-0"}),o(s,{text:"",label:"Ayer",onClick:t[1]||(t[1]=e=>E(1)),class:"p-button-text col-12 p-1 m-0"}),o(s,{text:"",label:"Últimos 7 días",onClick:t[2]||(t[2]=e=>E(7)),class:"p-button-text col-12 p-1 m-0"}),o(s,{text:"",label:"Últimos 14 días",onClick:t[3]||(t[3]=e=>E(14)),class:"p-button-text col-12 p-1"}),o(s,{text:"",label:"Últimos 28 días",onClick:t[4]||(t[4]=e=>E(28)),class:"p-button-text col-12 p-0"})]),a("div",qe,[Re,o(d,{style:{"min-width":"max-content"},modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=e=>C.value=e)},null,8,["modelValue"])]),a("div",Le,[Ne,o(d,{style:{"min-width":"max-content"},modelValue:x.value,"onUpdate:modelValue":t[6]||(t[6]=e=>x.value=e),showWeek:""},null,8,["modelValue"])]),a("div",Ve,[a("div",Be,[o(s,{onClick:t[7]||(t[7]=()=>{ve(C.value,x.value),O.value=!1})},{default:r(()=>[f("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),o(i,{class:"mx-2",visible:A.value,"onUpdate:visible":t[12]||(t[12]=e=>A.value=e),modal:"",header:"Notas de Transporte de orden",style:{width:"25rem"}},{footer:r(()=>[a("div",ze,[o(s,{text:"",onClick:t[10]||(t[10]=e=>A.value=!1),severity:"danger",label:"cancelar"}),o(s,{onClick:t[11]||(t[11]=e=>ge(S.value.filter(n=>n.quantity!=0))),severity:"help",label:"Alistar orden"})])]),default:r(()=>[He,a("div",null,[o(h,{modelValue:B.value,"onUpdate:modelValue":t[9]||(t[9]=e=>B.value=e),style:{width:"100%",resize:"none",height:"10rem"}},null,8,["modelValue"])])]),_:1},8,["visible"]),o(i,{class:"mx-2",visible:H.value,"onUpdate:visible":t[13]||(t[13]=e=>H.value=e),modal:"",header:"Notas de la orden",style:{width:"28rem"}},{default:r(()=>[a("div",null,[a("p",null,[Ge,f(p(V.value.item.name),1)]),a("p",null,[Qe,f(p(V.value.item.status_timestamp.split("T")[0]),1)]),a("p",We,[Ke,f(),Je,f(p(V.value.item.notes),1)])])]),_:1},8,["visible"]),o(i,{class:"mx-2",visible:I.value,"onUpdate:visible":t[17]||(t[17]=e=>I.value=e),modal:"",header:"Interactuar con la orden",style:{width:"25rem"}},{default:r(()=>[a("div",Ye,[o(g,{to:`/purchase-order/recorrido/purchase-order-view/${_.value.purchase_order_id}`},{default:r(()=>[o(s,{text:"",style:{width:"100%"},severity:"help",class:"",label:"Ver detalles",icon:"pi pi-eye"})]),_:1},8,["to"]),o(s,{text:"",label:"Descargar en excel",style:{},onClick:t[14]||(t[14]=e=>{var n;return ye(_.value.purchase_order_id,_.value.site_name,(n=_.value.expedition_date)==null?void 0:n.split("T")[0])}),severity:"success",class:"",icon:"pi pi-download"}),o(s,{onClick:t[15]||(t[15]=e=>de(_.value.purchase_order_id)),text:"",label:"Ver Historial",style:{},severity:"warning",class:"",icon:"pi pi-history p-0 m-0"}),o(s,{onClick:t[16]||(t[16]=e=>pe(_.value.purchase_order_id)),label:"Transportar orden",style:{},severity:"help",class:"",icon:"pi  p-0 m-0"})])]),_:1},8,["visible"]),o(i,{class:"px-2",visible:q.value,"onUpdate:visible":t[20]||(t[20]=e=>q.value=e),modal:"",header:"Transportar orden",style:{width:"max-content","max-width":"100vw"}},{footer:r(()=>[a("div",dt,[o(s,{outlined:"",onClick:ce,severity:"help",label:"Todo esta completo"}),o(s,{onClick:t[19]||(t[19]=e=>re(S.value.filter(n=>n.quantity!=0))),severity:"help",label:"Transportar orden"})])]),default:r(()=>[a("div",Xe,[a("p",Ze,[et,f(" "+p(_.value.responsible_lap),1)]),a("p",tt,[at,f(" "+p(_.value.site_name),1)]),a("p",st,[ot,f(" "+p(_.value.status_timestamp.split("T")[0]),1)]),a("div",lt,[(W(),K(ae,null,Fe(he,e=>a("div",nt,[o(R,{style:N([`background-color:${e.color}`,{height:"2rem","aspect-ratio":"4 / 3"}])},null,8,["style"]),a("span",null,p(e.description),1)])),64))]),o(y,{showGridlines:"",style:{"max-width":"1024px"},stripedRows:"",filters:D.value,"onUpdate:filters":t[18]||(t[18]=e=>D.value=e),class:"col-12 m-auto p-0 m-0",value:S.value.filter(e=>e.quantity!=0),tableStyle:"min-width: 50rem;"},{default:r(()=>[o(m,{class:"py-0",field:"item_id",header:"id"}),o(m,{class:"py-0",field:"item_name",header:"Item"},{body:r(e=>[a("p",{style:N(e.data.ajustment===0?"text-decoration: line-through;background-color:#ffc9d1":"")},p(e.data.item_name),5)]),_:1}),o(m,{class:"py-0",field:"quantity_adjusted",header:"cant. Aprobada en despacho"},{body:r(e=>[a("p",it,p(e.data.quantity_adjusted),1)]),_:1}),o(m,{class:"py-0 px-0",field:"quantity",header:"cant. realmente recibida"},{body:r(e=>[Se(a("input",{onKeydown:xe,class:"text-right",max:e.data.quantity,min:0,"onUpdate:modelValue":n=>e.data.ajustment=n,style:N([{"background-color":"transparent",height:"2rem",width:"100%",border:"none"},e.data.quantity_adjusted===e.data.ajustment?"background-color: aquamarine;":e.data.ajustment===0?"background-color:#ffc9d1":e.data.ajustment<e.data.quantity?"background-color:#FFAF33;border:2px solid #FF7A33":e.data.ajustment>e.data.quantity?"background-color:#FF3393;border:2px solid #FF3342":""]),type:"number"},null,44,rt),[[Ae,e.data.ajustment]])]),_:1}),o(m,{class:"py-0",field:"unit_measure",header:"Und. de medida"}),o(m,{class:"py-0",field:"quantity",header:"interactuar"},{body:r(e=>[o(s,{onClick:n=>e.data.ajustment=e.data.quantity_adjusted,style:{"min-width":"max-content"},text:"",class:"px-0 py-1",label:"Esta completo"},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value"])])]),_:1},8,["visible"]),a("div",ct,[a("div",ut,[o(s,{severity:"help",icon:"pi pi-download",label:"Descargar Todo",onClick:be}),o(s,{severity:"help",icon:"pi pi-download",label:"Descargar Informe",onClick:we})])]),a("div",pt,[o(y,{showGridlines:"",style:{"max-width":"1024px"},filters:D.value,"onUpdate:filters":t[22]||(t[22]=e=>D.value=e),class:"col-12 m-auto",value:T.value,tableStyle:"min-width: 50rem;",paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reportes"},{header:r(()=>[a("div",mt,[ht,a("div",vt,[o(G,{style:{width:"100%"},class:"",modelValue:D.value.global.value,"onUpdate:modelValue":t[21]||(t[21]=e=>D.value.global.value=e),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:r(()=>[o(m,{class:"py-1",field:"purchase_order_id",header:"ID"}),o(m,{class:"py-1",field:"responsible_lap",header:"Autorizada por"}),o(m,{class:"py-1",field:"site_name",header:"Sede"}),o(m,{class:"py-1",field:"date",header:"Fecha de autorizacion"},{body:r(e=>{var n;return[a("p",_t,p((n=e.data.status_timestamp)==null?void 0:n.split("T")[0]),1)]}),_:1}),o(m,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:r(e=>{var n;return[a("span",yt,p((n=e.data.status_timestamp)==null?void 0:n.split("T")[1]),1)]}),_:1}),o(m,{class:"py-1",field:"date",header:"Estado actual"},{body:r(e=>[o(R,{style:N([{width:"100%",height:"2.7rem"},`background-color:${me[e.data.current_status]}`])},{default:r(()=>[f(p(e.data.current_status),1)]),_:2},1032,["style"])]),_:1}),o(m,{style:{width:"20px"},class:"py-1 mx-0 px-0",field:"date",header:"Acciones"},{body:r(e=>[a("div",ft,[o(s,{label:"Interactuar",onClick:n=>ue(e.data),severity:"help",class:"",icon:"pi "},null,8,["onClick"])])]),_:1})]),_:1},8,["filters","value"])]),o(i,{class:"mx-2",visible:z.value,"onUpdate:visible":t[23]||(t[23]=e=>z.value=e),modal:"",header:"Historial de la orden",style:{width:"min-content"}},{default:r(()=>[o(L,{value:J.value},{opposite:r(e=>{var n;return[a("p",gt,p(e.item.status_timestamp.split("T")[0]),1),f(),wt,a("p",bt,p((n=e.item.status_timestamp.split("T")[1])==null?void 0:n.split(":").slice(0,2).join(":")),1)]}),content:r(e=>[a("p",xt,[a("b",null,p(e.item.lap_name),1)]),a("p",Dt,p(e.item.name),1),e.item.notes?(W(),K("p",kt,[Ct,f(" "+p(e.item.notes),1)])):Oe("",!0),a("div",Tt,[o(s,{disabled:!e.item.notes,style:{height:"2rem",opacity:"0","border-radius":"0.3rem"},cla:"",severity:"help",class:"",label:"Notas"},null,8,["disabled"]),o(s,{disabled:!e.item.conflict,style:{height:"2rem","border-radius":"0.3rem"},severity:"danger",class:"mb-4",label:"Conflictos"},null,8,["disabled"])])]),_:1},8,["value"])]),_:1},8,["visible"])],64)}}},qt=De(jt,[["__scopeId","data-v-a751ecd3"]]);export{qt as default};
