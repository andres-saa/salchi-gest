import{_ as E,l as N,r as i,i as H,a as c,o as q,c as z,g as a,w as d,b as l,F as G,s as W,m as V,t as C,k as Y,p as J,h as K}from"./index-5708809f.js";import{s as Q}from"./siteService-460c2fd3.js";import"./sass.default-a5b7a582.js";import{u as F,w as X}from"./xlsx-4f9172c7.js";import{p as S}from"./purchaseOrderService-ad05a1cf.js";const k=f=>(J("data-v-cbad8627"),f=f(),K(),f),Z={class:"grid"},ee={class:"col-12 px-0 mx-0"},te={class:"col-12",style:{display:"flex","flex-direction":"column"}},ae=k(()=>l("span",{class:"text-l",style:{"font-weight":"bold"}},"Desde ",-1)),se={class:"col-12",style:{display:"flex","flex-direction":"column"}},le=k(()=>l("span",{style:{"font-weight":"bold"},class:"text-l"},"Hasta ",-1)),oe={class:"col-12 p-0",style:{display:"flex","justify-content":"center"}},ne={class:"col-12",style:{display:"flex","justify-content":"center"}},ie={class:"m-auto",style:{"max-width":"1024px"}},de={class:"grid mx-0 mt-4"},re={class:"col-12 p-2",style:{display:"flex",gap:"1rem","justify-content":"center","align-items":"center"}},ce=k(()=>l("span",{class:"text-xl"},[l("b",null,"Periodo")],-1)),pe={class:"col-12 px-3",style:{display:"flex","justify-content":"end"}},ue={class:"mt-3",style:{"min-height":"20vh",display:"flex","justify-content":"center","align-items":"center"}},me={class:"grid",style:{"align-items":"center"}},_e=k(()=>l("div",{class:"col-12 md:col-6 p-3"},[l("span",{class:"text-xl",style:{width:"100%"}}," Mis Ordenes de compra")],-1)),ve={class:"col-12 md:col-6 p-3"},ye={style:{"min-width":"max-content"}},he={style:{"min-width":"max-content"}},ge={class:"m-0 p-0",style:{display:"flex",width:"min-content","justify-content":"start","align-items":"center",gap:"0.5rem"}},xe={__name:"purchaseOrderMyOrders",setup(f){const R={Generada:"#FF0000",Lista:"#FFA500","Entregada al transportista":"#FFFF00",Completada:"#00FF00"},T=N(),U=i([]);i([]);const u=i(!1),m=i(new Date(new Date().setDate(new Date().getDate()-7))),p=i(new Date),y=i(new Date(new Date().setDate(new Date().getDate()-7))),h=i(new Date),D=i(),g=i(),I=(o,e)=>{y.value=o,h.value=e},x=o=>{const e=new Date,s=new Date(e);s.setDate(s.getDate()+1);const r=new Date(e);r.setDate(e.getDate()-o),m.value=r,o==1?(p.value=e,h.value=p.value,y.value=m.value,u.value=!1):(p.value=s,y.value=m.value,h.value=p.value,u.value=!1),$()};H(async()=>{U.value=await Q.getSites();const o=T.rawUserData.id;D.value=await S.getAllMypurchaseOrderReports(o)}),(()=>{g.value={global:{value:null,matchMode:W.CONTAINS}}})();function b(o){const e=new Date(o),s=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),_=e.getDate().toString().padStart(2,"0");return`${s}-${r}-${_}`}const $=async()=>{const o=T.rawUserData.id,e=b(y.value),s=b(h.value);D.value=await S.getAllMypurchaseOrderReportsFiltered(o,e,s)},M=i([]),O=async(o,e,s)=>{M.value=await S.getpurchaseOrderEntriesBypurchaseOrderID(o);const r=M.value.map(n=>({Producto:n.item_name,Cantidad:n.quantity,"Unidad de medida":n.unit_measure})),_=F.json_to_sheet(r);_["!cols"]=[{wch:Math.max(30,8)},{wch:Math.max(0,8)},{wch:Math.max(0,16)}];const w=F.book_new();F.book_append_sheet(w,_,"Usuarios"),X(w,`Orden_de_compra_${e}_${s} .xlsx`)},j=async()=>{D.value.forEach(e=>{var s;O(e.purchase_order_id,e.site_name,(s=e.expedition_date)==null?void 0:s.split("T")[0])})};return(o,e)=>{const s=c("Button"),r=c("Calendar"),_=c("Dialog"),w=c("InputText"),n=c("Column"),A=c("Tag"),B=c("router-link"),L=c("DataTable");return q(),z(G,null,[a(_,{class:"mx-2",visible:u.value,"onUpdate:visible":e[8]||(e[8]=t=>u.value=t),modal:"",header:"Periodo",style:{width:"25rem"}},{default:d(()=>[l("div",Z,[l("div",ee,[a(s,{text:"",label:"Hoy",onClick:e[0]||(e[0]=t=>x(0)),class:"p-button-text col-12 p-1 m-0"}),a(s,{text:"",label:"Ayer",onClick:e[1]||(e[1]=t=>x(1)),class:"p-button-text col-12 p-1 m-0"}),a(s,{text:"",label:"Últimos 7 días",onClick:e[2]||(e[2]=t=>x(7)),class:"p-button-text col-12 p-1 m-0"}),a(s,{text:"",label:"Últimos 14 días",onClick:e[3]||(e[3]=t=>x(14)),class:"p-button-text col-12 p-1"}),a(s,{text:"",label:"Últimos 28 días",onClick:e[4]||(e[4]=t=>x(28)),class:"p-button-text col-12 p-0"})]),l("div",te,[ae,a(r,{style:{"min-width":"max-content"},modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value=t)},null,8,["modelValue"])]),l("div",se,[le,a(r,{style:{"min-width":"max-content"},modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),showWeek:""},null,8,["modelValue"])]),l("div",oe,[l("div",ne,[a(s,{onClick:e[7]||(e[7]=()=>{I(m.value,p.value),u.value=!1})},{default:d(()=>[V("Aplicar")]),_:1})])])])]),_:1},8,["visible"]),l("div",ie,[l("div",de,[l("div",re,[ce,a(w,{class:"",onClick:e[9]||(e[9]=t=>u.value=!0),style:{height:"2.7rem"},value:`${b(y.value)}  |  ${b(h.value)}`,placeholder:"periodo"},null,8,["value"]),a(s,{onClick:$,icon:"pi pi-search",severity:"help",class:"text-center p-0 col-12 md:p-0",style:{height:"2.5rem",width:"min-content","aspect-ratio":"1 / 1","font-weight":"bold","border-radius":"50%",display:"flex","justify-content":"center"}})]),l("div",pe,[a(s,{severity:"help",icon:"pi pi-download",label:"Descargar todo",onClick:j})])])]),l("div",ue,[a(L,{style:{"max-width":"1024px"},filters:g.value,"onUpdate:filters":e[11]||(e[11]=t=>g.value=t),class:"col-12 m-auto",value:D.value,tableStyle:"min-width: 50rem;",paginator:!0,rows:15,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reportes"},{header:d(()=>[l("div",me,[_e,l("div",ve,[a(w,{style:{width:"100%"},class:"",modelValue:g.value.global.value,"onUpdate:modelValue":e[10]||(e[10]=t=>g.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:d(()=>[a(n,{class:"py-1",field:"purchase_order_id",header:"ID"}),a(n,{class:"py-1",field:"employer_name",header:"Responsable"}),a(n,{class:"py-1",field:"site_name",header:"Sede"}),a(n,{class:"py-1",field:"date",header:"Fecha"},{body:d(t=>{var v;return[l("p",ye,C((v=t.data.expedition_date)==null?void 0:v.split("T")[0]),1)]}),_:1}),a(n,{style:{"min-width":"max-content"},class:"py-1",field:"date",header:"Hora"},{body:d(t=>{var v;return[l("span",he,C((v=t.data.expedition_date)==null?void 0:v.split("T")[1]),1)]}),_:1}),a(n,{class:"py-1",field:"date",header:"Estado"},{body:d(t=>[a(A,{style:Y([{width:"100%",height:"2.7rem"},`background-color:${R[t.data.current_status]}`])},{default:d(()=>[V(C(t.data.current_status),1)]),_:2},1032,["style"])]),_:1}),a(n,{style:{width:"20px"},class:"py-1 mx-0 px-0",field:"date",header:"Acciones"},{body:d(t=>[l("div",ge,[a(B,{to:`/purchase-order/purchase-order-view/${t.data.purchase_order_id}`},{default:d(()=>[a(s,{style:{height:"2rem"},severity:"help",class:"p-1",icon:"pi pi-eye"})]),_:2},1032,["to"]),a(s,{style:{height:"2rem"},onClick:v=>{var P;return O(t.data.purchase_order_id,t.data.site_name,(P=t.data.expedition_date)==null?void 0:P.split("T")[0])},severity:"success",class:"p-1",icon:"pi pi-download"},null,8,["onClick"]),a(s,{style:{height:"2rem"},severity:"warning",class:"p-1",icon:"pi pi-history p-0 m-0"})])]),_:1})]),_:1},8,["filters","value"])])],64)}}},Fe=E(xe,[["__scopeId","data-v-cbad8627"]]);export{Fe as default};
